angular.module("gettext",[]),angular.module("gettext").constant("gettext",function(e){return e}),angular.module("gettext").service("translate",["gettextCatalog",function(t){return function(e){return t.getString(e)}}]),angular.module("gettext").service("translatePlural",["gettextCatalog",function(r){return function(e,t,a){var n={$count:e};return r.getPlural(e,t,a,n)}}]),angular.module("gettext").factory("gettextCatalog",["gettextPlurals","gettextFallbackLanguage","$http","$cacheFactory","$interpolate","$rootScope",function(l,o,t,e,s,a){var n,c="$$noContext",r='<span id="test" title="test" class="tested">test</span>',d=angular.element("<span>"+r+"</span>").html()!==r,u=function(e){return n.debug&&n.currentLanguage!==n.baseLanguage?n.debugPrefix+e:e},f=function(e){return n.showTranslatedMarkers?n.translatedMarkerPrefix+e+n.translatedMarkerSuffix:e};function g(){a.$broadcast("gettextLanguageChanged")}return n={debug:!1,debugPrefix:"[MISSING]: ",showTranslatedMarkers:!1,translatedMarkerPrefix:"[",translatedMarkerSuffix:"]",strings:{},baseLanguage:"en",currentLanguage:"en",cache:e("strings"),setCurrentLanguage:function(e){this.currentLanguage=e,g()},getCurrentLanguage:function(){return this.currentLanguage},setStrings:function(e,t){for(var a in this.strings[e]||(this.strings[e]={}),t){var n=t[a];if(d&&(a=angular.element("<span>"+a+"</span>").html()),angular.isString(n)||angular.isArray(n)){var r={};r[c]=n,n=r}var i=l(e,1);for(var o in n){var s=n[o];angular.isArray(s)||(n[o]=[],n[o][i]=s)}this.strings[e][a]=n}g()},getStringFormFor:function(e,t,a,n){return e?(((this.strings[e]||{})[t]||{})[n||c]||[])[l(e,a)]:null},getString:function(e,t,a){var n=o(this.currentLanguage);return e=this.getStringFormFor(this.currentLanguage,e,1,a)||this.getStringFormFor(n,e,1,a)||u(e),e=t?s(e)(t):e,f(e)},getPlural:function(e,t,a,n,r){var i=o(this.currentLanguage);return t=this.getStringFormFor(this.currentLanguage,t,e,r)||this.getStringFormFor(i,t,e,r)||u(1===e?t:a),n&&(n.$count=e,t=s(t)(n)),f(t)},loadRemote:function(e){return t({method:"GET",url:e,cache:n.cache}).then(function(e){var t=e.data;for(var a in t)n.setStrings(a,t[a]);return e})}}}]),angular.module("gettext").directive("translate",["gettextCatalog","$parse","$animate","$compile","$window",function(g,n,p,h,e){var t=String.prototype.trim?function(e){return"string"==typeof e?e.trim():e}:function(e){return"string"==typeof e?e.replace(/^\s*/,"").replace(/\s*$/,""):e},m=function(e){if("string"!=typeof e)return e;for(e=(e=t(e)).replace("\n"," ");-1<e.indexOf("  ");)e=e.replace("  "," ");return e};function r(e,t,a){if(!e)throw new Error("You should add a "+t+" attribute whenever you add a "+a+" attribute.")}var i=parseInt((/msie (\d+)/.exec(angular.lowercase(e.navigator.userAgent))||[])[1],10);return{restrict:"AE",compile:function(e,t){var d,a;r(!t.translatePlural||t.translateN,"translate-n","translate-plural"),r(!t.translateN||t.translatePlural,"translate-plural","translate-n"),d=t.translate?(a=t.$normalize(t.translate),m(t[a])):m(e.html());var u=t.translatePlural,f=t.translateContext;return i<=8&&"\x3c!--IE fix--\x3e"===d.slice(-13)&&(d=d.slice(0,-13)),{post:function(r,i,o){var s=n(o.translateN),l=null,c=!0;function e(){var e;if(e=u?((r=l||(l=r.$new())).$count=s(r),g.getPlural(r.$count,d,u,null,f)):g.getString(d,null,f),o.translate){if(i.attr(o.translate)===e)return;i.attr(o.translate,e)}else{var t=i.contents();if(0===t.length)return;if(e===m(t.html()))return void(c&&h(t)(r));var a=angular.element("<span>"+e.replace(/{{( *)count\$( *)}}/,"{{$1$$count$2}}")+"</span>");h(a.contents())(r);var n=a.contents();p.enter(n,i),p.leave(t)}}o.translateN&&r.$watch(o.translateN,e),r.$on("gettextLanguageChanged",e),e(),c=!1}}}}}]),angular.module("gettext").factory("gettextFallbackLanguage",function(){var a={},n=/([^_]+)_[^_]+$/;return function(e){if(a[e])return a[e];var t=n.exec(e);return t?(a[e]=t[1],t[1]):null}}),angular.module("gettext").filter("translate",["gettextCatalog",function(a){function e(e,t){return a.getString(e,null,t)}return e.$stateful=!0,e}]),angular.module("gettext").factory("gettextPlurals",function(){return function(e,t){switch(e){case"ay":case"bo":case"cgg":case"dz":case"fa":case"id":case"ja":case"jbo":case"ka":case"kk":case"km":case"ko":case"ky":case"lo":case"ms":case"my":case"sah":case"su":case"th":case"tt":case"ug":case"vi":case"wo":case"zh":return 0;case"is":return t%10!=1||t%100==11?1:0;case"jv":return 0!=t?1:0;case"mk":return 1==t||t%10==1?0:1;case"ach":case"ak":case"am":case"arn":case"br":case"fil":case"fr":case"gun":case"ln":case"mfe":case"mg":case"mi":case"oc":case"pt_BR":case"tg":case"ti":case"tr":case"uz":case"wa":case"zh":return 1<t?1:0;case"lv":return t%10==1&&t%100!=11?0:0!=t?1:2;case"lt":return t%10==1&&t%100!=11?0:2<=t%10&&(t%100<10||20<=t%100)?1:2;case"be":case"bs":case"hr":case"ru":case"sr":case"uk":return t%10==1&&t%100!=11?0:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?1:2;case"mnk":return 0==t?0:1==t?1:2;case"ro":return 1==t?0:0==t||0<t%100&&t%100<20?1:2;case"pl":return 1==t?0:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?1:2;case"cs":case"sk":return 1==t?0:2<=t&&t<=4?1:2;case"sl":return t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0;case"mt":return 1==t?0:0==t||1<t%100&&t%100<11?1:10<t%100&&t%100<20?2:3;case"gd":return 1==t||11==t?0:2==t||12==t?1:2<t&&t<20?2:3;case"cy":return 1==t?0:2==t?1:8!=t&&11!=t?2:3;case"kw":return 1==t?0:2==t?1:3==t?2:3;case"ga":return 1==t?0:2==t?1:t<7?2:t<11?3:4;case"ar":return 0==t?0:1==t?1:2==t?2:3<=t%100&&t%100<=10?3:11<=t%100?4:5;default:return 1!=t?1:0}}}),function(){var r,s,l,f,re,h,c,n,y,v,b,w,d,_,u,g,x,p,e,i,t,a,o,C,A,S,m,ie,k,D,F;re=function(e,t,a,n){return new r(e,t,a,n)},"undefined"!=typeof module&&null!==module&&null!=module.exports&&(module.exports=re),"function"==typeof define&&define.amd?define([],function(){return re}):("undefined"!=typeof exports&&null!==exports?exports:this).chroma=re,re.color=function(e,t,a,n){return new r(e,t,a,n)},re.hsl=function(e,t,a,n){return new r(e,t,a,n,"hsl")},re.hsv=function(e,t,a,n){return new r(e,t,a,n,"hsv")},re.rgb=function(e,t,a,n){return new r(e,t,a,n,"rgb")},re.hex=function(e){return new r(e)},re.css=function(e){return new r(e)},re.lab=function(e,t,a){return new r(e,t,a,"lab")},re.lch=function(e,t,a){return new r(e,t,a,"lch")},re.hsi=function(e,t,a){return new r(e,t,a,"hsi")},re.gl=function(e,t,a,n){return new r(255*e,255*t,255*a,n,"gl")},re.mix=re.interpolate=function(e,t,a,n){return null==e||null==t?"#000":("string"===ie(e)&&(e=new r(e)),"string"===ie(t)&&(t=new r(t)),e.interpolate(a,t,n))},re.contrast=function(e,t){var a,n;return"string"===ie(e)&&(e=new r(e)),"string"===ie(t)&&(t=new r(t)),a=e.luminance(),(n=t.luminance())<a?(a+.05)/(n+.05):(n+.05)/(a+.05)},re.luminance=function(e){return re(e).luminance()},re._Color=r,r=function(){function m(){var e,t,a,n,r,i,o,s,l,c,d,u,f,g,p;for(r=this,a=[],l=0,c=arguments.length;l<c;l++)null!=(t=arguments[l])&&a.push(t);if(0===a.length)i=(d=[255,0,255,1,"rgb"])[0],o=d[1],s=d[2],e=d[3],n=d[4];else if("array"===ie(a[0])){if(3===a[0].length)i=(u=a[0])[0],o=u[1],s=u[2],e=1;else{if(4!==a[0].length)throw"unknown input argument";i=(f=a[0])[0],o=f[1],s=f[2],e=f[3]}n=null!=(g=a[1])?g:"rgb"}else"string"===ie(a[0])?(i=a[0],n="hex"):"object"===ie(a[0])?(i=(p=a[0]._rgb)[0],o=p[1],s=p[2],e=p[3],n="rgb"):3<=a.length&&(i=a[0],o=a[1],s=a[2]);3===a.length?(n="rgb",e=1):4===a.length?"string"===ie(a[3])?(n=a[3],e=1):"number"===ie(a[3])&&(n="rgb",e=a[3]):5===a.length&&(e=a[3],n=a[4]),null==e&&(e=1),"rgb"===n?r._rgb=[i,o,s,e]:"gl"===n?r._rgb=[255*i,255*o,255*s,e]:"hsl"===n?(r._rgb=b(i,o,s),r._rgb[3]=e):"hsv"===n?(r._rgb=w(i,o,s),r._rgb[3]=e):"hex"===n?r._rgb=y(i):"lab"===n?(r._rgb=_(i,o,s),r._rgb[3]=e):"lch"===n?(r._rgb=x(i,o,s),r._rgb[3]=e):"hsi"===n&&(r._rgb=v(i,o,s),r._rgb[3]=e),h(r._rgb)}return m.prototype.rgb=function(){return this._rgb.slice(0,3)},m.prototype.rgba=function(){return this._rgb},m.prototype.hex=function(){return t(this._rgb)},m.prototype.toString=function(){return this.name()},m.prototype.hsl=function(){return o(this._rgb)},m.prototype.hsv=function(){return C(this._rgb)},m.prototype.lab=function(){return A(this._rgb)},m.prototype.lch=function(){return S(this._rgb)},m.prototype.hsi=function(){return a(this._rgb)},m.prototype.gl=function(){return[this._rgb[0]/255,this._rgb[1]/255,this._rgb[2]/255,this._rgb[3]]},m.prototype.luminance=function(){return e(this._rgb)},m.prototype.name=function(){var e,t;for(t in e=this.hex(),re.colors)if(e===re.colors[t])return t;return e},m.prototype.alpha=function(e){return arguments.length?(this._rgb[3]=e,this):this._rgb[3]},m.prototype.css=function(e){var t,a,n;return null==e&&(e="rgb"),a=this._rgb,3===e.length&&a[3]<1&&(e+="a"),"rgb"===e?e+"("+a.slice(0,3).map(Math.round).join(",")+")":"rgba"===e?e+"("+a.slice(0,3).map(Math.round).join(",")+","+a[3]+")":"hsl"===e||"hsla"===e?(n=function(e){return Math.round(100*e)/100},(t=this.hsl())[0]=n(t[0]),t[1]=n(100*t[1])+"%",t[2]=n(100*t[2])+"%",4===e.length&&(t[3]=a[3]),e+"("+t.join(",")+")"):void 0},m.prototype.interpolate=function(e,t,a){var n,r,i,o,s,l,c,d,u,f,g,p,h;if(c=this,null==a&&(a="rgb"),"string"===ie(t)&&(t=new m(t)),"hsl"===a||"hsv"===a||"lch"===a||"hsi"===a)"hsl"===a?(p=c.hsl(),h=t.hsl()):"hsv"===a?(p=c.hsv(),h=t.hsv()):"hsi"===a?(p=c.hsi(),h=t.hsi()):"lch"===a&&(p=c.lch(),h=t.lch()),"h"===a.substr(0,1)?(r=p[0],f=p[1],s=p[2],i=h[0],g=h[1],l=h[2]):(s=p[0],f=p[1],r=p[2],l=h[0],g=h[1],i=h[2]),isNaN(r)||isNaN(i)?isNaN(r)?isNaN(i)?n=Number.NaN:(n=i,1!==s&&0!==s||"hsv"===a||(u=g)):(n=r,1!==l&&0!==l||"hsv"===a||(u=f)):n=r+e*(r<i&&180<i-r?i-(r+360):i<r&&180<r-i?i+360-r:i-r),null==u&&(u=f+e*(g-f)),o=s+e*(l-s),d="h"===a.substr(0,1)?new m(n,u,o,a):new m(o,u,n,a);else if("rgb"===a)p=c._rgb,h=t._rgb,d=new m(p[0]+e*(h[0]-p[0]),p[1]+e*(h[1]-p[1]),p[2]+e*(h[2]-p[2]),a);else{if("lab"!==a)throw"color mode "+a+" is not supported";p=c.lab(),h=t.lab(),d=new m(p[0]+e*(h[0]-p[0]),p[1]+e*(h[1]-p[1]),p[2]+e*(h[2]-p[2]),a)}return d.alpha(c.alpha()+e*(t.alpha()-c.alpha())),d},m.prototype.premultiply=function(){var e,t;return t=this.rgb(),e=this.alpha(),re(t[0]*e,t[1]*e,t[2]*e,e)},m.prototype.darken=function(e){var t;return null==e&&(e=20),(t=this.lch())[0]-=e,re.lch(t).alpha(this.alpha())},m.prototype.darker=function(e){return this.darken(e)},m.prototype.brighten=function(e){return null==e&&(e=20),this.darken(-e)},m.prototype.brighter=function(e){return this.brighten(e)},m.prototype.saturate=function(e){var t;return null==e&&(e=20),(t=this.lch())[1]+=e,re.lch(t).alpha(this.alpha())},m.prototype.desaturate=function(e){return null==e&&(e=20),this.saturate(-e)},m}(),h=function(e){var t;for(t in e)t<3?(e[t]<0&&(e[t]=0),255<e[t]&&(e[t]=255)):3===t&&(e[t]<0&&(e[t]=0),1<e[t]&&(e[t]=1));return e},n=function(e){var t,a,n,r,i,o,s,l;if(e=e.toLowerCase(),null!=re.colors&&re.colors[e])return y(re.colors[e]);if(n=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(r=n.slice(1,4),a=i=0;i<=2;a=++i)r[a]=+r[a];r[3]=1}else if(n=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(r=n.slice(1,5),a=o=0;o<=3;a=++o)r[a]=+r[a];else if(n=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(r=n.slice(1,4),a=s=0;s<=2;a=++s)r[a]=Math.round(2.55*r[a]);r[3]=1}else if(n=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(r=n.slice(1,5),a=l=0;l<=2;a=++l)r[a]=Math.round(2.55*r[a]);r[3]=+r[3]}else(n=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?((t=n.slice(1,4))[1]*=.01,t[2]*=.01,(r=b(t))[3]=1):(n=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&((t=n.slice(1,4))[1]*=.01,t[2]*=.01,(r=b(t))[3]=+n[4]);return r},y=function(e){var t,a;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return 4!==e.length&&7!==e.length||(e=e.substr(1)),3===e.length&&(e=(e=e.split(""))[0]+e[0]+e[1]+e[1]+e[2]+e[2]),[(a=parseInt(e,16))>>16,a>>8&255,255&a,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return 9===e.length&&(e=e.substr(1)),[(a=parseInt(e,16))>>24&255,a>>16&255,a>>8&255,255&a];if(t=n(e))return t;throw"unknown color: "+e},v=function(e,t,a){var n,r,i,o;return e=(o=k(arguments))[0],t=o[1],a=o[2],(e/=360)<1/3?r=1-((n=(1-t)/3)+(i=(1+t*c(l*e)/c(s-l*e))/3)):e<2/3?n=1-((i=(1-t)/3)+(r=(1+t*c(l*(e-=1/3))/c(s-l*e))/3)):i=1-((r=(1-t)/3)+(n=(1+t*c(l*(e-=2/3))/c(s-l*e))/3)),[255*(i=p(a*i*3)),255*(r=p(a*r*3)),255*(n=p(a*n*3))]},b=function(){var e,t,a,n,r,i,o,s,l,c,d,u,f,g;if(n=(f=k(arguments))[0],s=f[1],i=f[2],0===s)o=a=e=255*i;else{for(t=[0,0,0],l=2*i-(c=i<.5?i*(1+s):i+s-i*s),(d=[0,0,0])[0]=(n/=360)+1/3,d[1]=n,d[2]=n-1/3,r=u=0;u<=2;r=++u)d[r]<0&&(d[r]+=1),1<d[r]&&(d[r]-=1),6*d[r]<1?t[r]=l+6*(c-l)*d[r]:2*d[r]<1?t[r]=c:3*d[r]<2?t[r]=l+(c-l)*(2/3-d[r])*6:t[r]=l;o=(g=[Math.round(255*t[0]),Math.round(255*t[1]),Math.round(255*t[2])])[0],a=g[1],e=g[2]}return[o,a,e]},w=function(){var e,t,a,n,r,i,o,s,l,c,d,u,f,g,p,h,m,y;if(n=(u=k(arguments))[0],l=u[1],d=u[2],d*=255,0===l)s=a=e=d;else switch(360===n&&(n=0),360<n&&(n-=360),n<0&&(n+=360),i=d*(1-l),o=d*(1-l*(t=(n/=60)-(r=Math.floor(n)))),c=d*(1-l*(1-t)),r){case 0:s=(f=[d,c,i])[0],a=f[1],e=f[2];break;case 1:s=(g=[o,d,i])[0],a=g[1],e=g[2];break;case 2:s=(p=[i,d,c])[0],a=p[1],e=p[2];break;case 3:s=(h=[i,o,d])[0],a=h[1],e=h[2];break;case 4:s=(m=[c,i,d])[0],a=m[1],e=m[2];break;case 5:s=(y=[d,i,o])[0],a=y[1],e=y[2]}return[s=Math.round(s),a=Math.round(a),e=Math.round(e)]},d=function(){var e,t,a,n;return a=(n=k(arguments))[0],e=n[1],t=n[2],[a,Math.sqrt(e*e+t*t),Math.atan2(t,e)/Math.PI*180]},_=function(e,t,a){var n,r,i,o,s,l,c;return void 0!==e&&3===e.length&&(e=(l=e)[0],t=l[1],a=l[2]),void 0!==e&&3===e.length&&(e=(c=e)[0],t=c[1],a=c[2]),s=(o=(e+16)/116)-a/200,i=.95047*u(i=o+t/500),o=1*u(o),s=1.08883*u(s),r=F(3.2404542*i-1.5371385*o-.4985314*s),n=F(-.969266*i+1.8760108*o+.041556*s),a=F(.0556434*i-.2040259*o+1.0572252*s),[p(r,0,255),p(n,0,255),p(a,0,255),1]},u=function(e){return.206893034<e?e*e*e:(e-4/29)/7.787037},F=function(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))},g=function(){var e,t,a,n;return a=(n=k(arguments))[0],e=n[1],t=(t=n[2])*Math.PI/180,[a,Math.cos(t)*e,Math.sin(t)*e]},x=function(e,t,a){var n,r,i,o,s,l,c;return n=(l=g(e,t,a))[0],r=l[1],i=l[2],s=(c=_(n,r,i))[0],o=c[1],i=c[2],[p(s,0,255),p(o,0,255),p(i,0,255)]},e=function(e,t,a){var n;return e=(n=k(arguments))[0],t=n[1],a=n[2],.2126*(e=i(e))+.7152*(t=i(t))+.0722*(a=i(a))},i=function(e){return(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)},t=function(){var e,t;return"#"+(e="000000"+((t=k(arguments))[0]<<16|t[1]<<8|t[2]).toString(16)).substr(e.length-6)},a=function(){var e,t,a,n,r,i,o,s;return i=(s=k(arguments))[0],a=s[1],t=s[2],e=2*Math.PI,i/=255,a/=255,t/=255,0===(o=1-Math.min(i,a,t)/(r=(i+a+t)/3))?n=0:(n=(i-a+(i-t))/2,n/=Math.sqrt((i-a)*(i-a)+(i-t)*(a-t)),n=Math.acos(n),a<t&&(n=e-n),n/=e),[360*n,o,r]},o=function(e,t,a){var n,r,i,o,s,l;return void 0!==e&&3<=e.length&&(e=(l=e)[0],t=l[1],a=l[2]),e/=255,t/=255,a/=255,o=Math.min(e,t,a),r=((i=Math.max(e,t,a))+o)/2,i===o?(s=0,n=Number.NaN):s=r<.5?(i-o)/(i+o):(i-o)/(2-i-o),e===i?n=(t-a)/(i-o):t===i?n=2+(a-e)/(i-o):a===i&&(n=4+(e-t)/(i-o)),(n*=60)<0&&(n+=360),[n,s,r]},C=function(){var e,t,a,n,r,i,o,s,l,c;return o=(c=k(arguments))[0],a=c[1],e=c[2],i=Math.min(o,a,e),t=(r=Math.max(o,a,e))-i,l=r/255,0===r?(n=Number.NaN,s=0):(s=t/r,o===r&&(n=(a-e)/t),a===r&&(n=2+(e-o)/t),e===r&&(n=4+(o-a)/t),(n*=60)<0&&(n+=360)),[n,s,l]},A=function(){var e,t,a,n,r,i;return a=(i=k(arguments))[0],t=i[1],e=i[2],a=m(a),t=m(t),e=m(e),n=D((.4124564*a+.3575761*t+.1804375*e)/.95047),[116*(r=D((.2126729*a+.7151522*t+.072175*e)/1))-16,500*(n-r),200*(r-D((.0193339*a+.119192*t+.9503041*e)/1.08883))]},m=function(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},D=function(e){return.008856<e?Math.pow(e,1/3):7.787037*e+4/29},S=function(){var e,t,a,n,r,i,o;return r=(i=k(arguments))[0],a=i[1],t=i[2],n=(o=A(r,a,t))[0],e=o[1],t=o[2],d(n,e,t)},re.scale=function(s,e){var l,c,d,u,a,i,f,g,p,t,h,m,y,v,b,w,n,_,o;return v="rgb",b=re("#ccc"),!1,h=[o=0,1],n=!(p=[]),_=[],t=!(m=1),w=y=0,g={},a=function(e,t){var a,n,r,i,o,s,l;if(null==e&&(e=["#ddd","#222"]),null!=e&&"string"===ie(e)&&null!=(null!=(o=re.brewer)?o[e]:void 0)&&(e=re.brewer[e]),"array"===ie(e)){for(a=r=0,s=(e=e.slice(0)).length-1;0<=s?r<=s:s<=r;a=0<=s?++r:--r)n=e[a],"string"===ie(n)&&(e[a]=re(n));if(null!=t)_=t;else for(_=[],a=i=0,l=e.length-1;0<=l?i<=l:l<=i;a=0<=l?++i:--i)_.push(a/(e.length-1))}return u(),p=e},i=function(e){return null==e&&(e=[]),y=(h=e)[0],m=e[e.length-1],u(),w=2===e.length?0:e.length-1},c=function(e){var t,a;if(null==h)return 0;for(a=h.length-1,t=0;t<a&&e>=h[t];)t++;return t-1},f=function(e){return e},function(e){var t,a,n,r,i;return i=e,2<h.length&&(r=h.length-1,t=c(e),n=h[0]+(h[1]-h[0])*(0+.5*o),a=h[r-1]+(h[r]-h[r-1])*(1-.5*o),i=y+(h[t]+.5*(h[t+1]-h[t])-n)/(a-n)*(m-y)),i},d=function(e,t){var a,n,r,i,o,s,l;if(null==t&&(t=!1),isNaN(e))return b;if(o=t?e:2<h.length?c(e)/(w-1):m!==y?(o=(e-y)/(m-y),Math.min(1,Math.max(0,o))):y,t||(o=f(o)),r=Math.floor(1e4*o),g[r])a=g[r];else{if("array"===ie(p))for(n=s=0,l=_.length-1;0<=l?s<=l:l<=s;n=0<=l?++s:--s){if(o<=(i=_[n])){a=p[n];break}if(i<=o&&n===_.length-1){a=p[n];break}if(i<o&&o<_[n+1]){o=(o-i)/(_[n+1]-i),a=re.interpolate(p[n],p[n+1],o,v);break}}else"function"===ie(p)&&(a=p(o));g[r]=a}return a},u=function(){return g={}},a(s,e),(l=function(e){var t;return t=d(e),n&&t[n]?t[n]():t}).domain=function(e,t,a,n){var r;return null==a&&(a="e"),arguments.length?(null!=t&&(r=re.analyze(e,n),e=0===t?[r.min,r.max]:re.limits(r,a,t)),i(e),l):h},l.mode=function(e){return arguments.length?(v=e,u(),l):v},l.range=function(e,t){return a(e,t),l},l.out=function(e){return n=e,l},l.spread=function(e){return arguments.length?(o=e,l):o},l.correctLightness=function(e){return arguments.length?(t=e,u(),f=t?function(e){var t,a,n,r,i,o,s,l,c;for(t=d(0,!0).lab()[0],a=d(1,!0).lab()[0],s=a<t,n=d(e,!0).lab()[0],r=n-(i=t+(a-t)*e),l=0,c=1,o=20;.01<Math.abs(r)&&0<o--;)s&&(r*=-1),e+=r<0?.5*(c-(l=e)):.5*(l-(c=e)),n=d(e,!0).lab()[0],r=n-i;return e}:function(e){return e},l):t},l.colors=function(e){var t,a,n,r,i,o;if(null==e&&(e="hex"),s=[],a=[],2<h.length)for(t=n=1,o=h.length;1<=o?n<o:o<n;t=1<=o?++n:--n)a.push(.5*(h[t-1]+h[t]));else a=h;for(r=0,i=a.length;r<i;r++)t=a[r],s.push(l(t)[e]());return s},l},null==re.scales&&(re.scales={}),re.scales.cool=function(){return re.scale([re.hsl(180,1,.9),re.hsl(250,.7,.4)])},re.scales.hot=function(){return re.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},re.analyze=function(e,a,n){var r,t,i,o,s,l;if(i={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},null==n&&(n=function(){return!0}),r=function(e){null==e||isNaN(e)||(i.values.push(e),i.sum+=e,e<i.min&&(i.min=e),e>i.max&&(i.max=e),i.count+=1)},o=function(e,t){if(n(e,t))return null!=a&&"function"===ie(a)?r(a(e)):null!=a&&"string"===ie(a)||"number"===ie(a)?r(e[a]):r(e)},"array"===ie(e))for(s=0,l=e.length;s<l;s++)o(e[s]);else for(t in e)o(e[t],t);return i.domain=[i.min,i.max],i.limits=function(e,t){return re.limits(i,e,t)},i},re.limits=function(e,t,a){var n,r,i,o,s,l,c,d,u,f,g,p,h,m,y,v,b,w,_,x,C,A,S,k,D,F,M,E,L,O,T,P,$,R,I,B,U,N,j,z,Y,q,V,G,H,W,Z,K,J,Q,X,ee,te,ae,ne;if(null==t&&(t="equal"),null==a&&(a=7),"array"===ie(e)&&(e=re.analyze(e)),h=e.min,g=e.max,e.sum,D=e.values.sort(function(e,t){return e-t}),f=[],"c"===t.substr(0,1)&&(f.push(h),f.push(g)),"e"===t.substr(0,1)){for(f.push(h),c=F=1,B=a-1;1<=B?F<=B:B<=F;c=1<=B?++F:--F)f.push(h+c/a*(g-h));f.push(g)}else if("l"===t.substr(0,1)){if(h<=0)throw"Logarithmic scales are only possible for values > 0";for(m=Math.LOG10E*Math.log(h),p=Math.LOG10E*Math.log(g),f.push(h),c=M=1,V=a-1;1<=V?M<=V:V<=M;c=1<=V?++M:--M)f.push(Math.pow(10,m+c/a*(p-m)));f.push(g)}else if("q"===t.substr(0,1)){for(f.push(h),c=E=1,G=a-1;1<=G?E<=G:G<=E;c=1<=G?++E:--E)_=D.length*c/a,(x=Math.floor(_))===_?f.push(D[x]):(C=_-x,f.push(D[x]*C+D[x+1]*(1-C)));f.push(g)}else if("k"===t.substr(0,1)){for(v=D.length,n=new Array(v),s=new Array(a),A=!0,b=0,i=null,(i=[]).push(h),c=L=1,H=a-1;1<=H?L<=H:H<=L;c=1<=H?++L:--L)i.push(h+c/a*(g-h));for(i.push(g);A;){for(d=O=0,W=a-1;0<=W?O<=W:W<=O;d=0<=W?++O:--O)s[d]=0;for(c=T=0,Z=v-1;0<=Z?T<=Z:Z<=T;c=0<=Z?++T:--T){for(k=D[c],y=Number.MAX_VALUE,d=P=0,K=a-1;0<=K?P<=K:K<=P;d=0<=K?++P:--P)(l=Math.abs(i[d]-k))<y&&(y=l,r=d);s[r]++,n[c]=r}for(w=new Array(a),d=$=0,J=a-1;0<=J?$<=J:J<=$;d=0<=J?++$:--$)w[d]=null;for(c=R=0,Q=v-1;0<=Q?R<=Q:Q<=R;c=0<=Q?++R:--R)null===w[o=n[c]]?w[o]=D[c]:w[o]+=D[c];for(d=I=0,U=a-1;0<=U?I<=U:U<=I;d=0<=U?++I:--I)w[d]*=1/s[d];for(A=!1,d=X=0,N=a-1;0<=N?X<=N:N<=X;d=0<=N?++X:--X)if(w[d]!==i[c]){A=!0;break}i=w,200<++b&&(A=!1)}for(u={},d=ee=0,j=a-1;0<=j?ee<=j:j<=ee;d=0<=j?++ee:--ee)u[d]=[];for(c=te=0,z=v-1;0<=z?te<=z:z<=te;c=0<=z?++te:--te)u[o=n[c]].push(D[c]);for(S=[],d=ae=0,Y=a-1;0<=Y?ae<=Y:Y<=ae;d=0<=Y?++ae:--ae)S.push(u[d][0]),S.push(u[d][u[d].length-1]);for(S=S.sort(function(e,t){return e-t}),f.push(S[0]),c=ne=1,q=S.length-1;ne<=q;c=ne+=2)isNaN(S[c])||f.push(S[c])}return f},re.brewer={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},re.colors={indigo:"#4b0082",gold:"#ffd700",hotpink:"#ff69b4",firebrick:"#b22222",indianred:"#cd5c5c",yellow:"#ffff00",mistyrose:"#ffe4e1",darkolivegreen:"#556b2f",olive:"#808000",darkseagreen:"#8fbc8f",pink:"#ffc0cb",tomato:"#ff6347",lightcoral:"#f08080",orangered:"#ff4500",navajowhite:"#ffdead",lime:"#00ff00",palegreen:"#98fb98",darkslategrey:"#2f4f4f",greenyellow:"#adff2f",burlywood:"#deb887",seashell:"#fff5ee",mediumspringgreen:"#00fa9a",fuchsia:"#ff00ff",papayawhip:"#ffefd5",blanchedalmond:"#ffebcd",chartreuse:"#7fff00",dimgray:"#696969",black:"#000000",peachpuff:"#ffdab9",springgreen:"#00ff7f",aquamarine:"#7fffd4",white:"#ffffff",orange:"#ffa500",lightsalmon:"#ffa07a",darkslategray:"#2f4f4f",brown:"#a52a2a",ivory:"#fffff0",dodgerblue:"#1e90ff",peru:"#cd853f",lawngreen:"#7cfc00",chocolate:"#d2691e",crimson:"#dc143c",forestgreen:"#228b22",darkgrey:"#a9a9a9",lightseagreen:"#20b2aa",cyan:"#00ffff",mintcream:"#f5fffa",silver:"#c0c0c0",antiquewhite:"#faebd7",mediumorchid:"#ba55d3",skyblue:"#87ceeb",gray:"#808080",darkturquoise:"#00ced1",goldenrod:"#daa520",darkgreen:"#006400",floralwhite:"#fffaf0",darkviolet:"#9400d3",darkgray:"#a9a9a9",moccasin:"#ffe4b5",saddlebrown:"#8b4513",grey:"#808080",darkslateblue:"#483d8b",lightskyblue:"#87cefa",lightpink:"#ffb6c1",mediumvioletred:"#c71585",slategrey:"#708090",red:"#ff0000",deeppink:"#ff1493",limegreen:"#32cd32",darkmagenta:"#8b008b",palegoldenrod:"#eee8aa",plum:"#dda0dd",turquoise:"#40e0d0",lightgrey:"#d3d3d3",lightgoldenrodyellow:"#fafad2",darkgoldenrod:"#b8860b",lavender:"#e6e6fa",maroon:"#800000",yellowgreen:"#9acd32",sandybrown:"#f4a460",thistle:"#d8bfd8",violet:"#ee82ee",navy:"#000080",magenta:"#ff00ff",dimgrey:"#696969",tan:"#d2b48c",rosybrown:"#bc8f8f",olivedrab:"#6b8e23",blue:"#0000ff",lightblue:"#add8e6",ghostwhite:"#f8f8ff",honeydew:"#f0fff0",cornflowerblue:"#6495ed",slateblue:"#6a5acd",linen:"#faf0e6",darkblue:"#00008b",powderblue:"#b0e0e6",seagreen:"#2e8b57",darkkhaki:"#bdb76b",snow:"#fffafa",sienna:"#a0522d",mediumblue:"#0000cd",royalblue:"#4169e1",lightcyan:"#e0ffff",green:"#008000",mediumpurple:"#9370db",midnightblue:"#191970",cornsilk:"#fff8dc",paleturquoise:"#afeeee",bisque:"#ffe4c4",slategray:"#708090",darkcyan:"#008b8b",khaki:"#f0e68c",wheat:"#f5deb3",teal:"#008080",darkorchid:"#9932cc",deepskyblue:"#00bfff",salmon:"#fa8072",darkred:"#8b0000",steelblue:"#4682b4",palevioletred:"#db7093",lightslategray:"#778899",aliceblue:"#f0f8ff",lightslategrey:"#778899",lightgreen:"#90ee90",orchid:"#da70d6",gainsboro:"#dcdcdc",mediumseagreen:"#3cb371",lightgray:"#d3d3d3",mediumturquoise:"#48d1cc",lemonchiffon:"#fffacd",cadetblue:"#5f9ea0",lightyellow:"#ffffe0",lavenderblush:"#fff0f5",coral:"#ff7f50",purple:"#800080",aqua:"#00ffff",whitesmoke:"#f5f5f5",mediumslateblue:"#7b68ee",darkorange:"#ff8c00",mediumaquamarine:"#66cdaa",darksalmon:"#e9967a",beige:"#f5f5dc",blueviolet:"#8a2be2",azure:"#f0ffff",lightsteelblue:"#b0c4de",oldlace:"#fdf5e6"},ie=function(){var a,e,t,n,r;for(a={},t=0,n=(r="Boolean Number String Function Array Date RegExp Undefined Null".split(" ")).length;t<n;t++)e=r[t],a["[object "+e+"]"]=e.toLowerCase();return function(e){var t;return t=Object.prototype.toString.call(e),a[t]||"object"}}(),p=function(e,t,a){return null==t&&(t=0),null==a&&(a=1),e<t&&(e=t),a<e&&(e=a),e},k=function(e){return 3<=e.length?e:e[0]},l=2*Math.PI,s=Math.PI/3,c=Math.cos,f=function(n){var e,t,a,r,i,o,s,l,c,d,u;return 2===(n=function(){var e,t,a;for(a=[],e=0,t=n.length;e<t;e++)r=n[e],a.push(re(r));return a}()).length?(c=function(){var e,t,a;for(a=[],e=0,t=n.length;e<t;e++)r=n[e],a.push(r.lab());return a}(),i=c[0],o=c[1],e=function(a){var n,e;return e=function(){var e,t;for(t=[],n=e=0;e<=2;n=++e)t.push(i[n]+a*(o[n]-i[n]));return t}(),re.lab.apply(re,e)}):3===n.length?(d=function(){var e,t,a;for(a=[],e=0,t=n.length;e<t;e++)r=n[e],a.push(r.lab());return a}(),i=d[0],o=d[1],s=d[2],e=function(a){var n,e;return e=function(){var e,t;for(t=[],n=e=0;e<=2;n=++e)t.push((1-a)*(1-a)*i[n]+2*(1-a)*a*o[n]+a*a*s[n]);return t}(),re.lab.apply(re,e)}):4===n.length?(u=function(){var e,t,a;for(a=[],e=0,t=n.length;e<t;e++)r=n[e],a.push(r.lab());return a}(),i=u[0],o=u[1],s=u[2],l=u[3],e=function(a){var n,e;return e=function(){var e,t;for(t=[],n=e=0;e<=2;n=++e)t.push((1-a)*(1-a)*(1-a)*i[n]+3*(1-a)*(1-a)*a*o[n]+3*(1-a)*a*a*s[n]+a*a*a*l[n]);return t}(),re.lab.apply(re,e)}):5===n.length&&(t=f(n.slice(0,3)),a=f(n.slice(2,5)),e=function(e){return e<.5?t(2*e):a(2*(e-.5))}),e},re.interpolate.bezier=f}.call(this),function(e){var n={}.hasOwnProperty,f=function(a,e){return e&&function(e,t){var a;for(a in e)n.call(e,a)&&t(a,e[a])}(e,function(e,t){a[e]=t}),a},g=/["'\\\b\f\n\r\t]/,p=/[ !#-&\(-\[\]-~]/,t=function(e,t){var a,n=t&&t.json;t=f({es6:!1,json:!1},t);var r,i,o=e,s=-1,l=o.length;for(a="";++s<l;){var c=o.charAt(s);if(t.es6&&55296<=(r=o.charCodeAt(s))&&r<=56319&&s+1<l&&56320<=(i=o.charCodeAt(s+1))&&i<=57343)a+="\\u{"+(1024*(r-55296)+i-56320+65536).toString(16).toUpperCase()+"}",s++;else if(p.test(c))a+=c;else if('"'!=c)if("'"!=c)if(g.test(c))a+=c;else{var d=c.charCodeAt(0).toString(16).toUpperCase(),u=2<d.length||n;a+="\\"+(u?"u":"x")+("0000"+d).slice(u?-4:-2)}else a+=c;else a+=c}return a};t.version="0.5.0",e.jsesc=t}(this),function(e){var s=function(){"use strict";var r=function(e){var t=-e.getTimezoneOffset();return null!==t?t:0},t=function(e,t,a){var n=new Date;return void 0!==e&&n.setFullYear(e),n.setMonth(t),n.setDate(a),n},i=function(e){return r(t(e,0,2))},o=function(e){return r(t(e,5,2))};return{determine:function(){var e,t,a,n=(e=i(),t=o(),(a=e-t)<0?e+",1":0<a?t+",1,s":e+",0");return new s.TimeZone(s.olson.timezones[n])},date_is_dst:function(e){var t=7<e.getMonth(),a=t?o(e.getFullYear()):i(e.getFullYear()),n=a-r(e);return a<0||t?0!==n:n<0},dst_start_for:function(e){var t=new Date(2010,6,15,1,0,0,0);return{"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"America/Asuncion":new Date(2012,9,7,3,0,0,0),"America/Santiago":new Date(2012,9,3,3,0,0,0),"America/Campo_Grande":new Date(2012,9,21,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2012,2,10,2,0,0,0),"America/New_York":new Date(2012,2,10,7,0,0,0),"Europe/Helsinki":new Date(2013,2,31,5,0,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0),"Europe/Moscow":t,"Asia/Amman":new Date(2013,2,29,1,0,0,0),"Asia/Beirut":new Date(2013,2,31,2,0,0,0),"Asia/Damascus":new Date(2013,3,6,2,0,0,0),"Asia/Jerusalem":new Date(2013,2,29,5,0,0,0),"Asia/Yekaterinburg":t,"Asia/Omsk":t,"Asia/Krasnoyarsk":t,"Asia/Irkutsk":t,"Asia/Yakutsk":t,"Asia/Vladivostok":t,"Asia/Baku":new Date(2013,2,31,4,0,0),"Asia/Yerevan":new Date(2013,2,31,3,0,0),"Asia/Kamchatka":t,"Asia/Gaza":new Date(2010,2,27,4,0,0),"Africa/Cairo":new Date(2010,4,1,3,0,0),"Europe/Minsk":t,"Pacific/Apia":new Date(2010,10,1,1,0,0,0),"Pacific/Fiji":new Date(2010,11,1,0,0,0),"Australia/Perth":new Date(2008,10,1,1,0,0,0)}[e]}}}();s.TimeZone=function(e){"use strict";var r={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Santiago":["America/Santiago","America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Asia/Beirut","Europe/Helsinki","Asia/Damascus"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"],"Asia/Dubai":["Europe/Moscow"],"Asia/Dhaka":["Asia/Yekaterinburg"],"Asia/Jakarta":["Asia/Omsk"],"Asia/Shanghai":["Asia/Krasnoyarsk","Australia/Perth"],"Asia/Tokyo":["Asia/Irkutsk"],"Australia/Brisbane":["Asia/Yakutsk"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Tarawa":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk"],"Asia/Baku":["Asia/Yerevan","Asia/Baku"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},i=e;return void 0!==r[i]&&function(){for(var e=r[i],t=e.length,a=0,n=e[0];a<t;a+=1)if(n=e[a],s.date_is_dst(s.dst_start_for(n)))return i=n}(),{name:function(){return i}}},s.olson={},s.olson.timezones={"-720,0":"Pacific/Majuro","-660,0":"Pacific/Pago_Pago","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Tarawa","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},"undefined"!=typeof exports?exports.jstz=s:e.jstz=s}(this),LazyLoad=function(h){var m,y,v={},r=0,b={css:[],js:[]},a=h.styleSheets;function w(e,t){var a,n=h.createElement(e);for(a in t)t.hasOwnProperty(a)&&n.setAttribute(a,t[a]);return n}function _(e){var t,a,n=v[e];n&&(t=n.callback,(a=n.urls).shift(),r=0,a.length||(t&&t.call(n.context,n.obj),v[e]=null,b[e].length&&i(e)))}function i(e,t,a,n,r){var i,o,s,l,c,d,u,f=function(){_(e)},g="css"===e,p=[];if(m||(u=navigator.userAgent,((m={async:!0===h.createElement("script").async}).webkit=/AppleWebKit\//.test(u))||(m.ie=/MSIE|Trident/.test(u))||(m.opera=/Opera/.test(u))||(m.gecko=/Gecko\//.test(u))||(m.unknown=!0)),t)if(t="string"==typeof t?[t]:t.concat(),g||m.async||m.gecko||m.opera)b[e].push({urls:t,callback:a,obj:n,context:r});else for(i=0,o=t.length;i<o;++i)b[e].push({urls:[t[i]],callback:i===o-1?a:null,obj:n,context:r});if(!v[e]&&(l=v[e]=b[e].shift())){for(y||(y=h.head||h.getElementsByTagName("head")[0]),i=0,o=(c=l.urls.concat()).length;i<o;++i)d=c[i],g?s=m.gecko?w("style"):w("link",{href:d,rel:"stylesheet"}):(s=w("script",{src:d})).async=!1,s.className="lazyload",s.setAttribute("charset","utf-8"),m.ie&&!g&&"onreadystatechange"in s&&!("draggable"in s)?s.onreadystatechange=function(){/loaded|complete/.test(s.readyState)&&(s.onreadystatechange=null,f())}:g&&(m.gecko||m.webkit)?m.webkit?(l.urls[i]=s.href,C()):(s.innerHTML='@import "'+d+'";',x(s)):s.onload=s.onerror=f,p.push(s);for(i=0,o=p.length;i<o;++i)y.appendChild(p[i])}}function x(t){var a;try{a=!!t.sheet.cssRules}catch(e){return void((r+=1)<200?setTimeout(function(){x(t)},50):a&&_("css"))}_("css")}function C(){var e,t=v.css;if(t){for(e=a.length;0<=--e;)if(a[e].href===t.urls[0]){_("css");break}r+=1,t&&(r<200?setTimeout(C,50):_("css"))}}return{css:function(e,t,a,n){i("css",e,t,a,n)},js:function(e,t,a,n){i("js",e,t,a,n)}}}(this.document),window.Modernizr=function(e,t,n){var a,r,i={},o=t.documentElement,s=t.createElement("modernizr"),l=s.style,c="http://www.w3.org/2000/svg",d={},u=[],f=u.slice,g={}.hasOwnProperty;function p(e){l.cssText=e}function h(e,t){return typeof e===t}for(var m in r=h(g,"undefined")||h(g.call,"undefined")?function(e,t){return t in e&&h(e.constructor.prototype[t],"undefined")}:function(e,t){return g.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(n){var r=this;if("function"!=typeof r)throw new TypeError;var i=f.call(arguments,1),o=function(){if(this instanceof o){var e=function(){};e.prototype=r.prototype;var t=new e,a=r.apply(t,i.concat(f.call(arguments)));return Object(a)===a?a:t}return r.apply(n,i.concat(f.call(arguments)))};return o}),d.geolocation=function(){return"geolocation"in navigator},d.svg=function(){return!!t.createElementNS&&!!t.createElementNS(c,"svg").createSVGRect},d.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==c},d)r(d,m)&&(a=m.toLowerCase(),i[a]=d[m](),u.push((i[a]?"":"no-")+a));return i.addTest=function(e,t){if("object"==typeof e)for(var a in e)r(e,a)&&i.addTest(a,e[a]);else{if(e=e.toLowerCase(),i[e]!==n)return i;t="function"==typeof t?t():t,o.className+=" "+(t?"":"no-")+e,i[e]=t}return i},p(""),s=null,function(e,l){var c,d,t=e.html5||{},r=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,i=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,a="_html5shiv",n=0,o={};function u(){var e=p.elements;return"string"==typeof e?e.split(" "):e}function f(e){var t=o[e[a]];return t||(t={},n++,e[a]=n,o[n]=t),t}function g(e,t,a){return t||(t=l),d?t.createElement(e):(a||(a=f(t)),!(n=a.cache[e]?a.cache[e].cloneNode():i.test(e)?(a.cache[e]=a.createElem(e)).cloneNode():a.createElem(e)).canHaveChildren||r.test(e)||n.tagUrn?n:a.frag.appendChild(n));var n}function s(e){e||(e=l);var t,a,n,r,i,o,s=f(e);return!p.shivCSS||c||s.hasCSS||(s.hasCSS=(a="article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}",n=(t=e).createElement("p"),r=t.getElementsByTagName("head")[0]||t.documentElement,n.innerHTML="x<style>"+a+"</style>",!!r.insertBefore(n.lastChild,r.firstChild))),d||(i=e,(o=s).cache||(o.cache={},o.createElem=i.createElement,o.createFrag=i.createDocumentFragment,o.frag=o.createFrag()),i.createElement=function(e){return p.shivMethods?g(e,i,o):o.createElem(e)},i.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+u().join().replace(/[\w\-]+/g,function(e){return o.createElem(e),o.frag.createElement(e),'c("'+e+'")'})+");return n}")(p,o.frag)),e}!function(){try{var e=l.createElement("a");e.innerHTML="<xyz></xyz>",c="hidden"in e,d=1==e.childNodes.length||function(){l.createElement("a");var e=l.createDocumentFragment();return void 0===e.cloneNode||void 0===e.createDocumentFragment||void 0===e.createElement}()}catch(e){d=c=!0}}();var p={elements:t.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:"3.7.0",shivCSS:!1!==t.shivCSS,supportsUnknownElements:d,shivMethods:!1!==t.shivMethods,type:"default",shivDocument:s,createElement:g,createDocumentFragment:function(e,t){if(e||(e=l),d)return e.createDocumentFragment();for(var a=(t=t||f(e)).frag.cloneNode(),n=0,r=u(),i=r.length;n<i;n++)a.createElement(r[n]);return a}};e.html5=p,s(l)}(this,t),i._version="2.8.3",o.className=o.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+" js "+u.join(" "),i}(0,this.document),function(e,f,t){function u(e){return"[object Function]"==i.call(e)}function g(e){return"string"==typeof e}function p(){}function h(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function m(){var e=w.shift();_=1,e?e.t?v(function(){("c"==e.t?y.injectCss:y.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),m()):_=0}function a(e,t,a,n,r){return _=0,t=t||"j",g(e)?function(a,n,e,t,r,i,o){function s(e){if(!c&&h(l.readyState)&&(u.r=c=1,!_&&m(),l.onload=l.onreadystatechange=null,e))for(var t in"img"!=a&&v(function(){C.removeChild(l)},50),k[n])k[n].hasOwnProperty(t)&&k[n][t].onload()}o=o||y.errorTimeout;var l=f.createElement(a),c=0,d=0,u={t:e,s:n,e:r,a:i,x:o};1===k[n]&&(d=1,k[n]=[]),"object"==a?l.data=n:(l.src=n,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){s.call(this,d)},w.splice(t,0,u),"img"!=a&&(d||2===k[n]?(C.insertBefore(l,x?null:b),v(s,o)):k[n].push(l))}("c"==t?c:l,e,t,this.i++,a,n,r):(w.splice(this.i++,0,e),1==w.length&&m()),this}function s(){var e=y;return e.loader={load:a,i:0},e}var n,y,r=f.documentElement,v=e.setTimeout,b=f.getElementsByTagName("script")[0],i={}.toString,w=[],_=0,o="MozAppearance"in r.style,x=o&&!!f.createRange().compareNode,C=x?r:b.parentNode,l=(r=e.opera&&"[object Opera]"==i.call(e.opera),r=!!f.attachEvent&&!r,o?"object":r?"script":"img"),c=r?"script":l,A=Array.isArray||function(e){return"[object Array]"==i.call(e)},S=[],k={},D={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};(y=function(e){function d(e,t,a,n,r){var i=function(e){e=e.split("!");var t,a,n,r=S.length,i=e.pop(),o=e.length;for(i={url:i,origUrl:i,prefixes:e},a=0;a<o;a++)n=e[a].split("="),(t=D[n.shift()])&&(i=t(i,n));for(a=0;a<r;a++)i=S[a](i);return i}(e),o=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(t&&(t=u(t)?t:t[e]||t[n]||t[e.split("/").pop().split("?")[0]]),i.instead?i.instead(e,t,a,n,r):(k[i.url]?i.noexec=!0:k[i.url]=1,a.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":void 0,i.noexec,i.attrs,i.timeout),(u(t)||u(o))&&a.load(function(){s(),t&&t(i.origUrl,r,n),o&&o(i.origUrl,r,n),k[i.url]=2})))}function t(e,t){function a(a,e){if(a){if(g(a))e||(s=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}),d(a,s,t,0,i);else if(Object(a)===a)for(r in n=function(){var e,t=0;for(e in a)a.hasOwnProperty(e)&&t++;return t}(),a)a.hasOwnProperty(r)&&(!e&&!--n&&(u(s)?s=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}:s[r]=function(t){return function(){var e=[].slice.call(arguments);t&&t.apply(this,e),c()}}(l[r])),d(a[r],s,t,r,i))}else!e&&c()}var n,r,i=!!e.test,o=e.load||e.both,s=e.callback||p,l=s,c=e.complete||p;a(i?e.yep:e.nope,!!o),o&&a(o)}var a,n,r=this.yepnope.loader;if(g(e))d(e,0,r,0);else if(A(e))for(a=0;a<e.length;a++)g(n=e[a])?d(n,0,r,0):A(n)?y(n):Object(n)===n&&t(n,r);else Object(e)===e&&t(e,r)}).addPrefix=function(e,t){D[e]=t},y.addFilter=function(e){S.push(e)},y.errorTimeout=1e4,null==f.readyState&&f.addEventListener&&(f.readyState="loading",f.addEventListener("DOMContentLoaded",n=function(){f.removeEventListener("DOMContentLoaded",n,0),f.readyState="complete"},0)),e.yepnope=s(),e.yepnope.executeStack=m,e.yepnope.injectJs=function(e,t,a,n,r,i){var o,s,l=f.createElement("script");n=n||y.errorTimeout;for(s in l.src=e,a)l.setAttribute(s,a[s]);t=i?m:t||p,l.onreadystatechange=l.onload=function(){!o&&h(l.readyState)&&(o=1,t(),l.onload=l.onreadystatechange=null)},v(function(){o||t(o=1)},n),r?l.onload():b.parentNode.insertBefore(l,b)},e.yepnope.injectCss=function(e,t,a,n,r,i){var o;n=f.createElement("link"),t=i?m:t||p;for(o in n.href=e,n.rel="stylesheet",n.type="text/css",a)n.setAttribute(o,a[o]);r||(b.parentNode.insertBefore(n,b),v(t,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("cors",!!(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest)),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){"use strict";var e,r;function f(){return e.apply(null,arguments)}function s(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function l(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function c(e){return void 0===e}function d(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function g(e,t){var a,n=[];for(a=0;a<e.length;++a)n.push(t(e[a],a));return n}function p(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function h(e,t){for(var a in t)p(t,a)&&(e[a]=t[a]);return p(t,"toString")&&(e.toString=t.toString),p(t,"valueOf")&&(e.valueOf=t.valueOf),e}function m(e,t,a,n){return kt(e,t,a,n,!0).utc()}function y(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function v(e){if(null==e._isValid){var t=y(e),a=r.call(t.parsedDateParts,function(e){return null!=e}),n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&a);if(e._strict&&(n=n&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return n;e._isValid=n}return e._isValid}function b(e){var t=m(NaN);return null!=e?h(y(t),e):y(t).userInvalidated=!0,t}r=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),a=t.length>>>0,n=0;n<a;n++)if(n in t&&e.call(this,t[n],n,t))return!0;return!1};var i=f.momentProperties=[];function w(e,t){var a,n,r;if(c(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),c(t._i)||(e._i=t._i),c(t._f)||(e._f=t._f),c(t._l)||(e._l=t._l),c(t._strict)||(e._strict=t._strict),c(t._tzm)||(e._tzm=t._tzm),c(t._isUTC)||(e._isUTC=t._isUTC),c(t._offset)||(e._offset=t._offset),c(t._pf)||(e._pf=y(t)),c(t._locale)||(e._locale=t._locale),0<i.length)for(a=0;a<i.length;a++)c(r=t[n=i[a]])||(e[n]=r);return e}var t=!1;function _(e){w(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===t&&(t=!0,f.updateOffset(this),t=!1)}function x(e){return e instanceof _||null!=e&&null!=e._isAMomentObject}function C(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function A(e){var t=+e,a=0;return 0!==t&&isFinite(t)&&(a=C(t)),a}function o(e,t,a){var n,r=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),o=0;for(n=0;n<r;n++)(a&&e[n]!==t[n]||!a&&A(e[n])!==A(t[n]))&&o++;return o+i}function S(e){!1===f.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function a(r,i){var o=!0;return h(function(){if(null!=f.deprecationHandler&&f.deprecationHandler(null,r),o){for(var e,t=[],a=0;a<arguments.length;a++){if(e="","object"==typeof arguments[a]){for(var n in e+="\n["+a+"] ",arguments[0])e+=n+": "+arguments[0][n]+", ";e=e.slice(0,-2)}else e=arguments[a];t.push(e)}S(r+"\nArguments: "+Array.prototype.slice.call(t).join("")+"\n"+(new Error).stack),o=!1}return i.apply(this,arguments)},i)}var n,k={};function D(e,t){null!=f.deprecationHandler&&f.deprecationHandler(e,t),k[e]||(S(t),k[e]=!0)}function F(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function M(e,t){var a,n=h({},e);for(a in t)p(t,a)&&(l(e[a])&&l(t[a])?(n[a]={},h(n[a],e[a]),h(n[a],t[a])):null!=t[a]?n[a]=t[a]:delete n[a]);for(a in e)p(e,a)&&!p(t,a)&&l(e[a])&&(n[a]=h({},n[a]));return n}function E(e){null!=e&&this.set(e)}f.suppressDeprecationWarnings=!1,f.deprecationHandler=null,n=Object.keys?Object.keys:function(e){var t,a=[];for(t in e)p(e,t)&&a.push(t);return a};var L={};function O(e,t){var a=e.toLowerCase();L[a]=L[a+"s"]=L[t]=e}function T(e){return"string"==typeof e?L[e]||L[e.toLowerCase()]:void 0}function P(e){var t,a,n={};for(a in e)p(e,a)&&(t=T(a))&&(n[t]=e[a]);return n}var $={};function R(e,t){$[e]=t}function I(e,t,a){var n=""+Math.abs(e),r=t-n.length;return(0<=e?a?"+":"":"-")+Math.pow(10,Math.max(0,r)).toString().substr(1)+n}var B=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,U=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,N={},j={};function z(e,t,a,n){var r=n;"string"==typeof n&&(r=function(){return this[n]()}),e&&(j[e]=r),t&&(j[t[0]]=function(){return I(r.apply(this,arguments),t[1],t[2])}),a&&(j[a]=function(){return this.localeData().ordinal(r.apply(this,arguments),e)})}function Y(e,t){return e.isValid()?(t=q(t,e.localeData()),N[t]=N[t]||function(n){var e,r,t,i=n.match(B);for(e=0,r=i.length;e<r;e++)j[i[e]]?i[e]=j[i[e]]:i[e]=(t=i[e]).match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"");return function(e){var t,a="";for(t=0;t<r;t++)a+=F(i[t])?i[t].call(e,n):i[t];return a}}(t),N[t](e)):e.localeData().invalidDate()}function q(e,t){var a=5;function n(e){return t.longDateFormat(e)||e}for(U.lastIndex=0;0<=a&&U.test(e);)e=e.replace(U,n),U.lastIndex=0,a-=1;return e}var V=/\d/,G=/\d\d/,H=/\d{3}/,W=/\d{4}/,Z=/[+-]?\d{6}/,K=/\d\d?/,J=/\d\d\d\d?/,Q=/\d\d\d\d\d\d?/,X=/\d{1,3}/,ee=/\d{1,4}/,te=/[+-]?\d{1,6}/,ae=/\d+/,ne=/[+-]?\d+/,re=/Z|[+-]\d\d:?\d\d/gi,ie=/Z|[+-]\d\d(?::?\d\d)?/gi,oe=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,se={};function le(e,a,n){se[e]=F(a)?a:function(e,t){return e&&n?n:a}}function ce(e,t){return p(se,e)?se[e](t._strict,t._locale):new RegExp(de(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,a,n,r){return t||a||n||r})))}function de(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var ue={};function fe(e,a){var t,n=a;for("string"==typeof e&&(e=[e]),d(a)&&(n=function(e,t){t[a]=A(e)}),t=0;t<e.length;t++)ue[e[t]]=n}function ge(e,r){fe(e,function(e,t,a,n){a._w=a._w||{},r(e,a._w,a,n)})}var pe=0,he=1,me=2,ye=3,ve=4,be=5,we=6,_e=7,xe=8;function Ce(e){return Ae(e)?366:365}function Ae(e){return e%4==0&&e%100!=0||e%400==0}z("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),z(0,["YY",2],0,function(){return this.year()%100}),z(0,["YYYY",4],0,"year"),z(0,["YYYYY",5],0,"year"),z(0,["YYYYYY",6,!0],0,"year"),O("year","y"),R("year",1),le("Y",ne),le("YY",K,G),le("YYYY",ee,W),le("YYYYY",te,Z),le("YYYYYY",te,Z),fe(["YYYYY","YYYYYY"],pe),fe("YYYY",function(e,t){t[pe]=2===e.length?f.parseTwoDigitYear(e):A(e)}),fe("YY",function(e,t){t[pe]=f.parseTwoDigitYear(e)}),fe("Y",function(e,t){t[pe]=parseInt(e,10)}),f.parseTwoDigitYear=function(e){return A(e)+(68<A(e)?1900:2e3)};var Se,ke=De("FullYear",!0);function De(t,a){return function(e){return null!=e?(Me(this,t,e),f.updateOffset(this,a),this):Fe(this,t)}}function Fe(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function Me(e,t,a){e.isValid()&&!isNaN(a)&&("FullYear"===t&&Ae(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](a,e.month(),Ee(a,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](a))}function Ee(e,t){if(isNaN(e)||isNaN(t))return NaN;var a,n=(t%(a=12)+a)%a;return e+=(t-n)/12,1===n?Ae(e)?29:28:31-n%7%2}Se=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},z("M",["MM",2],"Mo",function(){return this.month()+1}),z("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),z("MMMM",0,0,function(e){return this.localeData().months(this,e)}),O("month","M"),R("month",8),le("M",K),le("MM",K,G),le("MMM",function(e,t){return t.monthsShortRegex(e)}),le("MMMM",function(e,t){return t.monthsRegex(e)}),fe(["M","MM"],function(e,t){t[he]=A(e)-1}),fe(["MMM","MMMM"],function(e,t,a,n){var r=a._locale.monthsParse(e,n,a._strict);null!=r?t[he]=r:y(a).invalidMonth=e});var Le=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Oe="January_February_March_April_May_June_July_August_September_October_November_December".split("_");var Te="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Pe(e,t){var a;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=A(t);else if(!d(t=e.localeData().monthsParse(t)))return e;return a=Math.min(e.date(),Ee(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,a),e}function $e(e){return null!=e?(Pe(this,e),f.updateOffset(this,!0),this):Fe(this,"Month")}var Re=oe;var Ie=oe;function Be(){function e(e,t){return t.length-e.length}var t,a,n=[],r=[],i=[];for(t=0;t<12;t++)a=m([2e3,t]),n.push(this.monthsShort(a,"")),r.push(this.months(a,"")),i.push(this.months(a,"")),i.push(this.monthsShort(a,""));for(n.sort(e),r.sort(e),i.sort(e),t=0;t<12;t++)n[t]=de(n[t]),r[t]=de(r[t]);for(t=0;t<24;t++)i[t]=de(i[t]);this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+n.join("|")+")","i")}function Ue(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&0<=e&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function Ne(e,t,a){var n=7+t-a;return-((7+Ue(e,0,n).getUTCDay()-t)%7)+n-1}function je(e,t,a,n,r){var i,o,s=1+7*(t-1)+(7+a-n)%7+Ne(e,n,r);return o=s<=0?Ce(i=e-1)+s:s>Ce(e)?(i=e+1,s-Ce(e)):(i=e,s),{year:i,dayOfYear:o}}function ze(e,t,a){var n,r,i=Ne(e.year(),t,a),o=Math.floor((e.dayOfYear()-i-1)/7)+1;return o<1?n=o+Ye(r=e.year()-1,t,a):o>Ye(e.year(),t,a)?(n=o-Ye(e.year(),t,a),r=e.year()+1):(r=e.year(),n=o),{week:n,year:r}}function Ye(e,t,a){var n=Ne(e,t,a),r=Ne(e+1,t,a);return(Ce(e)-n+r)/7}z("w",["ww",2],"wo","week"),z("W",["WW",2],"Wo","isoWeek"),O("week","w"),O("isoWeek","W"),R("week",5),R("isoWeek",5),le("w",K),le("ww",K,G),le("W",K),le("WW",K,G),ge(["w","ww","W","WW"],function(e,t,a,n){t[n.substr(0,1)]=A(e)});z("d",0,"do","day"),z("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),z("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),z("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),z("e",0,0,"weekday"),z("E",0,0,"isoWeekday"),O("day","d"),O("weekday","e"),O("isoWeekday","E"),R("day",11),R("weekday",11),R("isoWeekday",11),le("d",K),le("e",K),le("E",K),le("dd",function(e,t){return t.weekdaysMinRegex(e)}),le("ddd",function(e,t){return t.weekdaysShortRegex(e)}),le("dddd",function(e,t){return t.weekdaysRegex(e)}),ge(["dd","ddd","dddd"],function(e,t,a,n){var r=a._locale.weekdaysParse(e,n,a._strict);null!=r?t.d=r:y(a).invalidWeekday=e}),ge(["d","e","E"],function(e,t,a,n){t[n]=A(e)});var qe="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");var Ve="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");var Ge="Su_Mo_Tu_We_Th_Fr_Sa".split("_");var He=oe;var We=oe;var Ze=oe;function Ke(){function e(e,t){return t.length-e.length}var t,a,n,r,i,o=[],s=[],l=[],c=[];for(t=0;t<7;t++)a=m([2e3,1]).day(t),n=this.weekdaysMin(a,""),r=this.weekdaysShort(a,""),i=this.weekdays(a,""),o.push(n),s.push(r),l.push(i),c.push(n),c.push(r),c.push(i);for(o.sort(e),s.sort(e),l.sort(e),c.sort(e),t=0;t<7;t++)s[t]=de(s[t]),l[t]=de(l[t]),c[t]=de(c[t]);this._weekdaysRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+o.join("|")+")","i")}function Je(){return this.hours()%12||12}function Qe(e,t){z(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Xe(e,t){return t._meridiemParse}z("H",["HH",2],0,"hour"),z("h",["hh",2],0,Je),z("k",["kk",2],0,function(){return this.hours()||24}),z("hmm",0,0,function(){return""+Je.apply(this)+I(this.minutes(),2)}),z("hmmss",0,0,function(){return""+Je.apply(this)+I(this.minutes(),2)+I(this.seconds(),2)}),z("Hmm",0,0,function(){return""+this.hours()+I(this.minutes(),2)}),z("Hmmss",0,0,function(){return""+this.hours()+I(this.minutes(),2)+I(this.seconds(),2)}),Qe("a",!0),Qe("A",!1),O("hour","h"),R("hour",13),le("a",Xe),le("A",Xe),le("H",K),le("h",K),le("k",K),le("HH",K,G),le("hh",K,G),le("kk",K,G),le("hmm",J),le("hmmss",Q),le("Hmm",J),le("Hmmss",Q),fe(["H","HH"],ye),fe(["k","kk"],function(e,t,a){var n=A(e);t[ye]=24===n?0:n}),fe(["a","A"],function(e,t,a){a._isPm=a._locale.isPM(e),a._meridiem=e}),fe(["h","hh"],function(e,t,a){t[ye]=A(e),y(a).bigHour=!0}),fe("hmm",function(e,t,a){var n=e.length-2;t[ye]=A(e.substr(0,n)),t[ve]=A(e.substr(n)),y(a).bigHour=!0}),fe("hmmss",function(e,t,a){var n=e.length-4,r=e.length-2;t[ye]=A(e.substr(0,n)),t[ve]=A(e.substr(n,2)),t[be]=A(e.substr(r)),y(a).bigHour=!0}),fe("Hmm",function(e,t,a){var n=e.length-2;t[ye]=A(e.substr(0,n)),t[ve]=A(e.substr(n))}),fe("Hmmss",function(e,t,a){var n=e.length-4,r=e.length-2;t[ye]=A(e.substr(0,n)),t[ve]=A(e.substr(n,2)),t[be]=A(e.substr(r))});var et,tt=De("Hours",!0),at={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Oe,monthsShort:Te,week:{dow:0,doy:6},weekdays:qe,weekdaysMin:Ge,weekdaysShort:Ve,meridiemParse:/[ap]\.?m?\.?/i},nt={},rt={};function it(e){return e?e.toLowerCase().replace("_","-"):e}function ot(e){var t=null;if(!nt[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=et._abbr,require("./locale/"+e),st(t)}catch(e){}return nt[e]}function st(e,t){var a;return e&&((a=c(t)?ct(e):lt(e,t))?et=a:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),et._abbr}function lt(e,t){if(null===t)return delete nt[e],null;var a,n=at;if(t.abbr=e,null!=nt[e])D("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),n=nt[e]._config;else if(null!=t.parentLocale)if(null!=nt[t.parentLocale])n=nt[t.parentLocale]._config;else{if(null==(a=ot(t.parentLocale)))return rt[t.parentLocale]||(rt[t.parentLocale]=[]),rt[t.parentLocale].push({name:e,config:t}),null;n=a._config}return nt[e]=new E(M(n,t)),rt[e]&&rt[e].forEach(function(e){lt(e.name,e.config)}),st(e),nt[e]}function ct(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return et;if(!s(e)){if(t=ot(e))return t;e=[e]}return function(e){for(var t,a,n,r,i=0;i<e.length;){for(t=(r=it(e[i]).split("-")).length,a=(a=it(e[i+1]))?a.split("-"):null;0<t;){if(n=ot(r.slice(0,t).join("-")))return n;if(a&&a.length>=t&&o(r,a,!0)>=t-1)break;t--}i++}return et}(e)}function dt(e){var t,a=e._a;return a&&-2===y(e).overflow&&(t=a[he]<0||11<a[he]?he:a[me]<1||a[me]>Ee(a[pe],a[he])?me:a[ye]<0||24<a[ye]||24===a[ye]&&(0!==a[ve]||0!==a[be]||0!==a[we])?ye:a[ve]<0||59<a[ve]?ve:a[be]<0||59<a[be]?be:a[we]<0||999<a[we]?we:-1,y(e)._overflowDayOfYear&&(t<pe||me<t)&&(t=me),y(e)._overflowWeeks&&-1===t&&(t=_e),y(e)._overflowWeekday&&-1===t&&(t=xe),y(e).overflow=t),e}function ut(e,t,a){return null!=e?e:null!=t?t:a}function ft(e){var t,a,n,r,i,o=[];if(!e._d){var s,l;for(s=e,l=new Date(f.now()),n=s._useUTC?[l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()]:[l.getFullYear(),l.getMonth(),l.getDate()],e._w&&null==e._a[me]&&null==e._a[he]&&function(e){var t,a,n,r,i,o,s,l;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)i=1,o=4,a=ut(t.GG,e._a[pe],ze(Dt(),1,4).year),n=ut(t.W,1),((r=ut(t.E,1))<1||7<r)&&(l=!0);else{i=e._locale._week.dow,o=e._locale._week.doy;var c=ze(Dt(),i,o);a=ut(t.gg,e._a[pe],c.year),n=ut(t.w,c.week),null!=t.d?((r=t.d)<0||6<r)&&(l=!0):null!=t.e?(r=t.e+i,(t.e<0||6<t.e)&&(l=!0)):r=i}n<1||n>Ye(a,i,o)?y(e)._overflowWeeks=!0:null!=l?y(e)._overflowWeekday=!0:(s=je(a,n,r,i,o),e._a[pe]=s.year,e._dayOfYear=s.dayOfYear)}(e),null!=e._dayOfYear&&(i=ut(e._a[pe],n[pe]),(e._dayOfYear>Ce(i)||0===e._dayOfYear)&&(y(e)._overflowDayOfYear=!0),a=Ue(i,0,e._dayOfYear),e._a[he]=a.getUTCMonth(),e._a[me]=a.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=o[t]=n[t];for(;t<7;t++)e._a[t]=o[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ye]&&0===e._a[ve]&&0===e._a[be]&&0===e._a[we]&&(e._nextDay=!0,e._a[ye]=0),e._d=(e._useUTC?Ue:function(e,t,a,n,r,i,o){var s=new Date(e,t,a,n,r,i,o);return e<100&&0<=e&&isFinite(s.getFullYear())&&s.setFullYear(e),s}).apply(null,o),r=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[ye]=24),e._w&&void 0!==e._w.d&&e._w.d!==r&&(y(e).weekdayMismatch=!0)}}var gt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,pt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ht=/Z|[+-]\d\d(?::?\d\d)?/,mt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],yt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],vt=/^\/?Date\((\-?\d+)/i;function bt(e){var t,a,n,r,i,o,s=e._i,l=gt.exec(s)||pt.exec(s);if(l){for(y(e).iso=!0,t=0,a=mt.length;t<a;t++)if(mt[t][1].exec(l[1])){r=mt[t][0],n=!1!==mt[t][2];break}if(null==r)return void(e._isValid=!1);if(l[3]){for(t=0,a=yt.length;t<a;t++)if(yt[t][1].exec(l[3])){i=(l[2]||" ")+yt[t][0];break}if(null==i)return void(e._isValid=!1)}if(!n&&null!=i)return void(e._isValid=!1);if(l[4]){if(!ht.exec(l[4]))return void(e._isValid=!1);o="Z"}e._f=r+(i||"")+(o||""),At(e)}else e._isValid=!1}var wt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function _t(e,t,a,n,r,i){var o=[function(e){var t=parseInt(e,10);{if(t<=49)return 2e3+t;if(t<=999)return 1900+t}return t}(e),Te.indexOf(t),parseInt(a,10),parseInt(n,10),parseInt(r,10)];return i&&o.push(parseInt(i,10)),o}var xt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Ct(e){var t,a,n,r=wt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(r){var i=_t(r[4],r[3],r[2],r[5],r[6],r[7]);if(t=r[1],a=i,n=e,t&&Ve.indexOf(t)!==new Date(a[0],a[1],a[2]).getDay()&&(y(n).weekdayMismatch=!0,!(n._isValid=!1)))return;e._a=i,e._tzm=function(e,t,a){if(e)return xt[e];if(t)return 0;var n=parseInt(a,10),r=n%100;return(n-r)/100*60+r}(r[8],r[9],r[10]),e._d=Ue.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),y(e).rfc2822=!0}else e._isValid=!1}function At(e){if(e._f!==f.ISO_8601)if(e._f!==f.RFC_2822){e._a=[],y(e).empty=!0;var t,a,n,r,i,o,s,l,c=""+e._i,d=c.length,u=0;for(n=q(e._f,e._locale).match(B)||[],t=0;t<n.length;t++)r=n[t],(a=(c.match(ce(r,e))||[])[0])&&(0<(i=c.substr(0,c.indexOf(a))).length&&y(e).unusedInput.push(i),c=c.slice(c.indexOf(a)+a.length),u+=a.length),j[r]?(a?y(e).empty=!1:y(e).unusedTokens.push(r),o=r,l=e,null!=(s=a)&&p(ue,o)&&ue[o](s,l._a,l,o)):e._strict&&!a&&y(e).unusedTokens.push(r);y(e).charsLeftOver=d-u,0<c.length&&y(e).unusedInput.push(c),e._a[ye]<=12&&!0===y(e).bigHour&&0<e._a[ye]&&(y(e).bigHour=void 0),y(e).parsedDateParts=e._a.slice(0),y(e).meridiem=e._meridiem,e._a[ye]=function(e,t,a){var n;if(null==a)return t;return null!=e.meridiemHour?e.meridiemHour(t,a):(null!=e.isPM&&((n=e.isPM(a))&&t<12&&(t+=12),n||12!==t||(t=0)),t)}(e._locale,e._a[ye],e._meridiem),ft(e),dt(e)}else Ct(e);else bt(e)}function St(e){var t,a,n,r,i=e._i,o=e._f;return e._locale=e._locale||ct(e._l),null===i||void 0===o&&""===i?b({nullInput:!0}):("string"==typeof i&&(e._i=i=e._locale.preparse(i)),x(i)?new _(dt(i)):(u(i)?e._d=i:s(o)?function(e){var t,a,n,r,i;if(0===e._f.length)return y(e).invalidFormat=!0,e._d=new Date(NaN);for(r=0;r<e._f.length;r++)i=0,t=w({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[r],At(t),v(t)&&(i+=y(t).charsLeftOver,i+=10*y(t).unusedTokens.length,y(t).score=i,(null==n||i<n)&&(n=i,a=t));h(e,a||t)}(e):o?At(e):c(a=(t=e)._i)?t._d=new Date(f.now()):u(a)?t._d=new Date(a.valueOf()):"string"==typeof a?(n=t,null===(r=vt.exec(n._i))?(bt(n),!1===n._isValid&&(delete n._isValid,Ct(n),!1===n._isValid&&(delete n._isValid,f.createFromInputFallback(n)))):n._d=new Date(+r[1])):s(a)?(t._a=g(a.slice(0),function(e){return parseInt(e,10)}),ft(t)):l(a)?function(e){if(!e._d){var t=P(e._i);e._a=g([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ft(e)}}(t):d(a)?t._d=new Date(a):f.createFromInputFallback(t),v(e)||(e._d=null),e))}function kt(e,t,a,n,r){var i,o={};return!0!==a&&!1!==a||(n=a,a=void 0),(l(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||s(e)&&0===e.length)&&(e=void 0),o._isAMomentObject=!0,o._useUTC=o._isUTC=r,o._l=a,o._i=e,o._f=t,o._strict=n,(i=new _(dt(St(o))))._nextDay&&(i.add(1,"d"),i._nextDay=void 0),i}function Dt(e,t,a,n){return kt(e,t,a,n,!1)}f.createFromInputFallback=a("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),f.ISO_8601=function(){},f.RFC_2822=function(){};var Ft=a("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Dt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:b()}),Mt=a("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Dt.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:b()});function Et(e,t){var a,n;if(1===t.length&&s(t[0])&&(t=t[0]),!t.length)return Dt();for(a=t[0],n=1;n<t.length;++n)t[n].isValid()&&!t[n][e](a)||(a=t[n]);return a}var Lt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ot(e){var t=P(e),a=t.year||0,n=t.quarter||0,r=t.month||0,i=t.week||0,o=t.day||0,s=t.hour||0,l=t.minute||0,c=t.second||0,d=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Se.call(Lt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var a=!1,n=0;n<Lt.length;++n)if(e[Lt[n]]){if(a)return!1;parseFloat(e[Lt[n]])!==A(e[Lt[n]])&&(a=!0)}return!0}(t),this._milliseconds=+d+1e3*c+6e4*l+1e3*s*60*60,this._days=+o+7*i,this._months=+r+3*n+12*a,this._data={},this._locale=ct(),this._bubble()}function Tt(e){return e instanceof Ot}function Pt(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function $t(e,a){z(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+I(~~(e/60),2)+a+I(~~e%60,2)})}$t("Z",":"),$t("ZZ",""),le("Z",ie),le("ZZ",ie),fe(["Z","ZZ"],function(e,t,a){a._useUTC=!0,a._tzm=It(ie,e)});var Rt=/([\+\-]|\d\d)/gi;function It(e,t){var a=(t||"").match(e);if(null===a)return null;var n=((a[a.length-1]||[])+"").match(Rt)||["-",0,0],r=60*n[1]+A(n[2]);return 0===r?0:"+"===n[0]?r:-r}function Bt(e,t){var a,n;return t._isUTC?(a=t.clone(),n=(x(e)||u(e)?e.valueOf():Dt(e).valueOf())-a.valueOf(),a._d.setTime(a._d.valueOf()+n),f.updateOffset(a,!1),a):Dt(e).local()}function Ut(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Nt(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}f.updateOffset=function(){};var jt=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,zt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Yt(e,t){var a,n,r,i=e,o=null;return Tt(e)?i={ms:e._milliseconds,d:e._days,M:e._months}:d(e)?(i={},t?i[t]=e:i.milliseconds=e):(o=jt.exec(e))?(a="-"===o[1]?-1:1,i={y:0,d:A(o[me])*a,h:A(o[ye])*a,m:A(o[ve])*a,s:A(o[be])*a,ms:A(Pt(1e3*o[we]))*a}):(o=zt.exec(e))?(a="-"===o[1]?-1:(o[1],1),i={y:qt(o[2],a),M:qt(o[3],a),w:qt(o[4],a),d:qt(o[5],a),h:qt(o[6],a),m:qt(o[7],a),s:qt(o[8],a)}):null==i?i={}:"object"==typeof i&&("from"in i||"to"in i)&&(r=function(e,t){var a;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Bt(t,e),e.isBefore(t)?a=Vt(e,t):((a=Vt(t,e)).milliseconds=-a.milliseconds,a.months=-a.months);return a}(Dt(i.from),Dt(i.to)),(i={}).ms=r.milliseconds,i.M=r.months),n=new Ot(i),Tt(e)&&p(e,"_locale")&&(n._locale=e._locale),n}function qt(e,t){var a=e&&parseFloat(e.replace(",","."));return(isNaN(a)?0:a)*t}function Vt(e,t){var a={milliseconds:0,months:0};return a.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(a.months,"M").isAfter(t)&&--a.months,a.milliseconds=+t-+e.clone().add(a.months,"M"),a}function Gt(n,r){return function(e,t){var a;return null===t||isNaN(+t)||(D(r,"moment()."+r+"(period, number) is deprecated. Please use moment()."+r+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),a=e,e=t,t=a),Ht(this,Yt(e="string"==typeof e?+e:e,t),n),this}}function Ht(e,t,a,n){var r=t._milliseconds,i=Pt(t._days),o=Pt(t._months);e.isValid()&&(n=null==n||n,o&&Pe(e,Fe(e,"Month")+o*a),i&&Me(e,"Date",Fe(e,"Date")+i*a),r&&e._d.setTime(e._d.valueOf()+r*a),n&&f.updateOffset(e,i||o))}Yt.fn=Ot.prototype,Yt.invalid=function(){return Yt(NaN)};var Wt=Gt(1,"add"),Zt=Gt(-1,"subtract");function Kt(e,t){var a=12*(t.year()-e.year())+(t.month()-e.month()),n=e.clone().add(a,"months");return-(a+(t-n<0?(t-n)/(n-e.clone().add(a-1,"months")):(t-n)/(e.clone().add(a+1,"months")-n)))||0}function Jt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=ct(e))&&(this._locale=t),this)}f.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",f.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Qt=a("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function Xt(){return this._locale}function ea(e,t){z(0,[e,e.length],0,t)}function ta(e,t,a,n,r){var i;return null==e?ze(this,n,r).year:((i=Ye(e,n,r))<t&&(t=i),function(e,t,a,n,r){var i=je(e,t,a,n,r),o=Ue(i.year,0,i.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}.call(this,e,t,a,n,r))}z(0,["gg",2],0,function(){return this.weekYear()%100}),z(0,["GG",2],0,function(){return this.isoWeekYear()%100}),ea("gggg","weekYear"),ea("ggggg","weekYear"),ea("GGGG","isoWeekYear"),ea("GGGGG","isoWeekYear"),O("weekYear","gg"),O("isoWeekYear","GG"),R("weekYear",1),R("isoWeekYear",1),le("G",ne),le("g",ne),le("GG",K,G),le("gg",K,G),le("GGGG",ee,W),le("gggg",ee,W),le("GGGGG",te,Z),le("ggggg",te,Z),ge(["gggg","ggggg","GGGG","GGGGG"],function(e,t,a,n){t[n.substr(0,2)]=A(e)}),ge(["gg","GG"],function(e,t,a,n){t[n]=f.parseTwoDigitYear(e)}),z("Q",0,"Qo","quarter"),O("quarter","Q"),R("quarter",7),le("Q",V),fe("Q",function(e,t){t[he]=3*(A(e)-1)}),z("D",["DD",2],"Do","date"),O("date","D"),R("date",9),le("D",K),le("DD",K,G),le("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),fe(["D","DD"],me),fe("Do",function(e,t){t[me]=A(e.match(K)[0])});var aa=De("Date",!0);z("DDD",["DDDD",3],"DDDo","dayOfYear"),O("dayOfYear","DDD"),R("dayOfYear",4),le("DDD",X),le("DDDD",H),fe(["DDD","DDDD"],function(e,t,a){a._dayOfYear=A(e)}),z("m",["mm",2],0,"minute"),O("minute","m"),R("minute",14),le("m",K),le("mm",K,G),fe(["m","mm"],ve);var na=De("Minutes",!1);z("s",["ss",2],0,"second"),O("second","s"),R("second",15),le("s",K),le("ss",K,G),fe(["s","ss"],be);var ra,ia=De("Seconds",!1);for(z("S",0,0,function(){return~~(this.millisecond()/100)}),z(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),z(0,["SSS",3],0,"millisecond"),z(0,["SSSS",4],0,function(){return 10*this.millisecond()}),z(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),z(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),z(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),z(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),z(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),O("millisecond","ms"),R("millisecond",16),le("S",X,V),le("SS",X,G),le("SSS",X,H),ra="SSSS";ra.length<=9;ra+="S")le(ra,ae);function oa(e,t){t[we]=A(1e3*("0."+e))}for(ra="S";ra.length<=9;ra+="S")fe(ra,oa);var sa=De("Milliseconds",!1);z("z",0,0,"zoneAbbr"),z("zz",0,0,"zoneName");var la=_.prototype;function ca(e){return e}la.add=Wt,la.calendar=function(e,t){var a=e||Dt(),n=Bt(a,this).startOf("day"),r=f.calendarFormat(this,n)||"sameElse",i=t&&(F(t[r])?t[r].call(this,a):t[r]);return this.format(i||this.localeData().calendar(r,this,Dt(a)))},la.clone=function(){return new _(this)},la.diff=function(e,t,a){var n,r,i;if(!this.isValid())return NaN;if(!(n=Bt(e,this)).isValid())return NaN;switch(r=6e4*(n.utcOffset()-this.utcOffset()),t=T(t)){case"year":i=Kt(this,n)/12;break;case"month":i=Kt(this,n);break;case"quarter":i=Kt(this,n)/3;break;case"second":i=(this-n)/1e3;break;case"minute":i=(this-n)/6e4;break;case"hour":i=(this-n)/36e5;break;case"day":i=(this-n-r)/864e5;break;case"week":i=(this-n-r)/6048e5;break;default:i=this-n}return a?i:C(i)},la.endOf=function(e){return void 0===(e=T(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},la.format=function(e){e||(e=this.isUtc()?f.defaultFormatUtc:f.defaultFormat);var t=Y(this,e);return this.localeData().postformat(t)},la.from=function(e,t){return this.isValid()&&(x(e)&&e.isValid()||Dt(e).isValid())?Yt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},la.fromNow=function(e){return this.from(Dt(),e)},la.to=function(e,t){return this.isValid()&&(x(e)&&e.isValid()||Dt(e).isValid())?Yt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},la.toNow=function(e){return this.to(Dt(),e)},la.get=function(e){return F(this[e=T(e)])?this[e]():this},la.invalidAt=function(){return y(this).overflow},la.isAfter=function(e,t){var a=x(e)?e:Dt(e);return!(!this.isValid()||!a.isValid())&&("millisecond"===(t=T(c(t)?"millisecond":t))?this.valueOf()>a.valueOf():a.valueOf()<this.clone().startOf(t).valueOf())},la.isBefore=function(e,t){var a=x(e)?e:Dt(e);return!(!this.isValid()||!a.isValid())&&("millisecond"===(t=T(c(t)?"millisecond":t))?this.valueOf()<a.valueOf():this.clone().endOf(t).valueOf()<a.valueOf())},la.isBetween=function(e,t,a,n){return("("===(n=n||"()")[0]?this.isAfter(e,a):!this.isBefore(e,a))&&(")"===n[1]?this.isBefore(t,a):!this.isAfter(t,a))},la.isSame=function(e,t){var a,n=x(e)?e:Dt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=T(t||"millisecond"))?this.valueOf()===n.valueOf():(a=n.valueOf(),this.clone().startOf(t).valueOf()<=a&&a<=this.clone().endOf(t).valueOf()))},la.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},la.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},la.isValid=function(){return v(this)},la.lang=Qt,la.locale=Jt,la.localeData=Xt,la.max=Mt,la.min=Ft,la.parsingFlags=function(){return h({},y(this))},la.set=function(e,t){if("object"==typeof e)for(var a=function(e){var t=[];for(var a in e)t.push({unit:a,priority:$[a]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=P(e)),n=0;n<a.length;n++)this[a[n].unit](e[a[n].unit]);else if(F(this[e=T(e)]))return this[e](t);return this},la.startOf=function(e){switch(e=T(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},la.subtract=Zt,la.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},la.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},la.toDate=function(){return new Date(this.valueOf())},la.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,a=t?this.clone().utc():this;return a.year()<0||9999<a.year()?Y(a,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):F(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",Y(a,"Z")):Y(a,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},la.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var a="["+e+'("]',n=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",r=t+'[")]';return this.format(a+n+"-MM-DD[T]HH:mm:ss.SSS"+r)},la.toJSON=function(){return this.isValid()?this.toISOString():null},la.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},la.unix=function(){return Math.floor(this.valueOf()/1e3)},la.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},la.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},la.year=ke,la.isLeapYear=function(){return Ae(this.year())},la.weekYear=function(e){return ta.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},la.isoWeekYear=function(e){return ta.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},la.quarter=la.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},la.month=$e,la.daysInMonth=function(){return Ee(this.year(),this.month())},la.week=la.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},la.isoWeek=la.isoWeeks=function(e){var t=ze(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},la.weeksInYear=function(){var e=this.localeData()._week;return Ye(this.year(),e.dow,e.doy)},la.isoWeeksInYear=function(){return Ye(this.year(),1,4)},la.date=aa,la.day=la.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,a,n=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,a=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=a.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-n,"d")):n},la.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},la.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null==e)return this.day()||7;var t,a,n=(t=e,a=this.localeData(),"string"==typeof t?a.weekdaysParse(t)%7||7:isNaN(t)?null:t);return this.day(this.day()%7?n:n-7)},la.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},la.hour=la.hours=tt,la.minute=la.minutes=na,la.second=la.seconds=ia,la.millisecond=la.milliseconds=sa,la.utcOffset=function(e,t,a){var n,r=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null==e)return this._isUTC?r:Ut(this);if("string"==typeof e){if(null===(e=It(ie,e)))return this}else Math.abs(e)<16&&!a&&(e*=60);return!this._isUTC&&t&&(n=Ut(this)),this._offset=e,this._isUTC=!0,null!=n&&this.add(n,"m"),r!==e&&(!t||this._changeInProgress?Ht(this,Yt(e-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,f.updateOffset(this,!0),this._changeInProgress=null)),this},la.utc=function(e){return this.utcOffset(0,e)},la.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ut(this),"m")),this},la.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=It(re,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},la.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Dt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},la.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},la.isLocal=function(){return!!this.isValid()&&!this._isUTC},la.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},la.isUtc=Nt,la.isUTC=Nt,la.zoneAbbr=function(){return this._isUTC?"UTC":""},la.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},la.dates=a("dates accessor is deprecated. Use date instead.",aa),la.months=a("months accessor is deprecated. Use month instead",$e),la.years=a("years accessor is deprecated. Use year instead",ke),la.zone=a("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),la.isDSTShifted=a("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!c(this._isDSTShifted))return this._isDSTShifted;var e={};if(w(e,this),(e=St(e))._a){var t=e._isUTC?m(e._a):Dt(e._a);this._isDSTShifted=this.isValid()&&0<o(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var da=E.prototype;function ua(e,t,a,n){var r=ct(),i=m().set(n,t);return r[a](i,e)}function fa(e,t,a){if(d(e)&&(t=e,e=void 0),e=e||"",null!=t)return ua(e,t,a,"month");var n,r=[];for(n=0;n<12;n++)r[n]=ua(e,n,a,"month");return r}function ga(e,t,a,n){t=("boolean"==typeof e?d(t)&&(a=t,t=void 0):(t=e,e=!1,d(a=t)&&(a=t,t=void 0)),t||"");var r,i=ct(),o=e?i._week.dow:0;if(null!=a)return ua(t,(a+o)%7,n,"day");var s=[];for(r=0;r<7;r++)s[r]=ua(t,(r+o)%7,n,"day");return s}da.calendar=function(e,t,a){var n=this._calendar[e]||this._calendar.sameElse;return F(n)?n.call(t,a):n},da.longDateFormat=function(e){var t=this._longDateFormat[e],a=this._longDateFormat[e.toUpperCase()];return t||!a?t:(this._longDateFormat[e]=a.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},da.invalidDate=function(){return this._invalidDate},da.ordinal=function(e){return this._ordinal.replace("%d",e)},da.preparse=ca,da.postformat=ca,da.relativeTime=function(e,t,a,n){var r=this._relativeTime[a];return F(r)?r(e,t,a,n):r.replace(/%d/i,e)},da.pastFuture=function(e,t){var a=this._relativeTime[0<e?"future":"past"];return F(a)?a(t):a.replace(/%s/i,t)},da.set=function(e){var t,a;for(a in e)F(t=e[a])?this[a]=t:this["_"+a]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},da.months=function(e,t){return e?s(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Le).test(t)?"format":"standalone"][e.month()]:s(this._months)?this._months:this._months.standalone},da.monthsShort=function(e,t){return e?s(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Le.test(t)?"format":"standalone"][e.month()]:s(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},da.monthsParse=function(e,t,a){var n,r,i;if(this._monthsParseExact)return function(e,t,a){var n,r,i,o=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],n=0;n<12;++n)i=m([2e3,n]),this._shortMonthsParse[n]=this.monthsShort(i,"").toLocaleLowerCase(),this._longMonthsParse[n]=this.months(i,"").toLocaleLowerCase();return a?"MMM"===t?-1!==(r=Se.call(this._shortMonthsParse,o))?r:null:-1!==(r=Se.call(this._longMonthsParse,o))?r:null:"MMM"===t?-1!==(r=Se.call(this._shortMonthsParse,o))?r:-1!==(r=Se.call(this._longMonthsParse,o))?r:null:-1!==(r=Se.call(this._longMonthsParse,o))?r:-1!==(r=Se.call(this._shortMonthsParse,o))?r:null}.call(this,e,t,a);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),n=0;n<12;n++){if(r=m([2e3,n]),a&&!this._longMonthsParse[n]&&(this._longMonthsParse[n]=new RegExp("^"+this.months(r,"").replace(".","")+"$","i"),this._shortMonthsParse[n]=new RegExp("^"+this.monthsShort(r,"").replace(".","")+"$","i")),a||this._monthsParse[n]||(i="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[n]=new RegExp(i.replace(".",""),"i")),a&&"MMMM"===t&&this._longMonthsParse[n].test(e))return n;if(a&&"MMM"===t&&this._shortMonthsParse[n].test(e))return n;if(!a&&this._monthsParse[n].test(e))return n}},da.monthsRegex=function(e){return this._monthsParseExact?(p(this,"_monthsRegex")||Be.call(this),e?this._monthsStrictRegex:this._monthsRegex):(p(this,"_monthsRegex")||(this._monthsRegex=Ie),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},da.monthsShortRegex=function(e){return this._monthsParseExact?(p(this,"_monthsRegex")||Be.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(p(this,"_monthsShortRegex")||(this._monthsShortRegex=Re),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},da.week=function(e){return ze(e,this._week.dow,this._week.doy).week},da.firstDayOfYear=function(){return this._week.doy},da.firstDayOfWeek=function(){return this._week.dow},da.weekdays=function(e,t){return e?s(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:s(this._weekdays)?this._weekdays:this._weekdays.standalone},da.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},da.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},da.weekdaysParse=function(e,t,a){var n,r,i;if(this._weekdaysParseExact)return function(e,t,a){var n,r,i,o=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],n=0;n<7;++n)i=m([2e3,1]).day(n),this._minWeekdaysParse[n]=this.weekdaysMin(i,"").toLocaleLowerCase(),this._shortWeekdaysParse[n]=this.weekdaysShort(i,"").toLocaleLowerCase(),this._weekdaysParse[n]=this.weekdays(i,"").toLocaleLowerCase();return a?"dddd"===t?-1!==(r=Se.call(this._weekdaysParse,o))?r:null:"ddd"===t?-1!==(r=Se.call(this._shortWeekdaysParse,o))?r:null:-1!==(r=Se.call(this._minWeekdaysParse,o))?r:null:"dddd"===t?-1!==(r=Se.call(this._weekdaysParse,o))?r:-1!==(r=Se.call(this._shortWeekdaysParse,o))?r:-1!==(r=Se.call(this._minWeekdaysParse,o))?r:null:"ddd"===t?-1!==(r=Se.call(this._shortWeekdaysParse,o))?r:-1!==(r=Se.call(this._weekdaysParse,o))?r:-1!==(r=Se.call(this._minWeekdaysParse,o))?r:null:-1!==(r=Se.call(this._minWeekdaysParse,o))?r:-1!==(r=Se.call(this._weekdaysParse,o))?r:-1!==(r=Se.call(this._shortWeekdaysParse,o))?r:null}.call(this,e,t,a);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),n=0;n<7;n++){if(r=m([2e3,1]).day(n),a&&!this._fullWeekdaysParse[n]&&(this._fullWeekdaysParse[n]=new RegExp("^"+this.weekdays(r,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[n]=new RegExp("^"+this.weekdaysShort(r,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[n]=new RegExp("^"+this.weekdaysMin(r,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[n]||(i="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[n]=new RegExp(i.replace(".",""),"i")),a&&"dddd"===t&&this._fullWeekdaysParse[n].test(e))return n;if(a&&"ddd"===t&&this._shortWeekdaysParse[n].test(e))return n;if(a&&"dd"===t&&this._minWeekdaysParse[n].test(e))return n;if(!a&&this._weekdaysParse[n].test(e))return n}},da.weekdaysRegex=function(e){return this._weekdaysParseExact?(p(this,"_weekdaysRegex")||Ke.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(p(this,"_weekdaysRegex")||(this._weekdaysRegex=He),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},da.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(p(this,"_weekdaysRegex")||Ke.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(p(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=We),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},da.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(p(this,"_weekdaysRegex")||Ke.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(p(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ze),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},da.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},da.meridiem=function(e,t,a){return 11<e?a?"pm":"PM":a?"am":"AM"},st("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===A(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),f.lang=a("moment.lang is deprecated. Use moment.locale instead.",st),f.langData=a("moment.langData is deprecated. Use moment.localeData instead.",ct);var pa=Math.abs;function ha(e,t,a,n){var r=Yt(t,a);return e._milliseconds+=n*r._milliseconds,e._days+=n*r._days,e._months+=n*r._months,e._bubble()}function ma(e){return e<0?Math.floor(e):Math.ceil(e)}function ya(e){return 4800*e/146097}function va(e){return 146097*e/4800}function ba(e){return function(){return this.as(e)}}var wa=ba("ms"),_a=ba("s"),xa=ba("m"),Ca=ba("h"),Aa=ba("d"),Sa=ba("w"),ka=ba("M"),Da=ba("y");function Fa(e){return function(){return this.isValid()?this._data[e]:NaN}}var Ma=Fa("milliseconds"),Ea=Fa("seconds"),La=Fa("minutes"),Oa=Fa("hours"),Ta=Fa("days"),Pa=Fa("months"),$a=Fa("years");var Ra=Math.round,Ia={ss:44,s:45,m:45,h:22,d:26,M:11};var Ba=Math.abs;function Ua(e){return(0<e)-(e<0)||+e}function Na(){if(!this.isValid())return this.localeData().invalidDate();var e,t,a=Ba(this._milliseconds)/1e3,n=Ba(this._days),r=Ba(this._months);t=C((e=C(a/60))/60),a%=60,e%=60;var i=C(r/12),o=r%=12,s=n,l=t,c=e,d=a?a.toFixed(3).replace(/\.?0+$/,""):"",u=this.asSeconds();if(!u)return"P0D";var f=u<0?"-":"",g=Ua(this._months)!==Ua(u)?"-":"",p=Ua(this._days)!==Ua(u)?"-":"",h=Ua(this._milliseconds)!==Ua(u)?"-":"";return f+"P"+(i?g+i+"Y":"")+(o?g+o+"M":"")+(s?p+s+"D":"")+(l||c||d?"T":"")+(l?h+l+"H":"")+(c?h+c+"M":"")+(d?h+d+"S":"")}var ja=Ot.prototype;return ja.isValid=function(){return this._isValid},ja.abs=function(){var e=this._data;return this._milliseconds=pa(this._milliseconds),this._days=pa(this._days),this._months=pa(this._months),e.milliseconds=pa(e.milliseconds),e.seconds=pa(e.seconds),e.minutes=pa(e.minutes),e.hours=pa(e.hours),e.months=pa(e.months),e.years=pa(e.years),this},ja.add=function(e,t){return ha(this,e,t,1)},ja.subtract=function(e,t){return ha(this,e,t,-1)},ja.as=function(e){if(!this.isValid())return NaN;var t,a,n=this._milliseconds;if("month"===(e=T(e))||"year"===e)return t=this._days+n/864e5,a=this._months+ya(t),"month"===e?a:a/12;switch(t=this._days+Math.round(va(this._months)),e){case"week":return t/7+n/6048e5;case"day":return t+n/864e5;case"hour":return 24*t+n/36e5;case"minute":return 1440*t+n/6e4;case"second":return 86400*t+n/1e3;case"millisecond":return Math.floor(864e5*t)+n;default:throw new Error("Unknown unit "+e)}},ja.asMilliseconds=wa,ja.asSeconds=_a,ja.asMinutes=xa,ja.asHours=Ca,ja.asDays=Aa,ja.asWeeks=Sa,ja.asMonths=ka,ja.asYears=Da,ja.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*A(this._months/12):NaN},ja._bubble=function(){var e,t,a,n,r,i=this._milliseconds,o=this._days,s=this._months,l=this._data;return 0<=i&&0<=o&&0<=s||i<=0&&o<=0&&s<=0||(i+=864e5*ma(va(s)+o),s=o=0),l.milliseconds=i%1e3,e=C(i/1e3),l.seconds=e%60,t=C(e/60),l.minutes=t%60,a=C(t/60),l.hours=a%24,s+=r=C(ya(o+=C(a/24))),o-=ma(va(r)),n=C(s/12),s%=12,l.days=o,l.months=s,l.years=n,this},ja.clone=function(){return Yt(this)},ja.get=function(e){return e=T(e),this.isValid()?this[e+"s"]():NaN},ja.milliseconds=Ma,ja.seconds=Ea,ja.minutes=La,ja.hours=Oa,ja.days=Ta,ja.weeks=function(){return C(this.days()/7)},ja.months=Pa,ja.years=$a,ja.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,a,n,r,i,o,s,l,c,d,u,f=this.localeData(),g=(a=!e,n=f,r=Yt(t=this).abs(),i=Ra(r.as("s")),o=Ra(r.as("m")),s=Ra(r.as("h")),l=Ra(r.as("d")),c=Ra(r.as("M")),d=Ra(r.as("y")),(u=i<=Ia.ss&&["s",i]||i<Ia.s&&["ss",i]||o<=1&&["m"]||o<Ia.m&&["mm",o]||s<=1&&["h"]||s<Ia.h&&["hh",s]||l<=1&&["d"]||l<Ia.d&&["dd",l]||c<=1&&["M"]||c<Ia.M&&["MM",c]||d<=1&&["y"]||["yy",d])[2]=a,u[3]=0<+t,u[4]=n,function(e,t,a,n,r){return r.relativeTime(t||1,!!a,e,n)}.apply(null,u));return e&&(g=f.pastFuture(+this,g)),f.postformat(g)},ja.toISOString=Na,ja.toString=Na,ja.toJSON=Na,ja.locale=Jt,ja.localeData=Xt,ja.toIsoString=a("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Na),ja.lang=Qt,z("X",0,0,"unix"),z("x",0,0,"valueOf"),le("x",ne),le("X",/[+-]?\d+(\.\d{1,3})?/),fe("X",function(e,t,a){a._d=new Date(1e3*parseFloat(e,10))}),fe("x",function(e,t,a){a._d=new Date(A(e))}),f.version="2.22.2",e=Dt,f.fn=la,f.min=function(){return Et("isBefore",[].slice.call(arguments,0))},f.max=function(){return Et("isAfter",[].slice.call(arguments,0))},f.now=function(){return Date.now?Date.now():+new Date},f.utc=m,f.unix=function(e){return Dt(1e3*e)},f.months=function(e,t){return fa(e,t,"months")},f.isDate=u,f.locale=st,f.invalid=b,f.duration=Yt,f.isMoment=x,f.weekdays=function(e,t,a){return ga(e,t,a,"weekdays")},f.parseZone=function(){return Dt.apply(null,arguments).parseZone()},f.localeData=ct,f.isDuration=Tt,f.monthsShort=function(e,t){return fa(e,t,"monthsShort")},f.weekdaysMin=function(e,t,a){return ga(e,t,a,"weekdaysMin")},f.defineLocale=lt,f.updateLocale=function(e,t){if(null!=t){var a,n,r=at;null!=(n=ot(e))&&(r=n._config),(a=new E(t=M(r,t))).parentLocale=nt[e],nt[e]=a,st(e)}else null!=nt[e]&&(null!=nt[e].parentLocale?nt[e]=nt[e].parentLocale:null!=nt[e]&&delete nt[e]);return nt[e]},f.locales=function(){return n(nt)},f.weekdaysShort=function(e,t,a){return ga(e,t,a,"weekdaysShort")},f.normalizeUnits=T,f.relativeTimeRounding=function(e){return void 0===e?Ra:"function"==typeof e&&(Ra=e,!0)},f.relativeTimeThreshold=function(e,t){return void 0!==Ia[e]&&(void 0===t?Ia[e]:(Ia[e]=t,"s"===e&&(Ia.ss=t-1),!0))},f.calendarFormat=function(e,t){var a=e.diff(t,"days",!0);return a<-6?"sameElse":a<-1?"lastWeek":a<0?"lastDay":a<1?"sameDay":a<2?"nextDay":a<7?"nextWeek":"sameElse"},f.prototype=la,f.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"},f});var mod=angular.module("infinite-scroll",[]);mod.directive("infiniteScroll",["$rootScope","$window","$timeout",function(d,u,f){return{link:function(s,l,c){f(function(){var t,a,n,r,i,o,e;return u=angular.element(u),0===(t=l.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y"))}).eq(0)).length&&(t=u),null!=c.infiniteScrollSelf&&(t=l),i=0,null!=c.infiniteScrollDistance&&s.$watch(c.infiniteScrollDistance,function(e){return i=parseFloat(e,10)}),a=!(o=!0),null!=c.infiniteScrollDisabled&&s.$watch(c.infiniteScrollDisabled,function(e){if((o=!e)&&a)return a=!1,r()}),e=t!==u?t.position().top:0,n=l.position().top-e,r=function(){var e;return(e=l==t?l[0].scrollHeight-l.scrollTop()-l.height()<=l[0].scrollHeight*i:n+l.height()-(t.height()+t.scrollTop())<=t.height()*i)&&o?d.$$phase?s.$eval(c.infiniteScroll):s.$apply(c.infiniteScroll):e?a=!0:void 0},t.on("scroll",r),s.$on("$destroy",function(){return t.off("scroll",r)}),f(function(){return c.infiniteScrollImmediateCheck?s.$eval(c.infiniteScrollImmediateCheck)?r():void 0:r()},0)},0)}}}]),function(){"use strict";var r,i,o,s;if(Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,a=Number(arguments[1])||0;for((a=a<0?Math.ceil(a):Math.floor(a))<0&&(a+=t);a<t;a++)if(a in this&&this[a]===e)return a;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){if(null==this)throw new TypeError;var t=Object(this),a=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],r=2<=arguments.length?arguments[1]:void 0,i=0;i<a;i++)if(i in t){var o=t[i];e.call(r,o,i,t)&&n.push(o)}return n}),Array.prototype.map||(Array.prototype.map=function(e,t){var a,n,r;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(a=t),n=new Array(o),r=0;r<o;){var s,l;r in i&&(s=i[r],l=e.call(a,s,r,i),n[r]=l),r++}return n}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.keys||(Object.keys=(r=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),s=(o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var t,a,n=[];for(t in e)r.call(e,t)&&n.push(t);if(i)for(a=0;a<s;a++)r.call(e,o[a])&&n.push(o[a]);return n})),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var a=this.toString();(void 0===t||t>a.length)&&(t=a.length),t-=e.length;var n=a.indexOf(e,t);return-1!==n&&n===t}),window.hasOwnProperty||(window.hasOwnProperty=function(e){return Object.prototype.hasOwnProperty.call(window,e)}),window.selectText=function(e){var t,a;document.body.createTextRange?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&(a=window.getSelection(),(t=document.createRange()).selectNodeContents(e),a.removeAllRanges(),a.addRange(t))},window.isObjectEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},window.utf8_to_b64=function(e){return window.btoa(jsesc(e,{json:!0}))},window.b64_to_utf8=function(e){return window.atob(e)},window.format_string=function(){var e,t=arguments[0];if(null!==arguments[1]&&"object"==typeof arguments[1]){var a=arguments[1];for(var n in a)a.hasOwnProperty(n)&&(e=new RegExp("\\{"+n+"\\}","gm"),t=t.replace(e,a[n]))}else for(var r=1;r<arguments.length;r++)e=new RegExp("\\{"+(r-1)+"\\}","gm"),t=t.replace(e,arguments[r]);return t},window.isNullOrUndefined=function(e){return null==e},"function"!=typeof Object.assign&&(Object.assign=function(e,t){if(isNullOrUndefined(e))throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(!isNullOrUndefined(r))for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(a[i]=r[i])}return a}),RegExp.escape=function(e){return e?e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"):e},"function"!=typeof window.CustomEvent){var e=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var a=document.createEvent("CustomEvent");return a.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),a};e.prototype=window.Event.prototype,window.CustomEvent=e}}(),function(){"use strict";var e=angular.module("ods-widgets",["infinite-scroll","ngSanitize","gettext"]);e.provider("ODSWidgetsConfig",function(){this.defaultConfig={ODSWidgetsVersion:"1.3.1",defaultDomain:"",language:null,disqusShortname:null,customAPIHeaders:null,basemaps:[{provider:"jawg.streets",label:"Jawg Streets",jawg_apikey:"opendatasoft-community"}],mapGeobox:!1,chartColors:null,mapPrependAttribution:null,basePath:null,websiteName:null,themes:{},defaultMapLocation:"12,48.85218,2.36996"},this.customConfig={},this.setConfig=function(e){angular.extend(this.customConfig,e)},this.$get=function(){return angular.extend({},this.defaultConfig,this.customConfig)}}),e.run(["gettextCatalog","ODSWidgetsConfig",function(e,t){if(!t.basePath){var a,n,r,i=document.getElementsByTagName("script"),o=/[\/^]ods-widgets(\.min)?\.js\??/;for(a=0;a<i.length;a++)(n=i[a].src).match(o)&&((r=n.split(o)[0])?".js"===r.substring(r.length-3)?t.basePath="":t.basePath=r+"/":t.basePath="/")}}])}(),function(){"use strict";angular.module("ods-widgets").service("ODSAPI",["$http","ODSWidgetsConfig","odsNotificationService","odsHttpErrorMessages","$q",function(o,s,l,c,r){var i=function(e,t,a,n){var r=e?e.domainUrl:"";r+=t,(a=ODS.URLUtils.cleanupAPIParams(a)||{}).timezone=jstz.determine().name(),e&&e.apikey&&(a.apikey=e.apikey),e&&e.source&&(a.source=e.source);var i={params:a,paramSerializer:function(e){return ODS.URLUtils.getAPIQueryString(e)}};return n&&(i.timeout=n),r.startsWith("http://")||(s.customAPIHeaders?i.headers=s.customAPIHeaders:i.headers={},i.headers["ODS-Widgets-Version"]=s.ODSWidgetsVersion),!e.domainUrl||Modernizr.cors?o.get(r,i).error(function(e,t){e?l.sendNotification(e):400<=t&&l.sendNotification(c.getForStatus(t))}):(r+=-1<r.indexOf("?")?"&":"?",r+="callback=JSON_CALLBACK",o.jsonp(r,i))};return{uniqueCall:function(a){var n;return function(){var e,t=Array.prototype.slice.call(arguments);return n&&(n.resolve(),n=void 0),n=r.defer(),(e=a.apply(null,t.concat(n.promise))).finally(function(){n=void 0}),e}},getDomainURL:function(e){var t=null;return angular.isUndefined(e)||null===e||""===e?t=s.defaultDomain:"/"!==(t="/"!==e.substr(0,1)&&-1===e.indexOf(".")?e+".opendatasoft.com":e).substr(0,1)&&-1===t.indexOf("http://")&&-1===t.indexOf("https://")&&(t="https://"+t),"/"===t.substr(-1)&&(t=t.substr(0,t.length-1)),t},datasets:{get:function(e,t,a,n){return i(e,"/api/datasets/1.0/"+t+"/",a,n)},search:function(e,t,a){var n=angular.extend({},e.parameters,t);return i(e,"/api/datasets/1.0/search/",n,a)},facets:function(e,t,a){var n=angular.extend({},e.parameters,{rows:0,facet:t});return i(e,"/api/datasets/1.0/search/",n,a)}},records:{analyze:function(e,t,a){return i(e,"/api/records/1.0/analyze/",angular.extend({},t,{dataset:e.dataset.datasetid}),a).success(function(e,t,a,n){a()["ods-analyze-truncated"]&&l.sendNotification(translate("An analysis request hit the maximum number of results limit. Returned data is incomplete and not trustworthy."))})},search:function(e,t,a){return i(e,"/api/records/1.0/search/",angular.extend({},t,{dataset:e.dataset.datasetid}),a)},download:function(e,t,a){return i(e,"/api/records/1.0/download/",angular.extend({},t,{dataset:e.dataset.datasetid}),a)},geo:function(e,t,a){return i(e,"/api/records/1.0/geocluster/",angular.extend({},t,{dataset:e.dataset.datasetid}),a)},geopreview:function(e,t,a){return i(e,"/api/records/1.0/geopreview/",angular.extend({},t,{dataset:e.dataset.datasetid}),a)},boundingbox:function(e,t,a){return i(e,"/api/records/1.0/boundingbox/",angular.extend({},t,{dataset:e.dataset.datasetid}),a)},geopolygon:function(e,t,a){return i(e,"/api/records/1.0/geopolygon/",angular.extend({},t,{dataset:e.dataset.datasetid}),a)}},reuses:function(e,t,a){return i(e,"/api/reuses/",t,a)}}}])}(),function(){"use strict";var e=angular.module("ods-widgets");e.factory("AggregationHelper",["translate",function(e){var a=[{label:e("Count"),func:"COUNT"},{label:e("Average"),func:"AVG"},{label:e("Minimum"),func:"MIN"},{label:e("Maximum"),func:"MAX"},{label:e("Standard deviation"),func:"STDDEV"},{label:e("Sum"),func:"SUM"},{label:e("Percentile"),func:"QUANTILES"},{label:e("Constant value"),func:"CONSTANT"}];return{getAvailableFunctions:function(e){return 0===e?[a[0],a[a.length-1]]:a},getAvailableFunction:function(e){return a[e]},getFunctionLabel:function(t){return t=t.toUpperCase(),$.grep(a,function(e){return t===e.func})[0].label}}}]),e.factory("ChartHelper",["translate","AggregationHelper","ODSWidgetsConfig","ODSCurrentDomain","colorScale",function(i,o,e,t,r){var s={},a={},l={year:i("Year"),month:i("Month"),day:i("Day"),hour:i("Hour"),minute:i("Minute"),"month month":i("Month of year"),"day day":i("Day of month"),"day weekday":i("Day of week"),"hour weekday":i("Hour per weekday"),"day month":i("Day of year"),"hour hour":i("Hour of day")},n={},u=[],c={"top left":{label:i("top left"),position:{center:["15%","20%"],size:"25%"}},"top right":{label:i("top right"),position:{center:["85%","20%"],size:"25%"}},"bottom left":{label:i("bottom left"),position:{center:["15%","80%"],size:"25%"}},"bottom right":{label:i("bottom right"),position:{center:["85%","80%"],size:"25%"}},center:{label:i("center"),position:{}}},d=e.chartColors||chroma.brewer.Set2,f=[{label:i("Line"),type:"line",group:i("line charts")},{label:i("Spline"),type:"spline",group:i("line charts")},{label:i("Range"),type:"arearange",group:i("Area charts"),filter:"hasNumericField"},{label:i("Range spline"),type:"areasplinerange",group:i("Area charts"),filter:"hasNumericField"},{label:i("Column range"),type:"columnrange",group:i("Area charts"),filter:"hasNumericField"},{label:i("Treemap"),type:"treemap",group:i("Special")},{label:i("Area"),type:"area",group:i("Area charts")},{label:i("Area spline"),type:"areaspline",group:i("Area charts")},{label:i("Column chart"),type:"column",group:i("Bar charts")},{label:i("Bar chart"),type:"bar",group:i("Bar charts")},{label:i("Pie chart"),type:"pie",group:i("Pie charts")},{label:i("Scatter plot"),type:"scatter",group:i("line charts")},{label:i("Spiderweb chart"),type:"spiderweb",group:i("Pie charts")},{label:i("Polar chart"),type:"polar",group:i("Pie charts")},{label:i("Funnel chart"),type:"funnel",group:i("Pyramid charts")},{label:i("Boxplot"),type:"boxplot",group:i("Boxplot charts")}],g=["year","month","day","hour","minute"],p=["month month","day day","day weekday","hour weekday","day month","hour hour"],h={},m={},y=function(e,t,a){var n=!1;e?n=!0:e="date"==t?"day":"hour";for(var r=[],i=0;i<=g.indexOf(e)&&(r.push({name:g[i],label:l[g[i]]}),"date"!==t||"day"!=g[i])&&("datetime"!==t||n||"hour"!=g[i])&&("datetime"!==t||!n||"minute"!=g[i]);i++);if(a)for(var o=0;o<p.length&&(r.push({name:p[o],label:l[p[o]]}),"date"!==t||"day month"!=g[o]);o++);return r};return{getDatasetUniqueId:function(a){var n;if(angular.forEach(m,function(e,t){return t.endsWith(a)&&(n=e),!1}),n)return n.getUniqueId();throw"dataset "+a+" not loaded yet."},getDataset:function(a){var n;return angular.forEach(m,function(e,t){return a===t&&(n=e),!1}),n},isChartSortable:function(e){return!this.isRangeChart(e)},isRangeChart:function(e){return-1<["arearange","areasplinerange","columnrange"].indexOf(e)},getAllTimescales:function(){return y("minute","datetime",!0)},getAvailableX:function(e,t){return void 0===t?s[e]:s[e][t]},getAvailableBreakDowns:function(e,t){if(!t)return[];for(var a=-1!==["date","datetime"].indexOf(this.getFieldType(e,t)),n=[],r=0;r<s[e].length;r++)s[e][r].name!==t&&(a&&-1!==["date","datetime"].indexOf(this.getFieldType(e,s[e][r].name))||n.push({label:s[e][r].label,name:s[e][r].name}));return n},getAvailableY:function(e,t){return void 0===t?a[e]:a[e][t]},getTimescales:function(e,t,a){for(var n,r,i=0;i<h[e].length;i++)if(h[e][i].name===t){r=h[e][i];break}if(r){if(r.annotations)for(var o=0;o<r.annotations.length;o++)if("timeserie_precision"==r.annotations[o].name){n=r.annotations[o].args[0];break}return y(n,r.type,a)}},getDatasetId:function(e){return(e.domain||t.domainId)+"."+e.dataset.datasetid},init:function(e,t,a){void 0===a&&(a=!1);var n=[],r=[],i=this.getDatasetId(e);if(a||!(i in u)){h[i]=e.dataset.fields;for(var o=[],s=0;s<h[i].length;s++){var l=h[i][s];if("int"!=l.type&&"double"!=l.type||r.push(l),"datetime"==l.type||"date"==l.type)n.unshift(l);else if("double"==l.type||"int"==l.type)o.push(l);else if(l.annotations)for(var c=0;c<l.annotations.length;c++){var d=l.annotations[c];"facet"!==d.name&&"analyse"!==d.name||n.push(l)}}n=n.concat(o),this.setAvailableX(i,n),this.setAvailableY(i,r),u[i]=!0,m[i]=e.dataset,this.load(i)}},isInitialized:function(e){return""===e?!!u.length:!!(e in u)},load:function(e){if(n[e])for(var t=0;t<n[e].length;t++)n[e][t]();var a;if(n[e]=[],n[""])for(;n[""].length;)a=n[""].pop(),setTimeout(a)},onLoad:function(e,t){"function"==typeof e&&(t=e,e=""),this.isInitialized(e)?t():(e in n||(n[e]=[]),n[e].indexOf(t)<0&&n[e].push(t))},setAvailableX:function(e,t){s[e]=t},setAvailableY:function(e,t){a[e]=t},resolvePosition:function(e){return isNullOrUndefined(e)&&(e="center"),e in c||(e="center"),c[e].position},getPieChartPositions:function(){return $.map(c,function(e,t){return{label:e.label,value:t}})},getDefaultColors:function(){return d},getDefaultColor:function(e,t,a,n){return r.getDefaultColor(e,this.getAllowedColors(t,a),n)},getAllowedColors:function(e,t){var a=[];return(t||this.isMultiColorChart(e))&&a.push("range"),t||this.isMultiColorChart(e)||a.push("single"),a},getAvailableChartTypes:function(e,t){var a=[];if(m[e])for(var n=0;n<f.length;n++)(t&&-1!==["column","area","areaspline","line","spline","bar","polar"].indexOf(f[n].type)||!t)&&(void 0===f[n].filter?a.push(f[n]):m[e][f[n].filter]()&&a.push(f[n]));return a},getSerieTemplate:function(){return angular.copy({alignMonth:!0})},setChartDefaultValues:function(e,t,a,n){var r,i,o="";for(void 0===a&&(a=!1),void 0===n&&(n=!1),i=0;i<t.queries.length;i++)r=this.getFieldType(e,t.queries[i].xAxis),!t.queries[i].timescale||"date"!==r&&"datetime"!==r||(o=t.queries[i].timescale);if(o?!t.timescale&&n&&(t.timescale=o):t.timescale="",t.timescale)for(i=0;i<t.queries.length;i++)t.queries[i].timescale||(t.queries[i].timescale=t.timescale);t.singleAxis||(delete t.singleAxisLabel,delete t.singleAxisScale,delete t.yRangeMin,delete t.yRangeMax),void 0===t.displayLegend&&(t.displayLegend=!0),void 0===t.alignMonth&&(t.alignMonth=!0),a||delete t.xLabel},setDefaultQueryValues:function(e,t,a,n,r,i){t||(t={});var o={},s=o.x||this.getAvailableX(e,0).name,l=50;t.xAxis||(t.xAxis=s),"date"!=this.getFieldType(e,t.xAxis)&&"datetime"!=this.getFieldType(e,t.xAxis)||(l=""),void 0===t.maxpoints&&(t.maxpoints=l),t.charts||(t.charts=[]);var c=t.xAxis,d=this.getFieldType(e,c);"date"==d||"datetime"==d?t.timescale&&-1!==this.getTimescales(e,c,a).map(function(e){return e.name}).indexOf(t.timescale)||(t.timescale="year",t.timescale=a&&r?r:"year"):t.timescale&&(t.timescale=""),t.seriesBreakdown===c&&(t.seriesBreakdown="",t.seriesBreakdownTimescale="");for(var u=!1,f=0;f<t.charts.length;f++)-1!==["treemap","pie"].indexOf(t.charts[f].type)&&(u=!0);u&&(t.seriesBreakdown="",t.seriesBreakdownTimescale=""),!t.seriesBreakdown&&t.charts.length<2&&delete t.stacked,t.sort&&!t.seriesBreakdown||(t.sort="")},setSerieDefaultValues:function(e,t,a,n){var r,i;if(void 0!==a){var o=this.getAvailableY(e);if(t.type||(t.type="column",!a||"date"!=this.getFieldType(e,a)&&"datetime"!=this.getFieldType(e,a)||(t.type="line")),t.func||(t.func=0<o.length?"AVG":"COUNT"),void 0!==t.expr&&void 0===t.yAxis&&(t.yAxis=t.expr,delete t.expr),void 0===t.yAxis||""===t.yAxis?(0===o.length&&-1===["COUNT","CONSTANT","CUSTOM"].indexOf(t.func)&&(t.func="COUNT"),n||-1!==["COUNT","CONSTANT","CUSTOM"].indexOf(t.func)||(t.yAxis=o[0].name)):n||-1!==["COUNT","CONSTANT","CUSTOM"].indexOf(t.func)||0===$.grep(o,function(e){return e.name===t.yAxis}).length&&(t.yAxis=o[0].name),t.type&&this.isRangeChart(t.type))for(t.func="COUNT",i=[5,95],t.charts||(t.yAxis?t.charts=[{func:"MIN",yAxis:t.yAxis},{func:"MAX",yAxis:t.yAxis}]:t.charts=[{func:"COUNT"},{func:"COUNT"}]),5===t.charts.length&&(t.charts[1]=angular.copy(t.charts[4]),t.charts.splice(2,3)),r=0;r<2;r++)void 0!==t.charts[r].yAxis&&""!==t.charts[r].yAxis||(t.charts[r].yAxis=t.charts[r].expr||t.yAxis,delete t.charts[r].expr),"QUANTILES"!==t.charts[r].func||""!==t.charts[r].subsets&&void 0!==t.charts[r].subsets||(t.charts[r].subsets=i[r]),"QUANTILES"!==t.charts[r].func&&t.charts[r].subsets&&delete t.charts[r].subsets;else if(t.type&&"boxplot"===t.type){for(t.func="COUNT",i=[1,25,50,75,100],t.charts||(t.charts=[]),2===t.charts.length&&(t.charts[4]=angular.copy(t.charts[1]),t.charts[1]=void 0),void 0===t.charts[0]&&(t.charts[0]={func:"MIN",yAxis:t.yAxis}),r=1;r<4;r++)void 0===t.charts[r]&&(t.charts[r]={func:"QUANTILES",yAxis:t.yAxis,subsets:i[r]});for(void 0===t.charts[4]&&(t.charts[4]={func:"MAX",yAxis:t.yAxis}),r=0;r<5;r++)void 0!==t.charts[r].yAxis&&""!==t.charts[r].yAxis||(t.charts[r].yAxis=t.charts[r].expr||t.charts[r].yAxis||t.yAxis,delete t.charts[r].expr),"QUANTILES"!==t.charts[r].func||""!==t.charts[r].subsets&&void 0!==t.charts[r].subsets||(t.charts[r].subsets=i[r]),"QUANTILES"!==t.charts[r].func&&t.charts[r].subsets&&delete t.charts[r].subsets}else t.charts&&delete t.charts,"QUANTILES"===t.func?t.subsets||(t.subsets=50):t.subsets&&delete t.subsets;"pie"!==t.type||t.position||(t.position="center"),"column"!==t.type&&"bar"!==t.type&&t.displayStackValues&&(t.displayStackValues=!1),void 0===t.scientificDisplay&&(t.scientificDisplay=!0),delete t.yLabel,delete t.extras}},setSerieDefaultColors:function(e,t,a){e.color=this.getDefaultColor(e.color,e.type,t,a)},getXLabel:function(e,t,a,n){var r=this.getFieldType(e,t),i=this.getFieldLabel(e,t);return"date"!==r&&"datetime"!==r||!a?i:i+" ("+l[a]+")"},getYLabel:function(e,t){if(t.yLabelOverride)return t.yLabelOverride;if(this.isRangeChart(t.type))return this.getYLabel(e,t.charts[0])+" / "+this.getYLabel(e,t.charts[1]);if("boxplot"===t.type)return i("Boxplot");var a=o.getFunctionLabel(t.func),n=t.yAxis||t.expr,r=$.grep(this.getAvailableY(e),function(e){return e.name==n});return 0<r.length&&"COUNT"!==t.func&&"CONSTANT"!==t.func&&"CUSTOM"!==t.func?a+" "+r[0].label:a},getField:function(e,t){if(!h[e])return null;for(var a=0;a<h[e].length;a++){var n=h[e][a];if(n.name==t)return n}},getFieldLabel:function(e,t){var a=this.getField(e,t);return a?a.label:a},getFieldType:function(e,t){var a=this.getField(e,t);return a?a.type:a},getFieldUnit:function(e,t){var a=this.getField(e,t);if(a&&a.annotations){for(var n=0;n<a.annotations.length;n++)if("unit"===a.annotations[n].name)return a.annotations[n].args[0];return a.annotations.unit}return!1},getDecimals:function(e,t){var a=this.getField(e,t);if(a&&a.annotations){for(var n=0;n<a.annotations.length;n++)if("decimals"===a.annotations[n].name)return a.annotations[n].args[0];return!1}return!1},getAvailableFunctions:function(e){return o.getAvailableFunctions(this.getAvailableY(e).length)},allowThresholds:function(e){return-1!==["column","bar","scatter"].indexOf(e)},isMultiColorChart:function(e){return-1!==["pie","treemap","funnel","polar"].indexOf(e)}}}])}(),function(){"use strict";angular.module("ods-widgets").factory("colorScale",["ODSWidgetsConfig",function(e){var t=[{label:"Accent",colors:chroma.brewer.Accent},{label:"Dark2",colors:chroma.brewer.Dark2},{label:"Pastel2",colors:chroma.brewer.Pastel2},{label:"Pastel1",colors:chroma.brewer.Pastel1},{label:"Set2",colors:chroma.brewer.Set2},{label:"Set1",colors:chroma.brewer.Set1},{label:"Paired",colors:chroma.brewer.Paired},{label:"Set3",colors:chroma.brewer.Set3},{label:"OrRd",colors:chroma.brewer.OrRd.slice(1)},{label:"PuBu",colors:chroma.brewer.PuBu.slice(1)},{label:"BuPu",colors:chroma.brewer.BuPu.slice(1)},{label:"Oranges",colors:chroma.brewer.Oranges.slice(1)},{label:"YlOrBr",colors:chroma.brewer.YlOrBr.slice(1)},{label:"YlGn",colors:chroma.brewer.YlGn.slice(1)},{label:"Reds",colors:chroma.brewer.Reds.slice(1)},{label:"RdPu",colors:chroma.brewer.RdPu.slice(1)},{label:"Greens",colors:chroma.brewer.Greens.slice(1)},{label:"YlGnBu",colors:chroma.brewer.YlGnBu.slice(1)},{label:"Purples",colors:chroma.brewer.Purples.slice(1)},{label:"GnBu",colors:chroma.brewer.GnBu.slice(1)},{label:"Greys",colors:chroma.brewer.Greys.slice(1)},{label:"YlOrRd",colors:chroma.brewer.YlOrRd.slice(1)},{label:"PuRd",colors:chroma.brewer.PuRd.slice(1)},{label:"Blues",colors:chroma.brewer.Blues.slice(1)},{label:"PuBuGn",colors:chroma.brewer.PuBuGn.slice(1)},{label:"Spectral",colors:chroma.brewer.Spectral},{label:"RdYlGn",colors:chroma.brewer.RdYlGn},{label:"RdBu",colors:chroma.brewer.RdBu},{label:"PiYG",colors:chroma.brewer.PiYG},{label:"PRGn",colors:chroma.brewer.PRGn},{label:"RdYlBu",colors:chroma.brewer.RdYlBu},{label:"BrBG",colors:chroma.brewer.BrBG},{label:"RdGy",colors:chroma.brewer.RdGy},{label:"PuOr",colors:chroma.brewer.PuOr}],r="Set2",i="",o=0;if(e.chartColors&&0<e.chartColors.length){i="custom";var a=angular.copy(e.chartColors);angular.isArray(a)||(a=[a]),1==a.length&&a.push(a[0]),t.unshift({label:"custom",colors:a}),chroma.brewer.custom=a}function n(e){var t=s(e);return chroma.scale().range(t)}function s(e){var t,a,n;return"["===e[0]?JSON.parse(e):((a=e)?(a.startsWith("custom-")&&(a=a.replace("custom-","")),a.startsWith("range-")?a=a.replace("range-",""):a.startsWith("single-")&&(a=a.replace("single-","")),chroma.brewer[a]&&(n=a)):n=i||r,(t=n)?chroma.brewer[t]:[e=(e=e.replace("custom-","")).replace("single-",""),e])}return{getScale:function(e,t,a){return t=void 0!==t?t:0,a=void 0!==a?a:1,n(e).domain([t,a])},getUniqueColor:function(e){return n(e)(1).hex()},getColorAtIndex:function(e,t){var a=s(e);return a[t%a.length]},getColors:function(e){return s(e)},getColorSets:function(){return chroma.brewer},getOrderedColorSets:function(){return t},getDefaultColorSet:function(){return i||r},getDefaultColor:function(e,t,a){var n,r=this.getColorList(t);return void 0!==e&&""!==e?e:"undefined"!=typeof backupColor&&""!==backupColor?backupColor:(r[o].label.startsWith("custom-")&&(o=(o+1)%r.length),void 0!==a?n=r[a%r.length].label:(n=r[o].label,o=(o+1)%r.length),n)},getColorList:function(e,t){var a=[];if(-1!==e.indexOf("single")){var n=this.getColors(this.getDefaultColorSet());angular.forEach(n,function(e){a.push({label:e,color:e})})}return-1!==e.indexOf("range")&&angular.forEach(this.getOrderedColorSets(),function(e){a.push({label:"range-"+e.label,color:e.colors})}),a},isColorAllowed:function(t,e,a){var n=!1;return!!t&&(-1===a.indexOf("range")?!t.startsWith("range-")&&!t.startsWith("custom-range-"):-1!==a.indexOf("range")?!t.startsWith("custom-single-")&&(angular.forEach(e,function(e){e.label===t&&(n=!0)}),n):void 0)}}}])}(),function(){"use strict";var e=angular.module("ods-widgets"),p={},h={};e.factory("ContextHelper",["ODSAPI","$q","QueryParameters",function(u,f,g){return{getDatasetContext:function(t,e,a,n,r,i,o){var s=f.defer(),l={wait:function(){return s.promise},getDownloadURL:function(e,t){if(this.dataset&&this.dataset.datasetid){e=e||"csv";var a=this.domainUrl+"/explore/dataset/"+this.dataset.datasetid+"/download/?format="+e;return a+=this.getQueryStringURL(t)}},getQueryStringURL:function(e){return e=e||{},"&"+ODS.URLUtils.getAPIQueryString(angular.extend({},this.parameters,e))},toggleRefine:function(e,t,a){ODS.Context.toggleRefine(this,e,t,a)},getFacetValues:function(e){var a=f.defer(),t=angular.extend({},this.parameters,{rows:0,facet:e});return u.records.search(this,t).success(function(e){var t=e.facet_groups[0].facets.map(function(e){return e.name});a.resolve(t)}),a.promise},getActiveFilters:function(t){if(t=t||[],this.parameters){var e=Object.keys(this.parameters),a=this;return e.filter(function(e){var t=g;return"q"==e&&a.parameters.q&&0<a.parameters.q.length||-1<t.indexOf(e)||"geofilter.polygon"==e||"geofilter.distance"==e||0===e.indexOf("refine.")||e.match(/q\.[^\s]*/)}).filter(function(e){return-1===t.indexOf(e)})}return[]},name:t,type:"dataset",domain:e,domainUrl:u.getDomainURL(e),apikey:i,dataset:null,parameters:n,source:n&&n.source||r||null,error:!1};if(o)l.dataset=new ODS.Dataset(o),s.resolve(l.dataset);else{var c=n&&n.source||r||"",d=(l.domain||"")+"."+c+"."+a+"."+(i||"");angular.isDefined(p[d])?(l.dataset=new ODS.Dataset(p[d]),s.resolve(l.dataset)):angular.isDefined(h[d])?h[d].then(function(e){l.dataset=new ODS.Dataset(e.data),s.resolve(l.dataset)}):(h[d]=u.datasets.get(l,a,{extrametas:!0,interopmetas:!0,source:c}),h[d].success(function(e){p[d]=e,l.dataset=new ODS.Dataset(e),s.resolve(l.dataset)}).error(function(e){l.error=!0,s.reject("Failed to fetch "+t+" context.")}))}return l}}}])}(),function(){"use strict";angular.module("ods-widgets").provider("ODSCurrentDomain",[function(){var t={domainId:""};this.setDomain=function(e){t.domainId=e},this.$get=function(){return t}}])}(),function(){"use strict";angular.module("ods-widgets").service("odsHttpErrorMessages",function(t){this.getForStatus=function(e){switch(e){case 400:return t("Bad request: please retry the request later or contact the administrator.");case 401:return t("Request unauthorized: authentication is required.");case 403:return t("Request forbidden: you may not have the necessary permissions for the requested resource.");case 404:return t("Resource not found: if you have followed a valid link, please contact the administrator.");case 408:return t("Request timeout: please retry the request later or contact the administrator.");case 429:return t("Too many requests or API calls quota has been exceeded: please retry the request later or contact the administrator.");case 503:case 504:return t("The service is unavailable: please retry the request later or contact the administrator.");default:return t("The server encountered an internal error. Please retry the request or contact the administrator.")}}})}(),function(){"use strict";angular.module("ods-widgets").service("I18n",["translate",function(e){return{weekdays:{shorthand:[e("Sun"),e("Mon"),e("Tue"),e("Wed"),e("Thu"),e("Fri"),e("Sat")],longhand:[e("Sunday"),e("Monday"),e("Tuesday"),e("Wednesday"),e("Thursday"),e("Friday"),e("Saturday")]},months:{shorthand:[e("Jan"),e("Feb"),e("Mar"),e("Apr"),e("May"),e("Jun"),e("Jul"),e("Aug"),e("Sep"),e("Oct"),e("Nov"),e("Dec")],longhand:[e("January"),e("February"),e("March"),e("April"),e("May"),e("June"),e("July"),e("August"),e("September"),e("October"),e("November"),e("December")]},fr:{timeFormat:"HH:mm",timeSeparators:[":"],dateFormat:"DD/MM/YYYY",dateSeparators:["/"],firstDayOfWeek:1},en:{timeFormat:"hh:mm A",timeSeparators:[":"," "],dateFormat:"MM/DD/YYYY",dateSeparators:["/"],firstDayOfWeek:0}}}])}(),function(){"use strict";angular.module("ods-widgets").factory("MapHelper",["ODSWidgetsConfig","ODSAPI","$q","AggregationHelper","translate",function(e,s,l,o,c){var t="#C32D1C";return{WORLD_BOUNDS:[[-60,-180],[80,180]],DEFAULT_MARKER_COLOR:t,DEFAULT_RANGE_COLORS:["#FC9272","#A5211B"],retrieveBounds:function(e){var t=this,a=l.defer();if(0===e.length)a.resolve(null);else{var n=[];angular.forEach(e,function(e){var t={};jQuery.extend(t,e.parameters),n.push(s.records.boundingbox(e,t))}),l.all(n).then(function(e){var n;angular.forEach(e,function(e){var t=e.data,a=[[t.bbox[1],t.bbox[0]],[t.bbox[3],t.bbox[2]]];0<t.count&&(n?n.extend(a):n=L.latLngBounds(a))}),n&&n.isValid()?a.resolve(n):a.resolve(t.WORLD_BOUNDS)})}return a.promise},getLocationStructure:function(e){var t=e.split(",");return{center:[t[1],t[2]],zoom:t[0]}},getLocationParameter:function(e,t){return angular.isArray(e)&&(e=L.latLng(e)),t+","+L.Util.formatNum(e.lat,5)+","+L.Util.formatNum(e.lng,5)},_getDatasetFieldBound:function(e,t,a){var n=this,r=l.defer(),i=angular.extend({},e.parameters,{rows:1}),o=t;return a&&(o=a+o),s.records.search(e,angular.extend(i,{sort:o})).then(function(e){r.resolve(n.boundAsNumber(e.data.records[0].fields[t]))}),r.promise},getDatasetFieldBoundMin:function(e,t){return this._getDatasetFieldBound(e,t,"-")},getDatasetFieldBoundMax:function(e,t){return this._getDatasetFieldBound(e,t)},getDatasetFieldBounds:function(e,t){var a=[this.getDatasetFieldBoundMin(e,t),this.getDatasetFieldBoundMax(e,t)],r=l.defer();return l.all(a).then(function(e){var t=e.sort(ODS.ArrayUtils.sortNumbers),a=t[0],n=t[1];r.resolve([a,n])}),r.promise},getDatasetAggregationBounds:function(e,a,t){var n=angular.extend({},e.parameters),r=l.defer();return n.maxpoints=1,"COUNT"!==a&&(n["y.serie.expr"]=t,n["y.serie.func"]=a),s.records.geopolygon(e,n).then(function(e){var t=e.data;"COUNT"!==a?r.resolve([t.series.serie.min,t.series.serie.max]):r.resolve([t.count.min,t.count.max])}),r.promise},boundAsNumber:function(e){return parseFloat(e)},getLayerLegendLabel:function(e){var t=null;if(0<=["choropleth","categories","heatmap","clusters"].indexOf(e.display)){var a;if("categories"===e.display||"choropleth"===e.display&&e.color.field?a=e.context.dataset.getField(e.color.field):"COUNT"!==e.func.toUpperCase()&&(a=e.context.dataset.getField(e.expr)),a){t=a.label;var n=[];e.func&&n.push(o.getFunctionLabel(e.func));var r=e.context.dataset.getFieldAnnotation(a,"unit");if(r){var i=c("in {unit}");n.push(format_string(i,{unit:r.args[0]}))}n.length&&(t+=" ("+n.join(", ")+")")}else t=c("Number of elements");return t}},MapConfiguration:{getActiveContextList:function(e,t){t=t||{};var a=[];return angular.forEach(e.groups,function(e){e.displayed&&angular.forEach(e.layers,function(e){e.context.error||t.geoOnly&&!e.context.dataset.hasGeoField()||e.excludeFromRefit&&t.skipExcludedFromRefit||a.push(e.context)})}),a},getContextList:function(e){var t=[];return angular.forEach(e.groups,function(e){angular.forEach(e.layers,function(e){e.context&&e.context.dataset&&e.context.dataset.hasGeoField()&&t.push(e.context)})}),t},createLayerGroupConfiguration:function(){return{color:null,title:null,description:null,displayed:!0,picto:null,layers:[]}},createLayerConfiguration:function(e,t){angular.isUndefined(t)&&(t={});var a=t.display||"auto";"clusters"!==a&&"clustersforced"!==a||(a="polygonforced"),"raw"===a&&(a="none"),t.size=Math.min(t.size,10),t.radius=Math.min(t.radius,10);var n={context:null,color:t.color,colorFunction:t.colorFunction,picto:t.picto,display:a,func:t.function||null,expr:t.expression||null,marker:null,size:t.size||null,radius:t.radius||null,tooltipDisabled:!!angular.isDefined(t.tooltipDisabled)&&t.tooltipDisabled,tooltipTemplate:e,localKey:t.localKey||null,remoteKey:t.remoteKey||null,tooltipSort:t.tooltipSort,hoverField:t.hoverField||null,shapeOpacity:t.shapeOpacity||null,pointOpacity:t.pointOpacity||null,lineWidth:t.lineWidth||null,borderOpacity:t.borderOpacity||null,borderColor:t.borderColor,borderSize:t.borderSize||null,borderPattern:t.borderPattern||null,excludeFromRefit:t.excludeFromRefit,caption:!!angular.isDefined(t.caption)&&t.caption,captionTitle:t.captionTitle||null,captionPictoIcon:t.captionPictoIcon||null,captionPictoColor:t.captionPictoColor||null,title:t.title||null,description:t.description||null,showZoomMin:t.showZoomMin||null,showZoomMax:t.showZoomMax||null,minSize:t.minSize||null,maxSize:t.maxSize||null,sizeFunction:t.sizeFunction||null,geoField:t.geoField};return!n.func&&-1<["shape","aggregation"].indexOf(n.display)&&(n.func="COUNT"),this.createLayerId(n),n},setLayerDisplaySettingsFromDefault:function(e){(angular.isUndefined(e.marker)||null===e.marker)&&(null!==e.context.dataset.getExtraMeta("visualization","map_marker_hidemarkershape")?e.marker=!e.context.dataset.getExtraMeta("visualization","map_marker_hidemarkershape"):e.marker=!0),e.color=e.color||e.context.dataset.getExtraMeta("visualization","map_marker_color")||t,e.picto=e.picto||e.context.dataset.getExtraMeta("visualization","map_marker_picto")||(e.marker?"ods-circle":"dot"),e.marker?e.size=e.size||4:e.size=e.size||7,(angular.isUndefined(e.shapeOpacity)||null===e.shapeOpacity)&&(e.shapeOpacity=e.shapeOpacity||.5),(angular.isUndefined(e.pointOpacity)||null===e.pointOpacity)&&(e.pointOpacity=e.pointOpacity||1),e.radius=e.radius||4,e.lineWidth=e.lineWidth||5,e.borderOpacity=e.borderOpacity||1,e.borderColor=e.borderColor||"#FFFFFF",e.borderSize=e.borderSize||1,e.borderPattern=e.borderPattern||"solid",e.sizeFunction=e.sizeFunction||"linear",e.minSize=e.minSize||3,e.maxSize=e.maxSize||5,this.createLayerId(e)},getVisibleLayerIds:function(e){var t=[];return angular.forEach(e.groups,function(e){e.displayed&&angular.forEach(e.layers,function(e){t.push(e._runtimeId)})}),t},createLayerId:function(e){angular.isUndefined(e._runtimeId)&&(e._runtimeId=ODS.StringUtils.getRandomUUID())}}}}])}(),function(){"use strict";angular.module("ods-widgets").factory("MapLayerHelper",["$rootScope","$compile","$filter","ODSAPI","PictoHelper","SVGInliner",function(g,p,t,u,e,a){return{getRecordColor:function(e,t){var a,n;if(angular.isUndefined(t.color))return"#C32D1C";if(angular.isString(t.color))return t.color;if("range"===t.color.type)return t.color.field?(a=e&&e.fields&&e.fields[t.color.field],angular.isUndefined(a)?t.color.colors[0]:this.getColor(a,t)):(console.error("Range coloring requires a field"),t.color.colors[0]);if("categories"===t.color.type)return a=e&&e.fields&&e.fields[t.color.field],n=t.color.categories[a],angular.isUndefined(n)?t.color.otherCategories||"#000000":n;if("field"===t.color.type){if(!(n=e&&e.fields&&e.fields[t.color.field]))return"#000000";try{return chroma(n).hex()}catch(e){return"#000000"}}else{if("choropleth"!==t.color.type)return console.error("Scale coloring is not supported for simple records"),chroma.scale(t.color.scale).out("hex").scale(0);var r,i=Object.keys(t.color.ranges).sort(function(e,t){return parseFloat(e)-parseFloat(t)}),o=t.color.ranges[i[i.length-1]],s=this.getSplitComplementaryColors(o);if(a=t.func?e:e&&e.fields&&e.fields[t.color.field],a=ODS.NumberUtils.limitDecimals(a,5),angular.isUndefined(a))return t.color.undefinedColor||s[1];if(!angular.isNumber(a))return console.warn(a,"is not a numeric value to display in choropleth mode."),t.color.undefinedColor||s[1];if(a<t.color.minValue||a>i[i.length-1])return t.color.outOfBoundsColor||s[0];for(r=0;r<i.length;r++)if(a<=i[r])return t.color.ranges[i[r]]}},getClusterColor:function(e,t){return angular.isUndefined(t.color)?"#C32D1C":angular.isString(t.color)?t.color:t.color.colors[0]},getColor:function(e,t,a,n,r){if(r=r||10,angular.isUndefined(t.color))return"#C32D1C";if(angular.isString(t.color))return angular.isDefined(a)&&angular.isDefined(n)?chroma.scale([chroma(t.color).brighten(50),t.color]).domain([a,n],Math.min(10,r),t.colorFunction).out("hex")(e):t.color;if("scale"===t.color.type)return chroma.scale(t.color.scale).domain([a,n],Math.min(10,r),t.colorFunction).out("hex")(e);if("range"===t.color.type){var i;for(i=0;i<t.color.ranges.length;i++)if(e<t.color.ranges[i])return t.color.colors[i];return t.color.colors[t.color.colors.length-1]}},bindTooltip:function(n,e,r,i,o,s,t){var l=this;angular.isArray(i)&&(i={type:"Point",coordinates:[i[1],i[0]]}),r.refineOnClick?e.on("click",function(e){g.$broadcast("ods-map-interactive-click"),n.isDrawing||l.refineContextOnClick(r,i,s,t,o)}):r.tooltipDisabled||e.on("click",function(e){var t,a;n.isDrawing||(g.$broadcast("odsMapInteractiveClick"),(i||o||s||e.data)&&(a=angular.isDefined(e.target.getLatLng)?(t=e.target.getLatLng(),l.getMarkerTooltipYOffset(e.target,r)):(t=e.latlng,0),l.showPopup(n,r,t,i,o,s,a,e.data||null)))})},refineContextOnClick:function(o,s,l,c,d){angular.forEach(o.refineOnClick,function(e){var t=e.contextField,a=e.mapField,n=e.context,r=e.replaceRefine;if(a||t)if(angular.isDefined(c)&&a==o.hoverField)g.$apply(function(){n.toggleRefine(t,c,r)});else{var i={format:"json"};l?o.geoField?i["geo_digest."+o.geoField]=l:i.geo_digest=l:d?i.q="recordid:"+d:ODS.GeoFilter.addGeoFilterFromSpatialObject(i,s),angular.extend(i,o.context.parameters,{rows:1}),u.records.download(o.context,i).success(function(e){angular.isDefined(e[0].fields[a])&&n.toggleRefine(t,e[0].fields[a],r)})}else g.$apply(function(){ODS.GeoFilter.addGeoFilterFromSpatialObject(n.parameters,s)})})},bindZoomable:function(t,e,a){var n=this;e.on("click",function(e){t.isDrawing||(t.getZoom()!==t.getMaxZoom()||a.tooltipDisabled?t.setView(e.latlng,t.getZoom()+2):n.showPopup(t,a,e.target.getLatLng(),e.target.getClusterShape()))})},showPopup:function(e,t,a,n,r,i,o,s){var l=g.$new(!0);r&&(l.recordid=r),n&&(l.shape=n),s&&(l.gridData=s);var c=t.context.dataset;l.map=e,l.template=t.tooltipTemplate||c.extra_metas&&c.extra_metas.visualization&&!c.extra_metas.visualization.map_tooltip_disabled&&c.extra_metas.visualization.map_tooltip_html_enabled&&c.extra_metas.visualization.map_tooltip_html||"",l.context=t.context;var d={offset:[0,angular.isDefined(o)?o:-30],maxWidth:250,minWidth:250},u='<ods-map-tooltip tooltip-sort="'+(t.tooltipSort||"")+'" shape="shape" recordid="recordid" context="context" map="map" template="{{ template }}" grid-data="gridData" geo-digest="'+(i||"")+'"></ods-map-tooltip>',f=p(u)(l)[0];this._handleTopOverflow(e,d,a,330),this._handleBoundsOverflow(e,d,a,330),new L.Popup(d).setLatLng(a).setContent(f).openOn(e)},formatNumber:function(e){return e=Math.round(100*e)/100,e=t("number")(e)},getClusterValue:function(e,t){return"aggregation"===t.display&&t.joinContext?e.serie1:-1===["COUNT",null].indexOf(t.func)&&this.isAnalyzeEnabledClustering(t)?e.series?e.series.serie1:null:e.count},getClusterMin:function(e,t){return"aggregation"===t.display&&t.joinContext?e.aggregations.agg1.min:-1===["COUNT",null].indexOf(t.func)&&this.isAnalyzeEnabledClustering(t)?e.series.serie1.min:e.count?e.count.min:void 0},getClusterMax:function(e,t){return"aggregation"===t.display&&t.joinContext?e.aggregations.agg1.max:-1===["COUNT",null].indexOf(t.func)&&this.isAnalyzeEnabledClustering(t)?e.series.serie1.max:e.count?e.count.max:void 0},getClusterValues:function(e,t){var a,n=[];if("aggregation"===t.display&&t.joinContext)for(a=0;a<e.results.length;a++)n.push(e.results[a].serie1);else if(-1===["COUNT",null].indexOf(t.func)&&this.isAnalyzeEnabledClustering(t))for(a=0;a<e.clusters.length;a++)e.clusters[a].series&&n.push(e.clusters[a].series.serie1);else for(a=0;a<e.clusters.length;a++)n.push(e.clusters[a].count);return n},isAnalyzeEnabledClustering:function(e){return 0<=["heatmap","polygonforced","shape","aggregation","clusters","choropleth"].indexOf(e.display)},doesLayerRefreshOnLocationChange:function(e){return"tiles"!==e.display&&("shape"!==e.display&&"aggregation"!==e.display||!e.joinContext)},getMarkerTooltipYOffset:function(e,t){var a=e.options.icon.options.iconSize.y,n=e.options.size+1,r=e.options.icon.options.iconAnchor.y;return e.options.marker?-a+n+10:"dot"===t.picto?0:-a+r+10},drawPoint:function(n,r,i,o,s,l){var c=this;a.getPromise(e.mapPictoToURL(n.picto,n.context),n.marker?"white":c.getRecordColor(o,n)).then(function(e){var t=n.refineOnClick||!angular.isDefined(n.tooltipDisabled)||!n.tooltipDisabled,a=new L.VectorMarker(i,{color:c.getRecordColor(o,n),icon:e,marker:n.marker,opacity:n.pointOpacity,size:n.size,clickable:t});s.addLayer(a),t&&(angular.isObject(o)?c.bindTooltip(r,a,n,i,o.recordid):c.bindTooltip(r,a,n,i,null,l))})},drawShape:function(a,e,t,n,r,i){var o=this,s=a.refineOnClick||!angular.isDefined(a.tooltipDisabled)||!a.tooltipDisabled,l=new L.GeoJSON(t,{clickable:s,style:function(e){var t={radius:3};return a.borderPattern&&"solid"!==a.borderPattern&&(t.dashArray=o.patternToDashArray(a.borderPattern)),"LineString"===e.geometry.type||"MultiLineString"===e.geometry.type?(t.weight=a.lineWidth,t.color=o.getRecordColor(n,a),angular.isDefined(a.shapeOpacity)?t.opacity=a.shapeOpacity:t.opacity=.5):(t.fillColor=o.getRecordColor(n,a),angular.isDefined(a.borderSize)?t.weight=a.borderSize:t.weight=1,angular.isDefined(a.shapeOpacity)?t.fillOpacity=a.shapeOpacity:t.fillOpacity=.5,angular.isDefined(a.borderOpacity)?t.opacity=a.borderOpacity:t.opacity=1,angular.isDefined(a.borderColor)?t.color=a.borderColor:t.color="#fff",a.borderPattern&&"solid"!==a.borderPattern&&(t.dashArray=o.patternToDashArray(a.borderPattern))),t}});s&&(angular.isObject(n)?o.bindTooltip(e,l,a,t,n.recordid):o.bindTooltip(e,l,a,t,null,i)),r.addLayer(l)},patternToDashArray:function(e){var t;switch(e){case"long-dashes":t=[30,15];break;case"medium-dashes":t=[15,15];break;case"short-dashes":t=[5,15];break;case"dots":t=[1,15];break;case"short-dot":t=[1,5,5];break;case"short-dot-dot":t=[1,5,5,1,5];break;case"medium-short":t=[15,5,5,5];break;default:console.error("Unknown border pattern",e)}return t.join(", ")},_splitComplimentaryColors:{},_generateSplitComplimentaryColors:function(e){for(var t,a=[150,210],n=[],r=0;r<a.length;r++)(t=chroma(e).hsl()).splice(0,1,t[0]+a[r]),t=chroma.apply(null,t.concat(["hsl"])),n.push(t.hex());return n},getSplitComplementaryColors:function(e){return this._splitComplimentaryColors[e]||(this._splitComplimentaryColors[e]=this._generateSplitComplimentaryColors(e)),this._splitComplimentaryColors[e]},_handleTopOverflow:function(e,t,a,n){var r=e.latLngToContainerPoint(a),i=n+Math.abs(t.offset[1]),o=r.y-i;o<0&&e.panBy([0,o-5])},_handleBoundsOverflow:function(e,t,a,n){e.project(a).y<n&&(t.className="odswidget-map-tooltip--reverse",t.offset=[0,10])}}}])}(),function(){"use strict";angular.module("ods-widgets").factory("MapLayerRenderer",["ODSAPI","AggregationHelper","SVGInliner","PictoHelper","MapLayerHelper","MapRenderingAggregation","MapRenderingClustered","MapRenderingHeatmap","MapRenderingRaw","MapRenderingShapePreview","MapRenderingChoroplethAggregation","$q","$filter","$rootScope","$compile","$timeout",function(d,e,t,a,u,f,g,p,h,m,y,v,n,b,r,w){return{updateDataLayer:function(a,n,t){var r=new L.LayerGroup;a._currentRequestTimeout&&a._currentRequestTimeout.resolve();var i=v.defer();a._currentRequestTimeout=i;var o=function(e){a._rendered=e,a._currentRequestTimeout=null,a._loading=!1,t.resolve()};if(a.context.error)console.log('ERROR: Unknown dataset "'+a.title+'"');else if("tiles"===a.display){a._rendered||(a._rendered=new L.BundleTileLayer("",{tileSize:512,minZoom:n.getMinZoom(),maxZoom:n.getMaxZoom(),gridLayer:{options:{resolution:4}}}),n.addLayer(a._rendered),w(function(){a._rendered.on("loading",function(){a._loading=!0,b.$apply()}),a._rendered.on("load",function(){a._loading=!1,b.$apply()})},0),u.bindTooltip(n,a._rendered,a));var e={color:a.color,icon:a.picto,showmarker:a.marker};angular.extend(e,a.context.parameters);var s="/api/datasets/1.0/"+a.context.dataset.datasetid+"/tiles/simple/{z}/{x}/{y}.bundle",l="";angular.forEach(e,function(e,t){null!==e&&(l+=l?"&":"?",l+=t+"="+encodeURIComponent(e))}),s+=l,a._rendered._url!==s&&a._rendered.setUrl(s),t.resolve()}else if("none"===a.display||n.getZoom()===n.getMaxZoom()&&"polygon"===a.display)a._loading=!0,h.render(a,n,r,i).then(o);else if(0<=["polygon","polygonforced","clusters"].indexOf(a.display))a._loading=!0,g.render(a,n,r,i,!0).then(o);else if("heatmap"===a.display)a._loading=!0,p.render(a,n,r,i).then(o);else if("shape"===a.display||"aggregation"===a.display)a._loading=!0,f.render(a,n,r,i).then(o);else if("categories"===a.display)a._loading=!0,h.render(a,n,r,i).then(o);else if("choropleth"===a.display)a._loading=!0,a.func?y.render(a,n,r,i).then(o):h.render(a,n,r,i).then(o);else if("auto"===a.display){a._loading=!0;var c=angular.extend({},a.context.parameters,{"geofilter.bbox":ODS.GeoFilter.getBoundsAsBboxParameter(n.getBounds())});d.records.boundingbox(a.context,c).success(function(e){var t=e.count<5e5;e.geometries&&e.geometries.Point&&e.geometries.Point>e.count/2&&(e.count<200||n.getZoom()===n.getMaxZoom())?h.render(a,n,r,i).then(o):e.count<5e5?e.geometries&&e.geometries.Point&&e.geometries.Point>e.count/2?g.render(a,n,r,i,t).then(o):m.render(a,n,r,i).then(o):g.render(a,n,r,i,t).then(o)})}else console.log('ERROR: Unknown display mode "'+a.display+'"');return r}}}])}(),function(){"use strict";angular.module("ods-widgets").service("MapRenderingAggregation",["ODSAPI","MapLayerHelper","AggregationHelper","$q",function(c,x,C,d){return{render:function(m,y,e,t){var v,b,a,w=d.defer(),_=e;if(m.joinContext){var n=m.localKey,r=m.remoteKey;n&&r||console.error("An aggregation layer with a remote dataset requires a local-key and a remote-key");var i=m.joinContext.dataset.getFieldsForType("geo_shape");i.length||console.error("You can only join an aggregation layer with a dataset that contains a geo_shape field.");var o=i[0].name;v=function(e){return angular.isArray(e.x)&&e.x[0].fields?e.x[0].fields[o]:null},b=function(e){return e.results};var s=o;m.hoverField&&(s+=","+m.hoverField),a=angular.extend({},m.context.parameters,{clusterprecision:y.getZoom(),"geofilter.bbox":ODS.GeoFilter.getBoundsAsBboxParameter(y.getBounds()),"join.agg1.fields":s,"join.agg1.remotedataset":m.joinContext.dataset.datasetid,"join.agg1.remotekey":r,"join.agg1.localkey":n,"agg.agg1.func":"MIN,MAX","agg.agg1.expr":"serie1","y.serie1.expr":m.expr,"y.serie1.func":m.func}),c.records.analyze(m.context,a,t.promise).success(l)}else v=function(e){return e.cluster},b=function(e){return e.clusters},a=angular.extend({},m.context.parameters,{clusterprecision:y.getZoom(),"geofilter.bbox":ODS.GeoFilter.getBoundsAsBboxParameter(y.getBounds())}),"COUNT"!==m.func&&x.isAnalyzeEnabledClustering(m)&&(a["y.serie1.expr"]=m.expr,a["y.serie1.func"]=m.func),c.records.geopolygon(m.context,a,t.promise).success(l);function l(e){var t=b(e);if(0!==t.length){var s=x.getClusterMin(e,m),l=x.getClusterMax(e,m),c=x.getClusterValues(e,m),d=function(e){return x.getColor(e,m,s,l,c.length)},r={radius:3,color:"#fff",weight:1,opacity:.9,fillOpacity:.5};if((!angular.isObject(m.color)||"range"!==m.color.type)&&("COUNT"!==m.func&&x.isAnalyzeEnabledClustering(m)||s!==l)){L.Legend=L.Control.extend({initialize:function(e){L.Control.prototype.initialize.call(this,e)},onAdd:function(e){var t=chroma.scale().domain([s,l],Math.min(10,c.length),m.colorFunction).domain(),a="",n=L.DomUtil.create("div","odswidget-map__legend"),r=(m.context.dataset.datasetid,m.expr);if(r&&(r=m.context.dataset.getFieldLabel(m.expr)),a+='<div class="odswidget-map__legend-title">'+m.context.dataset.metas.title+"<br/>"+C.getFunctionLabel(m.func),"COUNT"!==m.func&&(a+=" "+r),a+="</div>",a+='<div class="odswidget-map__legend-colors">',1===c.length)a+='<i class="color_0" style="width: 90%; background-color:'+d((t[0]+t[1])/2)+'; opacity: 1;"></i>',a+='</div><div class="odswidget-map__legend-counts">',a+='<span class="odswidget-map__legend-value">',a+=x.formatNumber(t[0]),a+="</span>";else{for(var i=90/(t.length-1),o=0;o<t.length-1;o++)a+='<i class="odswidget-map__legend-color" style="width:'+i+"%; background-color:"+d((t[o]+t[o+1])/2)+'; opacity: 1;"></i>';a+="</div><div>",a+='<span class="odswidget-map__legend-value">',a+=x.formatNumber(t[0]),a+="</span>",a+='<span class="odswidget-map__legend-value">',a+=x.formatNumber(t[t.length-1]),a+="</span>"}return a+="</div>",n.innerHTML=a,n}});var a=new L.Legend({position:"bottomleft"}),n=function(e){e.layer===_&&(y.addControl(a),y.off("layeradd",n))};y.on("layeradd",n);var i=function(e){e.layer===_&&(y.removeControl(a),y.off("layerremove",i))};y.on("layerremove",i)}for(var o,u=0;u<t.length;u++){var f,g,p=t[u],h=x.getClusterValue(p,m);null!==h&&(g=v(p))&&(f=new L.GeoJSON(g,{pointToLayer:function(e,t){return L.circleMarker(t,r)},highlight:x.getColor(h,m,s,l,c.length),style:function(e){var t=angular.copy(r);t.fillColor=d(h);var a={shapeOpacity:"fillOpacity",size:"radius",borderSize:"weight",borderOpacity:"opacity",borderColor:"color"};for(var n in a)a.hasOwnProperty(n)&&angular.isDefined(m[n])&&(t[a[n]]=m[n]);return"LineString"!==e.geometry.type&&"MultiLineString"!==e.geometry.type||(t.weight=5,t.color=d(h)),t}}),"LineString"!==g.type&&"MultiLineString"!==g.type&&((o=f).on("mouseover",function(e){e.target.setStyle({weight:2})}),o.on("mouseout",function(e){e.target.setStyle({weight:1})})),m.joinContext&&m.hoverField?p.x[0].fields[m.hoverField]?(f.bindLabel(p.x[0].fields[m.hoverField]),m.refineOnClick&&x.bindTooltip(y,f,m,g,null,p.geo_digest,p.x[0].fields[m.hoverField])):m.refineOnClick&&x.bindTooltip(y,f,m,g,null,p.geo_digest):(("COUNT"!==m.func&&x.isAnalyzeEnabledClustering(m)||s!==l)&&f.bindLabel(x.formatNumber(h)),x.bindTooltip(y,f,m,g,null,p.geo_digest)),_.addLayer(f))}w.resolve(_)}else w.resolve(_)}return w.promise}}}])}(),function(){"use strict";angular.module("ods-widgets").service("MapRenderingChoroplethAggregation",["ODSAPI","MapLayerHelper","AggregationHelper","$q",function(n,d,e,r){return{render:function(o,s,e,t){var l=r.defer(),c=e,a=angular.extend({},o.context.parameters,{clusterprecision:s.getZoom(),"geofilter.bbox":ODS.GeoFilter.getBoundsAsBboxParameter(s.getBounds())});return o.geoField&&(a.geo_field=o.geoField),"COUNT"!==o.func&&d.isAnalyzeEnabledClustering(o)&&(a["y.serie1.expr"]=o.expr,a["y.serie1.func"]=o.func),n.records.geopolygon(o.context,a,t.promise).success(function(e){for(var t=e.clusters,a=0;a<t.length;a++){var n=t[a],r=d.getClusterValue(n,o),i=n.cluster;"Point"===i.type?d.drawPoint(o,s,[i.coordinates[1],i.coordinates[0]],r,c,n.geo_digest):d.drawShape(o,s,i,r,c,n.geo_digest)}l.resolve(c)}),l.promise}}}])}(),function(){"use strict";angular.module("ods-widgets").service("MapRenderingClustered",["ODSAPI","MapLayerHelper","SVGInliner","PictoHelper","$q",function(n,c,e,t,r){return{render:function(i,o,s,e,t){var l=r.defer(),a=angular.extend({},i.context.parameters,{clusterdistance:50,clusterprecision:o.getZoom(),"geofilter.bbox":ODS.GeoFilter.getBoundsAsBboxParameter(o.getBounds()),return_polygons:t});return"COUNT"!==i.func&&c.isAnalyzeEnabledClustering(i)&&(a["y.serie1.expr"]=i.expr,a["y.serie1.func"]=i.func),n.records.geo(i.context,a,e.promise).success(function(e){for(var t=e.clusters,a=0;a<t.length;a++){var n=t[a];if(1===n.count&&"polygonforced"!==i.display&&"clusters"!==i.display)c.drawPoint(i,o,n.cluster_center,n,s);else if(null!==c.getClusterValue(n,i)){var r=new L.ClusterMarker(n.cluster_center,{geojson:n.cluster,value:c.getClusterValue(n,i),min:c.getClusterMin(e,i),max:c.getClusterMax(e,i),color:c.getClusterColor(n,i),opacity:i.pointOpacity,numberFormattingFunction:c.formatNumber,minSize:i.minSize,maxSize:i.maxSize,borderOpacity:i.borderOpacity,borderSize:i.borderSize,borderColor:i.borderColor,sizeFunction:i.sizeFunction});c.bindZoomable(o,r,i),s.addLayer(r)}}l.resolve(s)}),l.promise}}}])}(),function(){"use strict";angular.module("ods-widgets").service("MapRenderingHeatmap",["ODSAPI","MapLayerHelper","$q",function(n,p,r){return{render:function(d,e,u,t){var f=r.defer(),g={};angular.isObject(d.color)&&"gradient"===d.color.type&&d.color.steps&&(g.gradient=d.color.steps);var a=angular.extend({},d.context.parameters,{clustermode:"heatmap",clusterdistance:15,clusterprecision:e.getZoom(),"geofilter.bbox":ODS.GeoFilter.getBoundsAsBboxParameter(e.getBounds())});return"COUNT"!==d.func&&p.isAnalyzeEnabledClustering(d)&&(a["y.serie1.expr"]=d.expr,a["y.serie1.func"]=d.func),n.records.geo(d.context,a,t.promise).success(function(e){var t=e.clusters;g.radius=Math.min(1/e.clusters.length*(d.radius/4*4e3)+20,50);var a=p.getClusterMin(e,d),n=p.getClusterMax(e,d);d._bounds=[a,n];for(var r=[],i=0;i<t.length;i++){var o=t[i],s=p.getClusterValue(o,d);if(null!==s){var l=ODS.CalculationUtils.getValueOnScale(s,a,n,d.sizeFunction);r.push([o.cluster_center[0],o.cluster_center[1],l])}}var c=null;0<r.length&&(c=L.heatLayer(r,g),u.addLayer(c)),f.resolve(c)}),f.promise}}}])}(),function(){"use strict";angular.module("ods-widgets").service("MapRenderingRaw",["ODSAPI","MapLayerHelper","SVGInliner","PictoHelper","$q",function(d,u,e,t,f){return{render:function(r,i,e,t){var o=f.defer(),s=e,l=angular.extend({},r.context.parameters,{rows:1e3,format:"json",geo_simplify:!0,geo_simplify_zoom:i.getZoom(),"geofilter.bbox":ODS.GeoFilter.getBoundsAsBboxParameter(i.getBounds())}),a=r.context.dataset.getFieldsForType("geo_shape"),c=a.length?a[0].name:null,n=[];return c?n.push(c):n.push(r.context.dataset.getFieldsForType("geo_point_2d")[0].name),r.color.field&&n.push(r.color.field),l.fields=n.join(","),d.records.download(r.context,l,t.promise).success(function(e){r._incomplete=!1,e.length>=l.rows&&(r._incomplete=!0);for(var t=0;t<e.length;t++){var a,n=e[t];if(c){if(!n.fields[c])return;"Point"===(a=n.fields[c]).type&&angular.isDefined(n.geometry)&&(a=n.geometry)}else{if(!n.geometry)return;a=n.geometry}"Point"===a.type?u.drawPoint(r,i,[a.coordinates[1],a.coordinates[0]],n,s):u.drawShape(r,i,a,n,s)}o.resolve(s)}),o.promise}}}])}(),function(){"use strict";angular.module("ods-widgets").service("MapRenderingShapePreview",["ODSAPI","MapLayerHelper","$q",function(t,l,a){return{render:function(n,r,i,e){var o=a.defer(),s=angular.extend({},n.context.parameters,{rows:1e3,clusterprecision:r.getZoom(),"geofilter.bbox":ODS.GeoFilter.getBoundsAsBboxParameter(r.getBounds())});return t.records.geopreview(n.context,s,e.promise).success(function(e){var t;e.length>=s.rows?n._incomplete=!0:n._incomplete=!1;for(var a=0;a<e.length;a++)"Point"===(t=e[a]).geometry.type?l.drawPoint(n,r,[t.geometry.coordinates[1],t.geometry.coordinates[0]],null,i,t.geo_digest):l.drawShape(n,r,t.geometry,null,i,t.geo_digest);o.resolve(i)}),o.promise}}}])}(),function(){"use strict";angular.module("ods-widgets").service("QueryParameters",[function(){return["q.timerange","q.timescale","q.calendar_bounds","q.geographic_area","q.mapfilter","q.to_date","q.from_date","geofilter.distance","geofilter.polygon"]}])}(),function(){"use strict";var e=angular.module("ods-widgets");e.factory("odsTimerangeParser",function(){var a=/([\w-]+):\[(.*) TO (.*)\]/;return function(e){var t=a.exec(decodeURIComponent(e));return t?{field:t[1],from:t[2],to:t[3]}:{}}}),e.factory("odsTimeboundParser",function(){var a=/([\w]+)(<|>)="(.*)"/;return function(e){var t=a.exec(decodeURIComponent(e));return t?{field:t[1],date:t[3]}:{}}}),e.factory("odsTimescaleParser",["translate",function(e){var a=/([\w-]+)>=#now\((.*)=-(\w)\)/,n={years:{1:e("Last 12 months")},weeks:{1:e("Last 7 days"),4:e("Last 4 weeks")},days:{1:e("Last 24 hours")}};return function(e){var t=a.exec(decodeURIComponent(e));return t?{field:t[1],scaleLabel:n[t[2]][t[3]]}:{}}}])}(),function(){"use strict";angular.module("ods-widgets").service("Timezones",[function(){return["UTC","Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Atikokan","America/Bahia","America/Bahia_Banderas","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Costa_Rica","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Inuvik","America/Iqaluit","America/Jamaica","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Kralendijk","America/La_Paz","America/Lima","America/Los_Angeles","America/Lower_Princes","America/Maceio","America/Managua","America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Menominee","America/Merida","America/Metlakatla","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Santa_Isabel","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Shiprock","America/Sitka","America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson","Antarctica/McMurdo","Antarctica/Palmer","Antarctica/Rothera","Antarctica/South_Pole","Antarctica/Syowa","Antarctica/Vostok","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Choibalsan","Asia/Chongqing","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Gaza","Asia/Harbin","Asia/Hebron","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kashgar","Asia/Kathmandu","Asia/Khandyga","Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Ust-Nera","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney","Canada/Atlantic","Canada/Central","Canada/Eastern","Canada/Mountain","Canada/Newfoundland","Canada/Pacific","Europe/Amsterdam","Europe/Andorra","Europe/Athens","Europe/Belgrade","Europe/Berlin","Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Busingen","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Uzhgorod","Europe/Vaduz","Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye","Europe/Zurich","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Chatham","Pacific/Chuuk","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Pohnpei","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Wake","Pacific/Wallis","US/Alaska","US/Arizona","US/Central","US/Eastern","US/Hawaii","US/Mountain","US/Pacific"]}])}(),function(){"use strict";var e=angular.module("ods-widgets"),p={},h=[];e.provider("ModuleLazyLoader",function(){var n={highcharts:{css:[],js:[["https://code.highcharts.com/6.1.4/highcharts.js"],["https://code.highcharts.com/6.1.4/modules/no-data-to-display.js"],["https://code.highcharts.com/6.1.4/highcharts-more.js"],["https://code.highcharts.com/6.1.4/modules/treemap.js"],["https://code.highcharts.com/6.1.4/modules/funnel.js"]]},leaflet:{css:["https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css","libs/ods-map-fullscreen/ods-map-fullscreen.css","https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.css","libs/leaflet-control-geocoder/Control.Geocoder.css","libs/ods-vectormarker/vectormarker.css","libs/ods-clustermarker/clustermarker.css","libs/leaflet-label/leaflet.label.css","libs/leaflet-draw/leaflet.draw.css"],js:[["L@https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"],["L.Control.ODSMapFullscreen@libs/ods-map-fullscreen/ods-map-fullscreen.js","L.Control.Locate@https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.js","L.Label@libs/leaflet-label/leaflet.label.js","L.ODSMap@libs/ods-map/ods-map.js","L.ODSTileLayer@libs/ods-map/ods-tilelayer.js","L.Control.Geocoder@libs/leaflet-control-geocoder/Control.Geocoder.js","L.VectorMarker@libs/ods-vectormarker/vectormarker.js","L.ClusterMarker@libs/ods-clustermarker/clustermarker.js","L.Draw@libs/leaflet-draw/leaflet.draw.js","L.HeatLayer@libs/leaflet-heat/leaflet-heat.js"]]},rome:{css:["libs/rome/rome.css"],js:["libs/rome/rome.standalone.js"]},fullcalendar:{css:["libs/fullcalendar/fullcalendar.min.css"],js:["libs/fullcalendar/fullcalendar.min.js"],language_specific:{ar:{js:["libs/fullcalendar/lang/ar.js"]},ca:{js:["libs/fullcalendar/lang/ca.js"]},de:{js:["libs/fullcalendar/lang/de.js"]},es:{js:["libs/fullcalendar/lang/es.js"]},eu:{js:["libs/fullcalendar/lang/eu.js"]},fr:{js:["libs/fullcalendar/lang/fr.js"]},it:{js:["libs/fullcalendar/lang/it.js"]},nl:{js:["libs/fullcalendar/lang/nl.js"]},pt:{js:["libs/fullcalendar/lang/pt.js"]}}},qtip:{css:["libs/qtip/jquery.qtip.min.css"],js:["libs/qtip/jquery.qtip.min.js"]},"simple-statistics":{css:[],js:["ss@https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/1.0.1/simple_statistics.js"]},vega:{js:["vega@https://cdn.jsdelivr.net/npm/vega@4.2.0","vl@https://cdn.jsdelivr.net/npm/vega-lite@3.0.0-rc3","vegaTooltip@https://cdn.jsdelivr.net/npm/vega-tooltip@0.13.0"]}};this.getConfig=function(){return n};var g=function(e,t){var a=t.split(".");if(e.hasOwnProperty(a[0])&&angular.isDefined(e[a[0]])){if(1===a.length)return!0;var n=e[a[0]];return a.shift(),g(n,a.join("."))}return!1};this.$get=["$q","ODSWidgetsConfig",function(d,r){var u=function(e,t){if(angular.isUndefined(p[t])){var a=d.defer();p[t]=a;var n="/"===t.substring(0,1)||"http://"===t.substring(0,7)||"https://"===t.substring(0,8)?t:r.basePath+t;LazyLoad[e](n,function(){a.resolve(),h.push(t)}),p[t]=a}return p[t]},f=function(e,t,a,n){var r,i,o=[];if(angular.isUndefined(n)&&(n=0),n>=t.length)a.resolve();else{r=t[n],angular.isArray(r)||(r=[r]);for(var s=0;s<r.length;s++){var l,c=r[s].split("@");if(1<c.length&&!c[0].startsWith("http://")&&!c[0].startsWith("https://")){if(i=c[0],g(window,i))continue;l=c.splice(1).join("@")}else l=r[s];-1===h.indexOf(l)?o.push(u(e,l).promise):o.push(p[l].promise)}d.all(o).then(function(){f(e,t,a,n+1)})}return a.promise};return function(){for(var e=[],t=0;t<arguments.length;t++){var a=n[arguments[t]];a.language_specific&&a.language_specific[r.language]&&angular.forEach(a.language_specific[r.language],function(e,t){a[t]?a[t]=a[t].concat(e):a[t]=e}),a.css&&e.push(f("css",a.css,d.defer())),a.js&&e.push(f("js",a.js,d.defer()))}return d.all(e)}}]}),e.factory("DebugLogger",["$window",function(e){return{log:function(){("#debug"==e.location.hash||0<=e.location.hash.indexOf("debug=")||$(document.body).hasClass("showDebug"))&&console.log.apply(console,arguments)}}}]),e.factory("odsNotificationService",function(){var a={high:[],normal:[]};return{registerForNotifications:function(e,t){"high"===t?a.high.push(e):a.normal.push(e)},unregisterForNotifications:function(e){var t;-1<(t=a.high.indexOf(e))&&a.high.splice(t,1),-1<(t=a.normal.indexOf(e))&&a.normal.splice(t,1)},sendNotification:function(t){angular.isString(t)&&(t={title:"Error",type:"error",message:t}),angular.forEach(["high","normal"],function(e){angular.forEach(a[e],function(e){e(t)})})},markNotificationAsHandled:function(e){e&&(e.handled=!0)}}}),e.provider("SVGInliner",function(){var l={},c='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg id="dot-icon" width="19px" height="19px" viewBox="0 0 19 19" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">    <path d="M13,9.50004202 C13,11.4330618 11.4329777,13.000084 9.49995798,13.000084 C7.56693813,13.000084 5.99991595,11.4330618 5.99991595,9.50004202 C5.99991595,7.56702218 7.56693813,6 9.49995798,6 C11.4329777,6 13,7.56702218 13,9.50004202 L13,9.50004202 Z" id="path8568" fill="#000000"></path>    <rect style="opacity: 0" x="0" y="0" width="19" height="19"></rect></svg>',d=function(e,t,a){var n=angular.element(t);a&&(n.css("fill",a),n.find("path, polygon, circle, rect, text, ellipse").css("fill",a)),e.append(n)};this.$get=["$http","$q",function(t,s){var a=function(a,n,r){var i;r&&(i=s.defer());var o=angular.element('<div class="ods-svginliner__svg-container"></div>');if(a)if(-1===a.indexOf(".svg"))o.append(angular.element('<img src="'+a+'"/>')),r&&i.resolve(o);else if(l[a])l[a].code?(d(o,l[a].code,n),r&&i.resolve(o)):l[a].promise.success(function(e){d(o,e,n),r&&i.resolve(o)}).error(function(){d(o,c,n),r&&i.resolve(o)});else{var e=t.get(a);l[a]={promise:e},e.success(function(e){l[a].code=e,d(o,e,n),r&&i.resolve(o)}).error(function(e,t){console.log("WARNING: Unable to fetch SVG image",a,"HTTP status:",t),l[a].code=c,d(o,c,n),r&&i.resolve(o)})}else d(o,c,n),r&&i.resolve(o);return r?i.promise:o};return{getElement:function(e,t){return a(e,t)},getPromise:function(e,t){return a(e,t,!0)}}}]}),e.service("PictoHelper",function(){var r={"ban-circle":"ban","bar-chart":"bar-chart-o",beaker:"flask",bell:"bell-o","bell-alt":"bell","bitbucket-sign":"bitbucket-square","bookmark-empty":"bookmark-o",building:"building-o (4.0.2)","calendar-empty":"calendar-o","check-empty":"square-o","check-minus":"minus-square-o","check-sign":"check-square",check:"check-square-o","chevron-sign-down":"chevron-down","chevron-sign-left":"chevron-left","chevron-sign-right":"chevron-right","chevron-sign-up":"chevron-up","circle-arrow-down":"arrow-circle-down","circle-arrow-left":"arrow-circle-left","circle-arrow-right":"arrow-circle-right","circle-arrow-up":"arrow-circle-up","circle-blank":"circle-o",cny:"rub","collapse-alt":"minus-square-o","collapse-top":"caret-square-o-up",collapse:"caret-square-o-down","comment-alt":"comment-o","comments-alt":"comments-o",copy:"files-o",cut:"scissors",dashboard:"tachometer","double-angle-down":"angle-double-down","double-angle-left":"angle-double-left","double-angle-right":"angle-double-right","double-angle-up":"angle-double-up",download:"arrow-circle-o-down","download-alt":"download","edit-sign":"pencil-square",edit:"pencil-square-o","ellipsis-horizontal":"ellipsis-h (4.0.2)","ellipsis-vertical":"ellipsis-v (4.0.2)","envelope-alt":"envelope-o",euro:"eur","exclamation-sign":"exclamation-circle","expand-alt":"plus-square-o (4.0.2)",expand:"caret-square-o-right","external-link-sign":"external-link-square","eye-close":"eye-slash","eye-open":"eye","facebook-sign":"facebook-square","facetime-video":"video-camera","file-alt":"file-o","file-text-alt":"file-text-o","flag-alt":"flag-o","folder-close-alt":"folder-o","folder-close":"folder","folder-open-alt":"folder-open-o",food:"cutlery",frown:"frown-o",fullscreen:"arrows-alt (4.0.2)","github-sign":"github-square","google-plus-sign":"google-plus-square",group:"users (4.0.2)","h-sign":"h-square","hand-down":"hand-o-down","hand-left":"hand-o-left","hand-right":"hand-o-right","hand-up":"hand-o-up",hdd:"hdd-o (4.0.1)","heart-empty":"heart-o",hospital:"hospital-o (4.0.2)","indent-left":"outdent","indent-right":"indent","info-sign":"info-circle",keyboard:"keyboard-o",legal:"gavel",lemon:"lemon-o",lightbulb:"lightbulb-o","linkedin-sign":"linkedin-square",meh:"meh-o","microphone-off":"microphone-slash","minus-sign-alt":"minus-square","minus-sign":"minus-circle","mobile-phone":"mobile",moon:"moon-o",move:"arrows (4.0.2)",off:"power-off","ok-circle":"check-circle-o","ok-sign":"check-circle",ok:"check","paper-clip":"paperclip",paste:"clipboard","phone-sign":"phone-square",picture:"picture-o","pinterest-sign":"pinterest-square","play-circle":"play-circle-o","play-sign":"play-circle","plus-sign-alt":"plus-square","plus-sign":"plus-circle",pushpin:"thumb-tack","question-sign":"question-circle","remove-circle":"times-circle-o","remove-sign":"times-circle",remove:"times",reorder:"bars (4.0.2)","resize-full":"expand (4.0.2)","resize-horizontal":"arrows-h (4.0.2)","resize-small":"compress (4.0.2)","resize-vertical":"arrows-v (4.0.2)","rss-sign":"rss-square",save:"floppy-o",screenshot:"crosshairs","share-alt":"share","share-sign":"share-square",share:"share-square-o","sign-blank":"square",signin:"sign-in",signout:"sign-out",smile:"smile-o","sort-by-alphabet-alt":"sort-alpha-desc","sort-by-alphabet":"sort-alpha-asc","sort-by-attributes-alt":"sort-amount-desc","sort-by-attributes":"sort-amount-asc","sort-by-order-alt":"sort-numeric-desc","sort-by-order":"sort-numeric-asc","sort-down":"sort-desc","sort-up":"sort-asc",stackexchange:"stack-overflow","star-empty":"star-o","star-half-empty":"star-half-o",sun:"sun-o","thumbs-down-alt":"thumbs-o-down","thumbs-up-alt":"thumbs-o-up",time:"clock-o",trash:"trash-o","tumblr-sign":"tumblr-square","twitter-sign":"twitter-square",unlink:"chain-broken",upload:"arrow-circle-o-up","upload-alt":"upload","warning-sign":"exclamation-triangle","xing-sign":"xing-square","youtube-sign":"youtube-square","zoom-in":"search-plus","zoom-out":"search-minus"};return{mapPictoToURL:function(e,t){if(!e)return null;var a=t&&t.domainUrl||"";if(e.startsWith("icon-")){var n=e.replace("icon-","");r[n]&&(n=r[n]),a+="/static/pictos/img/set-v1/fa/"+n+".svg"}else e.startsWith("pdpicto-")||e.startsWith("odspicto-")?a+="/static/pictos/img/set-v1/"+(e=e.replace("pdpicto-","pdpicto/").replace("odspicto-","odspicto/"))+".svg":e.startsWith("ods-")?a+="/static/pictos/img/set-v3/pictos/"+(e=e.replace("ods-",""))+".svg":a+="/static/pictos/img/set-v2/"+e+".svg";return a}}}),e.factory("URLSynchronizer",["$location","$document","$rootScope","$timeout",function(l,e,t,s){var c=!1,d=[],n=null,r=new Date;e.bind("webkitfullscreenchange mozfullscreenchange ofullscreenchange msfullscreenchange khtmlfullscreenchange",function(){if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)c=!0;else{c=!1;for(var e=0;e<d.length;e++)d[e]()}});var u=[];function f(e,t,a){if(a)return l.replace(),void(angular.isString(e)?l.search(e,t):l.search(e));n&&(s.cancel(n),n=null),n=s(function(){(new Date).getTime()-r.getTime()<300&&l.replace(),angular.isString(e)?l.search(e,t):l.search(e),r=new Date})}return t.$evalAsync(function(){s(function(){r=new Date})}),{addSynchronizedValue:function(a,n,t,r){u.push(n),t&&u.push(t);var e=l.search()[t||n];a.$eval(n+"=newObj",{newObj:e});var i=function(){var e=a.$eval(n);f(t||n,e,r)},o=a.$watch(n,function(e,t){c||i()},!0);d.push(i);var s=a.$watch(function(){return l.search()[t||n]},function(e,t){e&&a.$eval(n+"=newObj",{newObj:e})},!0);return function(){o(),s()}},addJSONSynchronizedObject:function(a,n,t){u.push(t||n);var r,e=l.search()[t||n];e&&("{"===e[0]?a.$eval(n+"=newObj",{newObj:JSON.parse(e)}):a.$eval(n+"=newObj",{newObj:JSON.parse(b64_to_utf8(e))}));var i=function(){var e=a.$eval(n);void 0===e&&(e=""),r=utf8_to_b64(angular.toJson(e)),f(t||n,r)};return d.push(i),a.$watch(function(){return[a.$eval(n),l.search()[t||n]]},function(t,e){void 0===t[0]&&(t[0]=""),r===utf8_to_b64(angular.toJson(t[0]))||c?r!==t[1]&&t[1]&&a.$eval(function(e){e[n]=JSON.parse(b64_to_utf8(t[1]))}):i()},!0)},addSynchronizedObject:function(e,n,r){r=r||[];var t=function(){var a=angular.copy(l.search());if(angular.forEach(a,function(e,t){0<=u.indexOf(t)&&delete a[t]}),0<r.length){var t=e.$eval(n);angular.forEach(r,function(e){angular.isDefined(t[e])&&(a[e]=t[e])})}e.$eval(n+"=newVal",{newVal:a})},a=function(){var a=angular.copy(e.$eval(n));angular.forEach(r,function(e){angular.isDefined(a[e])&&delete a[e]}),angular.forEach(l.search(),function(e,t){(0<=u.indexOf(t)||0<=r.indexOf(t))&&(a[t]=e)}),f(a)};t();var i,o=e.$watch(n,function(e,t){c||a()},!0);return d.push(a),s(function(){i=e.$watch(function(){return l.search()},t,!0)},300),function(){o(),i()}}}}])}(),function(){"use strict";angular.module("ods-widgets").service("ValueDisplay",["$filter","translate","ODSWidgetsConfig","$sce",function(t,a,n,r){var i={language:function(e){return t("isocode_to_language")(ODS.StringUtils.escapeHTML(e))},visualization:function(e){switch(e){case"analyze":return'<i class="odswidget-facet__value-icon fa fa-bar-chart"></i> '+a("Analyze");case"calendar":return'<i class="odswidget-facet__value-icon fa fa-calendar"></i> '+a("Calendar");case"geo":return'<i class="odswidget-facet__value-icon fa fa-globe"></i> '+a("Map");case"image":return'<i class="odswidget-facet__value-icon fa fa-picture-o"></i> '+a("Image");case"api":return'<i class="odswidget-facet__value-icon fa fa-cogs"></i> '+a("API");case"custom_view":return'<i class="odswidget-facet__value-icon fa fa-'+n.defaultCustomViewConfig.icon+'"></i> '+ODS.StringUtils.escapeHTML(n.defaultCustomViewConfig.title);default:return ODS.StringUtils.escapeHTML(e)}},date:function(e,t){return t.match(/^[0-9]{4}\/[0-9]{2}$/)?ODS.StringUtils.capitalize(moment.months()[parseInt(e,10)-1]):ODS.StringUtils.escapeHTML(e)}};return{format:function(e,t,a){return angular.isDefined(i)?i[t](e,a):(console.log('Warning (ValueDisplay): unknown value formatter "'+t+'"'),r.trustAsHtml(e))}}}])}(),function(){"use strict";var e=angular.module("ods-widgets");e.filter("nofollow",function(){return function(e){return angular.isString(e)?e.replace(/<a href="/g,'<a target="_blank" rel="nofollow" href="'):e}}),e.filter("prettyText",["$filter",function(e){var a=/[<>]+/,t=/([^\#-~| |!])/g;function n(e){return e.replace(/&/g,"&amp;").replace(t,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}return function(t){if(!t||!angular.isString(t))return t;if(a.test(t))return n(t);try{return e("linky")(t,"_blank")}catch(e){return n(t)}}}]),e.filter("safenewlines",function(){return function(e){return e?e.replace(/\n/g,"<br/>").replace(/&#10;/g,"<br/>"):e}}),e.filter("imagify",["$sce",function(a){var n=/^(http(?:s?):\/\/[^;,]*(?:jpg|jpeg|png|gif)(?:\?[^,;]*)?)(?:$|;|,|&)/i;return function(e){if(angular.isString(e)){e=e.trim();var t=n.exec(e);if(null!==t)return a.trustAsHtml('<img class="odswidget odswidget-imagified" src="'+t[1]+'" />')}return e}}]),e.filter("videoify",["$sce",function(a){var n=/^https?:\/\/(?:(?:youtu.be\/)|(?:(?:www.)?youtube.com\/watch\?v=))([0-9a-z_-]+)$/i,r=/^https?:\/\/(?:(?:dai.ly)|(?:www.dailymotion.com))\/(?:video\/)?([0-9a-z]+)(?:[0-9a-z_-]*)$/i,i=/^https?:\/\/vimeo.com\/([0-9]+)$/i;return function(e){if(angular.isString(e)){var t=n.exec(e.trim());if(null!==t)return a.trustAsHtml('<iframe width="200" height="113" src="//www.youtube.com/embed/'+t[1]+'" frameborder="0" allowfullscreen></iframe>');if(null!==(t=r.exec(e.trim())))return a.trustAsHtml('<iframe frameborder="0" width="200" height="113" src="//www.dailymotion.com/embed/video/'+t[1]+'" allowfullscreen></iframe>');if(null!==(t=i.exec(e.trim())))return a.trustAsHtml('<iframe src="https://player.vimeo.com/video/'+t[1]+'" width="200" height="113" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')}return e}}]),e.filter("isDefined",function(){return function(e){return angular.isDefined(e)}}),e.filter("keys",function(){return function(e){return Object.keys(e)}}),e.filter("numKeys",function(){return function(e){return Object.keys(e).length}}),e.filter("values",function(){return function(e){var t=[];return angular.forEach(e,function(e){t.push(e)}),t}}),e.filter("isEmpty",function(){return function(e){return 0===Object.keys(e).length}}),e.filter("displayImageValue",function(n){return function(e,t){if(!e)return e;var a="/explore/dataset/"+t+"/files/"+e.id+"/300/";return n.trustAsHtml('<img class="odswidget odswidget-imagified" src="'+a+'" />')}}),e.filter("fieldsForVisualization",function(){var a={table:[],map:["geo_point_2d","geo_shape"],images:["file"],calendar:[]};return function(e,t){if(angular.isUndefined(e))return e;if(angular.isUndefined(a[t]))throw'Unknown visualization type "'+t+"'";return e.filter(function(e){return-1===a[t].indexOf(e.type)})}}),e.filter("formatFieldValue",["$filter","$sce",function(p,h){var m=/^\/(explore\/(embed\/)?dataset|publish)\/([\w_@-]+)\//;return function(e,t,a){var n=e[t.name];if(null==n)return"";if("int"===t.type||"double"===t.type){var r,i,o="";if(t.annotations)for(var s=0;s<t.annotations.length;s++)"unit"===t.annotations[s].name&&(o=t.annotations[s].args[0]),"double"==t.type&&"decimals"===t.annotations[s].name&&(r=parseInt(t.annotations[s].args[0],10));return i=angular.isDefined(r)?p("number")(n,r):p("number")(n),o&&(i="$"===o||"£"===o?o+i:i+" "+o),i}if("geo_point_2d"===t.type)return n[0]+", "+n[1];if("geo_shape"===t.type)return p("limitTo")(angular.toJson(n),200);if("date"===t.type){var l=function(e){if(e.annotations){var t=e.annotations.filter(function(e){return"timeserie_precision"===e.name});if(0<t.length)return t[0].args[0]}return null}(t);if("year"===l){var c=moment(n,"YYYY");return p("moment")(c,"YYYY")}if("month"!==l)return p("moment")(n,"LL");c=moment(n,"YYYY-MM");return p("capitalize")(p("moment")(c,"MMMM YYYY"))}if("datetime"===t.type)return 19===n.length&&(n+="Z"),p("moment")(n,"LLL");if("file"!==t.type)return p("limitTo")(""+n,1e3);if(angular.isObject(n)){var d,u="";if(a&&a.domainUrl&&(u=a.domainUrl.replace(/\/+$/,"")),a&&a.dataset)d=a.dataset.datasetid;else{var f=m.exec(decodeURIComponent(window.location.pathname));f&&(d=f[3])}if(d){var g=u+"/explore/dataset/"+d+"/files/"+n.id+"/download/";return h.trustAsHtml('<a target="_self" href="'+g+'">'+(n.filename||e.filename)+"</a>")}return n.filename||e.filename}return""+n}}]),e.filter("capitalize",[function(){return function(e){return ODS.StringUtils.capitalize(e)}}]),e.filter("truncate",function(){return function(e,t){return e&&angular.isString(e)?(t||(t=200),e.substring(0,t)):e}}),e.filter("fieldsFilter",function(){return function(a,e){if(!a)return a;if(angular.isArray(e)&&e.length){var n=[];return angular.forEach(e,function(t){var e=$.grep(a,function(e){return e.name===t})[0];angular.isDefined(e)&&n.push(e)}),n}return a}}),e.filter("moment",[function(){return function(e,t){if(e)return moment(e).format(t)}}]),e.filter("momentadd",[function(){return function(e,t,a){if(e)return moment(e).add(t,parseInt(a,10)).toISOString().replace(".000Z","Z")}}]),e.filter("timesince",[function(){return function(e){if(e)return moment(e).fromNow()}}]),e.filter("momentdiff",function(){return function(e,t,a){return moment(e).diff(t,a)}}),e.filter("themeSlug",["$filter",function(t){return function(e){return!e||angular.isArray(e)&&0===e.length?e:(angular.isArray(e)&&(e=e[0]),t("slugify")(t("normalize")(e)))}}]),e.filter("slugify",function(){return function(e){return e?ODS.StringUtils.slugify(e):e}}),e.filter("normalize",[function(){return function(e){return ODS.StringUtils.normalize(e)}}]),e.filter("shortTextSummary",function(){return function(e,t){return e.length>t?e.substring(0,t-3)+"...":e}}),e.filter("shortSummary",[function(){return function(e,t){if(t=t||400,!e)return"";var a="",n=angular.element("<div>"+e+"</div>");if(0===n.children().length)a=-1<e.indexOf("\n")?e.substring(0,e.indexOf("\n")):e;else{var r=n.contents()[0];if(3==r.nodeType)a=r.textContent;else if(0<n.find("p").length){var i=n.find("p")[0];a=angular.isDefined(i.textContent)?i.textContent:i.innerText}else a=n.text()}return a.length>t&&(a=a.substring(0,t-3)+"…"),a}}]),e.filter("imageUrl",function(){return function(e,t){if(!e||angular.equals(e,{}))return null;if(t||console.log("ERROR : This filter requires a context as second parameter."),!t.dataset)return null;angular.isObject(e)||console.log("ERROR : This field is not an file field.");var a=t.domainUrl;return a+="/api/datasets/1.0/"+t.dataset.datasetid+"/files/"+e.id+"/"}}),e.filter("thumbnailUrl",["imageUrlFilter",function(n){return function(e,t){var a=n(e,t);return a?a+"300/":null}}]),e.filter("firstValue",function(){return function(e){return angular.isArray(e)?0<e.length?e[0]:null:e}}),e.filter("split",function(){return function(e,t){return e?(t||(t=";"),e.split(t)):e}}),e.filter("join",function(){return function(e,t){return e?(t||(t=", "),angular.isArray(e)?e.join(t):e):e}}),e.filter("stringify",function(){return function(e){return angular.isObject(e)?JSON.stringify(e):e}}),e.filter("themeColor",["ODSWidgetsConfig",function(t){return function(e){return e&&t.themes[e]?t.themes[e].color:""}}]),e.filter("isBefore",function(){return function(e,t){return moment(e).isBefore(t)}}),e.filter("isAfter",function(){return function(e,t){return moment(e).isAfter(t)}}),e.filter("propagateAppendedURLParameters",["ODSWidgetsConfig",function(t){return function(e){return e?e.startsWith("http://")||e.startsWith("https://")?e:t.appendedURLQuerystring?(-1<e.indexOf("?")?e+="&":e+="?",e+=t.appendedURLQuerystring):e:e}}]),e.filter("toObject",function(){return function(e,a){return a?e.reduce(function(e,t){return e[t[a]]=t,e},{}):(console.log("ERROR : this filter requires a key as a second parameter."),null)}}),e.filter("min",function(){return function(e,t){return Math.min(e,t)}}),e.filter("max",function(){return function(e,t){return Math.max(e,t)}}),e.filter("filesize",["translate","$filter",function(e,r){var i=e;return function(e){for(var t=e,a=[i("B"),i("KB"),i("MB"),i("GB"),i("TB")],n=0;1<t/1024&&n<a.length;)t/=1024,n++;return r("number")(t)+" "+a[n]}}])}(),function(e){var a=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];function n(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function r(e){return angular.isObject(e)?angular.isDate(e)?e.toISOString():angular.toJson(e):e}var i={Context:{toggleRefine:function(e,t,a,n){var r="refine."+t,i="/";if(e.dataset){var o=e.dataset.getField(t),s=e.dataset.getFieldAnnotation(o,"hierarchical");void 0!==s&&(i=s.args[0]||i)}if(angular.isDefined(e.parameters[r])){var l=angular.copy(e.parameters[r]);angular.isArray(l)||(l=[l]),-1<l.indexOf(a)?l.splice(l.indexOf(a),1):(angular.forEach(l,function(e,t){a.startsWith(e+i)?l.splice(t,1):e.startsWith(a+i)&&l.splice(t,1)}),angular.isUndefined(n)||!1===n?l.push(a):l=[a]),0===l.length?delete e.parameters[r]:e.parameters[r]=l}else e.parameters[r]=a}},GeoFilter:{getBboxParameterAsBounds:function(e){var t=e.split(",");return[[t[0],t[1]],[t[2],t[3]]]},getBoundsAsBboxParameter:function(e){return angular.isArray(e)?[e[0][0],e[0][1],e[1][0],e[1][1]].join(","):[e.getSouthWest().lat,e.getSouthWest().lng,e.getNorthEast().lat,e.getNorthEast().lng].join(",")},getBoundsAsPolygonParameter:function(e){for(var t,a=[[(t=angular.isArray(e)?new L.LatLngBounds(e):e).getNorthWest().lat,t.getNorthWest().lng],[t.getNorthEast().lat,t.getNorthEast().lng],[t.getSouthEast().lat,t.getSouthEast().lng],[t.getSouthWest().lat,t.getSouthWest().lng]],n=[],r=0;r<a.length;r++){var i=a[r];n.push(i.join(","))}return"("+n.join("),(")+")"},getPolygonParameterAsBounds:function(e){for(var t,a,n,r,i=e.replace(/[()]/g,"").split(","),o=0;o<i.length;o+=2){var s=parseFloat(i[o]),l=parseFloat(i[o+1]);(!t||s<t)&&(t=s),(!a||l<a)&&(a=l),(!n||n<s)&&(n=s),(!r||r<l)&&(r=l)}return[[t,a],[n,r]]},getPolygonParameterAsGeoJSON:function(e){for(var t={type:"Polygon",coordinates:[[]]},a=e.replace(/[()]/g,"").split(","),n=0;n<a.length;n+=2){var r=parseFloat(a[n]),i=parseFloat(a[n+1]);t.coordinates[0].push([i,r])}return t},getBboxParameterAsPolygonParameter:function(e){return this.getBoundsAsPolygonParameter(this.getBboxParameterAsBounds(e))},getGeoJSONPolygonAsPolygonParameter:function(e){var t,a=[];if("LineString"===e.type){t=e.coordinates;var n=null,r=null,i=null,o=null;angular.forEach(t,function(e){var t=e[0],a=e[1];n=null===n?t:Math.min(n,t),r=null===r?a:Math.min(r,a),i=null===i?t:Math.max(i,t),o=null===o?a:Math.max(o,a)}),a.push(r+","+n),a.push(r+","+i),a.push(o+","+i),a.push(o+","+n)}else{t=e.coordinates[0],"MultiPolygon"===e.type&&(t=t[0]);for(var s=0;s<t.length;s++){var l=angular.copy(t[s]);2<l.length&&l.splice(2,1),l.reverse(),a.push(l.join(","))}}return"("+a.join("),(")+")"},addGeoFilterFromSpatialObject:function(e,t){angular.isArray(t)?e["geofilter.distance"]=t[0]+","+t[1]:"Point"===t.type?e["geofilter.distance"]=t.coordinates[1]+","+t.coordinates[0]:e["geofilter.polygon"]=this.getGeoJSONPolygonAsPolygonParameter(t)}},StringUtils:{slugify:function(e){return e?e.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/-+/g,"-"):e},normalize:function(e){if(!e)return e;for(var t=0;t<a.length;t++)e=e.replace(a[t].letters,a[t].base);return e},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},startsWith:function(e,t){return e&&0===e.indexOf(t)},escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},getRandomUUID:function(e){e=Math.min(e||7,36);for(var t="abcdefghijklmnopqrstuvwxyz0123456789",a="",n=0;n<e;n++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}},NumberUtils:{limitDecimalsFloor:function(e,t){return Math.floor(e*Math.pow(10,t))/Math.pow(10,t)},limitDecimalsCeil:function(e,t){return Math.ceil(e*Math.pow(10,t))/Math.pow(10,t)},limitDecimals:function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}},ArrayUtils:{fromCSVString:function(e){return e.split(",").map(function(e){return e.trim()})},transpose:function(a){return angular.isArray(a)?a.reduce(function(e,t){return e[t]=!0,e},{}):Object.keys(a).reduce(function(e,t){return a[t]&&e.push(t),e},[])},sortNumbers:function(e,t){return e-t},reverseSortNumbers:function(e,t){return t-e}},URLUtils:{cleanupAPIParams:function(o){return delete(o=angular.copy(o))._refreshTimestamp,angular.forEach(o,function(r,i){angular.forEach(["q","rq"],function(e){var t,a,n;t=e,n=r,(a=i).startsWith(t+".")&&(o[t]?angular.isArray(o[t])?o[t].push(n):o[t]=[o[t],n]:o[t]=n,delete o[a])})}),o},getAPIQueryString:function(e){if(!(e=this.cleanupAPIParams(angular.extend({},e||{}))))return"";var a=[];return angular.forEach(e,function(e,t){isNullOrUndefined(e)||(angular.isArray(e)?angular.forEach(e,function(e){a.push(n(t)+"="+n(r(e)))}):a.push(n(t)+"="+n(r(e))))}),a.join("&")}},DatasetUtils:{isFieldSortable:function(e){if(0<=["int","double","date","datetime"].indexOf(e.type))return!0;if("text"===e.type&&e.annotations)for(var t=0;t<e.annotations.length;t++){if("sortable"===e.annotations[t].name)return!0}return!1}},Dataset:function(t){var n,r,i,a=function(e,t){var a=0;if(e.annotations)for(;a<e.annotations.length;a++)if(e.annotations[a].name===t)return e.annotations[a]},o=function(e,t){return void 0!==a(e,t)},s=function(e){i={facets:[]},n=[];for(var t=r=0;t<e.length;t++){var a=e[t];o(a,"facet")&&(r++,i.facets.push(a)),n[a.type]?n[a.type]+=1:n[a.type]=1}};return{datasetid:t.datasetid||"preview",has_records:t.has_records,data_visible:t.data_visible,metas:t.metas||{domain:"preview"},features:t.features,attachments:t.attachments,alternative_exports:t.alternative_exports,fields:t.fields,extra_metas:t.extra_metas,interop_metas:t.interop_metas,setFields:function(e){this.fields=e,s(this.fields)},getUniqueId:function(){return this.metas.domain+"."+this.datasetid},getTypes:function(){return void 0===n&&s(this.fields),n},hasFeature:function(e){return-1<t.features.indexOf(e)},hasFieldType:function(e){for(var t=0;t<this.fields.length;t++)if(this.fields[t].type==e)return!0;return!1},countFieldType:function(e){for(var t=0,a=0;a<this.fields.length;a++)this.fields[a].type==e&&t++;return t},countFieldTypes:function(e){for(var t=0,a=0;a<e.length;a++)t+=this.countFieldType(e[a]);return t},getFacetsCount:function(){return void 0===r&&s(this.fields),r},hasFacet:function(){return void 0===r&&s(this.fields),0<r},getFilterDescription:function(){return void 0===i&&s(this.fields),i},getFacets:function(){return this.getFilterDescription().facets},setMetas:function(e){this.metas=e},getField:function(e){for(var t=0;t<this.fields.length;t++){var a=this.fields[t];if(a.name===e)return a}return null},getFieldLabel:function(e){var t=this.getField(e);return t?t.label:t},getFieldsForType:function(e){for(var t=[],a=0;a<this.fields.length;a++){var n=this.fields[a];n.type===e&&t.push(n)}return t},hasNumericField:function(){for(var e=0;e<this.fields.length;e++){var t=this.fields[e];if("int"===t.type||"double"===t.type)return!0}return!1},hasGeoField:function(){for(var e=0;e<this.fields.length;e++){var t=this.fields[e];if("geo_point_2d"===t.type||"geo_shape"===t.type)return!0}return!1},getExtraMeta:function(e,t){return this.extra_metas&&this.extra_metas[e]&&this.extra_metas[e][t]?this.extra_metas[e][t]:null},isFieldAnnotated:function(e,t){return o(e,t)},getFieldAnnotation:function(e,t){return a(e,t)}}},Record:{getImageUrl:function(e,t,a,n){return format_string("{domainUrl}/explore/dataset/{datasetId}/files/{imageId}/{size}/",{domainUrl:a||"",datasetId:e.datasetid,imageId:e.fields[t].id,size:n||"300"})}},CalculationUtils:{getValueOnScale:function(e,t,a,n){if(t===a)return 1;var r,i=a-t,o=e-t;return"linear"===(n=n||"linear")?r=o/i:"log"===n&&(r=Math.log(o)/Math.log(i))===-1/0&&(r=0),r},incrementByOneUnit:function(e){var t,a,n=!1;return angular.isString(e)&&(e=parseFloat(e),n=!0),t=-1===e.toString().indexOf(".")?e+1:(a=e.toString().length-e.toString().indexOf(".")-1,e+Math.pow(10,-a)),n?a?t.toFixed(a):t.toString():a?Math.round(t*Math.pow(10,a))/Math.pow(10,a):t}},DateFieldUtils:{datePatternBuilder:function(e){var a={highcharts:{Hh:"%Hh",MMM:"%M",YYYY:"%Y",MMMM:"%B",D:"%e",ddd:"%a"},moment:{Hh:"H[h]",MMM:"MMM",YYYY:"YYYY",MMMM:"MMMM",D:"D",ddd:"ddd"}}[e];return function(e){var t="";return angular.isObject(e)&&("year"in e||"month"in e||"day"in e||"hour"in e||"minute"in e||"weekday"in e)&&("year"in e?("day"in e&&(t+=" "+a.D),"month"in e&&(t+=" "+a.MMMM),t+=" "+a.YYYY,"hour"in e&&(t+="minute"in e?" "+a.Hh+a.MMM:" "+a.Hh)):("month"in e&&(t=a.MMMM),"day"in e&&(t="month"in e?a.D+" "+a.MMMM:a.D),"weekday"in e?(t=a.ddd,"hour"in e&&(t+=" "+a.Hh)):"hour"in e&&(t=a.Hh))),t}},getDateFromXObject:function(e,t,a){void 0===a&&(a=!1);var n=t?t.getUTCFullYear():2e3,r=t?t.getUTCMonth():0,i=t?t.getUTCDate():1,o=t?t.getUTCHours():0,s=t?t.getUTCMinutes():0;if(angular.isObject(e)&&("year"in e||"month"in e||"day"in e||"hour"in e||"minute"in e||"weekday"in e||"yearday"in e)){var l=new Date(Date.UTC(e.year||n,e.month-1||0,e.day||1,e.hour||0,e.minute||0));return l.setUTCFullYear(e.year||n),"month"in e||l.setUTCMonth(r),"day"in e||l.setUTCDate(i),"hour"in e||l.setUTCHours(o),"minute"in e||l.setUTCMinutes(s),"year"in e||("weekday"in e&&l.setUTCDate(l.getUTCDate()+7-l.getUTCDay()+e.weekday),"yearday"in e&&l.setUTCDate(0+e.yearday)),"day"in e?29!=e.day||2!=e.month||e.year||(l.setUTCDate(28),l.setUTCMonth(1)):"month"in e&&(a?l.setUTCDate(1):l.setUTCDate(16)),l}},getTimescaleProperties:function(e){var t={year:["year"],month:["year","month"],day:["year","month","day"],hour:["year","month","day","hour"],minute:["year","month","day","hour","minute"],"month month":["month"],"day day":["day"],"day weekday":["weekday"],"hour weekday":["weekday","hour"],"day month":["yearday"],"hour hour":["hour"]};return e in t?t[e]:null},getTimescaleX:function(t,e){var a=[],n=i.DateFieldUtils.getTimescaleProperties(e);return n?angular.forEach(n,function(e){a.push(t+"."+e)}):a.push(t),a},getTimescaleSort:function(e){return e.map(function(e){return"x."+e}).join(",")}}};void 0===e.ODS&&(e.ODS={}),e.ODS=angular.extend(e.ODS,i)}(window),function(){"use strict";angular.module("ods-widgets").directive("odsAggregation",["ODSAPI",function(t){return{restrict:"A",scope:!0,controller:["$scope","$attrs",function(s,r){var e=ODS.ArrayUtils.fromCSVString(r.odsAggregation||"aggregation"),l=function(e,t){var a=r["odsAggregation"+ODS.StringUtils.capitalize(t)+ODS.StringUtils.capitalize(e)],n=r["odsAggregation"+ODS.StringUtils.capitalize(e)];return a||n};angular.forEach(e,function(i){var e,o=(e=i,s.$eval(l("context",e)));o.wait().then(function(){var r=t.uniqueCall(t.records.analyze);s.$watch(o.name+".parameters",function(e){var t,a,n=angular.extend({},e,{"y.serie1.expr":(a=i,l("expression",a)),"y.serie1.func":(t=i,l("function",t)||"COUNT")});r(o,n).success(function(e){e.length?s[i]=e[0].serie1:s[i]=null})},!0)})})}]}}])}(),function(){"use strict";var u=function(e,t,a){try{return!!e.$eval(t,{y:a})}catch(e){console.warn("Error while compiling condition with expr",t)}return!1},e=angular.module("ods-widgets");e.directive("odsAnalysis",["ODSAPI",function(e){return{restrict:"A",priority:1001,controller:["$scope","$attrs",function(r,l){r[l.odsAnalysisContext].wait().then(function(){var n=e.uniqueCall(e.records.analyze);r.$watch(l.odsAnalysisContext,function(e){var t=l.odsAnalysis||"results",a=angular.extend({},e.parameters,{maxpoints:l.odsAnalysisMax||0}),i={},o={},s=[];l.odsAnalysisSort&&(a.sort=l.odsAnalysisSort),angular.forEach(l,function(e,t){var a,n;if(t.startsWith("odsAnalysisSerie"))if(n=!1,(a=t.replace("odsAnalysisSerie","")).endsWith("Cumulative")&&0<a.replace("Cumulative","").length&&(a=a.replace("Cumulative",""),n=e),a=a.toLowerCase(),o[a]||(o[a]={}),n)o[a].cumulative=n;else{var r={expr:e};angular.extend(o[a],function(e,t){var a,n=/([A-Z_-]*?)\((.*?)\)/g,r=/([A-Z_-]*?)\(([a-zA-Z0-9\._]+),\s?([0-9\.]+)\)/g,i=t||e;e.compiled_expr=""+e.expr,i.aggregates=[];for(var o={};a=n.exec(e.expr);){var s=r.exec(a[0]);if(s&&4===s.length&&(a=s),a&&(3===a.length||4===a.length))if(0===a[2].indexOf("serie")){var l="operators."+a[1].toLowerCase()+".apply(null, accumulation['"+a[2]+"']";4===a.length&&(l+=", "+a[3]),l+=")",e.compiled_expr=e.compiled_expr.replace(a[0],l),i.aggregates.push(a[2])}else o.func=a[1],o.expr=a[2],a[3]&&(o.subsets=a[3]),e.compiled_expr+=e.compiled_expr.replace(a[0],"y")}return o}(r))}else t.startsWith("odsAnalysisAggregation")?(a=(a=t.replace("odsAnalysisAggregation","")).toLowerCase(),i[a]||(i[a]={}),i[a].expr=a,i[a].func=e):t.startsWith("odsAnalysisX")&&s.push(e)}),0<s.length&&(a.x=s),angular.forEach(o,function(e,t){a["y."+t+".expr"]=e.expr,a["y."+t+".func"]=e.func,a["y."+t+".cumulative"]=e.cumulative||"false","QUANTILES"===e.func&&(a["y."+t+".subsets"]=e.subsets||"50"),i[t]&&(a["agg."+t+".expr"]=i[t].expr,a["agg."+t+".func"]=i[t].func)}),n(e,a).success(function(e){r[t]={},angular.isArray(e)?r[t]={results:e}:r[t]=e})},!0)})}]}}]),e.directive("odsAnalysisSerie",[function(){return{restrict:"A",scope:!0,controller:["$scope","$attrs",function(t,a){t.condition="",t.field="",t.$watch(a.odsAnalysisSerieCondition,function(e){a.odsAnalysisSerieCondition&&(t.condition=a.odsAnalysisSerieCondition)},!0),t.$watch(a.odsAnalysisSerieName,function(e){a.odsAnalysisSerieName&&(t.name=a.odsAnalysisSerieName)},!0),t.$watch(a.odsAnalysisSerieSeparateOnX,function(e){a.odsAnalysisSerieSeparateOnX&&(t.separateOnX=a.odsAnalysisSerieSeparateOnX)},!0),t.$watch(a.odsAnalysisSerieMode,function(e){a.odsAnalysisSerieMode&&(t.mode=a.odsAnalysisSerieMode)},!0)}],link:function(d,e,t){d.$watch(t.odsAnalysisSerie,function(e,t){var a,n,r,i,o=e,s={};if(d.separateOnX&&(s={}),d.results={},o){for(n={},a=0;a<o.length;a++)r=o[a][d.name],i=d.separateOnX?o[a].x[d.separateOnX]:"global",u(d,d.condition,r)?(s[i]||(s[i]=[]),s[i].push(o[a])):s[i]&&((!n[i]||n[i].length<s[i].length)&&(n[i]=s[i]),s[i]=!1);if(angular.forEach(s,function(e,t){(!n[t]||n[t].length<e.length)&&(n[t]=e)}),"reduce"==d.mode&&d.separateOnX){var l=Object.keys(n),c=[];for(a=0;a<l.length;a++)n[l[a]].length>c.length&&(c=n[l[a]]);angular.copy({global:c},d.results)}else angular.copy(n,d.results)}})}}}]),e.directive("odsSubaggregation",["ModuleLazyLoader",function(a){return{restrict:"A",scope:!0,controller:["$scope","$attrs",function(t,a){t.aggregations={};var n=t.$watch(a.odsSubaggregation,function(e){if(e){var r={};angular.forEach(a,function(e,t){var a;if(t.startsWith("odsSubaggregationSerie")){a=(a=t.replace("odsSubaggregationSerie","")).toLowerCase(),r[a]||(r[a]={});var n={expr:e};angular.extend(r[a],function(e,t){var a,n=/([A-Z_-]*?)\((.*?)\)/g,r=/([A-Z_-]*?)\(([a-zA-Z0-9\._]+),\s?(.+)\)/g,i=t||e;e.compiled_expr=""+e.expr,i.aggregates=[];for(var o={};a=n.exec(e.expr);){var s=r.exec(a[0]);if(s&&4===s.length&&(a=s),a&&(3===a.length||4===a.length)){o.func=a[1],o.expr=a[2],a[3]&&(o.param=a[3]);var l="operators."+a[1].toLowerCase()+"(accumulation['"+a[2]+"']";4===a.length&&(l+=", "+a[3]),l+=")",o.compiled_expr=e.compiled_expr.replace(a[0],l),o.needed_aggregates=a[2]}}return o}(n))}}),angular.copy(r,t.aggregations),n()}},!0)}],link:function(o,e,t){a("simple-statistics").then(function(){o.$watch(t.odsSubaggregation,function(e,t){var a,n,r={},i=e;if(o.results=[],i){for(n={},angular.forEach(o.aggregations,function(e,t){r[e.needed_aggregates]=[]}),a=0;a<i.length;a++)angular.forEach(r,function(e,t){void 0!==i[a][t]&&r[t].push(i[a][t])});angular.forEach(o.aggregations,function(e,t){n[t]=function(e,t,a,n){var r,i,o,s;try{r=e.$eval(t,{operators:ss,accumulation:(i=a,o=n,s={},angular.forEach(o,function(e){s[e]=i[e]}),s),console:console})}catch(e){console.warn("Error while compiling aggregation value with expr",t)}return r}(o,e.compiled_expr,r,[e.needed_aggregates])}),o.results.push(n)}},!0)})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsAnalyze",function(e,t,a){return{restrict:"E",template:'<div class="records-analyze">    <div ng-if="fakeMultiChartContext.datasets" no-controls="noControls" advanced-chart-controls chart-context="chartContext" context="fakeMultiChartContext" urlsynchronize></div>    <div ng-if="fakeMultiChartContext.datasets" ods-highcharts-chart colors="colors" context="fakeMultiChartContext" parameters="chartContext.dataChart"></div></div>',scope:{context:"=",autoResize:"@",noControls:"=?"},replace:!0,controller:["$scope",function(e){e.noControls=!!e.noControls,e.fakeMultiChartContext={datasets:!1},e.chartContext={},e.context.wait().then(function(){e.fakeMultiChartContext.datasets={},e.fakeMultiChartContext.datasets[e.context.dataset.datasetid]=e.context})}]}})}(),function(){"use strict";var e=angular.module("ods-widgets"),t=["$timeout","$window",function(s,l){return{restrict:"A",require:["?odsAutoResize","?autoResize"],controller:function(e,t){},link:function(e,t,a,n){var r,i=n[0]||n[1];if("false"!==(a.odsAutoResize||a.autoResize)){var o=function(){var e=Math.max(200,angular.element(l).height()-t.offset().top);t.height(e)};o(),$(window).on("resize",function(){s.cancel(r),r=s(function(){o(),i.onResize&&i.onResize()},50)})}}}}];e.directive("odsAutoResize",t),e.directive("autoResize",t)}(),function(){"use strict";var e=angular.module("ods-widgets");e.directive("odsCalendar",["ODSAPI","ModuleLazyLoader","ODSWidgetsConfig","$compile","URLSynchronizer",function(t,f,g,p,a){return{restrict:"E",scope:{context:"=",startField:"@?",endField:"@?",titleField:"@?",tooltipFields:"@?",eventColor:"@?",calendarView:"@?",availableCalendarViews:"@?",syncToUrl:"@"},require:"?refineOnClick",replace:!0,template:'<div class="odswidget-calendar">    <div class="odswidget-calendar__fullcalendar"></div>    <div class="odswidget-calendar__tooltip"></div>    <div class="odswidget-calendar__loading-backdrop">        <ods-spinner class="odswidget-calendar__loading-wheel"></ods-spinner>    </div></div>',controller:function(e){"false"!==e.syncToUrl&&a.addSynchronizedValue(e,"calendarView","calendarview")},link:function(i,a,e,n){var r=function(){$(".odswidget-calendar__tooltip").hide()},o=function(e){e?$(".odswidget-calendar__loading-backdrop").show():$(".odswidget-calendar__loading-backdrop").hide()},s=t.uniqueCall(t.records.search),l=function(e,t,a,n){var r;(r=i.fullcalendar.fullCalendar("getView")).name!=i.calendarView&&(i.calendarView=r.name),s(i.context,u(e,t)).success(function(e){n(e.records)})},c=function(e){var t;return t="date"===i.context.dataset.getField(i.endField).type?moment(e.fields[i.endField]).add(1,"day").format("YYYY-MM-DD"):e.fields[i.endField],{title:e.fields[i.titleField],start:e.fields[i.startField],end:t,buildTooltipContent:d(e),editable:!1,record:e}},d=function(a){return function(){var e,t=i.$new(!0);return t.record=a,t.dataset=i.context.dataset,t.ctx=i.context,e=i.context.dataset.extra_metas.visualization.calendar_tooltip_html_enabled&&i.context.dataset.extra_metas.visualization.calendar_tooltip_html?p("<div>"+i.context.dataset.extra_metas.visualization.calendar_tooltip_html+"</div>")(t):(t.titleField=i.titleField,t.tooltipFields=i.tooltipFields,p("<ods-calendar-tooltip></ods-calendar-tooltip>")(t)),t.$apply(),e}},u=function(e,t){var a={dataset:i.context.dataset.datasetid,rows:1e3};a=$.extend(a,i.context.parameters);var n=[i.startField+"<"+t.format("YYYY-MM-DD"),i.endField+">="+e.format("YYYY-MM-DD")].join(" AND ");return a=$.extend(a,{"q.calendar_bounds":n})};f("fullcalendar","qtip").then(function(){i.context.wait().then(function(){!function(){var e={};if(i.context.dataset&&i.context.dataset.extra_metas&&i.context.dataset.extra_metas.visualization&&(e=i.context.dataset.extra_metas.visualization),angular.isDefined(i.startField)||(i.startField=e.calendar_event_start),angular.isDefined(i.endField)||(i.endField=e.calendar_event_end),angular.isDefined(i.titleField)||(i.titleField=e.calendar_event_title),angular.isDefined(i.eventColor)||(e.calendar_event_color?i.eventColor=e.calendar_event_color:i.eventColor="#C32D1C"),angular.isDefined(i.availableCalendarViews)?i.availableCalendarViews=i.availableCalendarViews.split(/\s*,\s*/):e.calendar_available_views?i.availableCalendarViews=e.calendar_available_views.split(/\s*,\s*/):i.availableCalendarViews=["month","agendaWeek","agendaDay"],angular.isDefined(i.calendarView)?-1===i.availableCalendarViews.indexOf(i.calendarView)&&(i.calendarView=i.availableCalendarViews[0]):e.calendar_default_view&&-1<i.availableCalendarViews.indexOf(e.calendar_default_view)?i.calendarView=e.calendar_default_view:i.calendarView=i.availableCalendarViews[0],angular.isDefined(i.tooltipFields)){var t=[];angular.forEach(i.tooltipFields.split(","),function(e){t.push(e.trim())}),i.tooltipFields=t}else e.calendar_tooltip_fields?i.tooltipFields=e.calendar_tooltip_fields:i.tooltipFields=[];i.tooltip=$(a).children(".odswidget-calendar__tooltip").first().qtip({content:{text:"",button:!0},position:{my:"bottom center",at:"top center",target:"mouse",viewport:$(".odswidget-calendar__fullcalendar"),adjust:{mouse:!1,scroll:!1}},show:!1,hide:!1,style:{classes:"odswidget-calendar__tooltip odswidget-calendar__tooltip--increase-precedence"}}).qtip("api"),$(document).on("click",function(e){$(e.target).parents(".fc-event").length||$(e.target).parents(".odswidget-calendar__tooltip").length||r()}),i.fullcalendar=$(a).children(".odswidget-calendar__fullcalendar").first(),i.fullcalendar.fullCalendar({lazyFetching:!1,header:{left:"rtl"===$(a).css("direction")?"nextYear,next,prev,prevYear, today":"prevYear,prev,next,nextYear, today",center:"title",right:i.availableCalendarViews.join(",")},lang:g.language,loading:o,editable:!0,eventLimit:!0,events:l,eventDataTransform:c,eventColor:i.eventColor,defaultView:i.calendarView,eventClick:function(e,t){n&&n.refineOnRecord(e.record),r(),i.tooltip.set({"content.text":e.buildTooltipContent(),"position.target":[t.pageX,t.pageY]}).reposition(t).show(t)}})}(),i.$watch("context.parameters",function(e,t){e!==t&&i.fullcalendar.fullCalendar("refetchEvents")},!0)})})}}}]),e.directive("odsCalendarTooltip",function(){return{restrict:"E",template:'<h2 class="odswidget-calendar__tooltip-title">{{ record.fields[titleField] }}</h2><dl class="odswidget-calendar__tooltip-fields">    <dt ng-repeat-start="field in dataset.fields|fieldsForVisualization:\'calendar\'|fieldsFilter:tooltipFields"        ng-show="record.fields[field.name]|isDefined"        class="odswidget-calendar__tooltip-field-name">        {{ field.label }}    </dt>    <dd ng-repeat-end ng-switch="field.type" ng-show="record.fields[field.name]|isDefined">        <debug data="record.fields[field.name]"></debug>        <span ng-switch-when="geo_point_2d">            <ods-geotooltip width="300" height="300" coords="record.fields[field.name]">                {{ record.fields|formatFieldValue:field:ctx }}            </ods-geotooltip>        </span>        <span ng-switch-when="geo_shape">            <ods-geotooltip width="300" height="300" geojson="record.fields[field.name]">                {{ record.fields|formatFieldValue:field:ctx }}            </ods-geotooltip>        </span>        <span ng-switch-when="file">            <div ng-if="!dataset.isFieldAnnotated(field, \'has_thumbnails\')"                 ng-bind-html="record.fields|formatFieldValue:field:ctx"></div>            <div ng-if="dataset.isFieldAnnotated(field, \'has_thumbnails\')"                 ng-bind-html="record.fields[field.name]|displayImageValue:dataset.datasetid"                 style="text-align: center;"></div>        </span>        <span ng-switch-default               title="{{record.fields|formatFieldValue:field:ctx}}"               ng-bind-html="record.fields|formatFieldValue:field:ctx|imagify|videoify|prettyText|nofollow">        </span>    </dd></dl>'}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsCatalogContext",["ODSAPI","URLSynchronizer","$interpolate",function(l,c,d){return{restrict:"AE",scope:!0,replace:!0,controller:["$scope","$attrs",function(e,t){for(var a=t.context.split(","),n=0;n<a.length;n++){var r=a[n].trim(),i=t[r+"Domain"];i&&(i=d(i)(e));var o=e.$eval(t[r+"Parameters"])||{};t[r+"Source"]&&(o.source=d(t[r+"Source"])(e));var s=t[r+"Apikey"];s&&(s=d(s)(e)),e[r]={name:r,type:"catalog",domain:i,domainUrl:l.getDomainURL(i),apikey:s,parameters:o,toggleRefine:function(e,t,a){ODS.Context.toggleRefine(this,e,t,a)},getActiveFilters:function(t){if(t=t||[],this.parameters){var e=Object.keys(this.parameters),a=this;return e.filter(function(e){return"q"==e&&a.parameters.q&&0<a.parameters.q.length||"q.timerange"==e||"geofilter.polygon"==e||"geofilter.distance"==e||0===e.indexOf("refine.")||e.match(/q\.[^\s]*/)||"q.geographic_area"==e&&a.parameters["q.geographic_area"]&&0<a.parameters["q.geographic_area"].length}).filter(function(e){return-1===t.indexOf(e)})}return[]},clearActiveFilters:function(){for(var e=this.getActiveFilters(),t=0;t<e.length;t++)delete this.parameters[e[t]]}},e.$eval(t[r+"Urlsync"])&&(angular.equals(o,{})||console.log("WARNING : Context "+r+" : There are specific parameters defined, but URL sync is enabled, so the parameters will be ignored."),c.addSynchronizedObject(e,r+".parameters"))}}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsClearAllFilters",function(){return{restrict:"E",replace:!0,scope:{context:"=",except:"="},template:'<a class="odswidget-clear-all-filters" href="" ng-click="clearAll()">    <i class="fa fa-ban" aria-hidden="true"></i>     <span translate>Clear all</span></a>',controller:["$scope",function(a){a.clearAll=function(){var e=a.except?a.except:[],t=a.context;return angular.isArray(a.context)||(t=[a.context]),angular.forEach(t,function(t){angular.forEach(t.getActiveFilters(e),function(e){delete t.parameters[e]})}),!1}}]}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsCrossTable",["ODSAPI","$q","$filter","$timeout",function(_,x,l,C){var o=function(t,e,a,n,r,i,o,s){return this.rowFields=t,this.colField=e,this.schema=n,this.dataset=r,this.series=a,this.rowNumbersIndexes=[],this.colNumbersIndex={},this.table=[],this.repeatRowHeaders=i,this.displayIntermediaryResults=o,this._insertedRowHeaders=[],this.labelBuilder=new c(this.dataset,this.schema,this.rowFields,this.colField),this.numberPrecision=s,this.setData=function(e,t,a){this.resetData(),this.buildColNumbersIndexes(e,!1),this.buildRowNumbersIndexes(t,1<this.rowFields.length),this.buildTableStructure(t),this.buildTableColumnHeaders(e,!1),this.buildTableRowHeaders(t,1<this.rowFields.length),this.buildTableBody(a,!0)},this.resetData=function(){if(this.colNumbersIndex={},this.rowNumbersIndexes=[],this.displayIntermediaryResults)for(var e=0;e<this.rowFields.length;e++)this.rowNumbersIndexes.push(new u(this.rowFields,e+1,this.labelBuilder));else this.rowNumbersIndexes.push(new u(this.rowFields,this.rowFields.length,this.labelBuilder));this._insertedRowHeaders=t.reduce(function(e,t){return e[t]=[],e},{}),this.table=[]},this.buildColNumbersIndexes=function(e,t){for(var a=0;a<e.length;a++){for(var n={},r=0;r<this.series.length;r++){n[this.series[r].name]=a*this.series.length+r}this.colNumbersIndex[this.labelBuilder.buildLabel(e[a],this.colField,t)]=n}},this.buildRowNumbersIndexes=function(e,t){for(var a=e[e.length-1],n=0,r=this.rowNumbersIndexes[0],i=0;i<a.length;i++){var o=a[i];if(this.displayIntermediaryResults)for(var s=0;s<this.rowFields.length;s++)void 0===(r=this.rowNumbersIndexes[s]).getRowNumber(o,t)&&(r.setRowNumber(o,n,t),n++);else void 0===r.getRowNumber(o,t)&&(r.setRowNumber(o,n,t),n++)}},this.buildTableStructure=function(e){var t;for(t=0;t<Math.min(2,this.series.length);t++)this.table.push([]);var a,n=this,r=Object.keys(this.colNumbersIndex).length*this.series.length+this.rowFields.length;if(this.displayIntermediaryResults)for(t=0;t<e.length;t++)a=e[t],angular.forEach(a,function(){n.table.push(new Array(r))});else a=e[0],angular.forEach(a,function(){n.table.push(new Array(r))})},this.buildTableColumnHeaders=function(e,t){var a,n=this,r=this.series.length;if(1<r){a=[],angular.forEach(this.rowFields,function(){a.push(new d("","ods-cross-table__cell--header"))}),angular.forEach(e,function(e){a.push(new d(n.labelBuilder.buildLabel(e,n.colField,t),"ods-cross-table__cell--header",r))}),this.table[0]=a,a=[],angular.forEach(this.rowFields,function(e){a.push(new d(n.schema[e].label,"ods-cross-table__cell--header"))});var i=[];angular.forEach(this.series,function(e){i.push(new d(e.label||e.name,"ods-cross-table__cell--header"))}),angular.forEach(e,function(){a=a.concat(i)}),this.table[1]=a}else a=[],angular.forEach(this.rowFields,function(e){a.push(new d(n.schema[e].label,"ods-cross-table__cell--header"))}),angular.forEach(e,function(e){a.push(new d(n.labelBuilder.buildLabel(e,n.colField,t),"ods-cross-table__cell--header"))}),this.table[0]=a},this.buildTableRowHeaders=function(e,s){var l=this;angular.forEach(e,function(e,o){angular.forEach(e,function(e){for(var t=l.getRowNumber(e,o,s)+Math.min(2,l.series.length),a=l.displayIntermediaryResults?o+1:l.rowFields.length,n=0;n<a;n++){var r=l.rowFields[n],i=l.labelBuilder.buildLabel(e,r,s);(n===l.rowFields.length-1||l.repeatRowHeaders||-1===l._insertedRowHeaders[r].indexOf(i))&&(l.table[t][n]=new d(i,0,"ods-cross-table__cell--header"),l._insertedRowHeaders[r]=[],l._insertedRowHeaders[r].push(i))}})})},this.buildTableBody=function(e,i){var o=this;angular.forEach(e,function(e,r){angular.forEach(e,function(n){angular.forEach(o.series,function(e){var t=o.getRowNumber(n,r,i)+Math.min(2,o.series.length),a=o.getColNumber(n,e.name,i)+o.rowFields.length;o.table[t][a]=new d(l("number")(n[e.name],o.numberPrecision),"ods-cross-table__cell--value")})})})},this.getColNumber=function(e,t,a){return this.colNumbersIndex[this.labelBuilder.buildLabel(e,this.colField,a)][t]},this.getRowNumber=function(e,t,a){return this.rowNumbersIndexes[t].getRowNumber(e,a)},this},c=function(e,t,a,n){return this.dataset=e,this.schema=t,this.rowFields=a,this.colField=n,this.formatXValue=function(e){if(angular.isObject(e)){var t=ODS.DateFieldUtils.datePatternBuilder("moment")(e);return moment(ODS.DateFieldUtils.getDateFromXObject(e)).format(t)}return e},this.buildLabel=function(e,t,a){return a?this.formatXValue(e.x[t]):this.formatXValue(e.x)},this},s=function(e){return this.name=e,this.label=void 0,this.func=void 0,this.expr=void 0,this.update=function(e,t){this[e]=t},this},d=function(e,t,a){return this.label=e,this.colspan=a||0,this.classes=t||"",this},u=function(e,t,a){return this.rowFields=e,this.depth=t,this.labelBuilder=a,this.rowNumbers={},this.getRowNumber=function(e,t){for(var a=this.rowNumbers,n=0;n<this.depth;n++){var r=this.rowFields[n];if(void 0===(a=a[this.labelBuilder.buildLabel(e,r,t)]))return}return a},this.setRowNumber=function(e,t,a){for(var n=this.depth-1;0<=n;n--){var r=this.rowFields[n],i={};i[this.labelBuilder.buildLabel(e,r,a)]=t,t=i}angular.merge(this.rowNumbers,t)},this};return{restrict:"E",replace:!0,scope:{context:"=",column:"@",rows:"@",repeatRowHeaders:"=",displayIntermediaryResults:"=",numberPrecision:"="},template:'<div class="ods-cross-table">    <ods-spinner with-backdrop ng-show="loading"></ods-spinner>    <div class="ods-cross-table__frozen-header-wrapper">        <table class="ods-cross-table__frozen-header">            <tr ng-repeat="row in table | limitTo:nbFrozenRows track by $index" class="ods-cross-table__row">                <td ng-repeat="cell in row | limitTo:nbFrozenCols track by $index"                     colspan="{{ cell.colspan }}"                     class="ods-cross-table__cell {{ cell.classes }}">                    <div class="ods-cross-table__cell-content" ng-bind="cell.label || \'&nbsp;\'"></div>                </td>            </tr>        </table>    </div>    <div class="ods-cross-table__frozen-rows-wrapper">        <table class="ods-cross-table__frozen-rows">            <tr ng-repeat="row in table | limitTo:nbFrozenRows track by $index" class="ods-cross-table__row">                <td ng-repeat="cell in row | limitTo:row.length:nbFrozenCols track by $index"                     colspan="{{ cell.colspan }}"                     class="ods-cross-table__cell {{ cell.classes }}">                    <div class="ods-cross-table__cell-content" ng-bind="cell.label || \'&nbsp;\'"></div>                </td>            </tr>        </table>    </div>    <div class="ods-cross-table__frozen-cols-wrapper">        <table class="ods-cross-table__frozen-cols">            <tr ng-repeat="row in table | limitTo:table.length:nbFrozenRows track by $index" class="ods-cross-table__row">                <td ng-repeat="cell in row | limitTo:nbFrozenCols track by $index"                     colspan="{{ cell.colspan }}"                     class="ods-cross-table__cell {{ cell.classes }}">                    <div class="ods-cross-table__cell-content" ng-bind="cell.label || \'&nbsp;\'"></div>                </td>            </tr>        </table>    </div>    <div class="ods-cross-table__body-wrapper">        <table class="ods-cross-table__body">            <tr ng-repeat="row in table | limitTo:table.length:nbFrozenRows track by $index" class="ods-cross-table__row">                <td ng-repeat="cell in row | limitTo:row.length:nbFrozenCols track by $index"                     colspan="{{ cell.colspan }}"                     class="ods-cross-table__cell {{ cell.classes }}">                    <div class="ods-cross-table__cell-content" ng-bind="cell.label || \'&nbsp;\'"></div>                </td>            </tr>        </table>    </div></div>',link:function(c,e,a){var d;c.table=[],c.nbFrozenRows=0,c.nbFrozenCols=0,c.loading=!1;var n=c.rows.split(","),t=$(e),u=t.find(".ods-cross-table__frozen-header-wrapper"),f=t.find(".ods-cross-table__frozen-header"),g=t.find(".ods-cross-table__frozen-cols-wrapper"),p=t.find(".ods-cross-table__frozen-cols"),h=t.find(".ods-cross-table__frozen-rows-wrapper"),m=t.find(".ods-cross-table__frozen-rows"),y=t.find(".ods-cross-table__body-wrapper"),v=t.find(".ods-cross-table__body"),b=function(e){e=angular.isArray(e)?e:[e];var n=[];return angular.forEach(e,function(e){var t=c.context.dataset.getField(e);if(-1<["date","datetime"].indexOf(t.type)){var a=c.context.dataset.getFieldAnnotation(t,"timeserie_precision").args[0];n=n.concat(ODS.DateFieldUtils.getTimescaleX(e,a))}else n.push(e)}),n},w=function(e){return angular.isArray(e)||(e=[e]),e.map(function(e){return"x."+e}).join(",")},r=function(){c.loading=!0;var e=[],t=b(d.colField),a={x:t,"y.serie1.func":"COUNT",sort:w(t)};e.push(_.records.analyze(c.context,angular.extend({},c.context.parameters,a)));for(var n=[],r=[],i=c.displayIntermediaryResults?0:d.rowFields.length-1;i<d.rowFields.length;i++){var o,s,l=d.rowFields.slice(0,i+1);s=b(l),o=angular.extend({},c.context.parameters,{x:s,"y.serie1.func":"COUNT",sort:w(s)}),n.push(_.records.analyze(c.context,o)),s=b(l.concat(d.colField)),o=angular.extend({},c.context.parameters,{x:s,sort:w(s)}),angular.forEach(d.series,function(e){o["y."+e.name+".expr"]=e.expr,o["y."+e.name+".func"]=e.func}),r.push(_.records.analyze(c.context,o))}e=e.concat(n).concat(r),x.all(e).then(function(e){var t=e[0].data,a=e.slice(1,(e.length-1)/2+1).map(function(e){return e.data}),n=e.slice((e.length-1)/2+1,e.length).map(function(e){return e.data});d.setData(t,a,n),c.table=d.table,c.nbFrozenCols=d.rowFields.length,c.nbFrozenRows=Math.min(2,d.series.length),C(function(){var t=function(e,t){var a=Math.max(t.outerWidth(),e.outerWidth());t.css({width:a}),e.find(".ods-cross-table__cell-content").css({width:a})},a=m.find("tr:last-child .ods-cross-table__cell-content");v.find("tr:first-child td").each(function(e){t($(this),$(a[e]))});var n=f.find("tr:last-child .ods-cross-table__cell-content");p.find("tr:first-child td").each(function(e){t($(this),$(n[e]))}),n=f.find("td:first-child .ods-cross-table__cell-content"),m.find("td:first-child").each(function(e){$(n[e]).css({height:$(this).height()})});var e=g.outerWidth(),r=h.outerHeight();u.css({top:0,left:0,width:e,height:r}),h.css({top:0,left:e}),g.css({top:r,left:0}),y.css({top:r,left:e}),y.on("scroll",function(){p.css({"margin-top":-$(this).scrollTop()}),m.css({"margin-left":-$(this).scrollLeft()})}),g.on("wheel",function(e){y.scrollTop(y.scrollTop()+e.originalEvent.deltaY),e.preventDefault()}),h.on("wheel",function(e){y.scrollLeft(y.scrollLeft()+e.originalEvent.deltaX),e.preventDefault()}),v.find("tr").hover(function(){p.find("tr:nth-child("+($(this).index()+1)+")").addClass("ods-cross-table__row--hover")},function(){p.find("tr:nth-child("+($(this).index()+1)+")").removeClass("ods-cross-table__row--hover")}),p.find("tr").hover(function(){v.find("tr:nth-child("+($(this).index()+1)+")").addClass("ods-cross-table__row--hover")},function(){v.find("tr:nth-child("+($(this).index()+1)+")").removeClass("ods-cross-table__row--hover")}),c.loading=!1})})};c.context.wait().then(function(){var t,i;angular.isDefined(c.numberPrecision)||(c.numberPrecision=3),d=new o(n,c.column,(i={},angular.forEach(a,function(e,t){var a=/serie([0-9A-Z][0-9a-z]*)(Label|Func|Expr)/g.exec(t);if(a){var n=a[1].toLowerCase(),r=i[n]||new s(n);r.update(a[2].toLowerCase(),e),i[n]=r}}),Object.keys(i).map(function(e){return i[e]})),(t={},angular.forEach(c.context.dataset.fields,function(e){(-1<n.indexOf(e.name)||e.name==c.column)&&(t[e.name]=e)}),t),c.context.dataset,!0===c.repeatRowHeaders,!0===c.displayIntermediaryResults,c.numberPrecision),c.$watch("context.parameters",r,!0)})}}}])}(),function(){"use strict";var e=angular.module("ods-widgets"),s=function(e,t){var a=e.find(".dataset-item").first(),n=$(e.find(".card-container")).outerHeight();"bottom"===t?($(a).css("top",0),$(a).css("bottom",n)):($(a).css("top",n),$(a).css("bottom",0))};e.directive("odsDatasetCard",function(){return{restrict:"E",scope:{context:"="},template:'<div class="odswidget odswidget-dataset-card">   <div class="card-container" ng-class="{bottom: position == \'bottom\', expanded: expanded, expandable: isExpandable()}">       <h2 class="dataset-title" ng-click="expanded = !expanded" ng-show="!expanded || (expanded && !context.dataset.metas.description)">{{context.dataset.metas.title}}</h2>       <div ng-click="expanded = !expanded" class="expand-control" title="Show/hide details" translate="title">           <span translate>Details</span>            <i class="fa fa-chevron-down" ng-show="!expanded" aria-hidden="true"></i>           <i class="fa fa-chevron-up" aria-hidden="true" ng-hide="!expanded"></i>       </div>       <div class="dataset-expanded" ng-click="expanded = !expanded"">           <h2 class="dataset-title" ng-show="expanded">               {{context.dataset.metas.title}}           </h2>           <p class="dataset-description" ng-if="expanded" ng-bind-html="safeHtml(context.dataset.metas.description)"></p>       </div>       <div class="dataset-infos">           <span class="dataset-infos-text">               <a ng-href="{{datasetUrl}}" target="_blank" ng-bind-html="websiteName"></a>               <span ng-show="context.dataset.metas.license"> -                    <span translate>License</span>                    {{context.dataset.metas.license}}               </span>           </span>       </div>   </div>   <div class="dataset-item" ng-transclude></div></div>',replace:!0,transclude:!0,link:function(e,t,a){e.position=a.position||"top"},controller:["$scope","$element","ODSWidgetsConfig","$transclude","$sce","$timeout",function(a,n,e,t,r,i){a.websiteName=e.websiteName,a.expanded=!1,a.safeHtml=function(e){return r.trustAsHtml(e)},a.isExpandable=function(){return!!(a.context&&a.context.dataset&&a.context.dataset.datasetid)&&!!a.context.dataset.metas.description};var o=a.$watch("context",function(e,t){e&&e.dataset&&(i(function(){s(n,a.position)},0),a.expanded=!1,a.datasetUrl=a.context.domainUrl+"/explore/dataset/"+a.context.dataset.datasetid+"/",a.websiteName||(a.websiteName=a.context.domainUrl),o())},!0);s(n,a.position)}]}}),e.directive("odsMultidatasetsCard",["ODSWidgetsConfig",function(e){return{restrict:"E",scope:{odsTitle:"=",datasets:"=",context:"="},template:'<div class="odswidget-multidatasets-card">   <div class="card-container multidatasets" ng-class="{bottom: (position == \'bottom\'), expanded: expanded, expandable: isExpandable()}">       <h2 ng-show="!expanded" ng-click="tryToggleExpand()">           {{ odsTitle }}       </h2>       <div ng-click="tryToggleExpand()" class="expand-control" ng-class="{expanded: expanded}" title="Show/hide details">           <span translate>Details</span>            <i class="fa fa-chevron-down" aria-hidden="true"></i>       </div>       <h3 class="datasets-counter" ng-click="tryToggleExpand()" ng-show="!expanded">           <span class="count-text" ng-hide="!datasetObjectKeys || datasetObjectKeys.length <= 1">               <span translate translate-n="datasetObjectKeys.length" translate-plural="{{ $count }} datasets">{{ $count }} dataset</span>          </span>       </h3>       <div class="datasets-expanded">           <h2 ng-show="expanded" ng-click="tryToggleExpand()">               {{ odsTitle }}           </h2>           <h3 class="datasets-counter" ng-click="tryToggleExpand()" ng-show="expanded">               <span class="count-text">                   <span ng-if="datasetObjectKeys.length == 0" translate>no dataset to display</span>                   <span ng-if="datasetObjectKeys.length > 0" translate translate-n="datasetObjectKeys.length" translate-plural="{{ $count }} datasets">{{ $count }} dataset</span>               </span>           </h3>           <ul class="dataset-list"              ng-show="(datasetObjectKeys && datasetObjectKeys.length === 1) || (isExpandable() && expanded)"              ng-class="{\'single-dataset\': datasetObjectKeys.length === 1}">               <li ng-repeat="(key, dataset) in datasets">                    <a ng-href="{{context.domainUrl}}/explore/dataset/{{dataset.datasetid}}/" target="_blank">{{ dataset.metas.title }}</a>                  <span ng-show="dataset.metas.license">- <span translate>License</span> {{ dataset.metas.license }}</span>               </li>           </ul>       </div>       <div class="dataset-infos">           <span class="dataset-infos-text">               <a ng-href="/" target="_blank" ng-bind-html="websiteName"></a>           </span>       </div>   </div>   \x3c!-- embedded content (chart, map etc.) --\x3e   <div class="dataset-item" ng-transclude></div></div>',replace:!0,transclude:!0,link:function(e,t,a){e.position=a.position||"top"},controller:["$scope","$element","ODSWidgetsConfig","$transclude","$sce","$timeout",function(n,r,e,t,a,i){n.datasetObjectKeys=[],n.websiteName=e.websiteName,n.safeHtml=function(e){return a.trustAsHtml(e)},n.isExpandable=function(){return!(!n.datasetObjectKeys.length||1===n.datasetObjectKeys.length)},n.tryToggleExpand=function(){n.isExpandable()&&(n.expanded=!n.expanded)};var o=n.$watch("datasets",function(e,t){if(e){var a=Object.keys(e);if(0===a.length)return;n.datasetObjectKeys=a,i(function(){s(r,n.position)},0),n.expanded=!1,o()}},!0);i(function(){s(r,n.position)},0)}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsDatasetContext",["ODSAPI","$q","$interpolate","$interval","URLSynchronizer","ContextHelper",function(e,t,h,g,p,m){var y=function(e,t,a,n,r,i,o,s,l,c,d){var u;if(angular.equals(i,{}))if(o){var f=a.$watch(o,function(e,t){e&&(s&&(e.parameters.source=s),a[n].parameters=e.parameters,f())});u=null}else u=angular.equals(i,{})?i:{};else u=i,l&&console.warn("Context "+n+" : There are specific parameters defined, but URL sync is enabled, so the parameters will be ignored.");s&&u&&(u.source=s),a[n]=m.getDatasetContext(n,e,t,u,s,r,c),d&&g(function(){a[n].parameters._refreshTimestamp=(new Date).getTime()},d),l&&p.addSynchronizedObject(a,n+".parameters",["basemap","location"])};return{restrict:"AE",scope:!0,replace:!0,controller:["$scope","$attrs",function(e,t){for(var a,n,r,i,o,s,l,c=t.context.split(","),d=0;d<c.length;d++){var u=c[d].trim();t[u+"Dataset"]||t[u+"DatasetSchema"]||console.error("Context "+u+" : Missing dataset parameter"),a=t[u+"Dataset"]?h(t[u+"Dataset"])(e):"",n=t[u+"Domain"]?h(t[u+"Domain"])(e):"",r=t[u+"Apikey"]?h(t[u+"Apikey"])(e):"",i=t[u+"Sort"]?h(t[u+"Sort"])(e):"",o=t[u+"Source"]?h(t[u+"Source"])(e):"",s=t[u+"DatasetSchema"]?angular.fromJson(t[u+"DatasetSchema"].replace(/\\{/g,"{").replace(/\\}/g,"}")):void 0,angular.isDefined(t[u+"RefreshDelay"])&&(l=parseInt(h(t[u+"RefreshDelay"])(e),10),isFinite(l)?l<1e4&&(console.warn(u+"-refresh-delay: Is too small (10000ms minimum). Fallbacking to 10000ms."),l=1e4):(console.warn(u+"-refresh-delay: Is not a valid integer. Fallbacking to 10000ms."),l=1e4));var f=e.$eval(t[u+"Parameters"])||{},g=t[u+"ParametersFromContext"];i&&(f.sort=i);var p=e.$eval(t[u+"Urlsync"]);y(n,a,e,u,r,f,g,o,p,s,l)}}]}}])}(),function(){"use strict";var e=angular.module("ods-widgets"),s=function(e){var t={geoJSON:{title:"Geo JSON object",description:"Schema for a Geo JSON object",type:"object",required:["type"],properties:{crs:{$ref:"#/definitions/crs"},bbox:{$ref:"#/definitions/bbox"}},oneOf:[{$ref:"#/definitions/geometry"},{$ref:"#/definitions/geometryCollection"},{$ref:"#/definitions/feature"},{$ref:"#/definitions/featureCollection"}]},bbox:{description:"A bounding box as defined by GeoJSON",type:"array",items:{type:"number"}},crs:{title:"crs",description:"a Coordinate Reference System object",type:["object","null"],required:["type","properties"],properties:{type:{type:"string"},properties:{type:"object"}},additionalProperties:!1,oneOf:[{$ref:"#/definitions/namedCrs"},{$ref:"#/definitions/linkedCrs"}]},namedCrs:{properties:{type:{enum:["name"]},properties:{required:["name"],additionalProperties:!1,properties:{name:{type:"string"}}}}},linkedObject:{type:"object",required:["href"],properties:{href:{type:"string",format:"uri"},type:{type:"string",description:"Suggested values: proj4, ogjwkt, esriwkt"}}},linkedCrs:{properties:{type:{enum:["link"]},properties:{$ref:"#/definitions/linkedObject"}}},geometryCollection:{title:"GeometryCollection",description:"A collection of geometry objects",required:["geometries"],properties:{type:{enum:["GeometryCollection"]},geometries:{type:"array",items:{$ref:"http://json-schema.org/geojson/geometry.json#"}}}},feature:{title:"Feature",description:"A Geo JSON feature object",required:["geometry","properties"],properties:{type:{enum:["Feature"]},geometry:{oneOf:[{type:"null"},{$ref:"#/definitions/geometry"}]},properties:{type:["object","null"]},id:{}}},featureCollection:{title:"FeatureCollection",description:"A Geo JSON feature collection",required:["features"],properties:{type:{enum:["FeatureCollection"]},features:{type:"array",items:{$ref:"#/definitions/feature"}}}},geometry:{title:"geometry",description:"One geometry as defined by GeoJSON",type:"object",required:["type","coordinates"],oneOf:[{title:"Point",properties:{type:{enum:["Point"]},coordinates:{$ref:"#/definitions/position"}}},{title:"MultiPoint",properties:{type:{enum:["MultiPoint"]},coordinates:{$ref:"#/definitions/positionArray"}}},{title:"LineString",properties:{type:{enum:["LineString"]},coordinates:{$ref:"#/definitions/lineString"}}},{title:"MultiLineString",properties:{type:{enum:["MultiLineString"]},coordinates:{type:"array",items:{$ref:"#/definitions/lineString"}}}},{title:"Polygon",properties:{type:{enum:["Polygon"]},coordinates:{$ref:"#/definitions/polygon"}}},{title:"MultiPolygon",properties:{type:{enum:["MultiPolygon"]},coordinates:{type:"array",items:{$ref:"#/definitions/polygon"}}}}],position:{description:"A single position",type:"array",minItems:2,items:[{type:"number"},{type:"number"}],additionalItems:!1},positionArray:{description:"An array of positions",type:"array",items:{$ref:"#/definitions/position"}},lineString:{description:"An array of two or more positions",allOf:[{$ref:"#/definitions/positionArray"},{minItems:2}]},linearRing:{description:"An array of four positions where the first equals the last",allOf:[{$ref:"#/definitions/positionArray"},{minItems:4}]},polygon:{description:"An array of linear rings",type:"array",items:{$ref:"#/definitions/linearRing"}}}};for(var a in t)t.hasOwnProperty(a)&&(e.definitions[a]=t[a])};e.directive("odsDatasetJsonSchema",function(){return{restrict:"E",replace:!0,scope:{context:"="},template:'<div>   <div contenteditable="true"         ods-json-formatter="json_schema"        class="odswidget-dataset-json-schema"></div></div>',link:function(o){o.json_schema={};o.context.wait().then(function(){o.json_schema=function(){var e=o.context.dataset,t={title:e.datasetid,type:"object",oneOf:[{$ref:"#/definitions/"+e.datasetid}],definitions:{}};t.definitions[e.datasetid]={properties:{records:{type:"array",items:{$ref:"#/definitions/"+e.datasetid+"_records"}}}};var a={},n={text:{type:"string"},date:{type:"string",format:"date"},datetime:{type:"string",format:"date-time"},int:{type:"integer"},double:{type:"number"},geo_point_2d:{type:"array",minItems:2,maxItems:2,items:{type:"number"}},geo_shape:{type:"object",oneOf:[{$ref:"#/definitions/geometry"}]}};for(var r in e.fields){var i=e.fields[r];i.type in n?a[i.name]=angular.copy(n[i.type]):a[i.name]={type:"string"},"geo_point_2d"!==i.type&&"geo_shape"!==i.type||s(t),a[i.name].title=i.label,a[i.name].description=i.description?i.description:"",angular.forEach(i.annotations,function(e){"unit"===e.name&&e.args&&0<e.args.length&&(a[i.name].unit=e.args[0])})}return t.definitions[e.datasetid+"_records"]={properties:{fields:{type:"object",properties:a}}},t}()})}}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsDatasetSchema",["ODSAPI",function(a){return{restrict:"E",replace:!0,scope:{context:"="},template:'<div class="odswidget-dataset-schema">   <div class="odswidget-dataset-schema__field"         ng-repeat="field in context.dataset.fields">       <div class="odswidget-dataset-schema__field-label">{{ field.label }}</div>       <div class="odswidget-dataset-schema__field-details">           <div class="odswidget-dataset-schema__field-description-wrapper">               <pre class="odswidget-dataset-schema__field-description"                    ng-show="field.description">{{ field.description }}</pre>               <p class="odswidget-dataset-schema__field-description odswidget-dataset-schema__field-description--empty"                  ng-hide="field.description" translate>No description available for this field.</p>           </div>               <table class="odswidget-dataset-schema__field-properties">                   <tr class="odswidget-dataset-schema__field-name">                       <td class="odswidget-dataset-schema__field-properties-key">                           <span translate>Name (identifier)</span>                       </td>                       <td class="odswidget-dataset-schema__field-properties-value">                           <pre class="odswidget-dataset-schema__field-name-value">{{ field.name }}</pre>                       </td>                   </tr>                   <tr class="odswidget-dataset-schema__field-type">                       <td class="odswidget-dataset-schema__field-properties-key">                           <span translate>Type</span>                       </td>                       <td class="odswidget-dataset-schema__field-properties-value">                           <pre class="odswidget-dataset-schema__field-type-value">{{ field.type | translate }}</pre>                       </td>                   </tr>                   <tr class="odswidget-dataset-schema__field-type"                       ng-repeat="annotation in field.annotations|filter:{name: \'unit\'}:true">                       <td class="odswidget-dataset-schema__field-properties-key">                           <span translate>Unit</span>                       </td>                       <td class="odswidget-dataset-schema__field-properties-value">                           <pre class="odswidget-dataset-schema__field-type-value">{{ annotation.args[0] }}</pre>                       </td>                   </tr>                   <tr class="odswidget-dataset-schema__field-sample">                       <td class="odswidget-dataset-schema__field-properties-key">                           <span translate>Sample</span>                       </td>                       <td class="odswidget-dataset-schema__field-properties-value">                           <pre class="odswidget-dataset-schema__field-sample-value">{{ sample.fields[field.name] }}</pre>                       </td>                   </tr>               </table>       </div>   </div></div>',link:function(t){t.sample={},t.context.wait().then(function(){var e={rows:1};t.context.parameters.source&&(e.source=t.context.parameters.source),t.context.dataset.data_visible&&a.records.search(t.context,e).success(function(e){t.sample=e.records[0]})})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsDatetime",function(){return{restrict:"A",controller:["$scope","$attrs","$q",function(e,t,a){var n=t.odsDatetime||"datetime";e.refreshDatetime=function(){e[n]=moment().format()},e.refreshDatetime()}]}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsDisqus",["ODSWidgetsConfig","$location","$window",function(a,n,r){return{restrict:"E",replace:!0,scope:{shortname:"@",identifier:"@"},template:'<div id="disqus_thread" class="odswidget"></div>',link:function(e){r.disqus_shortname=e.shortname||a.disqusShortname,e.identifier&&(r.disqus_identifier=e.identifier),r.disqus_url=n.absUrl(),r.disqus_config=function(){this.language=a.language};var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+r.disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsDomainStatistics",["ODSAPI",function(i){return{restrict:"AE",scope:!0,controller:["$scope","$attrs",function(e,t){var n=function(e,t,a){return a.name===t&&(e.stats[t]=a.facets.length,!0)},r=e.$watch(t.context,function(a){a.stats={dataset:0,keyword:0,publisher:0,theme:0},i.datasets.search(a,{facet:["keyword","publisher","theme"],rows:0}).success(function(e){if(a.stats.dataset=e.nhits,e.facet_groups)for(var t=0;t<e.facet_groups.length;t++)n(a,"keyword",e.facet_groups[t])||n(a,"publisher",e.facet_groups[t])||n(a,"theme",e.facet_groups[t])}),r()},!0)}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsFacetResults",["ODSAPI",function(e){return{restrict:"A",scope:!0,priority:1001,controller:["$scope","$attrs",function(o,s){var l=e.uniqueCall(e.records.search),c=e.uniqueCall(e.datasets.search);o.$watch(s.odsFacetResultsContext,function(e){var t,a=s.odsFacetResultsFacetName,n={};s.odsFacetResultsSort&&(n["facetsort."+a]=s.odsFacetResultsSort);var r=angular.extend({},e.parameters,{rows:0,facet:a},n),i=s.odsFacetResults||"results";if("dataset"===e.type&&e.dataset)t=l(e,r);else{if("catalog"!==e.type)return;t=c(e,r)}t.success(function(e){if(e.facet_groups){var t=e.facet_groups.filter(function(e){return e.name===a});0===t.length&&(o[i]=[]),o[i]=t[0].facets}else o[i]=[]})},!0)}]}}])}(),function(){"use strict";var e=angular.module("ods-widgets");e.directive("odsFacets",["$compile","translate","$q",function(i,o,l){var s=function(t,e,a){var n="";angular.forEach(a,function(e){n+='<ods-facet name="'+e.name+'" title="'+(e.title&&e.title.replace(/"/g,"&quot;")||e.name)+'" sort="'+(e.sort||"")+'" disjunctive="'+(e.disjunctive||"")+'" timerange-filter="'+(e.timerangeFilter||"")+'" hide-if-single-category="'+(e.hideIfSingleCategory?"true":"false")+'" hide-category-if="'+(e.hideCategoryIf||"")+'"value-formatter="'+(e.valueFormatter||"")+'"context="'+(t.context.name||"")+'">'+(e.template||"")+"</ods-facet>"}),n=n.replace(/{{(.*?)}}/g,"\\{\\{$1\\}\\}");var r=angular.element(n);e.append(r),i(r)(t)};return{restrict:"E",replace:!0,scope:{context:"=",facetsConfig:"="},compile:function(e){var i=e.children().length;return function(t,e){var a,n;if(n=function(){var e=t.$watch("context",function(){t.context&&("dataset"===t.context.type?t.context.wait().then(function(){t.init()}):t.init(),e())})},t.facetsConfig)s(t,e,t.facetsConfig),n();else if(0===i){var r;a=t.$watch("context",function(){t.context&&(a(),"catalog"===t.context.type?(r=[{name:"modified",title:o("Modified"),valueFormatter:"date"},{name:"publisher",title:o("Publisher")},{name:"keyword",title:o("Keyword")},{name:"theme",title:o("Theme")}],s(t,e,r),t.init()):t.context.wait().then(function(){r=angular.copy(t.context.dataset.getFacets()),angular.forEach(r,function(t){t.title=t.label,delete t.label,angular.forEach(t.annotations,function(e){"facetsort"===e.name&&0<e.args.length&&(t.sort=e.args[0]),"disjunctive"===e.name&&(t.disjunctive=!0),"timerangeFilter"===e.name&&(t.timerangeFilter=!0)}),"datetime"!=t.type&&"date"!=t.type||(t.valueFormatter="date")}),s(t,e,r),t.init()}))},!0)}else n()}},controller:["$scope","ODSAPI",function(o,e){var s={},a=e.uniqueCall(e.records.search),n=e.uniqueCall(e.datasets.search);o.facets=[],o.init=function(){o.$watch(function(){var e=angular.copy(o.context.parameters);return e.sort&&delete e.sort,e.start&&delete e.start,e.tab&&delete e.tab,e.dataChart&&delete e.dataChart,"dataset"===o.context.type?[e,o.context.dataset]:e},function(){("catalog"===o.context.type||o.context.dataset)&&(angular.isDefined(o.context.parameters.start)&&delete o.context.parameters.start,o.refreshData())},!0)},o.refreshData=function(){var t=angular.extend({},o.context.parameters,{rows:0,facet:o.facets.map(function(e){return e.name})});o.facets.map(function(e){e.sort&&e.sort.length&&"["!==e.sort[0]&&(t["facetsort."+e.name]=e.sort)}),("dataset"===o.context.type?a(o.context,t):n(o.context,t)).success(function(e){var t,a,r;o.context.nhits=e.nhits,angular.forEach(o.facets,function(e){e.categories.splice(0,e.categories.length)}),e.facet_groups&&angular.forEach(e.facet_groups,function(n){if(0<(a=o.facets.filter(function(e){return e.name===n.name})).length){if(t=a[0].categories,r=[],a[0].sort&&a[0].sort.length&&"["===a[0].sort[0]){var e=o.$eval(a[0].sort);angular.forEach(e,function(e){var t,a;for(t=0;t<n.facets.length;t++)if((a=n.facets[t]).path===e){r.push(a),n.facets.splice(t,1);break}}),Array.prototype.push.apply(r,n.facets)}else r=n.facets;Array.prototype.push.apply(t,r)}})})},this.registerFacet=function(i,e,t,a){var n=[];return o.facets.push({name:i,categories:n,sort:e}),s[i]=[],t&&(t=angular.isArray(t)?t:[t],angular.forEach(t,function(e){var r=a[e.name+"FacetName"];s[i].push({context:e,facetName:r||i});var t=function(a,n){angular.forEach(a.dataset.fields,function(t){angular.forEach(n.dataset.fields,function(e){t.name===i&&e.name===r&&t.type!=e.type&&console.warn("Error: mapping "+a.name+"'s \""+t.name+'" (type '+t.type+") on "+n.name+"'s \""+e.name+'" (type '+e.type+").")})})};"dataset"===e.type?l.all([o.context.wait(),e.wait()]).then(function(){t(o.context,e)}):t(o.context,e)})),n},this.setDisjunctive=function(e){o.context.parameters["disjunctive."+e]=!0},this.toggleRefinement=function(e,t){o.context.toggleRefine(e,t),angular.forEach(s[e],function(e){e.context.toggleRefine(e.facetName,t)})},this.context=o.context}]}}]),e.directive("odsFacet",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{name:"@",title:"@",visibleItems:"@",hideIfSingleCategory:"@",hideCategoryIf:"@",sort:"@",disjunctive:"=?",timerangeFilter:"=?",valueSearch:"@",valueFormatter:"@",refineAlso:"=?",context:"=?"},template:'<div ng-class="{\'odswidget\': true, \'odswidget-facet\': true, \'odswidget-facet--disjunctive\': disjunctive}">    <h3 class="odswidget-facet__facet-title"         ng-if="title && ((categories.length && visible()) || displayTimerange())">        {{ title }}    </h3>    <div class="odswidget-facet__date-range" ng-if="displayTimerange()">        <ods-timerange context="context"                        time-field="{{ name }}"                        display-time="false"                        suffix="{{ name }}"></ods-timerange>    </div>    <ods-facet-category-list ng-if="visible()"                              facet-name="{{ name }}"                              value-search="{{ valueSearch }}"                              hide-category-if="{{ hideCategoryIf }}"                              categories="categories"                              template="{{ customTemplate }}"                              value-formatter="{{valueFormatter}}"></ods-facet-category-list></div>',require:"^odsFacets",link:function(e,t,a,n){angular.isUndefined(n)&&console.log("ERROR : odsFacet must be used within an odsFacets tag."),e.categories=n.registerFacet(e.name,e.sort,e.refineAlso,a),e.facetsCtrl=n,e.disjunctive&&n.setDisjunctive(e.name),e.context=e.context||n.context,e.displayTimerange=function(){return!!e.timerangeFilter&&(!(!e.context.parameters||!e.context.parameters["q.from_date."+e.name]&&!e.context.parameters["q.timerange."+e.name])||!!e.categories.length)}},controller:["$scope","$element","$transclude",function(t,e,a){t.visibleItemsNumber=t.visibleItems||6,this.toggleRefinement=function(e){t.facetsCtrl.toggleRefinement(t.name,e)},this.getVisibleItemsNumber=function(){return t.visibleItemsNumber},t.visible=function(){return!(angular.isString(t.hideIfSingleCategory)&&"true"===t.hideIfSingleCategory.toLowerCase()&&1===t.categories.length&&"refined"!==t.categories[0].state)};var n=a.$$boundTransclude().html();n&&(t.customTemplate=n.trim())}]}}),e.directive("odsFacetCategoryList",function(){return{restrict:"E",replace:!0,scope:{categories:"=",template:"@",facetName:"@",hideCategoryIf:"@",valueSearch:"@",valueFormatter:"@",context:"="},require:"^odsFacet",template:'<ul class="odswidget-facet__category-list">   <li class="odswidget-facet__value-search" ng-show="valueSearchEnabled">       <input class="odswidget-facet__value-search-input" ng-model="valueFilter" aria-label="Search in {{facetName}}" translate="aria-label">       <i ng-show="!!valueFilter" class="odswidget-facet__value-search-cancel fa fa-times" ng-click="valueFilter=\'\'"></i>   </li>   <li ng-repeat="category in categories|filter:searchValue(valueFilter)" class="odswidget-facet__category-container">       <ods-facet-category ng-if="!categoryIsHidden(category)" facet-name="{{ facetName }}" category="category" template="{{template}}" value-formatter="{{valueFormatter}}" ng-show="visible($index)"></ods-facet-category>   </li>   <li ng-if="!suggestMode && visibleItems < (filterInvisibleCategories(categories)|filter:searchValue(valueFilter)).length"        class="odswidget-facet__expansion-control">       <a ng-hide="expanded" href="#" ng-click="toggle($event)" class="odswidget-facet__expansion-control-link">           <i class="fa fa-angle-right" aria-hidden="true"></i>           <span translate>More</span>       </a>       <a ng-show="expanded" href="#" ng-click="toggle($event)" class="odswidget-facet__expansion-control-link">           <i class="fa fa-angle-right" aria-hidden="true"></i>           <span translate>Less</span>       </a>   </li></ul>',link:function(a,e,t,n){a.expanded=!1,a.visibleItems=n.getVisibleItemsNumber(),a.visible=function(e){return a.expanded||e<a.visibleItems},a.toggle=function(e){e.preventDefault(),a.expanded=!a.expanded},a.categoryIsHidden=function(e){if(a.suggestMode&&""===a.valueFilter)return!0;if(!a.hideCategoryIf)return!1;var t=a.$new(!1);return t.category=e,t.$eval(a.hideCategoryIf)},a.filterInvisibleCategories=function(e){return e.filter(function(e){return!a.categoryIsHidden(e)})}},controller:["$scope","$filter",function(e,a){e.valueFilter="",e.valueSearchEnabled=!1,e.suggestMode=!1,angular.isString(e.valueSearch)&&("true"===e.valueSearch.toLowerCase()?e.valueSearchEnabled=!0:"suggest"===e.valueSearch.toLowerCase()&&(e.valueSearchEnabled=!0,e.suggestMode=!0)),e.searchValue=function(t){return t?(t=a("normalize")(t).toLowerCase(),function(e){return-1<a("normalize")(e.name).toLowerCase().indexOf(t)}):function(){return!0}},this.emptySearch=function(){e.valueFilter=""}}]}}),e.directive("odsFacetCategory",["$compile",function(l){return{restrict:"E",replace:!0,require:["^odsFacet","^?odsFacetCategoryList"],scope:{category:"=",facetName:"@",template:"@",valueFormatter:"@"},template:'<div class="odswidget odswidget-facet-category"></div>',link:function(e,t,a,n){var r=n[0],i=n[1];e.toggleRefinement=function(e,t){e.preventDefault(),r.toggleRefinement(t),i.emptySearch()};var o=e.template||'<span class="odswidget-facet__category-count">{{ category.count|number }}</span> <span class="odswidget-facet__category-name" ng-bind-html="formatCategory(category.name, category.path)"></span>';if(o='<a class="odswidget-facet__category"    href="#"    ng-click="toggleRefinement($event, category.path)"    ng-class="{\'odswidget-facet__category--refined\': category.state === \'refined\'}"    title="{{ category.name }}">'+o+"</a>",t.append(l(o)(e)),e.category.facets){var s=angular.element('<ods-facet-category-list categories="category.facets" template="{{template}}" value-formatter="{{valueFormatter}}"></ods-facet-category-list>');t.find("a").after(s),l(s)(e)}},controller:["$scope","ValueDisplay",function(t,a){t.formatCategory=function(e){return e=ODS.StringUtils.escapeHTML(e),t.valueFormatter?a.format(e,t.valueFormatter,t.category.path):e}}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsFilterSummary",["odsTimerangeParser","odsTimescaleParser","odsTimeboundParser","ValueDisplay","QueryParameters",function(p,n,h,c,d){return{restrict:"E",replace:!0,template:'<ul class="odswidget odswidget-filter-summary">    <li class="odswidget-filter-summary__active-filter"         ng-repeat="refinement in refinements">        <a class="odswidget-filter-summary__active-filter-link"            ng-click="removeRefinement(refinement)">            <span class="odswidget-filter-summary__active-filter-label">{{ refinement.label }}<span ng-if="refinement.contextsLabel && !hideContextsLabels"> ({{ refinement.contextsLabel }})</span></span>            <span ng-if="!refinement.displayValue.type"                   class="odswidget-filter-summary__active-filter-value"                  ng-bind-html="refinement.displayValue"></span>             <span ng-if="refinement.displayValue.type === \'visualization\'"                   class="odswidget-filter-summary__active-filter-value"                   ng-bind-html="refinement.displayValue.value"></span>        </a>    </li>    <li class="odswidget-filter-summary__clear-all" ng-show="clearAllButton && refinements.length > 0">        <ods-clear-all-filters context="context" except="excludes"></ods-clear-all-filters>    </li></ul>',scope:{context:"=",exclude:"@",clearAllButton:"=?",hideContextsLabels:"=?"},controller:["$scope","$attrs","$filter","translate",function(s,a,e,g){var i=["timerange","from_date","to_date"];Boolean(s.clearAllButton)!==s.clearAllButton&&(s.clearAllButton=!0),s.excludes=s.exclude?s.exclude.split(","):[];var l=function(e,t){return e&&e.parameters&&-1===s.excludes.indexOf(t)&&e.parameters[t]&&void 0!==e.parameters[t]};s.removeRefinement=function(n){angular.forEach(n.contexts,function(e){if(n.value){var t=e.parameters[n.parameter];angular.isArray(t)||(t=[t]);for(var a=0;a<t.length;a++)if(t[a]===n.value)return t.splice(a,1),void(0===t.length&&delete e.parameters[n.parameter])}else delete e.parameters[n.parameter]})};var t=function(t){var o=[],f=function(t,a,n,r,e){void 0===e&&(e=ODS.StringUtils.escapeHTML(n));var i=!1;angular.forEach(o,function(e){e.parameter===r&&e.label===a&&e.value===n&&(e.contexts.push(t),i=!0)}),i||o.push({label:a,value:n,displayValue:e,parameter:r,contexts:[t]})};return angular.forEach(t,function(o){if(o&&o.parameters&&("catalog"===o.type||o.dataset)){var r=!1;l(o,"q")&&f(o,g("Text search"),o.parameters.q,"q");if(angular.forEach(["geofilter.distance","geofilter.polygon"],function(e){l(o,e)&&f(o,function(e){for(var t=0;t<e.dataset.fields.length;t++){var a=e.dataset.fields[t];if("geo_point_2d"===a.type||"geo_shape"===a.type)return a.label}return""}(o),o.parameters[e],e,g("Drawn area on the map"))}),"catalog"===o.type&&l(o,"q.geographic_area")&&f(o,g("Geographic area"),o.parameters["q.geographic_area"],"q.geographic_area",g("Drawn area on the map")),l(o,"q.timescale")){var e=n(o.parameters["q.timescale"]);f(o,o.dataset.getFieldLabel(e.field),o.parameters["q.timescale"],"q.timescale",e.scaleLabel)}l(o,"q.mapfilter")&&f(o,g("Map filter"),o.parameters["q.mapfilter"],"q.mapfilter"),angular.forEach(o.parameters,function(e,t){var a=d;angular.forEach(i,function(e){-1!==t.indexOf(e)&&(r=!0)});var n=-1===a.indexOf(t)&&t.match(/q\.[^\s]*/);!r&&n&&l(o,t)?f(o,g("Text search"),e,t,ODS.StringUtils.escapeHTML(e)):r&&l(o,t)&&function(e,t){var a,n="From",r="To",i=function(e){if(0<document.querySelectorAll('[time-field="'+e.name+'"]').length){var t=document.querySelectorAll('[time-field="'+e.name+'"]'),a=!1;angular.forEach(t,function(e){a||$(e).is(".odswidget-timerange")&&(a=!0,angular.isUndefined($(e).attr("label-from"))||(n=$(e).attr("label-from")),angular.isUndefined($(e).attr("label-to"))||(r=$(e).attr("label-to")))})}};if(-1!==t.indexOf(".timerange")){var o=p(e.parameters[t]);i(a=e.dataset.getField(o.field));var s=g(n+" {fromDate}  "+r+" {toDate}");s=format_string(s,{fromDate:moment(o.from).format("LL"),toDate:moment(o.to).format("LL")}),f(e,a.label,e.parameters[t],t,s)}else if(-1!==t.indexOf(".from_date")){var l=h(e.parameters[t]);i(a=e.dataset.getField(l.field));var c=g(n+" {fromDate}");c=format_string(c,{fromDate:moment(l.date).format("LL")}),f(e,a.label,e.parameters[t],t,c)}else if(-1!==t.indexOf(".to_date")){var d=h(e.parameters[t]);i(a=e.dataset.getField(d.field));var u=g(r+" {toDate}");u=format_string(u,{toDate:moment(d.date).format("LL")}),f(e,a.label,e.parameters[t],t,u)}}(o,t)}),angular.forEach(o.parameters,function(e,a){if("refine."===a.substring(0,7)&&-1===s.excludes.indexOf(a)){var n=a.substring(7),r=(i=n,"catalog"===(t=o).type?("features"===i&&(i=g("View")),i=i.slice(i.indexOf(".")+1),g(ODS.StringUtils.capitalize(i))):t.dataset.getFieldLabel(i));angular.isArray(e)||(e=[e]),angular.forEach(e,function(e){var t;"catalog"===o.type&&"language"===n?t=c.format(e,"language"):"catalog"===o.type&&"features"===n?(t={type:"visualization"}).value=c.format(e,"visualization"):t=ODS.StringUtils.escapeHTML(e),f(o,r,e,a,t)})}var t,i})}}),angular.forEach(o,function(e){e.contexts.length<t.length&&(e.contextsLabel=e.contexts.map(function(e){return a[e.name+"Label"]||e.name}).join(", "))}),o};s.$watch("context",function(e){s.refinements=t(angular.isArray(e)?e:[e])},!0)}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsGauge",["$timeout",function(e){var s=function(e){return-1===["horizontal","bar"].indexOf(e.displayMode)?"circle":e.displayMode};return{restrict:"E",replace:!0,scope:{displayMode:"@",value:"=",max:"=?"},template:function(e,t){var a=s(t);return'<div class="odswidget-gauge odswidget-gauge--'+a+'">    <div class="odswidget-gauge__value">{{ percentage | number:0 }}%</div>'+("bar"===a?'<svg class="odswidget-gauge__svg" viewBox="0 0 100 10" preserveAspectRatio="none">   <line x1="0" y1="5px" x2="100%" y2="5px" class="odswidget-gauge__svg-background"/>   <line x1="0" y1="5px" x2="100%" y2="5px" class="odswidget-gauge__svg-filler"/></svg>':'<svg class="odswidget-gauge__svg" viewBox="0 0 100 100">   <circle cx="50" cy="50" r="45" class="odswidget-gauge__svg-background"/>   <circle cx="50%" cy="50%" r="45%" class="odswidget-gauge__svg-filler"/></svg>')+"</div>"},link:function(r,e,i){var o=e.find(".odswidget-gauge__svg-filler");r.$watch("[value, max]",function(e){var t,a,n;t=e[0],a=e[1],t=t||0,a=a||100,r.percentage=t/a*100,r.percentage=Math.max(r.percentage,0),r.percentage=Math.min(r.percentage,100),n="circle"===s(i)?283:100,o.css({"stroke-dasharray":format_string("{filled} {total}",{filled:r.percentage/100*n,total:n})})})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsGeoSearch",["ModuleLazyLoader","ODSWidgetsConfig","MapHelper",function(e,c,d){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-geo-search">    <div class="odswidget-geo-search__map"></div></div>',scope:{context:"="},link:function(n,o){var s,l=/.*polygon\(geographic_area,"(.*)"\).*/;e("leaflet").then(function(){var e=new L.ODSMap(o.find(".odswidget-geo-search__map")[0],{scrollWheelZoom:!1,basemapsList:[c.basemaps[0]],disableAttribution:!0,maxBounds:[[-90,-180],[90,180]]}),r=new L.FeatureGroup;e.addLayer(r);var t=new L.Control.Draw({edit:{featureGroup:r,edit:!1,remove:!1},draw:{polyline:!1,marker:!1,polygon:!1,circle:!1}});if(e.addControl(t),angular.isDefined(c.defaultMapLocation)){var a=d.getLocationStructure(c.defaultMapLocation);e.setView(a.center,a.zoom)}else e.setView([0,0],0);var i=function(){0<r.getLayers().length&&r.removeLayer(r.getLayers()[0])};e.on("draw:drawstart",function(){i()}),e.on("draw:created",function(e){var t=e.layer;r.addLayer(t),function(e){var t=e.toGeoJSON();s=ODS.GeoFilter.getGeoJSONPolygonAsPolygonParameter(t.geometry);var a=angular.isArray(n.context)?n.context:[n.context];angular.forEach(a,function(e){e.parameters["q.geographic_area"]='#polygon(geographic_area,"'+s+'")'}),n.$apply()}(t)}),n.$watch("context",function(e){var a=!1,t=angular.isArray(e)?e:[e];if(angular.forEach(t,function(e){if(!a&&e.parameters&&e.parameters["q.geographic_area"]){var t=l.exec(e.parameters["q.geographic_area"]);0<t.length&&(a=t[1])}}),a!==s){if(i(),a){var n=L.geoJson(ODS.GeoFilter.getPolygonParameterAsGeoJSON(a));r.addLayer(n)}s=a}},!0)})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsGeotooltip",["$timeout","ModuleLazyLoader","ODSWidgetsConfig",function(s,e,g){var p=angular.element('<div id="odswidget-geotooltip" class="odswidget" style="opacity: 0; transition: opacity 200ms ease-out; position: fixed; z-index: 40000; visibility: hidden;"></div>'),h=null,m=null,l=function(e,t,a,n,r,i){var o,s=!1;t===p.css("width")&&a===p.css("height")||(s=!0),p.css("width",t),p.css("height",a);var l=jQuery(window).height()-(e.offset().top-jQuery(document).scrollTop());p.height()<l?p.css("top",e.height()+e.offset().top-jQuery(document).scrollTop()+5+"px"):p.css("top",e.offset().top-jQuery(document).scrollTop()-5-p.height()+"px");var c=jQuery(window).width()-(e.offset().left-jQuery(document).scrollLeft());p.width()<c?p.css("left",e.offset().left-jQuery(document).scrollLeft()+"px"):p.css("left",e.offset().left-jQuery(document).scrollLeft()-p.width()+"px"),e.after(p),null===h?h=new L.ODSMap(p[0],{zoomControl:!1,basemapsList:[g.basemaps[0]],maxZoom:16}):s&&h.invalidateSize(),null!==m&&h.removeLayer(m),m=L.layerGroup();var d=new L.LatLngBounds;if(n){angular.isString(n)&&(n=n.split(","));var u=new L.LatLng(n[0],n[1]),f=L.marker(u);m.addLayer(f),d.extend(u)}r&&(angular.isString(r)&&(r=angular.fromJson(r)),o=L.geoJson(r),m.addLayer(o),d.extend(o.getBounds())),i&&angular.isDefined(i.geometry)&&(o=L.geoJson(i.geometry),m.addLayer(o),d.extend(o.getBounds())),m.addTo(h),h.fitBounds(d,{reset:!0}),p.css("opacity","1"),p.css("visibility","visible")};return{template:'<span ng-transclude style="border-bottom: 1px dotted #000000; cursor: help;" class="geotooltip"></span>',replace:!0,restrict:"E",transclude:!0,scope:{coords:"=",width:"@",height:"@",delay:"@",geojson:"=",record:"="},link:function(r,i,o){e("leaflet").then(function(){var e=(o.width||200)+"px",t=(o.height||200)+"px",a=null,n=o.delay||500;i.bind("mouseenter",function(){0===n?l(i,e,t,r.coords,r.geojson,r.record):a=s(function(){l(i,e,t,r.coords,r.geojson,r.record),a=null},n)}),i.bind("click",function(){l(i,e,t,r.coords,r.geojson,r.record),null!==a&&(s.cancel(a),a=null)}),i.bind("mouseleave",function(){p.css("opacity","0"),s(function(){p.css("visibility","hidden")},200),null!==a&&(s.cancel(a),a=null)})})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsGist",function(){return{restrict:"E",replace:!0,template:'<div class="odswidget"></div>',scope:{username:"@",id:"@"},link:function(e,t,a){$.ajax({url:"https://gist.github.com/"+a.username+"/"+a.id+".json",dataType:"jsonp",timeout:1e3,success:function(e){$(document.head).append('<link href="'+e.stylesheet+'" rel="stylesheet">'),t.append(e.div)}})}}})}(),function(){"use strict";var e=angular.module("ods-widgets");e.factory("requestData",["ODSAPI","$q","ChartHelper","AggregationHelper",function(p,n,d,e){var h=ODS.DateFieldUtils.getTimescaleX,m=function(e,t,a){var n,r,i,o,s,l,c=!0;if(t.type&&(d.isRangeChart(t.type)||"boxplot"===t.type)){if(e.sort==="y."+a&&(e.sort=""),"QUANTILES"===t.charts[0].func)for(r=angular.copy(t.charts[0]),n=1;n<t.charts.length;n++)"QUANTILES"!==t.charts[n].func||t.charts[n-1].yAxis!==t.charts[n].yAxis?c=!1:r.subsets=r.subsets+","+t.charts[n].subsets;else c=!1;if(c)m(e,r,a);else for(n=0;n<t.charts.length;n++)t.charts[n].multiplier=t.multiplier,m(e,t.charts[n],a+"-range-"+n)}else angular.extend(e,(o=a,l={},"CUSTOM"===(i=t).func?function(e,t,a){var n,r=/([A-Z_-]*?)\((.*?)\)/g,i=/([A-Z_-]*?)\(([a-zA-Z0-9\.]+),\s?([0-9\.]+)\)/g,o=a||e;e.compiled_expr=""+e.expr,o.aggregates=[];var s={};for(n=r.exec(e.expr);n;){var l=i.exec(n[0]);if(l&&4===l.length&&(n=l),n&&(3===n.length||4===n.length))if(0===n[2].indexOf("serie")){var c="operators."+n[1].toLowerCase()+".apply(null, accumulation['"+n[2]+"']";4===n.length&&(c+=", "+n[3]),c+=")",e.compiled_expr=e.compiled_expr.replace(n[0],c),o.aggregates.push(n[2])}else s[t+".func"]=n[1],s[t+".expr"]=n[2],e.compiled_expr+=e.compiled_expr.replace(n[0],"y");n=r.exec(e.expr)}return s}(i,"y."+o,s):-1!==["CONSTANT","COUNT"].indexOf(i.func)||i.yAxis||i.expr?(l["y."+o+".expr"]=i.yAxis||i.expr,l["y."+o+".func"]=i.func,l["y."+o+".cumulative"]=i.cumulative||!1,"QUANTILES"===i.func&&(i.subsets||(i.subsets=50),l["y."+o+".subsets"]=i.subsets||50),"CONSTANT"===i.func&&(l["y."+o+".expr"]=i.yAxis||0,l["y."+o+".func"]="AVG"),angular.isDefined(i.multiplier)&&""!==i.multiplier&&null!==i.multiplier&&(l["y."+o+".expr"]+=" * "+i.multiplier),l):{}))};return function(e,o,s,t,a,l,c,d){var u=[],f=[],g=l;return o=o||{},1===e.length?-1!==["hour","minute","second"].indexOf(e[0].timescale)&&(o.output_timezone="UTC"):-1!==["hour","minute","second"].indexOf(s)&&(o.output_timezone="UTC"),angular.forEach(e,function(e,n){var r={},i=function(e,t,a,n){var r,i,o,s={dataset:e.config.dataset,x:[],sort:e.sort||"",maxpoints:e.maxpoints||""};for(o=h(e.xAxis,e.timescale),r=0;r<o.length;r++)s.x.push(o[r]);if(e.seriesBreakdown)for(i=e.seriesBreakdown,o=h(i,e.seriesBreakdownTimescale),r=0;r<o.length;r++)s.x.push(o[r]);return(t||e.seriesBreakdown)&&(s.sort=ODS.DateFieldUtils.getTimescaleSort(s.x)),s}(e,s);angular.forEach(e.charts,function(e,t){var a="serie"+(n+1)+"-"+(t+1);m(i,e,a),r[a]=e}),l=e.config.domain||g,c=e.config.apikey||c;var t={domain:l,domainUrl:p.getDomainURL(l),dataset:{datasetid:i.dataset},apikey:c,parameters:{}},a=!1;angular.forEach(i,function(e,t){t.match(/y\..*\.func/)&&(a=!0)}),a&&(u.push(p.records.analyze(t,angular.extend({},o,e.config.options,i),d.promise)),f.push(r))}),{promise:n.all(u),charts:f}}}]),e.directive("odsHighchartsChart",["colorScale","requestData","translate","ModuleLazyLoader","AggregationHelper","ChartHelper","$rootScope","odsNotificationService","$q","ODSWidgetsConfig",function(R,o,w,i,e,_,t,b,s,g){var a=w,p=function(e,t){return t?t+"."+e:_.getDatasetUniqueId(e)},x=function(e,t,n,r,a,i,o,s){var l,c=_.getDatasetId({dataset:{datasetid:n.config.dataset},domain:i}),d=_.getYLabel(c,r);a||_.isMultiColorChart(r.type)?_.isMultiColorChart(r.type)?(r.extras||(r.extras={}),r.innersize&&(r.extras.innerSize=r.innersize),"inside"===r.labelsposition&&(r.extras.dataLabels={distance:-50}),r.extras.colors=R.getColors(r.color)):l=n.categoryColors&&n.categoryColors[a]?n.categoryColors[a]:R.getColorAtIndex(r.color,s):l=R.getUniqueColor(r.color);var u="line";"spiderweb"===r.type?u="line":"polar"===r.type?(u="column",r.extras.colorByPoint=!0):u=r.type;var f=angular.extend({},{name:a||d,color:l,type:u,yAxis:e.singleAxis?0:t[c][d],marker:{enabled:"scatter"===r.type,radius:3},shadow:!1,tooltip:{},data:[],stacking:n.stacked?n.stacked:null},r.extras);f.dataLabels||(f.dataLabels={}),"funnel"===r.type&&(f.neckWidth="30%",f.neckHeight="25%");var g,p,h,m=!1,y=!1;if(g=r.func,-1===["COUNT","CONSTANT"].indexOf(g)&&(m=_.getFieldUnit(c,r.yAxis),y=_.getDecimals(c,r.yAxis)),r.displayValues&&(f.dataLabels.enabled=!0,f.dataLabels.color="black","treemap"!==r.type&&(f.dataLabels.formatter=function(){return y?Highcharts.numberFormat(this.point.y,y):Highcharts.numberFormat(this.point.y).replace(/([,.][0-9]*?)0+$/,"$1").replace(/[,.]$/,"")})),r.displayUnits&&m&&(f.tooltip.valueSuffix=" "+m,r.displayValues&&"treemap"!==r.type)){var v=f.dataLabels.formatter;f.dataLabels.formatter=function(){return"$"===m?m+v.bind(this)(this.point.y):v.bind(this)(this.point.y)+" "+m}}function b(e,t,a){return!1!==t?e=Highcharts.numberFormat(e,t):angular.isNumber(e)&&(e=Highcharts.numberFormat(e).replace(/([,.][0-9]*?)0+$/,"$1").replace(/[,.]$/,"")),a&&(e="$"===a?a+e:e+" "+a),e}return f.tooltip.pointFormatter=(p=r.type,h=w('<span style="color: {color}">{name}</span>: <b style="display: inline-block">{value}</b>'),"treemap"===p?function(){var e=b(this.value,y,!!r.displayUnits&&m);return format_string(h,{name:this.series.name,color:this.series.color,value:e})}:"arearange"===p||"areasplinerange"===p||"columnrange"===p?function(){var e=b(this.low,y,!!r.displayUnits&&m),t=b(this.high,y,!!r.displayUnits&&m);return format_string(h,{name:this.series.name,color:this.series.color,value:e+" - "+t})}:"pie"===p?function(){var e=b(this.y,y,!!r.displayUnits&&m);return format_string(h,{name:this.series.name,color:this.series.color,value:e+" ("+Highcharts.numberFormat(this.percentage,1)+"%)"})}:"boxplot"===p?function(){var e=function(e){return'<span style="display:inline-block">'+b(e,y,!!r.displayUnits&&m)+"</span>"};return format_string(h,{name:this.series.name,color:this.series.color,value:"<br>"+w("Maximum:")+" "+e(this.high)+"<br>"+w("Upper quartile:")+" "+e(this.q3)+"<br>"+w("Median:")+" "+e(this.median)+"<br>"+w("Lower quartile:")+" "+e(this.q1)+"<br>"+w("Minimum:")+" "+e(this.low)})}:function(){var e=b(this.y,y,!!r.displayUnits&&m);return"percent"==this.series.userOptions.stacking&&(e=e+" ("+Highcharts.numberFormat(this.percentage,1)+"%)"),format_string(h,{name:this.series.name,color:this.series.color,value:e})}),r.refineOnClickCtrl&&(f.point={events:{click:function(e){var t=this.category||this.name,a={year:"YYYY",month:"YYYY/MM",day:"YYYY/MM/DD",hour:"YYYY/MM/DD HH",minute:"YYYY/MM/DD HH:mm"};n.timescale&&a[n.timescale]&&(t=(t=Highcharts.getOptions().global.useUTC?moment.utc(t):moment(t)).format(a[n.timescale])),r.refineOnClickCtrl.refineOnValue(t),o.$apply()}}},f.cursor="pointer"),delete(f=angular.extend(f,_.resolvePosition(r.position))).position,f},I=ODS.DateFieldUtils.datePatternBuilder("highcharts"),h=function(e,t,a,n){var r=void 0!==t.yRangeMin&&""!==t.yRangeMin,i=void 0!==t.yRangeMax&&""!==t.yRangeMax,o={title:{text:e||"",style:{color:t.color}},labels:{style:{color:t.color,direction:"initial"}},type:t.scale||"linear",min:r?parseFloat(t.yRangeMin):null,max:i?parseFloat(t.yRangeMax):null,tickInterval:t.yStep?parseFloat(t.yStep):null,startOnTick:!r,endOnTick:!i,opposite:a};return t.scientificDisplay||(o.labels.formatter=function(){return angular.isNumber(this.value)?Highcharts.numberFormat(this.value,-1):this.value}),"spiderweb"===t.type?(o.gridLineInterpolation="polygon",o.lineWidth=0,delete o.startOnTick,delete o.endOnTick,delete o.title,delete o.labels):"polar"===t.type&&(o.endOnTick=!1,o.showLastLabel=!0,delete o.title,delete o.labels),n&&(o.stackLabels={enabled:!0,style:{fontWeight:"bold"}}),o},l=ODS.DateFieldUtils.getDateFromXObject;function B(e,t,a,n,r,i){var o=l(a,n,i);return o&&"datetime"===r?o.getTime():o?e(t,o):void 0===a?void 0:angular.isObject(a)&&a.week?w("Week")+" "+a.week:"linear"===r?a:""+a}function U(e,t){return"QUANTILES"===t.func&&t.subsets?void 0===e[t.subsets+".0"]?null:e[t.subsets+".0"]:void 0===e?null:e}function N(e,t,a,n){var r,i,o,s;try{r=e.$eval(t,{operators:Math,accumulation:(i=a,o=n,s={},angular.forEach(o,function(e){s[e]=i[e]}),s),console:console})}catch(e){console.warn("Error while compiling aggregation value with expr",t)}return r}return{restrict:"A",replace:!0,require:["odsHighchartsChart"],scope:{parameters:"=parameters",domain:"=",apikey:"=",colors:"=",contexts:"=?"},template:'<div class="ods-chart">    <div class="ods-chart__loading" ng-show="loading">        <ods-spinner></ods-spinner>    </div>    <div class="chartplaceholder"></div>    <debug data="chartoptions"></debug></div>',controller:["$scope","$element","$attrs",function(T){var P,f,r,y,v,i=this;T.$watch("contexts",function(e,t){var a;if(e&&0<e.length)for(a=0;a<e.length;a++)T[e[a].name]=e[a]},!0),this.highchartsLoaded=function(O,e){var d=e.find(".chartplaceholder");function u(e){if(!r){if(angular.isObject(e)&&("day"in e||"month"in e||"year"in e)){var t=new Date(Date.UTC(e.year,e.month-1||0,e.day||1,e.hour||0,e.minute||0));return O.dateFormat("%Y-%m-%d",t)}return""+e}switch(console.warn("formatRowX on periodic value should not be used anymore"),r){case"month":return[a("Jan"),a("Feb"),a("Mar"),a("Apr"),a("May"),a("Jun"),a("Jul"),a("Aug"),a("Sep"),a("Oct"),a("Nov"),a("Dec")][e.month-1];case"weekday":return[a("Monday"),a("Tuesday"),a("Wednesday"),a("Thursday"),a("Friday"),a("Saturday"),a("Sunday")][e.weekday];case"day":return e.day;default:return""+e}}var n=s.defer();i.update=function(E){if(void 0===E&&(E=T.parameters),(E=angular.copy(E))&&E.queries&&0!==E.queries.length){r=void 0,y={};for(var e=0;e<E.queries.length;e++)try{p(E.queries[e].config.dataset,v)}catch(e){return void _.onLoad(i.update)}var t=function(e){var t,a,n,r=e.timescale;if(r||(r=e.queries[0].timescale||!1),r&&0===$.grep(e.queries,function(e){return e.sort}).length){var i=(n=r).split(" ");t=i[0],a=2==i.length?i[1]:""}else a=t=n=!1;return{precision:t,periodic:a,timeSerieMode:n}}(E);if(P=t.timeSerieMode,f=t.precision,r=t.periodic,f){var a=!1;r&&"hour"===f?a=!0:r||-1!==["year","month","day"].indexOf(f)&&(a=!0),O.setOptions({global:{useUTC:a}})}var L=function(e,t,a,n,r){var i;0===e.queries.length?e.xLabel="":(i=p(e.queries[0].config.dataset,r),angular.isDefined(e.xLabel)||(e.xLabel=_.getXLabel(i,e.queries[0].xAxis,e.timescale))),angular.isUndefined(e.displayLegend)&&(e.displayLegend=!0),e.labelsXLength=e.labelsXLength||12;var o='<span style="color:{series.color}">{series.name}</span>:',s={chart:{},title:{text:""},credits:{enabled:!1},series:[],xAxis:{title:{text:e.xLabel},labels:{step:1,rotation:-45,align:"right",useHTML:!0,style:{direction:"initial"}},startOfWeek:1,minPadding:0,maxPadding:0,dateTimeLabelFormats:{second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e %b %y",week:"%e. %b",month:"%b '%y",year:"%Y"}},legend:{enabled:!!e.displayLegend,useHTML:!0,rtl:"ar"===g.language},yAxis:[],plotOptions:{series:{animation:!1},columnrange:{pointPadding:0,groupPadding:0,borderWidth:0,tooltip:{pointFormat:o+" <b>{point.low}</b> - <b>{point.high}</b>"}},boxplot:{tooltip:{pointFormat:o+"<br>"+w("Maximum:")+" {point.high}<br>"+w("Upper quartile:")+" {point.q3}<br>"+w("Median:")+" {point.median}<br>"+w("Lower quartile:")+" {point.q1}<br>"+w("Minimum:")+" {point.low}<br>"}},arearange:{tooltip:{pointFormat:o+" <b>{point.low}</b> - <b>{point.high}</b>"}},areasplinerange:{tooltip:{pointFormat:o+" <b>{point.low}</b> - <b>{point.high}</b>"}},pie:{tooltip:{pointFormat:o+" <b>{point.y} ({point.percentage:.1f}%)</b>"},dataLabels:{formatter:function(){return this.key.length>e.labelsXLength?'<span title="'+this.key.replace('"',"")+'" alt="'+this.key.replace('"',"")+'">'+this.key.substring(0,e.labelsXLength-3)+"...</span>":this.key},style:{textOutline:"none"},useHTML:!0}},treemap:{tooltip:{pointFormat:'<span style="color:{series.color}">{point.name}</span>:<b>{point.value}</b>'},layoutAlgorithm:"squarified",colorByPoint:!0,dataLabels:{style:{textOutline:"none"},formatter:function(){return this.key.length>e.labelsXLength?'<span title="'+this.key.replace('"',"")+'" alt="'+this.key.replace('"',"")+'">'+this.key.substring(0,e.labelsXLength-3)+"...</span>":this.key},useHTML:!0}}},tooltip:{useHTML:!0,valueDecimals:2,headerFormat:"{point.key}<br>",pointFormat:o+' <b style="display: inline-block">{point.y}</b>',formatter:function(e){var t=this.points||angular.isArray(this)?this:[this],a=t[0].series,n=[];return n=[e.tooltipFooterHeaderFormatter(t[0])],angular.forEach(t,function(e){var t=(a=e.series).tooltipOptions.pointFormatter&&a.tooltipOptions.pointFormatter.bind(e.point)()||e.point.tooltipFormatter(a.tooltipOptions.pointFormat);n.push(t)}),n.push(e.options.footerFormat||""),"ar"===g.language&&(n.unshift('<div style="text-align:right">'),n.push("</div>")),n.join("")}},noData:{style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',fontWeight:"normal",fontSize:"1.4em",color:"#333",opacity:"0.5"}},lang:{noData:w("No data available yet"),resetZoom:w("Reset zoom")}},l=_.getFieldType(i,e.queries[0].xAxis);if(t?(s.xAxis.type="datetime",s.xAxis.maxZoom=36e5,s.chart.zoomType="xy",a&&(s.xAxis.showFirstLabel=!0)):-1!==["double","int"].indexOf(l)&&""===e.queries[0].sort?s.xAxis.type="linear":(s.xAxis.type="category",s.xAxis.categories=[]),"month"===a?s.xAxis.labels.format="{value: %B}":"weekday"===a?(s.xAxis.labels.format="{value: %A}","hour"===t&&(s.xAxis.labels.format="{value: %A %Hh}")):"day"===a?s.xAxis.labels.format="{value: %d}":"hour"===a&&(s.xAxis.labels.format="{value: %H}"),t?s.xAxis.labels.useHTML=!1:s.xAxis.labels.formatter=function(){return this.value.length>e.labelsXLength?'<span title="'+this.value.replace('"',"")+'" alt="'+this.value.replace('"',"")+'">'+this.value.substring(0,e.labelsXLength-3)+"...</span>":this.value},e.singleAxis){var c={color:"#000000",scale:e.singleAxisScale,yRangeMin:e.yRangeMin,yRangeMax:e.yRangeMax,yStep:e.yStep,scientificDisplay:e.scientificDisplay};s.yAxis=[h(e.singleAxisLabel,c,!1)]}for(var d=0;d<e.queries.length;d++)for(var u=0;u<e.queries[d].charts.length;u++)"spiderweb"!==e.queries[d].charts[u].type&&"polar"!==e.queries[d].charts[u].type||(s.chart.polar=!0,s.xAxis.lineWidth=0,s.xAxis.tickmarkPlacement="on",s.xAxis.labels.rotation=0,s.xAxis.title={}),"polar"===e.queries[d].charts[u].type&&(s.plotOptions.series.pointPlacement="on",s.plotOptions.series.pointPadding=0,s.plotOptions.series.groupPadding=0),"funnel"===e.queries[d].charts[u].type&&(s.chart.type="funnel",s.chart.marginRight=100,s.legend.enabled=!1);return s}(E,f,r,0,v);T.chartoptions=L,angular.forEach(E.queries,function(e){var r=_.getDatasetId({dataset:{datasetid:e.config.dataset},domain:e.config.domain});angular.isUndefined(y[r])&&(y[r]={}),angular.forEach(e.charts,function(e){var t=_.getYLabel(r,e);if(!E.singleAxis&&angular.isUndefined(y[r][t])){var a=h(t,e,Boolean(L.yAxis.length%2),Boolean(e.displayStackValues));y[r][t]=L.yAxis.push(a)-1}if("bar"==e.type&&(L.xAxis.labels.rotation=0),e.colorScale=R.getScale(e.color),_.allowThresholds(e.type)){if(e.thresholds){for(var n=0;n<e.thresholds.length;n++)angular.isNumber(e.thresholds[n].value)||e.thresholds.splice(n,1);e.thresholds=e.thresholds.sort(function(e,t){return e.value>t.value})}}else delete e.thresholds})}),n.resolve("new request coming, cancelling current one"),n=s.defer(),T.loading=!0;var c=o(E.queries,T.searchoptions,P,f,r,T.domain,T.apikey,n);c.promise.then(function(e){T.loading=!1;var D,t,F=c.charts;if(f)for(var a=0;a<e.length;a++){var n=e[a];for(t=0;t<n.data.length;t++){var r=n.data[t];if(r.x.year&&angular.isNumber(r.x.year)){var i=new Date(Date.UTC(r.x.year,r.x.month-1||0,r.x.day||1,r.x.hour||0,r.x.minute||0));i.setFullYear(r.x.year),(void 0===D||i<D)&&(D=i)}}}var g=[];for(t=0;t<E.queries.length;t++)if(!E.queries[t].seriesBreakdown)for(var o=0;o<E.queries[t].charts.length;o++)g.push("serie"+(t+1)+"-"+(o+1)),L.series.push(!1);var p={},h=0,M=function(e,t,a,n,r,i,o,s,l){var c,d,u=g.indexOf(e),f=0;l?l+i.color in p?f=p[l+i.color]:r.categoryColors&&r.categoryColors[l]?p[l+i.color]=r.categoryColors[l]:(f=h,p[l+i.color]=f,h++):(f=h,h++),-1===u?(a.series.push(x(t,y,r,i,l,r.config.domain||v,T,f)),u=g.push(e)-1):a.series[u]||(a.series[u]=x(t,y,r,i,l,r.config.domain||v,T,f)),"category"===a.xAxis.type&&-1===(c=a.xAxis.categories.indexOf(o))&&(c=a.xAxis.categories.length,a.xAxis.categories.push(o)),angular.extend(a.series[u].tooltip,n),r.categoryColors&&(d=r.categoryColors[o]),l||i.type,m(a.series[u],c,t.singleAxisScale||i.scale,o,s,d,i.thresholds||[])};for(angular.forEach(e,function(e,t){var a,r,n,l;if(e.data&&0!==e.data.length&&(e.data.results?(a=e.data.results,r=e.data.aggregations):a=e.data,0!==a.length)){var i,o,s,c,d=E.queries[t],u=F[t],f=d.xAxis,g=!!d.seriesBreakdown,p=(i=g?a[0].x[f]:a[0].x,o={},L&&(o.xDateFormat=I(i)),o);s=g?a[0].x[f]:a[0].x,c=L.xAxis,P&&angular.isObject(s)&&("second"in s?c.minTickInterval=Date.UTC(2010,1,1,1,1,2)-Date.UTC(2010,1,1,1,1,1):"minute"in s?c.minTickInterval=Date.UTC(2010,1,1,1,2)-Date.UTC(2010,1,1,1,1):"hour"in s?c.minTickInterval=Date.UTC(2010,1,1,2)-Date.UTC(2010,1,1,1):"weekday"in s?c.minTickInterval=Date.UTC(2010,1,2)-Date.UTC(2010,1,1):"day"in s||"yearday"in s?c.minTickInterval=Date.UTC(2010,1,2)-Date.UTC(2010,1,1):"month"in s?c.minTickInterval=Date.UTC(2010,1,1)-Date.UTC(2010,0,1):"year"in s&&(c.minTickInterval=Date.UTC(2010,0,1)-Date.UTC(2009,0,1))),d.defaultValues={},angular.forEach(u,function(e,t){d.defaultValues[t]=null}),r&&angular.forEach(r,function(e,t){var a,n;if(t.endsWith("min"))t=t.replace("min",""),a=e.min,n=r[t+"max"].max;else{if(t.endsWith("max"))return;u[t].charts&&"QUANTILES"===u[t].charts[0].func&&"QUANTILES"===u[t].charts[1].func?(a=e.min[u[t].charts[0].subset+".0"],a=e.max[u[t].charts[1].subset+".0"]):(a=e.min,n=e.max)}u[t].colorScale=R.getScale(u[t].color,a,n)});var h=!1,m=[],y=[],v={},b=E.queries[t].charts.length;for(l=0;l<b;l++){var w=E.queries[t].charts[l];if(w.aggregates)for(var _=0;_<w.aggregates.length;_++){var x=w.aggregates[_];x&&-1===m.indexOf(x)&&(m.push(x),v[x]=[])}w.compiled_expr&&(h=!0)}for(n=0;n<a.length;n++){var C=a[n];angular.extend({},d.defaultValues,C);var A=B(O.dateFormat,p.xDateFormat,g?C.x[f]:C.x,D,L.xAxis.type,E.alignMonth);l=0,angular.forEach(C,function(e,t){var a,n,r,i,o=!1;if("x"!==t){if((i=t.match(/-range-([0-9])$/))&&2===i.length){if(r=t.replace(/-range-[0-9]$/,""),o=!0,"0"!==i[1])return}else r=t;var s=u[r];if(o)for(n=[],a=0;a<s.charts.length;a++)n.push(U(C[r+"-range-"+a],s.charts[a]));else if(s.charts)for(n=[],a=0;a<s.charts.length;a++)n.push(U(e,s.charts[a]));else n=U(e,s);g?angular.forEach(C.x,function(e,t){t!==f&&(e=B(O.dateFormat,I(e),e,D,!1,E.alignMonth),M(""+r+t+e,E,L,p,d,s,A,n,e),0<=m.indexOf(r)&&v[r].push(n))}):(M(""+r,E,L,p,d,s,A,n),0<=m.indexOf(r)&&v[r].push(n)),h&&y.push(A),l++}})}if(h)for(y.sort(function(e,t){return e-t}),n=y.length-1;0<n;n--)y[n]==y[n-1]&&y.splice(n,1);for(n=0;n<d.charts.length;n++)if(d.charts[n].aggregates){var S=d.charts[n],k=N(T,S.compiled_expr,v,S.aggregates);for(l=0;l<y.length;l++)M("aggr"+t+"-"+n,E,L,p,d,S,y[l],k)}}}),t=L.series.length-1;0<=t;t--)!1===L.series[t]&&L.series.splice(t,1);var s=L.xAxis.categories;if(s){for(t=0;t<L.series.length;t++)for(var l=0;l<s.length;l++)L.series[t].data&&void 0===L.series[t].data[l]&&(L.series[t].data[l]=null);if(1===s.length)for(t=0;t<L.series.length;t++)-1!==["line","spline","area","arearange"].indexOf(L.series[t].type)&&(L.series[t].marker=L.series[t].marker||{},L.series[t].marker.enabled=!0)}else for(t=0;t<L.series.length;t++)-1!==["line","spline","area","arearange"].indexOf(L.series[t].type)&&1===L.series[t].data.length&&(L.series[t].marker=L.series[t].marker||{},L.series[t].marker.enabled=!0);T.chart&&L.chart.renderTo&&(T.chart.destroy(),d=$element.find(".chartplaceholder")),L.chart.renderTo=d[0];try{500<L.series.length&&(b.sendNotification(w("There are too many series to be displayed correctly, try to refine your query a bit.")),L.series=L.series.slice(0,10)),T.chart=new O.Chart(L,function(){})}catch(e){e.indexOf&&0===e.indexOf("Highcharts error #19")?(b.sendNotification(w("There was too many points to display, the maximum number of points has been decreased.")),angular.forEach(T.parameters.queries,function(e){e.maxpoints=20})):angular.isString(e)?b.sendNotification(e):b.sendNotification(e.message)}},function(e){T.loading=!1})}else T.chart&&angular.element(T.chart.container).empty();function m(e,t,a,n,r,i,o){var s,l,c=!1,d={};if("datetime"===L.xAxis.type||"linear"===L.xAxis.type){if("object"==typeof r){if(d=[n],"logarithmic"===a)for(l=0;l<r.length;l++)r[l]<=0&&(c=!0);if(c)for(l=0;l<r.length;l++)d.push(null);else for(l=0;l<r.length;l++)d.push(r[l]);e.data.push(d)}else if(-1!==["pie","funnel"].indexOf(e.type))"datetime"===L.xAxis.type?e.data.push({name:O.dateFormat(e.tooltip.xDateFormat,new Date(n)),y:r}):e.data.push({name:""+n,y:r});else if("treemap"==e.type)"datetime"===L.xAxis.type?e.data.push({name:O.dateFormat(e.tooltip.xDateFormat,new Date(n)),value:r}):e.data.push({name:""+n,y:r});else if("logarithmic"===a&&r<=0?e.data.push([n,null]):e.data.push([n,r]),i&&(e.data[e.data.length-1]={x:e.data[e.data.length-1][0],y:e.data[e.data.length-1][1],color:i}),0<o.length)for(s=o.length-1;0<=s;s--)if(r>=o[s].value){e.data[e.data.length-1]={x:e.data[e.data.length-1][0],y:e.data[e.data.length-1][1],color:o[s].color};break}}else if(-1!==["pie","funnel"].indexOf(e.type))e.data[t]={name:u(n),y:r},i&&(e.data[t].color=i);else if("treemap"==e.type)e.data[t]={name:u(n),value:r},i&&(e.data[t].color=i);else{if("object"==typeof r){if(d=[],"logarithmic"===a)for(l=0;l<r.length;l++)r[l]<=0&&(c=!0);if(c)for(l=0;l<r.length;l++)d.push(null);else for(l=0;l<r.length;l++)d.push(r[l]);e.data[t]=d}else e.data[t]="logarithmic"===a&&r<=0?null:r;if(i&&(e.data[t]={y:e.data[t],color:i}),0<o.length)for(s=o.length-1;0<=s;s--)if(r>=o[s].value){e.data[t]={y:e.data[t],color:o[s].color};break}}}}}}],link:function(e,t,a,n){var r=n[0];i("highcharts").then(function(){r.highchartsLoaded(Highcharts,t),e.$watch("parameters",function(e,t){r.update(e)},!0)})}}}]),e.directive("odsHighcharts",["colorScale",function(e){var t=e.getColors(e.getDefaultColorSet());return{restrict:"E",scope:{context:"=",fieldX:"@",expressionY:"@",functionY:"@",timescale:"@",chartType:"@",color:"@",chartConfig:"=",labelX:"@",labelY:"@",sort:"@",maxpoints:"@"},replace:!0,template:'<div class="odswidget odswidget-highcharts"><div ods-highcharts-chart parameters="chart" domain="context.domain" apikey="context.apikey"></div></div>',controller:["$scope","ODSWidgetsConfig","ChartHelper",function(i,e,o){var r=e.chartColors||t;i.color&&(r=ODS.ArrayUtils.fromCSVString(i.color));var s=i.$watch("context.dataset",function(e){if(e){if("dataset"!==i.context.type&&console.error("ods-highcharts requires a Dataset Context"),o.init(i.context),angular.isUndefined(i.chartConfig)){var t={};o.isMultiColorChart(i.chartType)&&(t={colors:r});var a="";a="y"===i.sort?"serie1-1":"-y"===i.sort?"-serie1-1":i.sort;var n=i.labelY||("COUNT"===i.functionY.toUpperCase()?"Count":i.expressionY);i.chart={timescale:i.timescale,xLabel:i.labelX,queries:[{config:{dataset:i.context.dataset.datasetid,options:i.context.parameters,domain:i.context.domain},xAxis:i.fieldX,sort:a,maxpoints:i.maxpoints||50,charts:[{yAxis:i.expressionY,yLabelOverride:n,func:i.functionY,color:r[0],type:i.chartType,extras:t}]}]}}else angular.isString(i.chartConfig)?i.chart=JSON.parse(b64_to_utf8(i.chartConfig)):i.chart=angular.copy(i.chartConfig);i.$broadcast("chartConfigReady",i.chart),i.$watch("chart",function(e){var t,a;if(e){var n=o.getDatasetId(i.context);for(t=0;t<e.queries.length;t++){var r=e.queries[t];for(void 0===r.xAxis&&o.setDefaultQueryValues(n,r,!0),a=0;a<r.charts.length;a++)o.setSerieDefaultValues(n,r.charts[a],r.xAxis,!0);for(o.setDefaultQueryValues(n,r,!0),1===i.chart.queries.length&&o.setChartDefaultValues(n,e,!0),a=0;a<r.charts.length;a++)o.setSerieDefaultColors(r.charts[a],r.seriesBreakdown)}i.$broadcast("chartConfigReady",i.chart)}},!0),s()}})}]}}]),e.directive("odsMultiHighcharts",["ODSAPI","ChartHelper","$q",function(c,d,u){return{restrict:"E",scope:{context:"=",chartConfig:"="},replace:!0,template:'<div class="odswidget odswidget-multihighcharts"><div ods-chart parameters="chart" domain="context.domain" apikey="context.apikey"></div></div>',controller:["$scope",function(s){var l=s.$watch("context",function(e){var t;if(e){var a;"catalog"!==e.type&&console.error("ods-multi-highcharts requires a Catalog Context"),a=angular.isString(s.chartConfig)?JSON.parse(b64_to_utf8(s.chartConfig)):s.chartConfig;var n=[];for(t=0;t<a.queries.length;t++){var r=a.queries[t].config.dataset;-1===n.indexOf(r)&&n.push(r)}var i=[],o=function(e){var t=new ODS.Dataset(e);s.context.dataset=t,d.init(s.context)};for(t=0;t<n.length;t++)i.push(c.datasets.get(s.context,n[t],{extrametas:!0}).success(o));u.all(i).then(function(e){s.chart=a}),l()}})}]}}]),e.directive("odsChart",["ODSAPI","ChartHelper","ODSWidgetsConfig",function(e,c,n){return{restrict:"EA",scope:{timescale:"@",labelX:"@",singleYAxis:"@",singleYAxisLabel:"@",singleYAxisScale:"@",min:"@",max:"@",step:"@",scientificDisplay:"@",logarithmic:"@",displayLegend:"@",labelsXLength:"@",alignMonth:"@",context:"=?",fieldX:"@",expressionY:"@",functionY:"@",chartType:"@",color:"@",chartConfig:"=?",labelY:"@",sort:"@",maxpoints:"@",chart:"=?parameters"},replace:!0,transclude:!0,template:'<div class="odswidget odswidget-charts"><debug data="chart"></debug><div ods-highcharts-chart parameters="chart" domain="context.domain" apikey="context.apikey" contexts="contexts"></div><div ng-transclude></div></div>',controller:["$scope","$element","$attrs","$transclude",function(l,e,t,a){l.contexts=[],this.pushContext=function(e){l.contexts.push(e)},l.chart||(l.chart={queries:[],xLabel:angular.isDefined(l.labelX)?l.labelX:void 0,timescale:l.timescale||"",singleAxis:!!l.singleYAxis,singleAxisLabel:angular.isDefined(l.singleYAxisLabel)?l.singleYAxisLabel:void 0,singleAxisScale:l.logarithmic?"logarithmic":"",yRangeMin:angular.isDefined(l.min)&&""!==l.min?parseFloat(l.min):void 0,yRangeMax:angular.isDefined(l.max)&&""!==l.max?parseFloat(l.max):void 0,yStep:angular.isDefined(l.step)&&""!==l.step?parseFloat(l.step):void 0,scientificDisplay:!angular.isDefined(l.scientificDisplay)||""===l.scientificDisplay||"true"===l.scientificDisplay,displayLegend:!angular.isDefined(l.displayLegend)||"false"!==l.displayLegend,labelsXLength:angular.isDefined(l.labelsXLength)&&""!==l.labelsXLength?parseInt(l.labelsXLength):void 0,alignMonth:!angular.isDefined(l.alignMonth)||"false"!==l.alignMonth}),angular.forEach(l.chart,function(e,t){void 0===e&&delete l.chart[t]}),t.context?(!function(){var r=n.chartColors||defaultColors;l.color&&(r=ODS.ArrayUtils.fromCSVString(l.color));var i=l.$watch("context.dataset",function(e){if(e){if("dataset"!==l.context.type&&console.error("ods-chart requires a Dataset Context"),c.init(l.context),angular.isUndefined(l.chartConfig)){var t={};c.isMultiColorChart(l.chartType)&&(t={colors:r});var a="";a="y"===l.sort?"serie1-1":"-y"===l.sort?"-serie1-1":l.sort;var n=l.labelY||("COUNT"===l.functionY.toUpperCase()?"Count":l.expressionY);l.chart={timescale:l.timescale,xLabel:l.labelX,queries:[{config:{dataset:l.context.dataset.datasetid,options:l.context.parameters},xAxis:l.fieldX,sort:a,maxpoints:l.maxpoints||50,charts:[{yAxis:l.expressionY,yLabelOverride:n,func:l.functionY,color:r[0],type:l.chartType,extras:t}]}]}}else angular.isString(l.chartConfig)?l.chart=JSON.parse(b64_to_utf8(l.chartConfig)):l.chart=l.chartConfig;i()}})}(),this.setQuery=function(e,t){console.error("cannot use ods-chart-query when context and chartConfig are declared on ods-chart")}):(this.setQuery=function(e,t){var a,n,r=l.chart.queries.indexOf(e);-1===r?(r=l.chart.queries.length,l.chart.queries.push(e)):l.chart.queries[r]=e,e.sort&&(a=e.sort.match(/^(-?)serie([0-9]+)$/))&&(l.chart.queries[r].sort=a[1]+"serie"+(r+1)+"-"+a[2]);for(var i=!1,o=0;o<l.contexts.length;o++)l.contexts[o].name===t.name&&(i=!0);i||l.contexts.push(t);var s=c.getDatasetId(t);for(void 0===e.xAxis&&c.setDefaultQueryValues(s,e,!0),n=0;n<e.charts.length;n++)c.setSerieDefaultValues(s,e.charts[n],e.xAxis,!0);for(c.setDefaultQueryValues(s,e,!0),1===l.chart.queries.length&&c.setChartDefaultValues(s,l.chart,!0),n=0;n<e.charts.length;n++)c.setSerieDefaultColors(e.charts[n],e.seriesBreakdown)},l.$watch("labelX",function(e,t){l.chart.xLabel=e}))}]}}]),e.directive("odsChartQuery",["ODSAPI","ChartHelper",function(e,d){return{restrict:"E",require:["odsChartQuery","^odsChart"],controller:["$scope",function(e){}],compile:function(){return{pre:function(a,e,t,n){var r=n[0],i=n[1],o={config:{},charts:[],xAxis:t.fieldX,maxpoints:t.maxpoints?parseInt(t.maxpoints,10):void 0,timescale:t.timescale,stacked:t.stacked,seriesBreakdown:t.seriesBreakdown,seriesBreakdownTimescale:t.seriesBreakdownTimescale,categoryColors:t.categoryColors?a.$eval(t.categoryColors):void 0,sort:""};"y"===t.sort?o.sort="serie1":"-y"===t.sort?o.sort="-serie1":o.sort=t.sort;var s=t.options||{};angular.forEach(o,function(e,t){void 0===e&&delete o[t]}),r.setChart=function(e){-1===o.charts.indexOf(e)&&o.charts.push(e)};var l=function(e){e&&i.setQuery(o,e)};r.pushContext=function(e){i.pushContext(e)};var c=t.context;a[c].wait().then(function(e){d.init(a[c]),o.config.dataset=e.datasetid,o.config.domain=a[c].domain,o.config.apikey=a[c].apikey,o.config.options=angular.extend({},a[c].parameters,s),r.setChart=function(e){-1===o.charts.indexOf(e)&&o.charts.push(e),l(a[c])},l(a[c]),a.$watch(c+".parameters",function(e,t){e&&(o.config.options=angular.extend({},e,s),l(a[c]))},!0)})}}}}}]),e.directive("odsChartSerie",["ODSAPI","ChartHelper","$compile","$parse",function(e,t,a,n){return{restrict:"E",require:["^odsChartQuery","?refineOnClick","?refineOnClickContext"],controller:["$scope","$transclude",function(e,t){}],link:function(e,t,a,n){var r=n[0],i=n[1]||n[2],o={type:a.chartType||void 0,innersize:a.innersize||void 0,labelsposition:a.labelsposition||void 0,func:a.functionY||void 0,yAxis:a.expressionY||void 0,color:a.color||void 0,cumulative:!!a.cumulative||!1,yLabelOverride:angular.isDefined(a.labelY)?a.labelY:void 0,scale:a.logarithmic?"logarithmic":"",yRangeMin:angular.isDefined(a.min)&&""!==a.min?parseFloat(a.min):void 0,yRangeMax:angular.isDefined(a.max)&&""!==a.max?parseFloat(a.max):void 0,yStep:angular.isDefined(a.step)&&""!==a.step?parseFloat(a.step):void 0,displayUnits:"true"===a.displayUnits,displayValues:"true"===a.displayValues,displayStackValues:"true"===a.displayStackValues,multiplier:angular.isDefined(a.multiplier)?parseFloat(a.multiplier):void 0,thresholds:a.colorThresholds?e.$eval(a.colorThresholds):[],subsets:a.subsets,charts:a.subseries?JSON.parse(a.subseries):void 0,refineOnClickCtrl:i,scientificDisplay:"true"===a.scientificDisplay};angular.forEach(o,function(e,t){void 0===e&&delete o[t]}),r.setChart(o),a.$observe("labelY",function(e){o.yLabelOverride=e,r.setChart(o)})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsHubspotForm",function(){var r=[];return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-hubspot-form" id="{{uniqueId}}"></div>',scope:{portalId:"@",formId:"@"},link:function(e,t,a){e.uniqueId="hubspotform-"+Math.random().toString(36).substring(7);var n=function(){-1===r.indexOf(e.uniqueId)&&(r.push(e.uniqueId),hbspt.forms.create({portalId:a.portalId,formId:a.formId,target:"#"+e.uniqueId}))};angular.isUndefined(window.hbspt)?LazyLoad.js("//js.hsforms.net/forms/v2.js",n):n()}}})}(),function(){"use strict";var e=angular.module("ods-widgets");e.directive("odsInfiniteScrollResults",function(){return{template:'<div class="{{listClass}} odswidget-infinite-scroll-results" infinite-scroll="loadMore()" infinite-scroll-distance="2" infinite-scroll-disabled="fetching">   <div class="{{resultClass}}" ng-repeat="item in results" inject>   </div>   <div class="odswidget-infinite-scroll-results__message-container">       <ods-spinner class="odswidget-infinite-scroll-results__spinner" ng-if="fetching"></ods-spinner>       <div class="odswidget-infinite-scroll-results__no-more-results-message" ng-if="!fetching && results.length > 0">{{ noMoreResultsMessage }}</div>       <div class="odswidget-infinite-scroll-results__no-results-message ng-cloak" ng-if="!fetching && results.length == 0 && context.getActiveFilters().length > 0"">{{ noResultsMessage }}</div>       <div class="odswidget-infinite-scroll-results__no-results-message ng-cloak" ng-if="!fetching && results.length == 0 && context.getActiveFilters().length == 0" ng-bind-html="noDataMessage"></div>   </div></div>',scope:{context:"=",resultClass:"@",listClass:"@",noMoreResultsMessage:"@",noResultsMessage:"@",noDataMessage:"@",scrollTopWhenRefresh:"="},transclude:!0,controller:["$scope","$window","$q","ODSAPI","$element",function(n,e,t,a,r){var i=0,o=!1;n.fetching=!1,n.results=[];var s,l,c=t.defer(),d=(s=e,0===(l=r.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y"))}).eq(0)).length&&(l=angular.element(s)),l),u=a.uniqueCall(a.records.search),f=a.uniqueCall(a.datasets.search),g=function(t){if(!o){t?i=0:i+=1;var e=10*i;if(n.fetching=!0,"catalog"===n.context.type)f(n.context,{rows:10,start:e,extrametas:!0,interopmetas:!0}).success(function(e){o=0===e.datasets.length,p(e.datasets,t)});else{var a=angular.extend({},n.context.parameters,{rows:10,start:e});u(n.context,a).success(function(e){o=0===e.records.length,p(e.records,t),c.resolve()})}}},p=function(e,t){t&&(n.results=[]),n.results=n.results.concat(e),n.fetching=!1,t&&n.scrollTopWhenRefresh&&d[0].scrollTo(0,0),t&&d.trigger("scroll");try{window.dispatchEvent(new Event("resize"))}catch(e){$(window).trigger("resize")}};n.loadMore=function(){"dataset"===n.context.type?c.promise.then(function(){g(!1)}):g(!1)},n.$watch("context.parameters",function(e,t){e!==t&&g(!(o=!1))},!0),"dataset"===n.context.type?n.context.wait().then(function(){g(!0)}):g(!0)}]}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsLastDatasetsFeed",["ODSAPI",function(a){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-last-datasets-feed"><ul class="odswidget-last-datasets-feed__datasets">   <li class="no-data" ng-hide="datasets" translate>No data available yet</li>   <li class="odswidget-last-datasets-feed__dataset" ng-repeat="dataset in datasets" ng-if="datasets">       <ods-theme-picto class="odswidget-last-datasets-feed__theme-picto" theme="{{dataset.metas.theme|firstValue}}"></ods-theme-picto>       <div class="odswidget-last-datasets-feed__dataset-details">           <div class="odswidget-last-datasets-feed__dataset-details-title"><a ng-href="{{context.domainUrl}}/explore/dataset/{{dataset.datasetid}}/" target="_self">{{ dataset.metas.title }}</a></div>           <div class="odswidget-last-datasets-feed__dataset-details-modified"><i class="fa fa-calendar" aria-hidden="true"></i> <span title="{{ dataset.metas.modified|moment:\'LLL\' }}"><span translate>Modified</span> {{ dataset.metas.modified|timesince }}</span></div>       </div>   </li></ul></div>',scope:{context:"=",max:"@"},controller:["$scope",function(t){t.max=t.max||5;var e=a.datasets.search;t.$watch("context",function(){e(t.context,{rows:t.max,sort:"modified"}).then(function(e){t.datasets=e.data.datasets})})}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsLastReusesFeed",["ODSAPI",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="odswidget odswidget-last-reuses-feed"><ul class="odswidget-last-reuses-feed__reuses">   <li class="no-data" ng-hide="reuses" translate>No data available yet</li>   <li class="odswidget-last-reuses-feed__reuse" ng-repeat="reuse in reuses" ng-if="reuses" inject>       <div class="odswidget-last-reuses-feed__reuse-thumbnail">           <span style="display: inline-block; height: 100%; vertical-align: middle;"></span>           <a ng-href="{{reuse.url}}" target="_self"><img class="odswidget-last-reuses-feed__reuse-thumbnail-image" ng-if="reuse.thumbnail" ng-src="{{ reuse.thumbnail }}"></a>       </div>       <div class="odswidget-last-reuses-feed__reuse-details">           <div class="odswidget-last-reuses-feed__reuse-details-title"><a ng-href="{{reuse.url}}" target="_self">{{ reuse.title }}</a></div>           <div class="odswidget-last-reuses-feed__reuse-details-dataset"><a ng-href="{{reuse.datasetUrl}}" target="_self">{{ reuse.dataset.title }}</a></div>           <div class="odswidget-last-reuses-feed__reuse-details-modified"><span title="{{ reuse.created_at|moment:\'LLL\' }}"><i class="fa fa-calendar" aria-hidden="true"></i> {{ reuse.created_at|timesince }}</span></div>       </div>   </li></ul></div>',scope:{context:"=",max:"@",externalLinks:"=?"},controller:["$scope",function(t){t.max=t.max||5;var e=a.uniqueCall(a.reuses);t.$watch("context",function(){"catalog"===t.context.type&&e(t.context,{rows:t.max}).success(function(e){angular.forEach(e.reuses,function(e){t.externalLinks||(e.url=t.context.domainUrl+"/explore/dataset/"+e.dataset.id+"/information/"),e.datasetUrl=t.context.domainUrl+"/explore/dataset/"+e.dataset.id+"/information/"}),t.reuses=e.reuses})})}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsMapDisplayControl",["translate",function(a){return{restrict:"E",require:"^odsMap",template:'<div class="odswidget odswidget-map-display-control"     ng-class="{\'odswidget-map-display-control--expanded\': expanded}"  >   <button class="odswidget-map-display-control__toggle"           ng-if="expanded"           ods-tooltip="Collapse panel"           translate="ods-tooltip"           ods-tooltip-direction="left"           ng-click="toggleDisplayControl()">       <i class="fa fa-caret-right"></i>   </button>   <button class="odswidget-map-display-control__toggle"           ng-if="!expanded"           ods-tooltip="Expand panel"           translate="ods-tooltip"           ods-tooltip-direction="left"           ng-click="toggleDisplayControl()">       <i class="fa fa-caret-left"></i>   </button>   <ul class="odswidget-map-display-control__groups"       ng-show="mapConfig.groups.length">       <li ng-repeat="group in mapConfig.groups"            ng-click="mapConfig.groups.length > 1 && toggleGroup(group)"            ng-class="{\'odswidget-map-display-control__group\': true, \'odswidget-map-display-control__group--disabled\': !group.displayed, \'odswidget-map-display-control__group--not-toggleable\': mapConfig.groups.length === 1}"           ng-style="group.pictoColor && {\'border-left-color\':group.pictoColor} || group.layers.length === 1 && group.layers[0].captionPictoColor && {\'border-left-color\':group.layers[0].captionPictoColor}">           <ods-map-picto class="odswidget-map-display-control__picto"                          ng-if="!group._hasUnknownDataset && (group.pictoIcon || (group.layers.length === 1 && group.layers[0].captionPictoIcon))"                          name="{{ group.pictoIcon || group.layers[0].captionPictoIcon }}"                          color="{{ group.pictoColor || group.layers[0].captionPictoColor }}">           </ods-map-picto>           <i class="fa fa-exclamation-triangle odswidget-map-display-control__picto--error"               ng-if="group._hasUnknownDataset"></i>           <span class="odswidget-map-display-control__group-title"                 ng-class="{\'odswidget-map-display-control__group-title--error\' : group._hasUnknownDataset}"                title="{{ getGroupTitle(group) }}"                 ng-bind="shortTextSummaryFilter(getGroupTitle(group), 50)"></span>           <div class="odswidget-map-display-control__group-description"                ng-class="{\'odswidget-map-display-control__group-description--error\' : group._hasUnknownDataset}"                ng-if="getGroupDescription(group)"                 ng-bind-html="getGroupDescription(group)|prettyText|safenewlines"></div>       </li>   </ul>   <div class="odswidget-map-display-control__no-groups"         ng-show="!mapConfig.groups.length"        translate>       There are no layers on this map   </div></div>',scope:{mapConfig:"=",singleLayer:"="},link:function(e,t,a,n){e.resizeMapDisplayControl=n.resizeMapDisplayControl},controller:["$scope","shortTextSummaryFilter",function(t,e){t.expanded=!0,t.$emit("toggleMapDisplayControl",{expanded:t.expanded}),t.shortTextSummaryFilter=e,t.getGroupDescription=function(t){return t._hasUnknownDataset=!1,angular.forEach(t.layers,function(e){null===e.context.dataset&&e.context.error&&(t._hasUnknownDataset=!0)}),t._hasUnknownDataset&&1===t.layers.length?a("The dataset associated with this layer is unknown. Some data may not appear on the map."):t._hasUnknownDataset&&1<t.layers.length?a("One or more datasets associated with this group of layers are unknown. Some data may not appear on the map."):1<t.layers.length?t.description:t.description||t.layers[0].description},t.getGroupTitle=function(e){return e.title||e.layers[0].title||e.layers[0].context.dataset.metas.title},t.toggleDisplayControl=function(){t.expanded=!t.expanded,t.$emit("toggleMapDisplayControl",{expanded:t.expanded})},t.toggleGroup=function(e){t.singleLayer?(t.mapConfig.groups.forEach(function(e){e.displayed=!1}),e.displayed=!0):e.displayed=!e.displayed,t.resizeMapDisplayControl()},t.$on("resizeMapDisplayControl",function(){t.resizeMapDisplayControl()})}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsMapLegacy",["ModuleLazyLoader",function(t){return{restrict:"E",scope:{context:"=",embedMode:"@",autoResize:"@",mapContext:"=?",location:"@",basemap:"@",isStatic:"@",showFilters:"@",itemClickContext:"=",colorBy:"@",colorByField:"@",colorByContext:"=",colorByAggregationKey:"@",colorByKey:"@",colorByExpression:"@",colorByFunction:"@",colorByRanges:"@",colorByRangesColors:"@"},replace:!0,template:function(e){return e.contents().wrapAll("<div>"),0<e.contents().length&&0<e.contents().html().trim().length&&(e.contents().wrapAll("<div>"),e.data("tooltip-template",e.children().html())),'<div class="odswidget odswidget-map"><div class="odswidget-map__map"></div><div class="odswidget-overlay map odswidget-overlay--opaque" ng-show="pendingRequests.length && initialLoading"><ods-spinner></ods-spinner></div></div>'},link:function(f,g){function e(){0<$(".odswidget-map__map").length&&$(".odswidget-map__map").height(Math.max(200,$(window).height()-$(".odswidget-map__map").offset().top))}angular.isUndefined(f.mapContext)&&(f.mapContext={},f.location&&(f.mapContext.location=f.location),f.basemap&&(f.mapContext.basemap=f.basemap)),"true"===f.autoResize&&($(window).on("resize",e),e()),t("leaflet").then(function(){L.Control.FilterByView=L.Control.extend({options:{position:"topright"},onAdd:function(e){var a="leaflet-control-filterview leaflet-bar leaflet-control",n=L.DomUtil.create("div",a),t=L.DomUtil.create("a","leaflet-bar-part",n);return t.href="#",f.mapViewFilter&&(n.className=a+" active"),L.DomEvent.on(t,"click",L.DomEvent.stopPropagation).on(t,"click",L.DomEvent.preventDefault).on(t,"click",function(){return f.$apply(function(e){e.mapViewFilter=!e.mapViewFilter}),f.mapViewFilter?n.className=a+" active":n.className=a,!1}).on(t,"dblclick",L.DomEvent.stopPropagation),f.$watch("mapViewFilter",function(e,t){e!==t&&(n.className=e?a+" active":a)}),n}}),f.initMap=function(e,t,a,n,r,i,o,s,l){var c={basemapsList:a,worldCopyJump:!0,minZoom:2,basemap:i,dragging:!o,zoomControl:!o,prependAttribution:s};o&&(c.doubleClickZoom=!1,c.scrollWheelZoom=!1);var d=new L.ODSMap(g.children()[0],c);if(d.addControl(new L.Control.Scale),r&&!o){var u=L.Control.geocoder({placeholder:n("Find a place..."),errorMessage:n("Nothing found."),geocoder:new L.Control.Geocoder.Nominatim({serviceUrl:"https://nominatim.openstreetmap.org/",geocodingQueryParams:{"accept-language":l||"en",polygon_geojson:!0}})});u.markGeocode=function(e){if(d.fitBounds(e.bbox),e.properties.geojson){var t=L.geoJson(e.properties.geojson,{style:function(){return{opacity:0,fillOpacity:.8,fillColor:"orange",className:"leaflet-geocoder-highlight"}}});d.addLayer(t),$timeout(function(){g.addClass("geocoder-highlight-on")},0),$timeout(function(){g.removeClass("geocoder-highlight-on"),d.removeLayer(t)},2500)}},d.addControl(u)}"true"!==t&&"true"===f.showFilters&&d.addControl(new L.Control.FilterByView),o||d.addControl(new L.Control.Locate({maxZoom:18})),d.on("popupclose",function(e){jQuery(e.popup.getContent()).trigger("popupclose")}),f.map=d}})},controller:["$scope","$http","$compile","$q","$filter","$element","translate","ODSAPI","DebugLogger","ODSWidgetsConfig","$attrs",function(u,e,d,s,t,f,l,c,g,p,h){g.log("init map"),u.pendingRequests=e.pendingRequests,u.initialLoading=!0,(u.itemClickMapField&&!u.itemClickContextField||!u.itemClickMapField&&u.itemClickContextField)&&console.log("ERROR: You need to configure both item-click-context-field and item-click-map-field.");var m,y=null,v=null,b={delimiter:",",accuracy:5,formatLatLng:function(e){var t=L.Util.formatNum(e.lat,this.accuracy),a=L.Util.formatNum(e.lng,this.accuracy);return new L.latLng(t,a)},getLocationParameterAsArray:function(e){return e.split(this.delimiter)},getLocationParameterFromMap:function(e){var t=this.formatLatLng(e.getCenter());return e.getZoom()+this.delimiter+t.lat+this.delimiter+t.lng},getCenterFromLocationParameter:function(e){var t=this.getLocationParameterAsArray(e);return new L.latLng(t[1],t[2])},getZoomFromLocationParameter:function(e){return this.getLocationParameterAsArray(e)[0]}},o=function(e,t,a,n){angular.isDefined(n.fields[t])&&(e.parameters["refine."+a]=n.fields[t])},w=function(a,t,n,r,e){if(t||n)if(e)u.$apply(function(){o(a,t,n,e)});else{var i={};ODS.GeoFilter.addGeoFilterFromSpatialObject(i,r),jQuery.extend(i,u.staticSearchOptions,u.context.parameters,{rows:1}),c.records.download(u.context,i).success(function(e){o(a,t,n,e[0])})}else u.$apply(function(){var e,t;e=a,t=r,ODS.GeoFilter.addGeoFilterFromSpatialObject(e.parameters,t)})},_=function(e,t,a,n){var r,i,o;if(u.itemClickContext)angular.isArray(u.itemClickContext)?angular.forEach(u.itemClickContext,function(e){i=h["itemClick"+ODS.StringUtils.capitalize(e.name)+"ContextField"],r=h["itemClick"+ODS.StringUtils.capitalize(e.name)+"MapField"],w(e,r,i,t,n)}):(o=u.itemClickContext,i=h["itemClick"+ODS.StringUtils.capitalize(o.name)+"ContextField"]||h.itemClickContextField,r=h["itemClick"+ODS.StringUtils.capitalize(o.name)+"MapField"]||h.itemClickMapField,w(o,r,i,t,n));else{var s=u.$new(!1);a?s.recordid=a:s.shape=t;var l={offset:[0,-30],maxWidth:250,minWidth:250,autoPanPaddingTopLeft:[50,305],autoPan:!u.mapViewFilter&&!u.staticMap},c=f.data("tooltip-template");!angular.isUndefined(c)&&angular.isString(c)&&""!==c.trim()||(c=u.context.dataset.extra_metas&&u.context.dataset.extra_metas.visualization&&u.context.dataset.extra_metas.visualization.map_tooltip_html?u.context.dataset.extra_metas.visualization.map_tooltip_html:""),s.template=c,new L.Popup(l).setLatLng(e).setContent(d('<ods-map-tooltip shape="shape" context="context" recordid="recordid" map="map" template="{{template}}"></ods-map-tooltip>')(s)[0]).openOn(u.map)}},x=function(e){return e=Math.round(100*e)/100,e=t("number")(e)},C=function(e){var t={"geofilter.polygon":ODS.GeoFilter.getBoundsAsPolygonParameter(u.map.getBounds()),clusterprecision:u.map.getZoom(),clusterdistance:50,return_polygons:e};jQuery.extend(t,u.staticSearchOptions,u.context.parameters),u.currentClusterRequestCanceler&&u.currentClusterRequestCanceler.resolve(),u.currentClusterRequestCanceler=s.defer(),c.records.geo(u.context,t,u.currentClusterRequestCanceler.promise).success(function(e){var t=e.clusters;u.records=t?t.length:0;for(var r,a=new L.LayerGroup,n=(r=a,function(n,e){if(1<n.count){var t=new L.ClusterMarker(n.cluster_center,{geojson:n.cluster,value:n.count,total:e,numberFormattingFunction:x,color:u.markerColor});u.staticMap||t.on("click",function(a){u.map.getZoom()===u.map.getMaxZoom()?_(marker.getLatLng(),n.cluster):u.$apply(function(){if(n.cluster)if("Point"===n.cluster.type)u.map.fitBounds([[n.cluster.coordinates[1],n.cluster.coordinates[0]],[n.cluster.coordinates[1],n.cluster.coordinates[0]]]);else{var e={},t=ODS.GeoFilter.getBoundsAsPolygonParameter(L.geoJson(n.cluster).getBounds());jQuery.extend(e,u.staticSearchOptions,u.context.parameters,{"geofilter.polygon":t}),c.records.boundingbox(u.context,e).success(function(e){u.map.fitBounds([[e.bbox[1],e.bbox[0]],[e.bbox[3],e.bbox[2]]])})}else u.map.setView(a.latlng,u.map.getZoom()+2)})}),r.addLayer(t)}else{var a=v(n.cluster_center);a.on("click",function(e){_(e.target.getLatLng(),n.cluster)}),r.addLayer(a)}}),i=0;i<t.length;i++){n(t[i],e.count.max)}a.addTo(u.map),u.layerGroup&&u.map.removeLayer(u.layerGroup),u.layerGroup=a,u.initialLoading=!1,u.currentClusterRequestCanceler=null})},A=function(e,t){var a={radius:3,fillColor:"#0033ff",color:"#0000ff",weight:1,opacity:1,fillOpacity:.5},n=new L.GeoJSON(t.geometry,{pointToLayer:function(e,t){return L.circleMarker(t,a)}});e.addLayer(n),n.on("click",function(e){_(e.latlng,t.geometry,t.id)})},S=function(e){var t;for(t=0;t<m.ranges.length;t++)if(e<m.ranges[t])return m.colors[t];return m.colors[m.colors.length-1]},k=function(t,e,a,n,r){var i,o=r;if("value"===u.colorBy){var s=t.fields[m.field];s&&(o=S(s))}if(y){if(!t.fields[y])return;"Point"===(i=t.fields[y]).type&&angular.isDefined(t.geometry)&&(i=t.geometry)}else{if(!t.geometry)return;i=t.geometry}if("Point"==i.type){var l=new L.LatLng(i.coordinates[1],i.coordinates[0]),c=v(l,o);c.on("click",function(e){_(e.target.getLatLng(),i,null,t)}),n.addLayer(c),a.extend(l)}else{var d;(d=o?new L.GeoJSON(i,{style:function(e){var t={radius:3,weight:1,opacity:.9,fillOpacity:.5,color:o};return t.fillColor=o,"LineString"===e.geometry.type||"MultiLineString"===e.geometry.type?(t.weight=5,t.color=o):t.color="#fff",t}}):new L.GeoJSON(i)).on("click",function(e){_(L.latLng(t.geometry.coordinates[1],t.geometry.coordinates[0]),i,t.recordid,t)}),e.addLayer(d),a.extend(d.getBounds())}};u.$watch("context.parameters",function(e,t){e!==t&&(u.initialLoading||(g.log("map -> searchOptions watch -> refresh records"),e["geofilter.polygon"]||!t["geofilter.polygon"]?t["geofilter.polygon"]||!e["geofilter.polygon"]?u.mapViewFilter?D(!1):D(!0):u.mapViewFilter=!0:u.mapViewFilter=!1))},!0),"aggregation"===u.colorBy&&u.$watch("colorByContext.parameters",function(){u.map&&D(!1)},!0),u.$watch("mapContext.location",function(){u.map&&D(!1)},!0);var D=function(n){var r=function(e){var t,a,n,r,i,o;"aggregation"===u.colorBy?(n=angular.extend({},m.context.parameters,{"join.geo.remotedataset":u.context.dataset.datasetid,"join.geo.localkey":m.localkey,"join.geo.remotekey":m.remotekey,"y.agg.expr":m.expr,"y.agg.func":m.func}),r=new L.LayerGroup,i=new L.LatLngBounds,o=new L.FeatureGroup,c.records.analyze(m.context,n).success(function(e){angular.forEach(e,function(e){var t=e.x,a=e.agg;angular.forEach(t,function(e){k(e,r,i,o,S(a))})}),u.layerGroup&&u.map.removeLayer(u.layerGroup),r.addLayer(o),r.addTo(u.map),u.layerGroup=r,u.initialLoading=!1})):"value"===u.colorBy||e.count<200||u.map.getZoom()===u.map.getMaxZoom()?((a={})["geofilter.polygon"]=ODS.GeoFilter.getBoundsAsPolygonParameter(u.map.getBounds()),jQuery.extend(a,u.staticSearchOptions,u.context.parameters),g.log("map -> download"),c.records.download(u.context,a).success(function(e,t,a,n){u.records=e,u.error="",u.nhits=e.length;for(var r=new L.LayerGroup,i=new L.LatLngBounds,o=new L.FeatureGroup,s=0;s<e.length;s++){var l=e[s];k(l,r,i,o)}u.layerGroup&&u.map.removeLayer(u.layerGroup),r.addLayer(o),r.addTo(u.map),u.layerGroup=r,u.initialLoading=!1}).error(function(e,t,a,n){u.error=e.error,u.initialLoading=!1})):e.count<5e5?e.geometries.Point&&e.geometries.Point>e.count/2?C(e.count<=5e5):(t={"geofilter.polygon":ODS.GeoFilter.getBoundsAsPolygonParameter(u.map.getBounds()),clusterprecision:u.map.getZoom()},jQuery.extend(t,u.staticSearchOptions,u.context.parameters),t.rows=1e3,u.currentClusterRequestCanceler&&u.currentClusterRequestCanceler.resolve(),u.currentClusterRequestCanceler=s.defer(),c.records.geopreview(u.context,t,u.currentClusterRequestCanceler.promise).success(function(e){for(var t=new L.LayerGroup,a=0;a<e.length;a++)A(t,e[a]);t.addTo(u.map),u.layerGroup&&u.map.removeLayer(u.layerGroup),u.layerGroup=t,u.initialLoading=!1,u.currentClusterRequestCanceler=null})):C(e.count<=5e5)},e={without_bbox:!n};n||(e["geofilter.polygon"]=ODS.GeoFilter.getBoundsAsPolygonParameter(u.map.getBounds())),jQuery.extend(e,u.staticSearchOptions,u.context.parameters),c.records.boundingbox(u.context,e).success(function(e){if(n)if(0<e.bbox.length){var t=u.map.getBounds();u.map.fitBounds([[e.bbox[1],e.bbox[0]],[e.bbox[3],e.bbox[2]]]);var a=u.map.getBounds();angular.equals(t,a)&&r(e)}else r(e);else r(e)})},F=function(e){var t=e.getSize();0<t.x&&0<t.y&&(u.mapContext.location=b.getLocationParameterFromMap(e),u.mapViewFilter&&(u.context.parameters["geofilter.polygon"]=ODS.GeoFilter.getBoundsAsPolygonParameter(e.getBounds())))},M=u.$watch("[context.dataset, colorByContext.dataset]",function(e,t){if(e[0]&&e[0].datasetid&&("aggregation"!==u.colorBy||e[1]&&e[1].datasetid)){"aggregation"===u.colorBy?m={context:u.colorByContext,localkey:u.colorByAggregationKey||u.colorByKey,remotekey:u.colorByKey,expr:u.colorByExpression,func:u.colorByFunction,ranges:u.colorByRanges.split(","),colors:u.colorByRangesColors.split(",")}:"value"===u.colorBy&&(m={field:u.colorByField,ranges:u.colorByRanges.split(","),colors:u.colorByRangesColors.split(",")}),e=e[0],u.context.parameters["geofilter.polygon"]?u.mapViewFilter=!0:u.mapViewFilter=!1,u.staticMap="true"===u.isStatic||"true"===u.context.parameters.static;var a=u.$watch("initMap",function(){u.initMap&&(a(),u.initMap(e,u.embedMode,p.basemaps,l,p.mapGeobox,u.mapContext.basemap,u.staticMap,p.mapPrependAttribution,p.language))});M(),u.staticSearchOptions={rows:u.recordLimit,dataset:u.context.dataset.datasetid,format:"json"};for(var n=0;n<e.fields.length;n++){var r=e.fields[n];if("geo_shape"===r.type){y=r.name;break}}var i={};e.extra_metas&&e.extra_metas.visualization&&(i=e.extra_metas.visualization),u.markerColor=i.map_marker_color||"#29398C",v=function(e,t){return new L.VectorMarker(e,{color:t||u.markerColor,icon:angular.element('<div><?xml version="1.0" encoding="UTF-8" standalone="no"?><svg width="19px" height="19px" viewBox="0 0 19 19" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">    <path d="M18,9.50004182 C18,14.1944851 14.1944015,18.0000836 9.49995818,18.0000836 C4.80551469,18.0000836 0.99991635,14.1944851 0.99991635,9.50004182 C0.99991635,4.80559834 4.80551469,1 9.49995818,1 C14.1944015,1 18,4.80559834 18,9.50004182 L18,9.50004182 Z" id="path8568" fill="#000000"></path>    <rect style="opacity: 0" x="0" y="0" width="19" height="19"></rect></svg></div>'),size:4,marker:!i.map_marker_hidemarkershape})},g.log("map -> dataset watch -> refresh records");var o=u.$watch("map",function(n,e){if(n){u.$watch("mapViewFilter",function(e,t){e!==t&&(e?u.context.parameters["geofilter.polygon"]=ODS.GeoFilter.getBoundsAsPolygonParameter(u.map.getBounds()):u.context.parameters["geofilter.polygon"]&&delete u.context.parameters["geofilter.polygon"])});(function(){var t=s.defer();if(u.mapContext.location){g.log("Location found");var e=b.getCenterFromLocationParameter(u.mapContext.location),a=b.getZoomFromLocationParameter(u.mapContext.location);g.log(e,a),n.setView(e,a),D(!1),t.resolve()}else g.log("Use boundsRetrieval"),function(e){var t=s.defer();if(u.context.parameters.mapviewport)"("===u.context.parameters.mapviewport.substring(0,1)&&(u.context.parameters.mapviewport=ODS.GeoFilter.getBoundsAsBboxParameter(ODS.GeoFilter.getPolygonParameterAsBounds(u.context.parameters.mapviewport))),t.resolve(ODS.GeoFilter.getBboxParameterAsBounds(u.context.parameters.mapviewport));else if(u.context.parameters["geofilter.polygon"])t.resolve(ODS.GeoFilter.getPolygonParameterAsBounds(u.context.parameters["geofilter.polygon"]));else{var a={};jQuery.extend(a,u.staticSearchOptions,u.context.parameters),c.records.boundingbox(u.context,a).success(function(e){0<e.count?t.resolve([[e.bbox[1],e.bbox[0]],[e.bbox[3],e.bbox[2]]]):t.resolve([[-60,-180],[80,180]])})}return t.promise}(u.context.dataset).then(function(e){u.context.parameters.mapviewport&&(g.log("Deleted mapviewport"),delete u.context.parameters.mapviewport),g.log(e),n.fitBounds(e),t.resolve()});return t.promise})().then(function(){g.log("First onViewportMove"),F(u.map),u.map.on("moveend",function(e){F(e.target),u.$$phase||u.$root.$$phase||u.$apply()})}),1<p.basemaps.length&&u.map.on("baselayerchange",function(e){u.mapContext.basemap=e.layer.basemapId,u.$$phase||u.$root.$$phase||u.$apply()}),o()}})}},!0)}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsMapLegend",[function(){return{restrict:"E",require:"^odsMap",template:'<div class="odswidget odswidget-map-legend"      ng-class="{\'odswidget-map-legend--extended\': ( selectedLayer.config.display === \'categories\' && extended), \'odswidget-map-legend--not-toggleable\' : !isToggleable(selectedLayer)}"      ng-if="layers.length > 0"      ng-click="isToggleable(selectedLayer) && !clickBlocked && toggle()">   <div class="odswidget-map-legend__header">       <div ng-if="selectedLayer.config.captionPictoIcon" class="odswidget-map-legend__picto">           <ods-map-picto name="{{ selectedLayer.config.captionPictoIcon }}"                          color="{{ selectedLayer.config.captionPictoColor }}">           </ods-map-picto>       </div>        <div class="odswidget-map-legend__title"           title="{{ getLayerTitle(selectedLayer) }}"           ng-bind="shortTextSummaryFilter(getLayerTitle(selectedLayer), 50)">       </div>       <i ng-show="isToggleable(selectedLayer) && !extended" class="odswidget-map-legend__title-toggle odsui-top" ods-tooltip="Click to unfold" translate="ods-tooltip"></i>       <i ng-show="isToggleable(selectedLayer) && extended" class="odswidget-map-legend__title-toggle odsui-bottom" ods-tooltip="Click to fold" translate="ods-tooltip"></i>       <div ng-show="selectedLayer.properties.legendLabel" ng-bind="selectedLayer.properties.legendLabel" class="odswidget-map-legend__label">       </div>   </div>   <div ng-switch="selectedLayer.config.display">       <div ng-switch-when="categories" class="odswidget-map-legend__categories-container" ng-class="{\'odswidget-map-legend__categories-container--extended\' : extended}">           <div ng-if="selectedLayer.config.color.type !== \'field\'">               <div ng-if="isToggleable(selectedLayer) && !extended" class="odswidget-map-legend__categories--condensed">                   <div ng-repeat="(value, color) in getCategories(selectedLayer, maxCategories) track by $index" class="odswidget-map-legend__categories__item">                       <div class="odswidget-map-legend__categories__item-color">                           <div ng-style="{\'background-color\' :color}" class="odswidget-map-legend__categories__color-block"></div>                       </div>                       <div class="odswidget-map-legend__categories__item-value" ng-bind="value"></div>                   </div>                   <div class="odswidget-map-legend__categories__item">                       <div class="odswidget-map-legend__categories__item-value--others" translate translate-n="getCategoriesCount(selectedLayer) - maxCategories" translate-plural="{{ $count }} more items...">{{ $count }} more item...</div>                   </div>               </div>               <div ng-if="!isToggleable(selectedLayer) || extended" class="odswidget-map-legend__categories--extended">                   <div ng-repeat="(value, color) in getCategories(selectedLayer) track by $index" class="odswidget-map-legend__categories__item">                       <div class="odswidget-map-legend__categories__item-color">                           <div ng-style="{\'background-color\' :color}" class="odswidget-map-legend__categories__color-block"></div>                       </div>                       <div class="odswidget-map-legend__categories__item-value" ng-bind="value"></div>                   </div>                   <div ng-show="selectedLayer.config.color.otherCategories" class="odswidget-map-legend__categories__item">                       <div class="odswidget-map-legend__categories__item-color">                           <div ng-style="{\'background-color\' :selectedLayer.config.color.otherCategories}" class="odswidget-map-legend__categories__color-block"></div>                       </div>                       <div class="odswidget-map-legend__categories__item-value--others">Others</div>                   </div>               </div>           </div>           <div ng-if="selectedLayer.config.color.type === \'field\'">               <div class="odswidget-map-legend__no-legend-placeholder" translate>No legend available</div>           </div>       </div>       <div ng-switch-when="choropleth" class="odswidget-map-legend__choropleth-container">           <div ng-if="!isToggleable(selectedLayer) || extended">               <div ng-repeat="bound in selectedLayer.properties.bounds" class="odswidget-map-legend__choropleth__item">                   <div class="odswidget-map-legend__choropleth__item-color">                       <div ng-style="{\'background-color\' : bound.color }" class="odswidget-map-legend__choropleth__color-block"></div>                   </div>                   <div class="odswidget-map-legend__choropleth__item-range">                       <div class="odswidget-map-legend__choropleth__item-range__bound">                           {{ bound.lowerBound|number:selectedLayer.properties.floatLength }}                           <i aria-hidden="true" class="fa fa-long-arrow-right odswidget-map-legend__choropleth__item-range__bound-arrow"></i>                       </div>                       <div class="odswidget-map-legend__choropleth__item-range__bound">                           {{ bound.upperBound|number:selectedLayer.properties.floatLength }}                       </div>                   </div>               </div>               <div class="odswidget-map-legend__choropleth__item" ng-show="selectedLayer.properties.undefinedColor">                   <div class="odswidget-map-legend__choropleth__item-color">                       <div ng-style="{\'background-color\' : selectedLayer.properties.undefinedColor }"                             class="odswidget-map-legend__choropleth__color-block"></div>                   </div>                   <div class="odswidget-map-legend__choropleth__item-range odswidget-map-legend__choropleth__item-range--center"                         translate>Undefined {{ selectedLayer.properties.legendLabel }}</div>               </div>               <div class="odswidget-map-legend__choropleth__item">                   <div class="odswidget-map-legend__choropleth__item-color">                       <div ng-style="{\'background-color\' : selectedLayer.properties.outOfBoundsColor }"                             class="odswidget-map-legend__choropleth__color-block"></div>                   </div>                   <div class="odswidget-map-legend__choropleth__item-range odswidget-map-legend__choropleth__item-range--center"                         translate>Out of bounds {{ selectedLayer.properties.legendLabel }}</div>               </div>           </div>           <div ng-if="isToggleable(selectedLayer) && !extended">               <div class="odswidget-map-legend__choropleth__item">                   <div class="odswidget-map-legend__choropleth__item-color">                       <div ng-style="{\'background-color\' : selectedLayer.properties.bounds[0].color }" class="odswidget-map-legend__choropleth__color-block"></div>                   </div>                   <div class="odswidget-map-legend__choropleth__item-range">                       <div class="odswidget-map-legend__choropleth__item-range__bound">                           {{ selectedLayer.properties.bounds[0].lowerBound|number:selectedLayer.properties.floatLength }}                           <i aria-hidden="true" class="fa fa-long-arrow-right odswidget-map-legend__choropleth__item-range__bound-arrow"></i>                       </div>                       <div class="odswidget-map-legend__choropleth__item-range__bound">                           {{ selectedLayer.properties.bounds[0].upperBound|number:selectedLayer.properties.floatLength }}                       </div>                   </div>               </div>               <div class="odswidget-map-legend__choropleth__item" ng-if="selectedLayer.properties.bounds.length > 3">                   <p class="odswidget-map-legend__choropleth__item-value--remaining" translate translate-n="selectedLayer.properties.bounds.length - 2" translate-plural="{{ $count }} more items...">                   {{ $count }} more item...                   </p>               </div>               <div class="odswidget-map-legend__choropleth__item" ng-if="selectedLayer.properties.bounds.length === 3">                   <div class="odswidget-map-legend__choropleth__item-color">                       <div ng-style="{ \'background-color\': selectedLayer.properties.bounds[1].color}" class="odswidget-map-legend__choropleth__color-block"></div>                   </div>                   <div class="odswidget-map-legend__choropleth__item-range">                       <div class="odswidget-map-legend__choropleth__item-range__bound">                           {{ selectedLayer.properties.bounds[1].lowerBound|number:selectedLayer.properties.floatLength }}                           <i aria-hidden="true" class="fa fa-long-arrow-right odswidget-map-legend__choropleth__item-range__bound-arrow"></i>                       </div>                       <div class="odswidget-map-legend__choropleth__item-range__bound">                           {{ selectedLayer.properties.bounds[1].upperBound|number:selectedLayer.properties.floatLength }}                       </div>                   </div>               </div>               <div class="odswidget-map-legend__choropleth__item">                   <div class="odswidget-map-legend__choropleth__item-color">                       <div ng-style="{ \'background-color\': selectedLayer.properties.bounds[selectedLayer.properties.bounds.length - 1].color }" class="odswidget-map-legend__choropleth__color-block"></div>                   </div>                   <div class="odswidget-map-legend__choropleth__item-range">                       <div class="odswidget-map-legend__choropleth__item-range__bound">                           {{ selectedLayer.properties.bounds[selectedLayer.properties.bounds.length - 1].lowerBound|number:selectedLayer.properties.floatLength }}                           <i aria-hidden="true" class="fa fa-long-arrow-right odswidget-map-legend__choropleth__item-range__bound-arrow"></i>                       </div>                       <div class="odswidget-map-legend__choropleth__item-range__bound">                           {{ selectedLayer.properties.bounds[selectedLayer.properties.bounds.length - 1].upperBound|number:selectedLayer.properties.floatLength }}                       </div>                   </div>               </div>           </div>       </div>       <div ng-switch-when="heatmap" class="odswidget-map-legend__simple-container">           <div><span translate ng-bind="layer.func"></div>            <div ng-style="{ \'background\': selectedLayer.properties.gradient}" class="odswidget-map-legend__simple__color-block"></div>           <div class="odswidget-map-legend__simple__color-block-subtext">               <div class="odswidget-map-legend__simple__color-block-subtext-left" translate>Low</div>               <div class="odswidget-map-legend__simple__color-block-subtext-right" translate>High</div>           </div>       </div>       <div ng-switch-default class="odswidget-map-legend__default-container">           <div ng-style="{ \'background-color\': selectedLayer.config.color}" class="odswidget-map-legend__default__color-block"></div>           <div translate>Item</div>       </div>   </div>   <div ng-if="layers.length > 1" class="odswidget-map-legend__pagination">       <button title="Previous" translate="title" class="odswidget-map-legend__pagination-button"                ng-show="selectedIndex > 0" ng-click="previous()" ng-mouseenter="preventToggle()" ng-mouseleave="allowToggle()">           <i class="odsui-left" aria-hidden="true"></i>       </button>       {{selectedIndex+1}}/{{layers.length}}       <button title="Next" translate="title" class="odswidget-map-legend__pagination-button"                ng-show="selectedIndex < layers.length - 1" ng-click="next()" ng-mouseenter="preventToggle()" ng-mouseleave="allowToggle()">           <i class="odsui-right"aria-hidden="true"></i>       </button>   </div></div>',scope:{mapConfig:"="},link:function(e,t,a,n){e.resizeMapDisplayControl=n.resizeMapDisplayControl},controller:["$scope","MapHelper","shortTextSummaryFilter","MapLayerHelper",function(l,c,e,d){l.extended=!1,l.selectedLayer=null,l.selectedIndex=0,l.maxCategories=4,l.isToggleable=function(e){return"choropleth"===e.config.display&&3<Object.keys(e.config.color.ranges).length||"categories"===e.config.display&&l.getCategoriesCount(e)>l.maxCategories&&"field"!==e.config.color.type},l.shortTextSummaryFilter=e,l.getLayerTitle=function(e){return e.config.captionTitle||e.config.title||e.config.context.dataset.metas.title},l.toggle=function(){l.getCategoriesCount(l.selectedLayer)<=l.maxCategories&&l.extended?l.extended=!1:l.extended=!l.extended,l.resizeMapDisplayControl()},l.select=function(e){l.selectedLayer=l.layers[e],l.isToggleable(l.selectedLayer)||(l.extended=!1)},l.previous=function(){l.selectedIndex-=1,l.select(l.selectedIndex),l.resizeMapDisplayControl()},l.next=function(){l.selectedIndex+=1,l.select(l.selectedIndex),l.resizeMapDisplayControl()},l.preventToggle=function(){l.clickBlocked=!0},l.allowToggle=function(){l.clickBlocked=!1},l.getCategoriesCount=function(e){if(angular.isUndefined(e.config.color.categories))return 1;var t=Object.keys(e.config.color.categories).length;return e.config.otherCategories&&(t+=1),t},l.getCategories=function(e,t){var a,n={},r=Object.keys(e.config.color.categories).sort(ODS.ArrayUtils.sortNumbers);for(t||(t=r.length),a=0;a<Math.min(t,r.length);a++){var i=r[a];n[i]=e.config.color.categories[i]}return n};var r=function(){var s=[];l.mapConfig.groups.forEach(function(e){e.displayed&&e.layers.forEach(function(n){if(n.caption&&null!==n.context.dataset){var e={};if(s.push({config:n,properties:e}),e.legendLabel=c.getLayerLegendLabel(n),"choropleth"===n.display){var r=n.color.minValue,i=Object.keys(n.color.ranges).sort(function(e,t){return parseFloat(e)-parseFloat(t)}),o=[];e.floatLength=Object.keys(n.color.ranges).reduce(function(e,t){return-1===t.toString().indexOf(".")?e:Math.max(e,t.toString().length-t.toString().indexOf(".")-1)},0),i.forEach(function(e,t){var a=n.color.ranges[e];0===t?o.push({color:a,lowerBound:r,upperBound:e}):o.push({color:a,lowerBound:ODS.CalculationUtils.incrementByOneUnit(i[t-1]),upperBound:e})}),e.bounds=o;var t=d.getSplitComplementaryColors(n.color.ranges[i[i.length-1]]);e.outOfBoundsColor=n.color.outOfBoundsColor||t[0],n.func||n.expr||(e.undefinedColor=n.color.undefinedColor||t[1]),l.resizeMapDisplayControl&&l.resizeMapDisplayControl()}else if("heatmap"===n.display){var a="linear-gradient(to right, "+Object.keys(n.color.steps).map(parseFloat).sort(ODS.ArrayUtils.sortNumbers).map(function(e){return n.color.steps[e]}).join(",")+")";e.gradient=a}}})}),l.layers=s,0===l.layers.length?(l.selectedIndex=0,l.selectedLayer=null):-1===l.layers.indexOf(l.selectedLayer)&&(l.selectedIndex=0,l.select(0)),null===l.selectedLayer&&0<s.length&&(l.selectedIndex=0,l.select(0))};r(),l.$watchCollection(function(){return l.mapConfig.groups.map(function(e){return e.displayed})},function(e,t){if(angular.isDefined(e)&&angular.isDefined(t)&&!angular.equals(e,t)){var a=null;if(l.selectedLayer&&(a=l.selectedLayer.config._runtimeId),r(),l.layers.length){var n=0;a&&l.layers.forEach(function(e){e.config._runtimeId===a&&(l.selectedIndex=n,l.select(l.selectedIndex)),n++})}}})}]}}])}(),function(){"use strict";var e=angular.module("ods-widgets");e.directive("odsMapSearchBox",["$timeout","AlgoliaPlaces","MapHelper","PictoHelper","SVGInliner",function(o,a,s,l,c){return{restrict:"E",template:'<div class="odswidget odswidget-map-search-box"      ng-class="{\'odswidget-map-search-box--datasearch\': dataSearchActive, \'odswidget-map-search-box--expanded\': expanded}">   <div class="odswidget-map-search-box__box-wrapper"        ng-class="{\'odswidget-map-search-box__box-wrapper--datasearch\': dataSearchActive}">       <input type="text"               class="odswidget-map-search-box__box"              ng-class="{\'odswidget-map-search-box__box--datasearch\': dataSearchActive}"              ng-model="userQuery"               ng-change="runQuery(userQuery)"               ng-keydown="handleKeyDown($event)"              ng-focus="expandSearchBox()" >       <button type="button" class="odswidget-map-search-box__box-cancel" ng-click="resetSearch()" ng-show="userQuery || dataSearchActive">           <i class="fa fa-times odswidget-map-search-box__close-search-icon"></i>       </button>       <button class="odswidget-map-search-box__toggle"               ng-hide="expanded"               ods-tooltip="Expand the search bar"               ods-tooltip-direction="right"               translate="ods-tooltip"               ng-click="expandSearchBox()">           <i class="fa fa-caret-right"></i>       </button>       <button class="odswidget-map-search-box__toggle"               ng-show="expanded"               ods-tooltip="Collapse the search bar"               translate="ods-tooltip"               ods-tooltip-direction="left"               ng-click="collapseSearchBox()">           <i class="fa fa-caret-left"></i>       </button>   </div>   <ul class="odswidget-map-search-box__suggestions"      ng-class="{\'odswidget-map-search-box__suggestions--expanded\': expanded}"       ng-if="!dataSearchActive && userQuery">       <li ng-show="userQuery"           ng-click="runDataSearch(userQuery)"           ng-class="[\'odswidget-map-search-box__search-suggestion\', {\'odswidget-map-search-box__search-suggestion--selected\': selectedIndex === 0}]">           <i class="fa fa-search"></i> Search {{userQuery}} in displayed data       </li>       <li ng-repeat="suggestion in suggestions"            ng-click="moveToSuggestion(suggestion, $index + 1)"           ng-class="[\'odswidget-map-search-box__suggestion\', {\'odswidget-map-search-box__suggestion--selected\': selectedIndex === $index + 1}]">           <i ng-class="[\'odswidget-map-search-box__suggestion-icon\', getSuggestionIcon(suggestion)]"></i>           <span class="odswidget-map-search-box__suggestion-name" ng-bind-html="suggestion._highlightResult.locale_names[0].value"></span>           <span class="odswidget-map-search-box__suggestion-localization" ng-bind-html="getLocalization(suggestion)"></span>       </li>   </ul>   <div class="odswidget-map-search-box__data-search" ng-if="dataSearchActive">       <ods-spinner ng-if="dataSearchWorking"></ods-spinner>       <ul ng-if="!dataSearchWorking && datasetSearchDatasetsCount > 1" class="odswidget-map-search-box__data-search__datasets">           <li ng-repeat="result in dataSearchResults"                ng-click="selectResult(result)"               class="odswidget-map-search-box__data-search__dataset"               ng-class="{\'odswidget-map-search-box__data-search__dataset--active\': selectedResult === result}">               <div class="odswidget-map-search-box__data-search__dataset-title" ng-bind="::result.context.dataset.metas.title"></div>               <div class="odswidget-map-search-box__data-search__dataset-count">                   {{result.nhits}} items               </div>           </li>       </ul>       <ul ng-if="!dataSearchWorking && datasetSearchDatasetsCount > 0" class="odswidget-map-search-box__data-search__results">           <li ng-repeat="record in currentResults"                class="odswidget-map-search-box__data-search__result"               ods-tooltip               ods-tooltip-template="getResultPreviewTemplate(selectedResult.context.dataset, record)"               ng-click="moveToDataRecord(selectedResult.context.dataset, record)">               <i class="fa fa-map-marker odswidget-map-search-box__data-search__result-icon"></i>               <span class="odswidget-map-search-box__data-search__result-empty" ng-if="getResultTitle(selectedResult.context.dataset, record) === null" translate>Empty</span>               <span ng-if="getResultTitle(selectedResult.context.dataset, record) !== null">{{getResultTitle(selectedResult.context.dataset, record)}}</span>           </li>       </ul>       <div class="odswidget-map-search-box__data-search__no-results" ng-if="!dataSearchWorking && datasetSearchDatasetsCount === 0">           No results found for your search       </div>       <div class="odswidget-map-search-box__data-search__pagination" ng-if="!dataSearchWorking && datasetSearchDatasetsCount > 0">           <div class="odswidget-map-search-box__data-search__pagination-counter">               {{ selectedResult.nhits }} results           </div>           <div class="odswidget-map-search-box__data-search__pagination-pages">               {{currentResultsStartIndex+1}}               -               {{selectedResult.nhits|min:(currentResultsStartIndex+11)}}               <button type="button"                        ng-click="previousResultPage()"                        ng-disabled="currentResultsStartIndex === 0"                       class="odswidget-map-search-box__data-search__pagination-button">                   <i class="fa fa-chevron-left"></i>               </button>               <button type="button"                        ng-click="nextResultPage()"                        ng-disabled="currentResultsStartIndex+10 >= selectedResult.nhits"                       class="odswidget-map-search-box__data-search__pagination-button">                   <i class="fa fa-chevron-right"></i>               </button>           </div>       </div>   </div></div>',require:"^odsMap",scope:{},link:function(r,e,t,i){var n=[];r.suggestions=[],r.selectedIndex=0,r.expanded=!1,r.runQuery=function(e){r.removeSearchMarkers();var t=s.getLocationStructure(i.getCurrentPosition());a(e,t.center.join(",")).then(function(e){r.selectedIndex=0,r.suggestions=e.data.hits},function(e){})},r.expandSearchBox=function(){r.expanded=!0},r.collapseSearchBox=function(){$(".odswidget-map-search-box__box").blur(),r.expanded=!1},r.addSearchMarker=function(a){c.getPromise(l.mapPictoToURL("ods-circle"),"white").then(function(e){var t=new L.VectorMarker(a,{clickable:!1,color:"#F06644",icon:e,zIndexOffset:9999,extraClasses:"ods-widget__ods-search-marker"});t.addTo(i.getMap()),o(function(){t.setOpacity(1)}),n.push(t)})},r.removeSearchMarkers=function(){angular.forEach(n,function(e){e.setOpacity(0),o(function(){i.getMap().removeLayer(e)},300)}),n=[]},r.$on("odsMapInteractiveClick",r.removeSearchMarkers),r.resetSearch=function(){i.resetMapDataFilter()},i.registerResetCallback(function(){r.suggestions=[],r.userQuery="",r.stopDataSearch()}),r.$on("$destroy",r.resetSearch),r.moveToSuggestion=function(e,t){var a;angular.isDefined(t)&&(r.selectedIndex=t),a=e.is_city?14:e.is_country?5:e.is_highway?18:21,r.addSearchMarker(e._geoloc),i.moveMap(e._geoloc,a),r.collapseSearchBox(),r.resetSearch()},r.moveToDataRecord=function(e,t){var a,n=e.getFieldsForType("geo_shape");(n.length?(a=n[0].name,!0):(a=e.getFieldsForType("geo_point_2d")[0].name,!1))?i.fitMapToShape(t.fields[a]):i.moveMap(t.fields[a],21),r.collapseSearchBox()},r.runDataSearch=function(e){i.applyMapDataFilter(e),r.startDataSearch(e,i.getActiveContexts())}},controller:["$scope","$q","$compile","ODSAPI",function(o,s,i,l){var n,t=13,a=27,r=38,c=40;o.handleKeyDown=function(e){switch(e.keyCode){case r:o.selectedIndex=Math.max(0,o.selectedIndex-1),e.preventDefault();break;case c:o.selectedIndex=Math.min(o.suggestions.length,o.selectedIndex+1),e.preventDefault();break;case a:o.resetSearch(),e.preventDefault();break;case t:0===o.selectedIndex?o.runDataSearch(o.userQuery):o.moveToSuggestion(o.suggestions[o.selectedIndex-1]),e.preventDefault()}},o.dataSearchActive=!1,o.dataSearchWorking=!1,o.startDataSearch=function(e,t){o.currentResults=[],o.dataSearchActive=!0,o.dataSearchWorking=!0;var a=t.slice(0);o.dataSearchResults=a.map(function(e){return{context:e}}).sort(function(e,t){return e.context.dataset.metas.title>t.context.dataset.metas.title});var i=[];angular.isArray(n)&&n.forEach(function(e){e.resolve()}),n=[],o.dataSearchResults.forEach(function(a){var e=a.context,t=s.defer(),n=angular.extend({},e.parameters,{rows:0}),r=l.records.search(e,n,t.promise).then(function(e){var t=e.data;t.parameters.dataset;a.nhits=t.nhits});i.push(r)}),s.all(i).then(function(e){o.dataSearchWorking=!1,o.dataSearchResults=o.dataSearchResults.filter(function(e){return 0<e.nhits}),o.datasetSearchDatasetsCount=Object.keys(o.dataSearchResults).length,o.dataSearchResults.length&&o.selectResult(o.dataSearchResults[0])})};var d=null;o.currentResultsStartIndex=0,o.selectResult=function(e){o.selectedResult=e,o.currentResultsStartIndex=0,u(e)};var u=function(e){d&&d.resolve(),d=s.defer();var t=angular.extend({},e.context.parameters,{rows:10,start:o.currentResultsStartIndex});l.records.search(e.context,t,d.promise).then(function(e){d=null,o.currentResults=e.data.records})};o.previousResultPage=function(){o.currentResultsStartIndex-=10,u(o.selectedResult)},o.nextResultPage=function(){o.currentResultsStartIndex+=10,u(o.selectedResult)},o.stopDataSearch=function(){angular.isArray(n)&&n.forEach(function(e){e.resolve()}),n=[],o.dataSearchActive=!1,o.dataSearchWorking=!1},o.getSuggestionIcon=function(e){return 0<=e._tags.indexOf("railway")?"fa fa-train":0<=e._tags.indexOf("aeroway")?"fa fa-plane":"fa fa-map-marker"},o.getLocalization=function(t){var a="";return["city","administrative","country"].forEach(function(e){angular.isDefined(t[e])&&(0<a.length&&(a+=", "),a+=t[e])}),a},o.getResultTitle=function(e,t){var a=e.getExtraMeta("explore","map_tooltip_title");if(a&&angular.isDefined(t.fields[a]))return t.fields[a];var n,r=e.getFieldsForType("text");if(0<r.length&&angular.isDefined(t.fields[r[0].name]))return t.fields[r[0].name];for(n=0;n<e.fields.length;n++)if(angular.isDefined(t.fields[e.fields[n]]))return t.fields[e.fields[n]];return null};o.getResultPreviewTemplate=function(e,t){var a=[];e.fields.forEach(function(e){a.length<3&&0<=["text","int","double","date","datetime"].indexOf(e.type)&&angular.isDefined(t.fields[e.name])&&a.push({label:e.label,value:t.fields[e.name]})});var n=o.$new(!0);n.items=a;var r=i('<ul class="odswidget-map-search-box__data-search__result-preview">   <li ng-repeat="item in items" class="odswidget-map-search-box__data-search__result-preview-line">       <div class="odswidget-map-search-box__data-search__result-preview-label">{{item.label}}</div>       <div class="odswidget-map-search-box__data-search__result-preview-value">{{item.value}}</div>   </li></ul>')(n);return n.$apply(),r.html()}}]}}]),e.service("AlgoliaPlaces",["$http","ODSWidgetsConfig",function(n,r){var i={};return r.algoliaPlacesApplicationId&&(i.headers={"X-Algolia-Application-Id":r.algoliaPlacesApplicationId,"X-Algolia-API-Key":r.algoliaPlacesAPIKey}),function(e,t){var a=angular.extend({},i);return a.params={query:e,aroundLatLngViaIP:!1,language:r.language||"en",hitsPerPage:5},t&&(a.params.aroundLatLng=t),n.get("https://places-dsn.algolia.net/1/places/query",a)}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsMapTooltip",["$compile","$templateCache",function(e,r){return{restrict:"E",transclude:!0,template:'<div class="odswidget-map-tooltip">   <ods-spinner class="odswidget-map-tooltip__spinner" ng-hide="records.length > 0"></ods-spinner>   <div class="ng-leaflet-tooltip-cloak odswidget-map-tooltip__limited-results-warning" ng-show="records && records.length == RECORD_LIMIT" translate>(limited to the first {{RECORD_LIMIT}} records)</div>   <div ng-repeat="record in records" ng-if="$index == selectedIndex" class="odswidget-map-tooltip__record">       <div ng-if="!template" ng-include src="\'default-tooltip\'"></div>       <div ng-if="template" ng-include src="\'custom-tooltip-\'+context.dataset.datasetid"></div>   </div>   <nav role="navigation" ng-show="records.length > 1" class="odswidget-map-tooltip__scroll-control ng-leaflet-tooltip-cloak">       <button class="odswidget-map-tooltip__scroll-left" ng-click="moveIndex(-1)">           <i class=" fa fa-chevron-left"  aria-hidden="true"></i>       </button>       <div class="odswidget-map-tooltip__scroll-amount" ng-bind="(selectedIndex+1)+\' / \'+records.length"></div>       <button class="odswidget-map-tooltip__scroll-right" ng-click="moveIndex(1)">          <i class="fa fa-chevron-right"></i>       </button>   </nav></div>',scope:{shape:"=",context:"=",recordid:"=",map:"=",template:"@",gridData:"=",geoDigest:"@",tooltipSort:"@"},replace:!0,link:function(t,a,e){t.ctx=t.context;var n=function(e){e.popup._content===a[0]&&(t.selectedShapeLayer&&t.map.removeLayer(t.selectedShapeLayer),t.map.off("popupclose",n),t.$destroy())};t.map.on("popupclose",n),t.unCloak=function(){jQuery(".ng-leaflet-tooltip-cloak",a).removeClass("ng-leaflet-tooltip-cloak")},e.template&&""!==e.template?r.put("custom-tooltip-"+t.context.dataset.datasetid,e.template):r.put("default-tooltip",'<div class="infoPaneLayout"><h2 class="odswidget-map-tooltip__header" ng-show="!!getTitle(record)">   <span ng-bind="getTitle(record) | shortSummary: 100"></span> </h2><dl class="odswidget-map-tooltip__record-values">    <dt ng-repeat-start="field in context.dataset.fields|fieldsForVisualization:\'map\'|fieldsFilter:context.dataset.extra_metas.visualization.map_tooltip_fields"         ng-show="record.fields[field.name]|isDefined"        class="odswidget-map-tooltip__field-name">        {{ field.label }}    </dt>    <dd ng-repeat-end         ng-switch="field.type"         ng-show="record.fields[field.name]|isDefined"        class="odswidget-map-tooltip__field-value">        <span ng-switch-when="geo_point_2d">            <ods-geotooltip width="300" height="300" coords="record.fields[field.name]">{{ record.fields|formatFieldValue:field:context }}</ods-geotooltip>        </span>        <span ng-switch-when="geo_shape">            <ods-geotooltip width="300" height="300" geojson="record.fields[field.name]">{{ record.fields|formatFieldValue:field:context }}</ods-geotooltip>        </span>        <span ng-switch-when="file">            <div ng-if="!context.dataset.isFieldAnnotated(field, \'has_thumbnails\')" ng-bind-html="record.fields|formatFieldValue:field:context"></div>            <div ng-if="context.dataset.isFieldAnnotated(field, \'has_thumbnails\')" ng-bind-html="record.fields[field.name]|displayImageValue:context.dataset.datasetid" style="text-align: center;"></div>        </span>        <span ng-switch-default title="{{record.fields|formatFieldValue:field:context}}" ng-bind-html="record.fields|formatFieldValue:field|imagify|videoify|prettyText|nofollow"></span>    </dd></dl></div>')},controller:["$scope","$filter","ODSAPI",function(i,e,r){i.RECORD_LIMIT=100,i.records=[],i.selectedIndex=0;var o=i.tooltipSort;!o&&i.context.dataset.getExtraMeta("visualization","map_tooltip_sort_field")&&(o=(i.context.dataset.getExtraMeta("visualization","map_tooltip_sort_direction")||"")+i.context.dataset.getExtraMeta("visualization","map_tooltip_sort_field")),i.moveIndex=function(e){var t=(i.selectedIndex+e)%i.records.length;t<0&&(t=i.records.length+t),i.selectedIndex=t};i.$watch("context.parameters",function(){!function(){var e={format:"json",rows:i.RECORD_LIMIT},t=null;i.shape&&(t=i.shape.type),i.recordid&&"Point"!==t?e.q="recordid:'"+i.recordid+"'":i.geoDigest?e.geo_digest=i.geoDigest:i.gridData?null!==i.gridData["ods:geo_grid"]?e.geo_grid=i.gridData["ods:geo_grid"]:e.geo_digest=i.gridData["ods:geo_digest"]:i.shape&&ODS.GeoFilter.addGeoFilterFromSpatialObject(e,i.shape);var a={};function n(e){if(0<e.length){i.selectedIndex=0,i.records=e,i.unCloak();var t,a=i.context.dataset.getFieldsForType("geo_shape");if(a.length&&(t=a[0].name),t&&i.gridData&&("Polygon"===i.gridData["ods:geo_type"]||"LineString"===i.gridData["ods:geo_type"]||"MultiPolygon"===i.gridData["ods:geo_type"]||"MultiLineString"===i.gridData["ods:geo_type"])){var n=e[0];if(n.fields[t]){var r=n.fields[t];"Point"!==r.type&&(i.selectedShapeLayer=L.geoJson(r,{fill:!1,color:"#CC0000",opacity:1,dashArray:[5],weight:2}),i.map.addLayer(i.selectedShapeLayer))}}}else i.map.closePopup()}angular.extend(a,i.context.parameters,e),o?(a.sort=o,r.records.search(i.context,a).success(function(e){n(e.records)})):r.records.download(i.context,a).success(n)}()},!0),i.$apply(),i.getTitle=function(e){if(i.context.dataset.extra_metas&&i.context.dataset.extra_metas.visualization&&i.context.dataset.extra_metas.visualization.map_tooltip_title){var t=i.context.dataset.extra_metas.visualization.map_tooltip_title;if(angular.isDefined(e.fields[t])&&""!==e.fields[t])return e.fields[t]}return null},i.fields=angular.copy(i.context.dataset.fields)}]}}])}(),function(){"use strict";var e=angular.module("ods-widgets");e.directive("odsMap",["URLSynchronizer","MapHelper","ModuleLazyLoader","ODSWidgetsConfig","MapLayerRenderer","translate","translatePlural","$q","$timeout","$location",function(i,x,o,C,A,S,k,D,F,M){return{restrict:"EA",scope:{context:"=",syncToUrl:"@",syncToObject:"=",location:"@",basemap:"@",staticMap:"@",noRefit:"@",autoResize:"@",autoGeolocation:"@",toolbarDrawing:"@",toolbarGeolocation:"@",toolbarFullscreen:"@",scrollWheelZoom:"@",minZoom:"@",maxZoom:"@",displayControl:"=?",displayControlSingleLayer:"=?",searchBox:"=?",displayLegend:"=?",mapConfig:"=?",dynamicConfig:"=?"},transclude:!0,template:'<div class="odswidget odswidget-map">    <div class="odswidget odswidget-map__map" ng-class="{\'odswidget-map__map--with-searchbox\': searchBox, \'odswidget-map__map--with-display-control\': displayControl}"></div>    <div class="odswidget-overlay map odswidget-overlay--opaque" ng-show="initialLoading">        <ods-spinner></ods-spinner>    </div>    <div class="odswidget-map__loading" ng-show="loading">        <ods-spinner></ods-spinner>    </div>    <div class="ods-message-box ods-message-box--warning odswidget-map__limited-data-warning" ng-if="partialDataLayersArray.length > 0"><i class="fa fa-fw fa-warning"></i><span translate><a ods-tooltip="{{ partialDataLayers }}" ods-tooltip-direction="top">Some layers</a> show partial results for performance reasons. Try zooming in.</span></div>    <ods-map-display-control ng-if="displayControl && allContextsInitialized" single-layer="displayControlSingleLayer" map-config="mapConfig"></ods-map-display-control>    <ods-map-search-box ng-if="searchBox"></ods-map-search-box>    <ods-map-legend ng-if="displayLegend && allContextsInitialized" map-config="mapConfig"></ods-map-legend>    <div ng-transclude></div></div>',link:function(g,u,e,a){var t=angular.element(u.children()[0]);e.id&&t.attr("id",e.id),e.style&&t.attr("style",e.style),e.class&&t.addClass(e.class),"true"!==e.odsAutoResize&&""!==e.odsAutoResize||(g.autoResize="true");var f,p,h,m=g.staticMap&&"true"===g.staticMap.toLowerCase(),y=g.noRefit&&"true"===g.noRefit.toLowerCase(),v=!(g.toolbarDrawing&&"false"===g.toolbarDrawing.toLowerCase());if(f=angular.isUndefined(g.toolbarGeolocation)?!angular.isDefined(g.mapConfig.toolbarGeolocation)||!!g.mapConfig.toolbarGeolocation:!(g.toolbarGeolocation&&"false"===g.toolbarGeolocation.toLowerCase()),p=angular.isUndefined(g.toolbarFullscreen)?!angular.isDefined(g.mapConfig.toolbarFullscreen)||!!g.mapConfig.toolbarFullscreen:!(g.toolbarFullscreen&&"false"===g.toolbarFullscreen.toLowerCase()),h=angular.isUndefined(g.autoGeolocation)?!!g.mapConfig.autoGeolocation:g.autoGeolocation&&"true"===g.autoGeolocation.toLowerCase(),angular.isUndefined(g.displayControl)&&(g.displayControl=g.mapConfig.layerSelection),angular.isUndefined(g.displayLegend)&&(g.displayLegend=!0),angular.isUndefined(g.displayControlSingleLayer)&&(g.displayControlSingleLayer=g.mapConfig.singleLayer),angular.isUndefined(g.searchBox)&&(g.searchBox=g.mapConfig.searchBox),g.context){var n=x.MapConfiguration.createLayerGroupConfiguration(),r=x.MapConfiguration.createLayerConfiguration();n.layers.push(r),g.mapConfig.groups.push(n),r.context=g.context,g.context.wait().then(function(e){e&&(g.context.dataset.extra_metas&&g.context.dataset.extra_metas.visualization&&(r.tooltipDisabled=Boolean(g.context.dataset.extra_metas.visualization.map_tooltip_disabled)),x.MapConfiguration.setLayerDisplaySettingsFromDefault(r))})}function b(){var e=$(".odswidget-map__map");if("true"===g.autoResize&&0<e.length){var t=Math.max(200,$(window).height()-e.offset().top);e.height(t)}a.resizeMapDisplayControl()}function w(){var t=D.defer(),e=x.MapConfiguration.getActiveContextList(g.mapConfig).map(function(e){return e.wait()}),a=function(e){D.all(e).then(function(){_(),t.resolve()}).catch(function(){e=e.filter(function(e){return 2!==e.$$state.status}),a(e)})};return a(e),t.promise}"true"===g.autoResize&&($(window).on("resize",b),b()),g.$on("invalidateMapSize",function(){g.map&&g.map.invalidateSize()}),g.$on("mapFitBounds",function(e,t){g.map.fitBounds(t)}),g.$on("toggleMapDisplayControl",function(e,t){var a=$(".leaflet-top.leaflet-right");t.expanded?a.removeClass("collapsed"):a.addClass("collapsed")}),g.initialLoading=!0,g.syncToObject?g.mapContext=g.syncToObject:g.mapContext={},"true"===g.syncToUrl&&(i.addSynchronizedValue(g,"mapContext.location","location",!0),i.addSynchronizedValue(g,"mapContext.basemap","basemap",!0)),g.location?g.mapContext.location=g.mapContext.location||g.location:g.mapConfig&&g.mapConfig.mapPresets&&g.mapConfig.mapPresets.location&&(g.mapContext.location=g.mapContext.location||g.mapConfig.mapPresets.location),g.basemap?g.mapContext.basemap=g.mapContext.basemap||g.basemap:g.mapConfig&&g.mapConfig.mapPresets&&g.mapConfig.mapPresets.basemap&&(g.mapContext.basemap=g.mapContext.basemap||g.mapConfig.mapPresets.basemap),o("leaflet").then(function(){var e={basemapsList:C.basemaps,worldCopyJump:!0,basemap:g.mapContext.basemap,dragging:!m,keyboard:!m,prependAttribution:C.mapPrependAttribution,appendAttribution:C.mapAppendAttribution,maxBounds:[[-90,-240],[90,240]],zoomControl:!1};"true"===g.syncToUrl&&"scrollWheelZoom"in M.search()?e.scrollWheelZoom="false"!==M.search().scrollWheelZoom:e.scrollWheelZoom="false"!==g.scrollWheelZoom,g.minZoom&&(e.minZoom=g.minZoom),g.maxZoom&&(e.maxZoom=g.maxZoom),m&&(e.doubleClickZoom=!1,e.scrollWheelZoom=!1),b();var a=new L.ODSMap(u.children()[0].children[0],e);if(a.addControl(new L.Control.Scale),m||a.addControl(new L.Control.Zoom({position:"topright",zoomInTitle:S("Zoom in"),zoomOutTitle:S("Zoom out")})),p)try{window.self===window.top&&a.addControl(new L.Control.ODSMapFullscreen({title:{false:S("View Fullscreen"),true:S("Exit Fullscreen")}}))}catch(e){}if(C.mapGeobox&&!g.searchBox&&!m){var t=L.Control.geocoder({placeholder:S("Find a place..."),errorMessage:S("Nothing found."),geocoder:new L.Control.Geocoder.Nominatim({serviceUrl:"https://nominatim.openstreetmap.org/",geocodingQueryParams:{"accept-language":C.language||"en",polygon_geojson:!0}})});t.markGeocode=function(e){if(a.fitBounds(e.bbox),e.properties.geojson){var t=L.geoJson(e.properties.geojson,{style:function(){return{opacity:0,fillOpacity:.8,fillColor:"orange",className:"leaflet-geocoder-highlight"}}});a.addLayer(t),F(function(){u.addClass("geocoder-highlight-on")},0),F(function(){u.removeClass("geocoder-highlight-on"),a.removeLayer(t)},2500)}},a.addControl(t)}if(f&&!m){var n=new L.Control.Locate({position:"topright",maxZoom:18,strings:{title:S("Show me where I am"),popup:S("You are within {distance} {unit} from this point"),outsideMapBoundsMsg:S("You seem located outside the boundaries of the map")}});a.addControl(n)}if(g.drawnItems=new L.FeatureGroup,a.addLayer(g.drawnItems),v&&!m){L.drawLocal.draw.toolbar.buttons.circle=S("Draw a circle to filter on"),L.drawLocal.draw.toolbar.buttons.polygon=S("Draw a polygon to filter on"),L.drawLocal.draw.toolbar.buttons.rectangle=S("Draw a rectangle to filter on"),L.drawLocal.draw.toolbar.actions={title:S("Cancel area filter"),text:S("Cancel")},L.drawLocal.draw.toolbar.undo={title:S("Delete last point"),text:S("Delete last point")},L.drawLocal.edit.toolbar.buttons={edit:S("Edit area filter."),editDisabled:S("No area filter to edit."),remove:S("Delete area filter."),removeDisabled:S("No area filter to delete.")},L.drawLocal.edit.toolbar.actions={save:{title:S("Apply"),text:S("Apply")},cancel:{title:S("Cancel editing, discards all changes."),text:S("Cancel")}},L.drawLocal.draw.handlers={circle:{tooltip:{start:S("Click and drag to draw circle")},radius:S("Radius")},marker:{tooltip:{start:S("Click map to place marker")}},polygon:{tooltip:{start:S("Click to start drawing shape"),cont:S("Click to continue drawing shape"),end:S("Click first point to close this shape")}},polyline:{error:"<strong>"+S("Error:")+"</strong> "+S("shape edges cannot cross!"),tooltip:{start:S("Click to start drawing line"),cont:S("Click to continue drawing line"),end:S("Click last point to finish line")}},rectangle:{tooltip:{start:S("Click and drag to draw rectangle")}},simpleshape:{tooltip:{end:S("Release mouse to finish drawing")}}},L.drawLocal.edit.handlers={edit:{tooltip:{text:S("Drag handles to edit shape, then apply")+"<br><em>"+S("Click cancel to undo changes")+"</em>"}},remove:{tooltip:{text:S("Click on a shape to delete it, then apply")}}};var r=new L.Control.Draw({edit:{featureGroup:g.drawnItems},draw:{polyline:!1,marker:!1,circle:{showRadius:!0,metric:!0,feet:!1}}});a.options.drawControlTooltips=!0,a.addControl(r)}g.map=a;var i;(function(e){var a=D.defer();if(e&&"boolean"!=typeof e){var t=x.getLocationStructure(e);g.map.setView(t.center,t.zoom),w().then(function(){c(!1)}),a.resolve(),h&&n&&n.locate()}else w().then(function(){x.retrieveBounds(x.MapConfiguration.getActiveContextList(g.mapConfig,{geoOnly:!0,skipExcludedFromRefit:!0})).then(function(e){if(e)g.map.fitBounds(e);else{var t=x.getLocationStructure(C.defaultMapLocation);g.map.setView(t.center,t.zoom)}c(!1),a.resolve(),h&&n&&n.locate()})});return a.promise})(g.mapContext.location).then(function(){g.initialLoading=!1,s(g.map),m||w().then(d),g.map.on("moveend",function(e){g.$applyAsync?g.$applyAsync(function(){s(e.target)}):F(function(){s(e.target)})}),g.$watch("mapContext.location",function(e,t){e!==t&&c(!1,!0)}),g.allContextsInitialized=!1,w().then(function(){g.allContextsInitialized=!0}),g.$watch(function(){var t=0;return angular.forEach(g.mapConfig.groups,function(e){angular.forEach(e.layers,function(e){e._loading&&t++})}),t},function(e){g.loading=!!e}),g.$watch(function(){var t=[],a=[];return angular.forEach(x.MapConfiguration.getActiveContextList(g.mapConfig),function(e){t.push([e.name,e.parameters])}),angular.forEach(x.MapConfiguration.getActiveContextList(g.mapConfig,{skipExcludedFromRefit:!0}),function(e){a.push([e.name,e.parameters])}),[t,a,x.MapConfiguration.getVisibleLayerIds(g.mapConfig)]},function(e,t){e!==t&&(_(),c(!angular.equals(e[1],t[1])))},!0)});g.$watch("dynamicConfig",function(e,t){angular.isDefined(e)&&(e?i=g.$watch(function(){return JSON.stringify(g.mapConfig,function(e,t){if("function"!=typeof t&&"$$"!==e.substring(0,2)&&"_"!==e[0]){if("context"===e)return{datasetId:t.dataset.datasetid,parameters:t.parameters};if(!(-1<["mapPresets","singleLayer","toolbarGeolocation","toolbarFullscreen","autoGeolocation","layerSelection","searchBox","title","description","caption","captionTitle"].indexOf(e)))return t}})},function(){c()}):i&&i())}),1<C.basemaps.length&&g.map.on("baselayerchange",function(t){g.$evalAsync('mapContext.basemap = "'+t.layer.basemapId+'"'),angular.forEach(g.mapConfig.groups,function(e){e.displayed&&angular.forEach(e.layers,function(e){"tiles"===e.display&&e._rendered&&(e._rendered.setMinZoom(t.layer.options.minZoom),e._rendered.setMaxZoom(t.layer.options.maxZoom))})})});var o,s=function(e){var t=e.getSize();0<t.x&&0<t.y&&(g.mapContext.location=x.getLocationParameter(e.getCenter(),e.getZoom()))},l={},c=function(e,a){var n=function(a){var n=[],r={},i=new L.LayerGroup;g.partialDataLayers="",g.partialDataLayersArray=[],angular.forEach(g.mapConfig.groups,function(e){e.displayed?angular.forEach(e.layers,function(e){if(!(e.showZoomMin&&e.showZoomMin>g.map.getZoom())&&!(e.showZoomMax&&e.showZoomMax<g.map.getZoom())&&null!==e.context.dataset&&(!a||A.doesLayerRefreshOnLocationChange(e))){var t=D.defer();i.addLayer(A.updateDataLayer(e,g.map,t)),n.push(t.promise),r[e._runtimeId]=e}}):angular.forEach(e.layers,function(e){e._currentRequestTimeout&&(e._currentRequestTimeout.resolve(),e._loading=!1),e._rendered&&(g.map.removeLayer(e._rendered),e._rendered=null)})}),Object.keys(l).forEach(function(e){if(angular.isUndefined(r[e])){var t=l[e];t._currentRequestTimeout&&(t._currentRequestTimeout.resolve(),t._loading=!1),t._rendered&&(g.map.removeLayer(t._rendered),t._rendered=null)}}),l=r,D.all(n).then(function(){o&&g.map.removeLayer(o),g.map.addLayer(i),o=i,angular.forEach(l,function(e){if(e._incomplete){var t=e.title||e.context.dataset.metas.title;50<t.length&&(t=t.substr(0,49)+"&hellip;"),g.partialDataLayersArray.push("&bull; "+t),g.partialDataLayers=g.partialDataTooltipMessage(g.partialDataLayersArray)}})})};(e=!y&&e)?x.retrieveBounds(x.MapConfiguration.getActiveContextList(g.mapConfig,{geoOnly:!0,skipExcludedFromRefit:!0})).then(function(t){t&&t!==x.WORLD_BOUNDS?F(function(){var e=g.map.getBounds().toBBoxString();g.map.fitBounds(t),e===g.map.getBounds().toBBoxString()&&c(!1,!0)},0):n(a)}):n()};g.partialDataTooltipMessage=function(e){if(5<e.length){var t=e.length-5;e.splice(0,5);var a=k(t,"... and {{ $count }} more layer","... and {{ $count }} more layers");e.push("<em>"+a+"</em>")}return e.join("<br>")},g.$on("mapRefresh",function(e,t){c(!1)});var d=function(){g.map.on("draw:drawstart draw:editstart",function(){g.map.isDrawing=!0}),g.map.on("draw:drawstop draw:editstop",function(){g.map.isDrawing=!1});var u=function(e){e._path.setAttribute("style","cursor: auto; pointer-events: none;")};g.map.on("draw:deletestart",function(){g.drawnItems.getLayers()[0]._path.setAttribute("style","cursor: pointer; pointer-events: auto;")}),g.map.on("draw:deleteend",function(){u(g.drawnItems.getLayers()[0])}),g.map.on("draw:created",function(e){var t=e.layer;0<g.drawnItems.getLayers().length&&g.drawnItems.removeLayer(g.drawnItems.getLayers()[0]),g.drawnItems.addLayer(t),n(t,e.layerType),g.$apply()}),g.map.on("draw:edited",function(e){var t=e.layers.getLayers()[0],a=r(t);n(t,a),g.$apply()}),g.map.on("draw:deleted",function(){delete g.mapConfig.drawnArea,g.$apply()});var n=function(e,t){if("circle"===t){var a=e.getRadius(),n=e.getLatLng();g.mapConfig.drawnArea={shape:"circle",coordinates:n.lat+","+n.lng+","+a}}else{var r=e.toGeoJSON(),i=ODS.GeoFilter.getGeoJSONPolygonAsPolygonParameter(r.geometry);g.mapConfig.drawnArea={shape:"polygon",coordinates:i}}},r=function(e){return angular.isDefined(e.getRadius)?"circle":"polygon"},f={color:"#2ca25f",fillOpacity:.2,opacity:.8,clickable:!0};g.$watch("mapConfig.drawnArea",function(t){var e;if(0<g.drawnItems.getLayers().length&&g.drawnItems.removeLayer(g.drawnItems.getLayers()[0]),t){if("polygon"===t.shape){var a,n,r,i=ODS.GeoFilter.getPolygonParameterAsGeoJSON(t.coordinates),o=i.coordinates[0];for(o.splice(i.coordinates[0].length-1,1),a=0;a<o.length;a++)r=(n=o[a])[0],n[0]=n[1],n[1]=r;e=4===o.length&&o[0][0]===o[3][0]&&o[1][0]===o[2][0]&&o[0][1]===o[1][1]&&o[2][1]===o[3][1]?new L.Rectangle(o,f):new L.Polygon(o,f)}else if("circle"===t.shape){var s=t.coordinates.split(","),l=s[0],c=s[1],d=s[2]||0;e=new L.Circle([l,c],d,f)}e&&(g.drawnItems.addLayer(e),u(g.drawnItems.getLayers()[0]))}angular.forEach(x.MapConfiguration.getActiveContextList(g.mapConfig,{geoOnly:!0}),function(e){t?"circle"===t.shape?(e.parameters["geofilter.distance"]=t.coordinates,delete e.parameters["geofilter.polygon"]):"polygon"===t.shape&&(e.parameters["geofilter.polygon"]=t.coordinates,delete e.parameters["geofilter.distance"]):(delete e.parameters["geofilter.polygon"],delete e.parameters["geofilter.distance"])})},!0)}});var _=function(){var t,a;angular.forEach(x.MapConfiguration.getActiveContextList(g.mapConfig,{geoOnly:!0}),function(e){angular.isUndefined(t)&&angular.isUndefined(t)?(t=e.parameters["geofilter.polygon"],a=e.parameters["geofilter.distance"]):(t!==e.parameters["geofilter.polygon"]&&(t=null),a!==e.parameters["geofilter.distance"]&&(a=null))}),g.mapConfig.drawnArea=t?{shape:"polygon",coordinates:t}:a?{shape:"circle",coordinates:a}:{}}},controller:["$scope",function(a){var n;angular.isUndefined(a.mapConfig)?a.mapConfig={singleLayer:!1,layerSelection:!1,groups:[]}:a.mapConfig.groups.forEach(function(e){e.layers.forEach(function(e){e.context.wait().then(function(){x.MapConfiguration.setLayerDisplaySettingsFromDefault(e)})})}),window.mapConfig=a.mapConfig,this.registerLayer=function(e){var t=x.MapConfiguration.createLayerGroupConfiguration();return t.layers.push(e),a.mapConfig.groups.push(t),t},this.registerLayerGroup=function(e){a.mapConfig.groups.push(e)},this.getCurrentPosition=function(){return a.mapContext.location},this.moveMap=function(e,t){a.map.setView(e,t)},this.getMap=function(e){return a.map},this.fitMapToShape=function(e){var t=L.geoJson(e);a.map.fitBounds(t.getBounds())},this.resetMapDataFilter=function(){x.MapConfiguration.getContextList(a.mapConfig).forEach(function(e){delete e.parameters["q.mapfilter"]}),n&&n()},this.applyMapDataFilter=function(t){x.MapConfiguration.getContextList(a.mapConfig).forEach(function(e){e.parameters["q.mapfilter"]=t})},this.getActiveContexts=function(){return x.MapConfiguration.getActiveContextList(a.mapConfig)},this.registerResetCallback=function(e){n=e},this.resizeMapDisplayControl=function(){F(function(){var e=$(".odswidget-map"),t=$(".odswidget-map-legend"),a=$(".odswidget-map-display-control__groups");1===a.length&&(a=a.first(),0<t.length?(t=t.first(),a.css("max-height","calc("+e.outerHeight()+"px - 2*10px - 26px - "+t.outerHeight()+"px)")):a.css("max-height","calc("+e.outerHeight()+"px - 10px - 26px)"))})};a.$watch(function(){return x.MapConfiguration.getContextList(a.mapConfig).reduce(function(e,t){return e&&!t.parameters["q.mapfilter"]},!0)},function(e,t){e&&!t&&n&&n()},!0)}]}}]),e.directive("odsMapLayerGroup",["MapHelper",function(e){return{restrict:"EA",scope:{title:"@",description:"@",pictoColor:"@",pictoIcon:"@",displayed:"=?"},require:"^odsMap",link:function(e,t,a,n){n.registerLayerGroup(e.group)},controller:["$scope",function(t){t.group=e.MapConfiguration.createLayerGroupConfiguration(),angular.isDefined(t.displayed)||(t.displayed=!0),angular.extend(t.group,{title:t.title,description:t.description,pictoColor:t.pictoColor,pictoIcon:t.pictoIcon,displayed:t.displayed}),this.registerLayer=function(e){return t.group.layers.push(e),t.group}}]}}]),e.directive("odsMapLayer",["MapHelper",function(m){return{restrict:"EA",scope:{context:"=",showIf:"=",showZoomMin:"@",showZoomMax:"@",color:"@",borderColor:"@",borderSize:"@",borderPattern:"@",borderOpacity:"@",opacity:"@",shapeOpacity:"@",pointOpacity:"@",lineWidth:"@",colorScale:"@",colorRanges:"@",colorCategories:"=",colorCategoriesOther:"@",colorUndefined:"@",colorOutOfBounds:"@",colorNumericRanges:"=",colorNumericRangeMin:"=",colorGradient:"=",colorByField:"@",colorFunction:"@",radius:"@",size:"@",sizeMin:"@",sizeMax:"@",sizeFunction:"@",picto:"@",showMarker:"@",display:"@",function:"@",expression:"@",tooltipSort:"@",tooltipDisabled:"@?",hoverField:"@",refineOnClickContext:"=",joinContext:"=",localKey:"@",remoteKey:"@",caption:"=?",captionTitle:"@",captionPictoColor:"@",captionPictoIcon:"@",title:"@",description:"@",geoField:"@",excludeFromRefit:"=?"},template:function(e){var t="";return e.contents().wrapAll("<div>"),0<e.contents().length&&0<e.contents().html().trim().length&&(e.contents().wrapAll("<div>"),t=e.children().html()),'<div tooltiptemplate="'+t.replace(/"/g,"&quot;")+'"></div>'},require:["?^odsMapLayerGroup","^odsMap"],link:function(t,e,n,a){var r,i=a[0],o=a[1],s=angular.element(e.children()[0]).attr("tooltiptemplate"),l=angular.isDefined(t.tooltipDisabled)&&"false"!==t.tooltipDisabled.toLowerCase();if(t.color)r=t.color;else if(t.colorScale)r={type:"scale",scale:t.colorScale};else if(t.colorRanges){var c=t.colorRanges.split(";");r={type:"range",ranges:c.filter(function(e,t){return t%2==1}),colors:c.filter(function(e,t){return t%2==0}),field:t.colorByField}}else t.colorCategories?(t.colorByField||console.error("odsMapLayer: using colorCategories requires specifying a field to use, using colorByField"),r={type:"categories",field:t.colorByField,categories:t.colorCategories},t.colorCategoriesOther&&(r.otherCategories=t.colorCategoriesOther)):t.colorGradient?r={type:"gradient",steps:t.colorGradient}:t.colorNumericRanges?(t.colorByField||t.function||console.error("odsMapLayer: using colorNumericRanges requires specifying either a field to use (using colorByField) or a function"),r={type:"choropleth",field:t.colorByField,ranges:t.colorNumericRanges},t.colorNumericRangeMin&&(r.minValue=t.colorNumericRangeMin),t.colorUndefined&&(r.undefinedColor=t.colorUndefined),t.colorOutOfBounds&&(r.outOfBoundsColor=t.colorOutOfBounds)):t.colorByField&&(r={type:"field",field:t.colorByField});var d,u={color:r,colorFunction:t.colorFunction,borderColor:t.borderColor,borderSize:t.borderSize,borderPattern:t.borderPattern,borderOpacity:t.borderOpacity,shapeOpacity:angular.isDefined(t.shapeOpacity)&&t.shapeOpacity||t.opacity,pointOpacity:angular.isDefined(t.pointOpacity)&&t.pointOpacity||t.opacity,lineWidth:t.lineWidth,picto:t.picto,display:t.display,function:t.function,expression:t.expression,localKey:t.localKey,remoteKey:t.remoteKey,tooltipSort:t.tooltipSort,hoverField:t.hoverField,excludeFromRefit:t.excludeFromRefit,caption:!!t.caption,captionTitle:t.captionTitle,captionPictoIcon:t.captionPictoIcon,captionPictoColor:t.captionPictoColor,title:t.title,description:t.description,showZoomMin:t.showZoomMin,showZoomMax:t.showZoomMax,radius:t.radius,size:t.size,minSize:t.sizeMin,maxSize:t.sizeMax,sizeFunction:t.sizeFunction,geoField:t.geoField,tooltipDisabled:l},f=m.MapConfiguration.createLayerConfiguration(s,u);d=i?i.registerLayer(f):o.registerLayer(f),n.showIf&&t.$watch("showIf",function(e,t){d.displayed=e});var g=t.$watch("context",function(e){e&&((f.context=e).wait().then(function(){t.showMarker&&(f.marker="true"===t.showMarker.toLowerCase()),angular.isDefined(t.tooltipDisabled)||(f.tooltipDisabled=Boolean(t.context.dataset.extra_metas.visualization.map_tooltip_disabled)),m.MapConfiguration.setLayerDisplaySettingsFromDefault(f)}),g())}),p=t.$watch("joinContext",function(e){e&&(f.joinContext=e,p())}),h=t.$watch("refineOnClickContext",function(e){if(angular.isArray(e)){var t=!0;if(angular.forEach(e,function(e){t=t&&angular.isDefined(e)}),!t)return}else if(!e)return;f.refineOnClick=[];var a=angular.isArray(e)&&e||[e];angular.forEach(a,function(e){var t=!1,a="refineOnClick"+ODS.StringUtils.capitalize(e.name);angular.isDefined(n[a+"ReplaceRefine"])?"false"!==n[a+"ReplaceRefine"]&&(t=!0):angular.isDefined(n.refineOnClickReplaceRefine)&&"false"!==n.refineOnClickReplaceRefine&&(t=!0),f.refineOnClick.push({context:e,mapField:n[a+"MapField"]||n.refineOnClickMapField,contextField:n[a+"ContextField"]||n.refineOnClickContextField,replaceRefine:t}),h()})})},controller:["$scope",function(e){}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsMediaGallery",["$timeout","$q","ODSAPI",function(e,f,g){var i;return{restrict:"E",scope:{context:"=",displayedFields:"@",imageFields:"@?"},replace:!0,template:'<div class="odswidget odswidget-media-gallery">   <div class="ods-aria-instructions" translate>Use left and right arrow to navigate the images, up and down arrows to open close the image inspector</div>   <div class="odswidget-media-gallery__container" >       <div style="vertical-align: top;"             class="odswidget-images__internal-table"             infinite-scroll="loadMore()"             infinite-scroll-distance="1"             infinite-scroll-disabled="fetching">           <div class="odswidget-media-gallery__media-line"                 ng-repeat="line in lines track by $index">               <div ng-class="{\'odswidget-media-gallery__media-container--selected\': image.selected}"                     class="odswidget-media-gallery__media-container"                     style="vertical-align: top; display: inline-block"                     ng-repeat="image in line.images track by $index"                     ng-click="onClick($event, image, line)"                    ng-style="{width: image.width, height: image.height, marginTop: image.marginTop, marginBottom: image.marginBottom, marginRight: image.marginRight, marginLeft: image.marginLeft }"                    data-index="{{ image.index + 1 }}">                       <ods-record-image record="image.record"                                          ng-keydown="onKeyDown($event, image, line)"                                         role="button"                                         tabindex="0"                                         aria-label="{{ getRecordTitle(image.record) }} - {{ image.index + 1 }} out of {{ images.length }}"                                         translate="aria-label"                                         field="{{ image.fieldname }}"                                          domain-url="{{context.domainUrl}}"></ods-record-image>                       <div ng-if="getRecordTitle(image.record)"                             class="odswidget-media-gallery__media-container__title-container">{{ getRecordTitle(image.record) }}</div>                       <ods-spinner ng-show="image.fetching"                                     class="ods-media-gallery__image-spinner-overlay"></ods-spinner>               </div>           </div>       </div>       <ods-spinner ng-if="!init && fetching"></ods-spinner>   </div>   <div class="odswidget-media-gallery__details"></div>   <div class="odswidget-overlay" ng-if="done && !records"><span class="odswidget-overlay__message" translate>No results</span></div>   <div class="odswidget-overlay" ng-if="fetching && !records"><ods-spinner></ods-spinner></div></div>',require:["odsMediaGallery","?odsWidgetTooltip","?odsAutoResize","?refineOnClick"],controller:["$scope","$element","$window","DebugLogger","$filter",function(d,e,t,a,n){d.page=0,d.resultsPerPage=40,d.fetching=!0,d.staticSearchOptions={rows:d.resultsPerPage},d.records=[],d.images=[],d.done=!1,d.init=!0,void(d.nextImage=0)===d.imageFields&&(d.imageFields=[]);var u=[],r=function(){d.fetching=!0;var e,t={};d.init?(e=0,u.length&&(u.forEach(function(e){e.resolve()}),u.splice(0,u.length))):(d.page++,e=d.page*d.resultsPerPage),angular.extend(t,d.staticSearchOptions,d.context.parameters,{start:e});var a=d.imageFields||[];d.context.dataset.extra_metas&&d.context.dataset.extra_metas.visualization&&d.context.dataset.extra_metas.visualization.image_title&&(a=a.concat(d.context.dataset.extra_metas.visualization.image_title)),0<a.length&&angular.extend(t,{fields:a.join(",")});var c=f.defer();u.push(c),angular.isDefined(t.q)?t.q=[t.q]:t.q=[];var n=[];angular.forEach(d.imageFields,function(e){n.push("NOT #null("+e+")")}),t.q.push(n.join(" OR ")),g.records.search(d.context,t,c.promise).success(function(e,t,a,n){var r,i,o,s,l;for(d.records=d.records.concat(e.records),r=0;r<e.records.length;r++)for(i=0;i<d.imageFields.length;i++)if(e.records[r].fields[d.imageFields[i]]){if(!1===(s=e.records[r].fields[d.imageFields[i]]).thumbnail)continue;l=s.url?(o=s.url,!1):s.placeholder?!(o=null):(o=d.context.domainUrl+"/explore/dataset/"+e.records[r].datasetid+"/files/"+s.id+"/300/",!1),d.images.push({record:e.records[r],fieldname:d.imageFields[i],thumbnail_url:o,download_url:o.replace("/300/","/download/"),id:s.id,index:d.images.length,placeholder:l,realwidth:s.width,realheight:s.height,allFieldsInitialized:!1,fetching:!1})}d.renderImages(),d.error="",d.fetching=!1,d.done=(d.page+1)*d.resultsPerPage>=e.nhits,d.init=!1,u.splice(u.indexOf(c),1)}).error(function(e,t,a,n){e&&(d.error=e.error),u.splice(u.indexOf(c),1),d.fetching=!1})};this.getDefaultsFromContext=function(){var e,t,a=d.context.dataset,n=[];if(i=d.context.dataset.extra_metas.visualization&&d.context.dataset.extra_metas.visualization.image_tooltip_html_enabled&&d.context.dataset.extra_metas.visualization.image_tooltip_html?"<div>"+d.context.dataset.extra_metas.visualization.image_tooltip_html+"</div>":'<div><div class="ods-media-gallery__tooltip__image-container" width="{{ image.realwidth }}px" height="{{ image.realheight }}px">   <img class="ods-media-gallery__tooltip__image" ng-src="{{ image.thumbnail_url }}"></div><div class="ods-media-gallery__tooltip__fields"><h2 ng-if="getRecordTitle(record)">   {{ getRecordTitle(record) }}</h2><dl>   <dt ng-repeat-start="field in displayedFields"       ng-show="record.fields[field.name]|isDefined">       {{ field.label }}   </dt>   <dd ng-repeat-end ng-switch="field.type"           ng-show="record.fields[field.name]|isDefined">       <span ng-switch-when="geo_point_2d">           <ods-geotooltip width="300" height="300"                   coords="record.fields[field.name]">{{ record.fields|formatFieldValue:field:context }}</ods-geotooltip>       </span>       <span ng-switch-when="geo_shape">            <ods-geotooltip width="300" height="300"                   geojson="record.fields[field.name]">{{ record.fields|formatFieldValue:field:context }}</ods-geotooltip>        </span>        <span ng-switch-when="double">{{ record.fields|formatFieldValue:field:context }}</span>        <span ng-switch-when="int">{{ record.fields|formatFieldValue:field:context }}</span>        <span ng-switch-when="date">{{ record.fields|formatFieldValue:field:context }}</span>        <span ng-switch-when="datetime">{{ record.fields|formatFieldValue:field:context }}</span>        <span ng-switch-when="file">            <div ng-bind-html="record.fields|formatFieldValue:field:context"></div>        </span>       <span ng-switch-default ng-bind-html="record.fields[field.name]|prettyText|nofollow|safenewlines"></span>   </dd></dl><a href="{{ image.download_url }}"       target="_self"       ods-resource-download-conditions       aria-label="Download {{ getRecordTitle(image.record) }} - {{ image.index + 1 }} out of {{ images.length }}"       translate="aria-label"       class="ods-button">   <i class="fa fa-download" aria-hidden="true"></i>   <span translate>Download image</span></a></div></div>',d.detailsTemplate=i,d.context.dataset.extra_metas.visualization&&d.context.dataset.extra_metas.visualization.media_gallery_fields)d.imageFields=d.context.dataset.extra_metas.visualization.media_gallery_fields;else{for(e=0;e<a.fields.length;e++)if("file"==a.fields[e].type)for(t=0;t<a.fields[e].annotations.length;t++)"has_thumbnails"==a.fields[e].annotations[t].name&&(0===d.imageFields.length||-1<d.imageFields.indexOf(a.fields[e].name))&&n.push(a.fields[e].name);d.imageFields=n}r()},this.watchContext=function(){d.$watch("context.parameters",function(e,t){e!==t&&(d.done=!1,d.lines.splice(0,d.lines.length),d.images.splice(0,d.images.length),d.records.splice(0,d.records.length),d.nextImage=0,d.init=!0,d.page=0,d.layout.resetImages(),r())},!0)},d.loadMore=function(){d.fetching||d.done||!d.staticSearchOptions||r()},d.detailsDisplayed=!1,d.getRecordTitle=function(e){if(d.context.dataset.extra_metas&&d.context.dataset.extra_metas.visualization&&d.context.dataset.extra_metas.visualization.image_title){var t=d.context.dataset.extra_metas.visualization.image_title,a=d.context.dataset.getField(t);return angular.isDefined(e.fields[t])&&""!==e.fields[t]&&"file"!==a.type?n("formatFieldValue")(e.fields,a,d.context):e.fields[t].filename}return null}}],link:function(i,o,e,t){var a=t[0],s=t[1],n=t[2],l=t[3];n&&(n.onResize=function(){i.lines.splice(0,i.lines.length),i.layout.reset(),i.layout.render(i.lines,o.children()[1].getBoundingClientRect().width,i.images.length)}),angular.isString(i.displayedFields)&&(i.displayedFields=i.displayedFields.split(",")),i.context.wait().then(function(){var e;(a.getDefaultsFromContext(),a.watchContext(),null!==s)&&(e=i.displayedFields?i.context.dataset.fields.filter(function(e){return-1!==i.displayedFields.indexOf(e.name)}):i.context.dataset.extra_metas.visualization&&i.context.dataset.extra_metas.visualization.image_fields?i.context.dataset.fields.filter(function(e){return-1!==i.context.dataset.extra_metas.visualization.image_fields.indexOf(e.name)}):i.context.dataset.fields,s.configure({defaultTemplate:i.detailsTemplate,displayedFields:e,fields:i.context.dataset.fields,context:i.context}))});var c,d=o.find(".odswidget-media-gallery__details");i.max_height=400,d=d.remove(),i.onClick=function(t,r,e){var a;if(r.allFieldsInitialized)a=f.resolve();else{var n=angular.copy(i.context.parameters);jQuery.extend(n,{q:["recordid="+r.record.recordid]}),r.fetching=!0,a=g.records.search(i.context,n,f.defer()).success(function(e,t,a,n){r.record=e.records[0],r.allFieldsInitialized=!0,r.fetching=!1})}a.then(function(){if(null!==l)l.refineOnRecord(r.record);else if(null!==s){if(c&&(c.selected=!1),c===r)return c=null,void(d=d.remove());(c=r).selected=!0;var e=s.render(r.record,{image:angular.copy(r),getRecordTitle:i.getRecordTitle,images:i.images,ctx:i.context},r.fieldname);(d=d.remove()).html(e),d.insertAfter(angular.element(t.currentTarget).parents(".odswidget-media-gallery__media-line"))}})},i.onKeyDown=function(e,t,a){if(13!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode||(i.onClick(e,t,a),38!==e.keyCode&&40!==e.keyCode||e.preventDefault()),37===e.keyCode||39===e.keyCode){var n=e.target.parentNode.dataset.index,r=37===e.keyCode?--n:++n;r=Math.min(Math.max(r,1),i.images.length),o.find(".odswidget-media-gallery__media-container[data-index="+r+"] .odswidget-record-image").focus()}},i.lines=[],i.layout=r(),i.layout.resetImages(),i.renderImages=function(){var e,t;for(e=i.nextImage;e<i.images.length;e++)t=i.images[e],i.layout.addImage(t,i.images.length);i.nextImage=e,i.layout.render(i.lines,o.children()[1].getBoundingClientRect().width,i.images.length)}}}}]);var r=function(){var l=0,c=0,d=[],u=-1,f=!1;return{reset:function(){c=l=0,u=-1},resetImages:function(){d.splice(0,d.length),this.reset()},addImage:function(e){var t=angular.copy(e);d.push(t)},render:function(e,a,t){if(!f){var n,r;for(f=!0,0===e.length&&e.push({images:[],height:250,offset:0,max_height:0}),n=u+1;n<d.length;n++){var i=(r=d[n]).realwidth/r.realheight,o=e[e.length-1];if(o.images.push(r),o.max_height=Math.min(250,Math.max(o.max_height,r.realheight)),l+=i,o.height=Math.min(Math.floor((a-1*(o.images.length-1))/l),o.max_height),o.height<o.max_height||r.index===t-1){var s=0;for($.each(o.images,function(e,t){t.height=o.height,t.width=Math.floor(t.realwidth*t.height/t.realheight),t.marginTop=t.marginBottom=t.marginRight=t.marginLeft="1px",s+=t.width+2}),o.offset=c+o.max_height;a<s;)angular.forEach(o.images,function(e,t){a<s&&(e.width-=1,s-=1)})}o.height<o.max_height&&(c+=o.height,e.push({images:[],height:250,offset:0,max_height:0}),l=0),u+=1}f=!1}}}}}(),function(){"use strict";angular.module("ods-widgets").directive("odsMostPopularDatasets",["ODSAPI",function(a){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-most-popular-datasets"><ul class="odswidget-most-popular-datasets__datasets">   <li class="no-data" ng-hide="datasets" translate>No data available yet</li>   <li class="odswidget-most-popular-datasets__dataset" ng-repeat="dataset in datasets" ng-if="datasets">       <ods-theme-picto class="odswidget-most-popular-datasets__theme-picto" theme="{{dataset.metas.theme|firstValue}}"></ods-theme-picto>       <div class="odswidget-most-popular-datasets__dataset-details">           <div class="odswidget-most-popular-datasets__dataset-details-title"><a ng-href="{{context.domainUrl}}/explore/dataset/{{dataset.datasetid}}/" target="_self">{{ dataset.metas.title }}</a></div>           <div class="odswidget-most-popular-datasets__dataset-details-count"><i class="fa fa-download" aria-hidden="true"></i> <span translate translate-n="dataset.extra_metas.explore.download_count" translate-plural="{{$count}} downloads">{{$count}} download</span></div>       </div>   </li></ul></div>',scope:{context:"=",max:"@"},controller:["$scope",function(t){t.max=t.max||5;var e=a.uniqueCall(a.datasets.search);t.$watch("context",function(){e(t.context,{rows:t.max,sort:"explore.download_count",extrametas:!0}).success(function(e){t.datasets=e.datasets})})}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsMostUsedThemes",["ODSAPI",function(a){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-most-used-themes"><ul class="odswidget-most-used-themes__themes">   <li class="no-data" ng-hide="themes" translate>No data available yet</li>   <li class="odswidget-most-used-themes__theme" ng-repeat="theme in themes" ng-if="themes">       <div class="odswidget-most-used-themes__theme-details">           <div class="odswidget-most-used-themes__theme-details-name"><a ng-href="{{ context.domainUrl }}/explore/?refine.theme={{ theme.path }}" target="_self">{{ theme.name }}</a></div>           <div class="odswidget-most-used-themes__theme-details-count"><i class="fa fa-table" aria-hidden="true"></i> <span translate translate-n="theme.count" translate-plural="Used by {{$count}} datasets">Used by {{$count}} dataset</span></div>       </div>   </li></ul></div>',scope:{context:"="},controller:["$scope",function(t){var e=a.uniqueCall(a.datasets.facets);t.$watch("context",function(){e(t.context,"theme").success(function(e){e.facet_groups&&(t.themes=e.facet_groups[0].facets.slice(0,5))})})}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsPageRefresh",["$window","$interval",function(i,o){return{restrict:"AE",scope:{delay:"="},link:function(e,t,a){var n=1e4,r=!1;angular.isDefined(a.delay)&&(e.delay&&"number"==typeof e.delay&&isFinite(e.delay)?e.delay<1e4?console.warn("ods-page-refresh: delay is too small (10000ms minimum): fallbacking to default value (10000ms)"):n=e.delay:console.warn("ods-page-refresh: delay is not a valid integer: fallbacking to default value (10000ms)")),o(function(){r||(r=!0,i.location.reload())},n)}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsPaginationBlock",["$location",function(e){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-pagination" ng-show="pages.length > 1">    <ul class="odswidget-pagination__page-list">        <li class="odswidget-pagination__page" ng-repeat="page in pages">            <a class="odswidget-pagination__page-link"                ng-class="{\'odswidget-pagination__page-link--active\': page.start == (context.parameters.start||0)}"                ng-attr-rel="{{nofollow?\'nofollow\':\'\'}}"               ng-click="click($event, page.start)"                href="?start={{ page.start }}"                rel="nofollow">{{ page.label }}</a>        </li>    </ul></div>',scope:{context:"=",perPage:"@",nofollow:"@",containerIdentifier:"@"},controller:["$scope","$anchorScroll",function(r,a){r.location=e,r.pages=[],r.perPage=r.perPage||10,r.click=function(e,t){e.preventDefault(),r.context.parameters.start=t};var n,i=function(){if(0!==r.context.nhits){var e,t,a=Math.max(1,Math.floor((r.context.nhits-1)/r.perPage)+1),n=[];if(a<=8)for(e=1;e<=a;e++)n.push({label:e,start:(e-1)*r.perPage});else if((t=r.context.parameters.start?Math.floor(r.context.parameters.start/r.perPage)+1:1)<=5){for(e=1;e<=8;e++)n.push({label:e,start:(e-1)*r.perPage});n.push({label:">>",start:(a-1)*r.perPage})}else if(a-4<=t)for(n.push({label:"<<",start:0}),e=a-7;e<=a;e++)n.push({label:e,start:(e-1)*r.perPage});else{for(n.push({label:"<<",start:0}),e=t-3;e<=t+3;e++)n.push({label:e,start:(e-1)*r.perPage});n.push({label:">>",start:(a-1)*r.perPage})}r.pages=n}else r.pages=[]};r.containerIdentifier&&(n=document.getElementById(r.containerIdentifier));var o=r.$watch("context",function(e,t){e&&(r.$watch("context.nhits",function(e,t){void 0!==r.context.nhits&&r.perPage&&i()}),r.$watch("perPage",function(e,t){r.context.nhits&&r.perPage&&i()}),r.$watch("context.parameters.start",function(e,t){r.context.nhits&&r.perPage&&i(),(angular.isDefined(e)||angular.isDefined(t))&&(n?n.scrollTop=0:a())}),o())})}]}}])}(),function(){"use strict";var e=angular.module("ods-widgets");e.directive("odsPicto",["SVGInliner","$http","$document",function(r,e,t){return{restrict:"E",replace:!0,scope:{url:"=",color:"=",classes:"="},template:'<div class="odswidget odswidget-picto {{ classes }}"></div>',link:function(t,a){var n;t.$watch("[url, color]",function(e){if(e[0]){if(Modernizr&&!Modernizr.svg)return;n&&a.empty(),n=r.getElement(t.url,t.color),t.color||n.addClass("ods-svginliner__svg-container--colorless"),a.append(n)}},!0)}}}]),e.directive("odsThemePicto",["ODSWidgetsConfig","$compile",function(n,r){return{restrict:"E",replace:!0,scope:{theme:"@"},template:"",link:function(e,t){e.originalClasses=t.attr("class").replace("ng-isolate-scope","").trim();var a=!1;n.themes[e.theme]&&n.themes[e.theme].url?e.themeConfig=n.themes[e.theme]:(e.themeConfig=n.themes.default,a=!0),e.getTheme=function(){return a?"default":e.theme},e.themeConfig&&t.replaceWith(angular.element(r('<ods-picto url="themeConfig.url" aria-label="Theme of this dataset: {{ theme|firstValue }}" translate="aria-label" color="themeConfig.color" classes="originalClasses + \' odswidget-theme-picto theme-\' + (getTheme()|themeSlug) "></ods-picto>')(e)))}}}]),e.directive("odsMapPicto",["ODSWidgetsConfig","PictoHelper","$compile",function(e,a,n){return{restrict:"E",replace:!0,scope:{name:"@",color:"@"},template:"",link:function(e,t){e.originalClasses=t.attr("class").replace("ng-isolate-scope","").trim();e.$watch("[name, color]",function(){e.pictoUrl=a.mapPictoToURL(e.name),e.pictoUrl&&t.replaceWith(angular.element(n('<ods-picto url="pictoUrl" color="color" classes="originalClasses + \' odswidget-map-picto\'"></ods-picto>')(e)))},!0)}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsPlumeAirQuality",function(){return{restrict:"E",replace:!0,template:'<div class="odswidget"></div>',scope:{city:"@",lang:"@"},link:function(e,t,a){var n='<a id="plumelabs-wjs-cfg" data-w="320" data-h="200" data-city="'+a.city+'" data-lng="'+(a.lang||"en_us")+'" data-type="l">Air Quality</a><script>window.plmlbs=function(e,t,s){var l,m=e.getElementsByTagName(t)[0],n=window.plmlbs||{},a=/^http:/.test(e.location)?"http":"https";return e.getElementById(s)?n:(l=e.createElement(t),l.id=s,l.src=a+"://static.plumelabs.com/embed/embed.js",m.parentNode.insertBefore(l,m),n)}(document,"script","plumelabs-wjs");<\/script>';t.append(n)}}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsRangeInput",["$timeout","translate","$compile",function(s,l,c){return{restrict:"E",replace:!0,scope:{ngModel:"=",min:"=",max:"=",step:"=",selectableMin:"=",minValuePosition:"=?",maxValuePosition:"=?",editableValue:"=",iconMin:"@",iconMax:"@",iconMinTitle:"@?",iconMaxTitle:"@?",ariaLabelText:"@"},require:"ngModel",link:function(a,e,t,n){var r=angular.element('<div class="ods-range-input">    <i class="ods-range-input__icon ods-range-input__icon--min" ng-if="iconMin" title="{{ iconMinTitle }}" ng-class="iconMin"></i>    <input type="range"           min="{{ actualMin }}"           max="{{ max }}"           step="{{ step }}"           class="ods-range-input__range-input"           ng-change="onRangeChange()"           ng-model-options="{ debounce: 0 }"           ng-model="values.internalRange"           aria-label="{{rangeLabel}}"           title="{{ values.internalRange }}">    <i class="ods-range-input__icon ods-range-input__icon--max" ng-if="iconMax" title="{{ iconMaxTitle }}" ng-class="iconMax"></i>    <input class="ods-range-input__value-input"           ng-change="onValueChange()"           ng-if="editableValue"           type="number"           ng-model="values.internalValue"          ng-model-options="{ debounce: 0 }"          ng-blur="onValueBlur()"          min="{{ actualMin }}"           max="{{ max }}"           step="{{ step }}"          aria-label="{{inputLabel}}"></div>');e.replaceWith(r),c(r)(a);var i=e.find(".ods-range-input__input");a.values={},angular.isDefined(a.selectableMin)?a.actualMin=a.selectableMin:a.actualMin=a.min,a.rangeLabel=format_string(l("{label} slider"),{label:a.ariaLabelText}),a.inputLabel=format_string(l("{label} input"),{label:a.ariaLabelText});var o=function(){return isNaN(a.values.internalValue)||a.values.internalValue<a.actualMin||a.values.internalValue>a.max};a.onRangeChange=function(){var e=parseFloat(a.values.internalRange,10);a.values.internalValue=e,n.$setViewValue(e)},a.onValueChange=function(){o()||(a.values.internalRange=a.values.internalValue.toString(),n.$setViewValue(a.values.internalValue))},a.onValueBlur=function(){o()&&a.onRangeChange()},n.$render=function(){a.values.internalValue=n.$modelValue,a.values.internalRange=n.$modelValue.toString()},a.$watch("selectableMin",function(e,t){e!==t&&(i.css({width:(a.max-e)/(a.max-a.min)*100+"%"}),(a.actualMin=e)>=a.ngModel&&(a.ngModel=e))}),a.$watch("minValuePosition",function(e,t){e!==t&&e>=a.ngModel&&(a.ngModel=e)}),a.$watch("maxValuePosition",function(e,t){e!==t&&e<=a.ngModel&&(a.ngModel=e)}),s(function(){e.find(".ods-range-input__range-input").val(a.values.internalRange)})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsRecordImage",function(){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-record-image">   <img class="odswidget-record-image__image" ng-style="{ \'background-image\': prefetchBackground}" ng-if="imageUrl" ng-src="{{ imageUrl }}">   <div class="odswidget-record-image__image odswidget-record-image__image--placeholder" ng-if="placeholder"></div>',scope:{record:"=",field:"@",domainUrl:"@?"},link:function(n){n.imageUrl=null;n.$watch("[record, field]",function(e,t){var a;(a=n.record.fields[n.field])&&"object"!=typeof a?console.error("Widget <record-image> requires a file field type"):a.url?(n.imageUrl=a.url,n.placeholder=!1):a.placeholder?(n.imageUrl=null,n.placeholder=!0):(n.imageUrl=ODS.Record.getImageUrl(n.record,n.field,n.domainUrl),n.placeholder=!1),a.color_summary&&(n.prefetchBackground="linear-gradient(to bottom, "+a.color_summary.join(",")+")")},!0)}}})}(),function(){"use strict";var e=angular.module("ods-widgets"),t=function(){return{restrict:"A",controller:function(r,e,i){var o=[];this.refineOnRecord=function(t){angular.forEach(o,function(e){e.context.toggleRefine(e.contextField,t.fields[e.recordField],e.replaceRefine)})},this.refineOnValue=function(t){angular.forEach(o,function(e){e.context.toggleRefine(e.contextField,t,e.replaceRefine)})};var s=r.$watch(function(){return i.refineOnClickContext},function(e){var t=e.split(","),a=[],n=!0;angular.forEach(t,function(e){var t=r[e];n=n&&angular.isDefined(t),a.push(t)}),n&&angular.forEach(a,function(e){var t="refineOnClick"+ODS.StringUtils.capitalize(e.name);o.push({context:e,recordField:i[t+"RecordField"]||i.refineOnClickRecordField,contextField:i[t+"ContextField"]||i.refineOnClickContextField,replaceRefine:"true"===i[t+"ReplaceRefine"]||"true"===i.refineOnClickReplaceRefine}),s()})})}}};e.directive("refineOnClick",t),e.directive("refineOnClickContext",t)}(),function(){"use strict";angular.module("ods-widgets").directive("odsResultEnumerator",["ODSAPI",function(e){return{restrict:"E",replace:!0,transclude:!0,scope:{context:"=",max:"@?",showHitsCounter:"@?",showPagination:"@?"},template:'<div class="odswidget odswidget-result-enumerator">    <div ods-results="items" ods-results-context="context" ods-results-max="{{maxHits}}" class="odswidget-result-enumerator__results">        <div ng-if="loading"><ods-spinner class="odswidget-spinner--large"></ods-spinner></div>        <div ng-if="!loading && !items.length" class="odswidget-result-enumerator__no-results-message" translate>No results</div>        <div ng-if="!loading && items.length && hitsCounter" class="odswidget-result-enumerator__results-count">{{context.nhits}} <span translate>results</span></div>        <div ng-repeat="item in items" inject class="odswidget-result-enumerator__item"></div>    </div>    <ods-pagination-block ng-if="pagination" context="context" per-page="{{maxHits}}" container-identifier="{{localId}}"></ods-pagination-block></div>',link:function(e,t){e.localId="odsResultEnumerator-"+ODS.StringUtils.getRandomUUID(),t.children()[0].id=e.localId},controller:["$scope",function(e){e.maxHits=e.max||10,e.hitsCounter=angular.isString(e.showHitsCounter)&&"true"===e.showHitsCounter.toLowerCase(),e.pagination=angular.isString(e.showPagination)&&"true"===e.showPagination.toLowerCase()}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsResults",["ODSAPI",function(e){return{restrict:"A",scope:!0,priority:1001,controller:["$scope","$attrs",function(i,o){var s=e.uniqueCall(e.records.search),l=e.uniqueCall(e.datasets.search),c=!0;i.$watch(o.odsResultsContext,function(e,t){var a,n,r;!("catalog"===e.type||"dataset"===e.type&&e.dataset)||angular.equals(e.parameters,t.parameters)&&!c||(c=!1,a=e,n=angular.extend({},a.parameters,{rows:o.odsResultsMax}),r=o.odsResults||"results",i.loading=!0,"catalog"===a.type?(angular.extend(n,{extrametas:"true",interopmetas:"true"}),l(a,n).success(function(e){i[r]=e.datasets,a.nhits=e.nhits,i.loading=!1}).error(function(){i.loading=!1})):"dataset"===a.type&&a.dataset&&s(a,n).success(function(e){i[r]=e.records,a.nhits=e.nhits,i.loading=!1}).error(function(){i.loading=!1}))},!0)}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsReuses",["ODSAPI",function(e){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="odswidget odswidget-reuses">  <div infinite-scroll="loadMore()" infinite-scroll-distance="1">      <div class="odswidget-reuses__reuse" ng-repeat="reuse in reuses" ods-full-click inject>          <h2 class="odswidget-reuses__reuse-title">{{ reuse.title }}             <a href="/explore/dataset/{{ reuse.dataset.id }}/?tab=metas" class="odswidget-reuses__reuse-dataset-link" target="_self"><span translate>From dataset:</span> {{ reuse.dataset.title }}</a>          </h2>          <div class="odswidget-reuses__reuse-infos">              <div class="odswidget-reuses__reuse-thumbnail" ng-class="{\'odswidget-reuses__reuse-thumbnail--no-thumbnail\': !reuse.thumbnail}">                  <a ng-show="reuse.thumbnail" href="{{ reuse.url }}" ods-main-click title="{{ reuse.title }}" target="_blank"><img class="odswidget-reuses__reuse-thumbnail-image" ng-src="{{ reuse.thumbnail }}" /></a>                  <i ng-hide="reuse.thumbnail" class="fa fa-ban odswidget-reuses__reuse-thumbnail-image--no-thumbnail"></i>              </div>              <div class="odswidget-reuses__reuse-description" ng-bind-html="reuse.description|prettyText|safenewlines"></div>          </div>          <div class="odswidget-reuses__reuse-author">              <strong ng-if="reuse.user.first_name || reuse.user.last_name">{{ reuse.user.first_name }} {{ reuse.user.last_name }}</strong>              <strong ng-if="!reuse.user.first_name && !reuse.user.last_name">{{ reuse.user.username }}</strong>              <i class="fa fa-calendar odswidget-reuses__creation-icon" aria-hidden="true"></i> {{ reuse.created_at|moment:\'LLL\' }}          </div>      </div> </div></div>',scope:{context:"="},controller:["$scope",function(t){var a=!1,n=!1,r=0,i=1,o=e.uniqueCall(e.reuses);t.reuses=[],t.loadMore=function(){if(t.reuses.length&&!a&&!n){n=!0;var e=20*i;o(t.context,{rows:20,start:e}).success(function(e){t.reuses=t.reuses.concat(e.reuses),a=r<=20*(i+1),i++,n=!1}).error(function(){n=!1})}};t.$watch("context",function(){n=!0,o(t.context,{rows:20}).success(function(e){t.reuses=e.reuses,a=e.nhits<=20,r=e.nhits,n=!1}).error(function(e){n=!1})})}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsSearchbox",function(){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-searchbox"><form method="GET" action="{{ actionUrl }}" ng-show="actionUrl"><input class="odswidget-searchbox__box" name="q" type="text" placeholder="{{placeholder|translate}}"></form></div>',scope:{placeholder:"@",context:"="},link:function(e,t,a){"autofocus"in a&&$(t).find("input").focus()},controller:["$scope","$sce",function(t,a){t.actionUrl="/explore/";var n=t.$watch("context",function(e){e&&(t.actionUrl=a.trustAsResourceUrl(t.context.domainUrl+t.actionUrl),n())})}]}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsSlideshow",["ODSAPI","$timeout",function(u,f){return{restrict:"E",transclude:!0,replace:!0,scope:{context:"=",imageField:"@?",titleFields:"@",domainUrl:"@?"},template:'<div class="ods-slideshow"      ng-keydown="onKeyDown($event)"      tabindex="0"      aria-label="Slideshow"     translate="aria-label">    <div class="ods-slideshow__image-wrapper">        <button class="ods-slideshow__previous-button"                ng-click="loadPreviousImage()"                ng-disabled="currentIndex <= 1"                aria-label="View previous image"                translate="aria-label">            <i class="fa fa-angle-left ods-slideshow__previous-icon" aria-hidden="true"></i>        </button>        <ods-spinner ng-show="loading"></ods-spinner>        <img src="{{ imageUrl}}"              alt="{{ imageTitle }}"              class="ods-slideshow__image"             width="{{ imageWidth }}"             height="{{ imageHeight }}"             ng-show="imageThumbnail"  >        <div class="ods-slideshow__tooltip-wrapper"             ng-if="tooltip">            <div class="ods-slideshow__tooltip"                  inject>                <dl>                   <dt ng-repeat-start="field in context.dataset.fields"                           ng-if="record.fields[field.name]|isDefined">                       {{ field.label }}                   </dt>                   <dd ng-repeat-end ng-switch="field.type"                           ng-if="record.fields[field.name]|isDefined">                        <span ng-switch-when="geo_point_2d">                           <ods-geotooltip width="300" height="300"                                   coords="record.fields[field.name]">{{ record.fields|formatFieldValue:field:context }}</ods-geotooltip>                        </span>                        <span ng-switch-when="geo_shape">                            <ods-geotooltip width="300" height="300"                                   geojson="record.fields[field.name]">{{ record.fields|formatFieldValue:field:context }}</ods-geotooltip>                        </span>                        <span ng-switch-when="double">{{ record.fields|formatFieldValue:field:context }}</span>                        <span ng-switch-when="int">{{ record.fields|formatFieldValue:field:context }}</span>                        <span ng-switch-when="date">{{ record.fields|formatFieldValue:field:context }}</span>                        <span ng-switch-when="datetime">{{ record.fields|formatFieldValue:field:context }}</span>                        <span ng-switch-when="file">                            <div ng-bind-html="record.fields|formatFieldValue:field:context"></div>                        </span>                       <span ng-switch-default ng-bind-html="record.fields[field.name]|prettyText|nofollow|safenewlines"></span>                   </dd>                </dl>            </div>        </div>        <div class="ods-slideshow__cannot-display"              ng-hide="imageThumbnail">            <i class="fa fa-eye-slash ods-slideshow__cannot-display-icon"></i>            <div class="ods-slideshow__cannot-display-message" translate>Sorry, this file cannot be displayed</div>        </div>        <button class="ods-slideshow__next-button"                ng-click="loadNextImage()"                aria-label="View next image"                translate="aria-label"                ng-disabled="currentIndex >= lastIndex">            <i class="fa fa-angle-right ods-slideshow__next-icon" aria-hidden="true"></i>        </button>    </div>    <div class="ods-slideshow__image-legend">        <div class="ods-slideshow__image-index"><div class="ods-slideshow__image-index__item">{{ currentIndex|number:0 }}</div><div class="ods-slideshow__image-index__item">/</div><div class="ods-slideshow__image-index__item">{{ lastIndex|number:0 }}</div></div>        <div class="ods-slideshow__image-title" title="{{ imageTitle }}" ng-bind="imageTitle"></div>        <div class="ods-slideshow__toggles">            <button class="ods-slideshow__tooltip-toggle"                    aria-label="Toggle tooltip"                    translate="aria-label"                    ng-click="toggleTooltip()">                <i class="fa fa-question-circle" aria-hidden="true"></i>            </button>            <button class="ods-slideshow__fullscreen-toggle"                    aria-label="Toggle fullscreen"                    translate="aria-label"                    ng-click="toggleFullscreen()">                <i class="fa fa-arrows-alt" ng-hide="fullscreen" aria-hidden="true"></i>                <i class="fa fa-compress" ng-show="fullscreen" aria-hidden="true"></i>            </button>        </div>    </div></div>',link:function(n,t){var r;n.loading=!1,n.currentIndex=0,n.lastIndex=0,n.imageUrl="",n.imageTitle="",n.imageWidth=0,n.imageHeight=0,n.imageThumbnail=!0,n.fullscreen=!1,n.tooltip=!1,angular.isDefined(n.titleFields)&&(r=n.titleFields.split(","));var i,a=$(t).children(".ods-slideshow__image-wrapper"),o=$(t).find(".ods-slideshow__image-index"),e=$(t).find(".ods-slideshow__image"),s=function(){if(i){var e=Math.min(a.width()/i.width,a.height()/i.height,1);n.imageWidth=e*i.width,n.imageHeight=e*i.height,n.$apply()}},l=u.uniqueCall(u.records.search),c=function(a){var e=angular.extend({},n.context.parameters,{rows:1,start:a-1,q:"NOT #null("+n.imageField+")"});n.loading=!0,l(n.context,e).success(function(e){if(n.lastIndex?(n.lastIndex=e.nhits,n.currentIndex=a):(n.currentIndex=e.nhits,n.lastIndex=e.nhits,f(function(){o.css({width:"auto"}),f(function(){o.css({width:o.outerWidth()}),n.lastIndex=e.nhits,n.currentIndex=a})})),e.records.length){var t=e.records[0];i=t.fields[n.imageField],n.imageThumbnail=i.thumbnail,i.thumbnail?n.imageUrl=ODS.Record.getImageUrl(t,n.imageField,n.context.domainUrl):n.imageUrl="",r.length&&(n.imageTitle=r.filter(function(e){return t.fields[e]}).map(function(e){return t.fields[e]}).join(", ")),n.record=t}n.loading=!1}).error(function(){n.loading=!1})};n.loadPreviousImage=function(){1<n.currentIndex&&c(n.currentIndex-1)},n.loadNextImage=function(){n.currentIndex<n.lastIndex&&c(n.currentIndex+1)},n.toggleFullscreen=function(){var e=t[0];document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},n.toggleTooltip=function(){n.tooltip=!n.tooltip},n.onKeyDown=function(e){if(!n.loading)if("rtl"===$(t).css("direction")){if(37==e.keyCode)return void n.loadNextImage();if(39==e.keyCode)return void n.loadPreviousImage()}else{if(39==e.keyCode)return void n.loadNextImage();if(37==e.keyCode)return void n.loadPreviousImage()}},$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(e){e.target==t[0]&&(n.fullscreen=!n.fullscreen,f(s))}),e.on("load",s);var d=n.$watch("context.dataset",function(e){if(e){var t,a;if(!r)for(t=0;t<n.context.dataset.fields.length;t++)if("text"===(a=n.context.dataset.fields[t]).type){r=[a.name];break}if(!n.imageField)for(t=0;t<n.context.dataset.fields.length;t++)if("file"===(a=n.context.dataset.fields[t]).type){n.imageField=a.name;break}c(1),d(),n.$watch("context.parameters",function(e,t){angular.equals(e,t)||(n.currentIndex=0,n.lastIndex=0,c(1))},!0)}},!0)}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsSocialButtons",["translate","$location","$window",function(t,r,i){return{restrict:"E",scope:{buttons:"@?",title:"@?",url:"@?"},replace:!0,template:'<div class="odswidget-social-buttons">   <button ng-repeat-start="(name, button) in activeButtons"           ng-hide="name === \'email\'"              type="button"           class="odswidget-social-buttons__button"           ng-click="openPopup(button)"           aria-label="{{ button.aria }}">       <i class="fa"           ng-class="button.icon"           aria-hidden="true"></i>   </button>   <a ng-repeat-end      ng-show="name === \'email\'"      class="odswidget-social-buttons__button"      ng-href="{{ button.href }}"       aria-label="{{ button.aria }}" >       <i class="fa"           ng-class="button.icon"           aria-hidden="true"></i>   </a> </div>',link:function(a){a.openPopup=function(e){if(e.popupWidth&&e.popupHeight){var t=format_string("menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height={height},width={width}",{width:e.popupWidth,height:e.popupHeight});i.open(e.href,"",t)}};var n={twitter:{aria:t("Share on Twitter"),hrefTemplate:"https://twitter.com/intent/tweet?text={title}&url={url}",icon:"fa-twitter",popupWidth:600,popupHeight:250},facebook:{aria:t("Share on Facebook"),hrefTemplate:"https://www.facebook.com/sharer/sharer.php?u={url}",icon:"fa-facebook",popupWidth:600,popupHeight:600},linkedin:{aria:t("Share on Linkedin"),hrefTemplate:"https://www.linkedin.com/shareArticle?url={url}&mini=true&title={title}&source={title}",icon:"fa-linkedin",popupWidth:600,popupHeight:600},email:{aria:t("Share by email"),hrefTemplate:"mailto:?subject={title}&body={url}",icon:"fa-envelope"}};if(angular.isDefined(a.buttons)){a.activeButtons={};var e=ODS.ArrayUtils.fromCSVString(a.buttons);angular.forEach(e,function(e){n[e]&&(a.activeButtons[e]=n[e])})}else a.activeButtons=n;a.$watch(function(){return i.encodeURIComponent(a.url||r.absUrl())},function(t){angular.forEach(n,function(e){e.href=format_string(e.hrefTemplate,{url:t,title:i.encodeURIComponent(a.title||i.document.title)})})})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsSpinner",["ODSWidgetsConfig",function(n){return{restrict:"E",replace:!0,template:function(e,t){var a;return a=Modernizr&&Modernizr.cssanimations&&Modernizr.svg?'<img src="'+n.basePath+'src/img/spinner.gif"      class="odswidget-spinner odswidget-spinner--gif"/>':'<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" version="1.1"     class="odswidget-spinner odswidget-spinner--svg">    <rect x="0" y="0" width="30" height="30" class="odswidget-spinner__cell-11"></rect>    <rect x="35" y="0" width="30" height="30" class="odswidget-spinner__cell-12"></rect>    <rect x="70" y="0" width="30" height="30" class="odswidget-spinner__cell-13"></rect>    <rect x="0" y="35" width="30" height="30" class="odswidget-spinner__cell-21"></rect>    <rect x="35" y="35" width="30" height="30" class="odswidget-spinner__cell-22"></rect>    <rect x="70" y="35" width="30" height="30" class="odswidget-spinner__cell-23"></rect>    <rect x="0" y="70" width="30" height="30" class="odswidget-spinner__cell-31"></rect>    <rect x="35" y="70" width="30" height="30" class="odswidget-spinner__cell-32"></rect>    <rect x="70" y="70" width="30" height="30" class="odswidget-spinner__cell-33"></rect></svg>',"withBackdrop"in t&&(a='<div class="odswidget-spinner__backdrop">'+a+"</div>"),a}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsTable",function(){return{restrict:"E",scope:{context:"=",displayedFields:"@",sort:"@",datasetFeedback:"@"},replace:!0,transclude:!0,require:["?odsAutoResize","?autoResize"],template:'<div class="records records-table odswidget odswidget-table"> <div class="odswidget-table__header" ng-show="records.length">     <table class="odswidget-table__internal-table">         <thead class="odswidget-table__internal-header-table-header">         <tr>             <th class="odswidget-table__header-cell odswidget-table__header-cell--spinner"><div class="odswidget-table__cell-container"><ods-spinner ng-show="fetching" class="odswidget-spinner--large"></ods-spinner></div></th>             <th class="odswidget-table__header-cell" ng-repeat="field in context.dataset.fields|fieldsForVisualization:\'table\'|fieldsFilter:displayedFieldsArray"                 title="{{ field.description || field.label }}"                 ng-click="toggleSort(field)"                 >                 <div class="odswidget-table__header-cell-container">                     <div class="odswidget-table__label" ng-bind="field.label"></div>                     <div ng-class="{\'odswidget-table__sort-icons\': true, \'odswidget-table__sort-icons--active\': field.name == context.parameters.sort || \'-\'+field.name == context.parameters.sort}" ng-show="isFieldSortable(field)" title="sort" translate="title">                         <button class="odswidget-table__sort-icon" aria-label="Sort column {{ field.label }} in ascending order" tabindex="0" translate="aria-label">                            <i class="fa fa-chevron-up odswidget-table__sort-icons__up"  ng-class="{\'odswidget-table__sort-icons__up--active\': isDescendingSorted(field)}" aria-hidden="true"></i>                         </button>                         <button class="odswidget-table__sort-icon" aria-label="Sort column {{ field.label }} in descending order" tabindex="0" translate="aria-label">                            <i class="fa fa-chevron-down odswidget-table__sort-icons__down"  ng-class="{\'odswidget-table__sort-icons__down--active\': isAscendingSorted(field)}" aria-hidden="true"></i>                         </button>                     </div>                 </div>             </th>         </tr>         </thead>     </table> </div> <div class="odswidget-table__records">     <table class="odswidget-table__internal-table" infinite-scroll="loadMore()" infinite-scroll-distance="1" infinite-scroll-disabled="fetching">         <thead class="odswidget-table__internal-table-header">             <tr>                 <th class="odswidget-table__header-cell odswidget-table__header-cell--spinner"><div class="odswidget-table__cell-container"><ods-spinner ng-show="fetching" class="odswidget-spinner--large"></ods-spinner></div></th>                 <th class="odswidget-table__header-cell" ng-repeat="field in context.dataset.fields|fieldsForVisualization:\'table\'|fieldsFilter:displayedFieldsArray"                     title="{{ field.name }}">                     <div class="odswidget-table__cell-container">                         <span ng-bind="field.label"></span>                         <div class="odswidget-table__sort-icons" ng-show="isFieldSortable(field)" title="sort" translate="title">                             <button class="odswidget-table__sort-icon" aria-label="Sort column {{ field.label }} in ascending order" tabindex="0" translate="aria-label">                                <i class="fa fa-chevron-up odswidget-table__sort-icons__up" aria-hidden="true"></i>                             </button>                             <button class="odswidget-table__sort-icon" aria-label="Sort column {{ field.label }} in descending order" tabindex="0" translate="aria-label">                                <i class="fa fa-chevron-down odswidget-table__sort-icons__down" aria-hidden="true"></i>                             </button>                         </div>                     </div>                 </th>             </tr>         </thead>         <tbody class="odswidget-table__records-tbody">         </tbody>     </table> </div> <div ng-if="displayDatasetFeedback" class="table-feedback-new"><a ods-dataset-feedback ods-dataset-feedback-dataset="context.dataset"><i class="fa fa-comment" aria-hidden="true"></i> <span translate>Suggest a new record</span></a></div> <div class="odswidget-overlay" ng-hide="fetching || records"><span class="odswidget-overlay__message" translate>No results</span></div> <div class="odswidget-overlay" ng-hide="(!fetching || records) && !working"><ods-spinner></ods-spinner></div></div>',controller:["$scope","$element","$timeout","$document","$window","ODSAPI","DebugLogger","$filter","$http","$compile","$transclude","$q",function(m,y,o,e,t,s,a,v,n,b,w,l){m.displayedFieldsArray=null,m.displayDatasetFeedback=!1,m.page=0,m.resultsPerPage=40,m.fetching=!1,m.records=[],m.working=!0,m.layout=[],m.done=!1;var _,r,i=y.find(".odswidget-table__header"),p=y.find(".odswidget-table__records"),h=y.find(".odswidget-table__records-tbody"),x=0,C=0,A=0,S=0,c=Math.random().toString(36).substring(7),d="table-"+c,u="stylesheet-"+c,f=[],g=null,k={},D=function(a){m.fetching=!0;var e,t={};if(a?(m.done=!1,m.page=0,m.records=[],e=0,f.length&&(f.forEach(function(e){e.resolve()}),f.splice(0,f.length)),k={},g=null):(m.page++,e=m.page*m.resultsPerPage),jQuery.extend(t,m.staticSearchOptions,m.context.parameters,{start:e}),m.displayedFieldsArray&&m.context.dataset.fields.length>m.displayedFieldsArray.length&&jQuery.extend(t,{fields:m.displayedFieldsArray.join(",")}),t.sort){var n=t.sort.replace("-","");m.context.dataset.getField(n)||delete t.sort}var r=l.defer();function i(e,t){e.records.length||(m.working=!1),m.records=a?e.records:m.records.concat(e.records),m.nhits=e.nhits,m.error="",m.fetching=!1,m.done=(m.page+1)*m.resultsPerPage>=e.nhits,f.splice(f.indexOf(r),1),g=t,o(function(){if(U(),angular.isDefined(k[t+1])){var e=k[t+1];delete k[t+1],e.callback(e.data,t+1)}})}f.push(r),s.records.search(m.context,t,r.promise).success(function(e){var t=e.parameters.start/e.parameters.rows;null===g&&0===t||angular.isNumber(g)&&t===g+1?i(e,t):k[t]={callback:i,data:e}}).error(function(e){e&&(m.error=e.error),f.splice(f.indexOf(r),1),m.fetching=!1})};m.loadMore=function(){m.fetching||m.done||!m.staticSearchOptions||D(!1)},m.isFieldSortable=function(e){return ODS.DatasetUtils.isFieldSortable(e)},m.isAscendingSorted=function(e){return"text"===e.type?e.name===m.context.parameters.sort:"-"+e.name===m.context.parameters.sort},m.isDescendingSorted=function(e){return"text"===e.type?"-"+e.name===m.context.parameters.sort:e.name===m.context.parameters.sort};var F=!(m.toggleSort=function(e){if(m.isFieldSortable(e)){if(m.context.parameters.sort===e.name)return void(m.context.parameters.sort="-"+e.name);if(m.context.parameters.sort==="-"+e.name)return void(m.context.parameters.sort=e.name);m.context.parameters.sort="text"===e.type?e.name:"-"+e.name}else delete m.context.parameters.sort});w(function(e){e.contents().wrapAll("<div>"),F=0<e.contents().length&&0<e.contents().html().trim().length});var M=function(e,t,a){var n,r,i=t[e];if((n=document.createElement("tr")).className="odswidget-table__internal-table-row record-"+e,"end"===a){var o=y.find(".js-placeholder-bottom")[0];o.parentNode.insertBefore(n,o)}else{var s=y.find(".js-placeholder-top")[0];s.parentNode.insertBefore(n,s.nextSibling)}(r=document.createElement("td")).className="odswidget-table__cell";var l=document.createElement("div");if(l.className="odswidget-table__cell-container",m.displayDatasetFeedback){var c=m.$new(!0);c.record=i,c.dataset=m.context.dataset,l.appendChild(b('<i class="fa fa-comment table-feedback-icon" aria-hidden="true" ods-dataset-feedback ods-dataset-feedback-record="record" ods-dataset-feedback-dataset="dataset" ods-tooltip="Suggest changes for this record" translate="ods-tooltip"></i>')(c)[0])}l.appendChild(document.createTextNode(e+1)),r.appendChild(l),n.appendChild(r);for(var d=0;d<_.length;d++){var u,f,g=_[d],p=v("formatFieldValue")(i.fields,g,m.context);if((r=document.createElement("td")).className="odswidget-table__cell",n.appendChild(r),(l=document.createElement("div")).className="odswidget-table__cell-container","int"!==g.type&&"double"!==g.type||(l.className+=" odswidget-table__cell-container__right-aligned"),r.appendChild(l),F)(u=m.$new(!0)).record=i,u.currentField=g.name,u.currentValue=i.fields[g.name],u.currentFormattedValue=p,f=b("<div inject></div>",w)(u)[0];else if((u=m.$new(!1)).recordFields=i.fields[g.name],g&&"geo_point_2d"===g.type)u.fieldValue=p,f=b('<ods-geotooltip width="300" height="300" coords="recordFields">'+p+"</ods-geotooltip>")(u)[0],l.dir="ltr";else if(g&&"geo_shape"===g.type)u.fieldValue=v("truncate")(p),f=b('<ods-geotooltip width="300" height="300" geojson="recordFields">'+p+"</ods-geotooltip>")(u)[0],l.dir="ltr";else if(g&&"file"===g.type){var h=v("nofollow")(v("prettyText")(p)).toString();(h=h.replace(/<a /,"<a ods-resource-download-conditions "))?(f=b(h)(u)[0]).title=i.fields[g.name]?i.fields[g.name].filename:"":f=document.createElement("span"),l.dir="ltr"}else(f=document.createElement("span")).title=p,f.innerHTML=v("nofollow")(v("prettyText")(p)),g&&"text"===g.type&&(l.dir="ar"===m.context.dataset.metas.language?"rtl":"ltr");l.appendChild(f)}return n},E=function(e){var t=y[0].getElementsByClassName("record-"+e)[0];t&&t.parentNode.removeChild(t)},L=function(e){var t;return angular.forEach(e.classList,function(e){e.startsWith("record-")&&(t=parseInt(e.substr(7),10))}),t},O=function(){var e=p[0].offsetHeight,t=p[0].scrollTop,a=h.find("tr").eq(1).height(),n=y.find(".js-placeholder-top")[0],r=y.find(".js-placeholder-bottom")[0];S=a?(A=Math.max(Math.floor((t-100*a)/a),0),Math.min(Math.ceil((t+e+100*a)/a),m.records.length)):(A=0,m.records.length);var i=0<(A=A&&A%2?A+1:A)-x||0<S-C;if(A!==x||S!==C){var o,s,l,c,d,u;if(n||((o=document.createElement("tr")).className="js-placeholder-top",o.style.height="0px",h[0].appendChild(o),n=y.find(".js-placeholder-top")[0]),r||((o=document.createElement("tr")).className="js-placeholder-bottom",o.style.height="0px",h[0].appendChild(o),r=y.find(".js-placeholder-bottom")[0]),!m.layout.length&&m.records.length){var f=Math.min(m.records.length,m.resultsPerPage);for(d=0;d<f;d++)M(d,m.records,"end")}else if(i){for(d=0;d<A;d++)E(d);for(n.style.height=A*a+"px",d=((l=2<(s=y[c=0].getElementsByTagName("tbody")[0].getElementsByTagName("tr")).length)?L(s[s.length-2]):A)+1;d<S;d++)M(d,m.records,"end"),c++;u=0<(u=l?$(r).height()-c*a:(m.records.length-S)*a)?u:0,r.style.height=u+"px"}else{for(c=0,d=S+1;d<m.records.length;d++)E(d),c++;var g=m.records.length-(S+1);for(g=0<=g?g:0,r.style.height=g*a+"px",d=((l=2<(s=y[c=0].getElementsByTagName("tbody")[0].getElementsByTagName("tr")).length)?L(s[1]):S)-1;A<=d;d--)M(d,m.records,"begin"),c++;u=0<(u=l?$(n).height()-c*a:A*a)?u:0,n.style.height=u+"px"}x=A,C=S}};m.$watchCollection("records",function(e,t){e!==t&&(O(),m.computeLayout(),r||(r=y.find("[infinite-scroll]")),y.height()>r.height()&&m.loadMore())}),m.context.wait().then(function(){if(m.displayedFields?m.displayedFieldsArray=ODS.ArrayUtils.fromCSVString(m.displayedFields):m.context.dataset.extra_metas&&m.context.dataset.extra_metas.visualization&&angular.isArray(m.context.dataset.extra_metas.visualization.table_fields)&&0<m.context.dataset.extra_metas.visualization.table_fields.length?m.displayedFieldsArray=m.context.dataset.extra_metas.visualization.table_fields:m.displayedFieldsArray=null,!m.context.parameters.sort&&m.context.dataset.extra_metas&&m.context.dataset.extra_metas.visualization&&m.context.dataset.extra_metas.visualization.table_default_sort_field){var e=m.context.dataset.extra_metas.visualization.table_default_sort_field;"-"===m.context.dataset.extra_metas.visualization.table_default_sort_direction&&(e="-"+e),m.context.parameters.sort=e}m.displayDatasetFeedback="true"===m.datasetFeedback&&m.context.dataset.getExtraMeta("explore","feedback_enabled"),m.staticSearchOptions={rows:m.resultsPerPage},a.log("table -> dataset watch -> refresh records");var t=v("fieldsForVisualization")(m.context.dataset.fields,"table");_=v("fieldsFilter")(t,m.displayedFieldsArray),D(!0),m.$watch("context.parameters",function(){a.log("table -> searchOptions watch -> refresh records"),m.layout=[],m.working=!0,B(),h.empty(),D(!0)},!0)});var T,P,R="rtl"===y.css("direction"),I=$.support.rtlScrollType;R?"reverse"===I?T=function(){i.css({left:p.scrollLeft()})}:"default"===I?T=function(){var e=p[0].scrollWidth-p[0].clientWidth;i.css({left:e-p.scrollLeft()})}:"negative"===I&&(T=function(){i.css({left:-p.scrollLeft()})}):T=function(){i.css({left:-p.scrollLeft()})};var B=function(){S&&(P=p.scrollLeft())},U=function(){P&&(p.scrollLeft(P),P=void 0)},N=0;p.on("scroll",function(){T();var e=Math.max(Math.floor(p[0].scrollTop/h.find("tr").eq(1).height()),0);Math.abs(e-N)<100&&A<e||(N=e,O())});m.computeLayout=function(){var e;if(!m.layout.length&&m.records.length){y.attr("id")||y.attr("id",d),y.hasClass("odswidget-table--embedded")?(e=$(window).height()-y.offset().top,y.height(e)):e=y.height();var t=0;m.displayDatasetFeedback&&(t=y.find(".table-feedback-new").height()+5);var a=y.find(".odswidget-table__header").height()||y.find(".odswidget-table__internal-table-header").height();p.height(e-a-t);var n=document.getElementById(u);n&&n.parentNode&&n.parentNode.removeChild(n),y.find(".odswidget-table__internal-header-table-header").hide().attr("role","representation"),y.find(".odswidget-table__internal-table-header").show().removeAttr("role");angular.forEach(y.find(".odswidget-table__internal-table-header .odswidget-table__cell-container"),function(e,t){m.layout[t]=$(e).width()+8,m.layout[t]}),m.layout[0]=30;var r=document.createElement("style"),i=function(e,t){for(var a="",n=0;n<m.layout.length;n++){var r=n+1,i=t?"max-width: none; ":"";a+="#"+e+" .odswidget-table__header tr th:nth-child("+r+") > div, #"+e+" .odswidget-table__records tr td:nth-child("+r+") > div { width: "+m.layout[n]+"px; "+i+"} "}return a}(d,!1);r.id=u,r.type="text/css",r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i)),y[0].appendChild(r),y.find(".odswidget-table__internal-table-header").hide().attr("role","representation"),y.find(".odswidget-table__internal-header-table-header").show().removeAttr("role")}m.layout.length&&(m.working=!1)}}],link:function(e,t,a,n){var r=n[0]||n[1];angular.isDefined(r)&&null!==r&&(r.onResize=function(){e.layout=[],e.computeLayout()})}}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsTagCloud",["ODSAPI","$location",function(e,t){function h(e,t){var a=$.grep(e,function(e){return e.count>=t}),n=$.grep(e,function(e){return e.count<=t}),r=[{count:a.length,min:a[a.length-1].count,max:a[0].count},{count:n.length,min:n[n.length-1].count,max:n[0].count}];return r[0].delta=r[0].max-r[0].min,r[1].delta=r[1].max-r[1].min,r}return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-tag-cloud">    <ul class="odswidget-tag-cloud__tag-list">        <li class="odswidget-tag-cloud__no-data-label" ng-hide="tags" translate>No data available yet</li>        <li ng-repeat="tag in tags"             class="odswidget-tag-cloud__tag"             ng-class="{\'odswidget-tag-cloud__tag--selected\': tag.selected}"            ng-style="{\'font-size\': tag.size + \'em\', \'opacity\': tag.opacity}">            <a ng-click="refine(tag.name)" href="">                {{ tag.name }}            </a>        </li>    </ul></div>',scope:{context:"=",facetName:"@",max:"@?",redirectTo:"@?",contextToRefine:"=?"},controller:["$scope",function(p){var t=e.uniqueCall(e.records.search),a=e.uniqueCall(e.datasets.search);p.refine=function(e){if(p.redirectTo){var t="refine."+p.facetName+"="+e,a=-1<p.redirectTo.indexOf("?")?"&":"?";window.location=p.redirectTo+a+t}else p.contextToRefine?p.contextToRefine.toggleRefine(p.facetName,e):p.context.toggleRefine(p.facetName,e)};var n=function(){var e={rows:0,facet:p.facetName};("catalog"===p.context.type?a(p.context,e):(e=$.extend({},p.context.parameters,e),t(p.context,e))).success(function(e){if(e.facet_groups){p.tags=e.facet_groups[0].facets,p.max&&(p.tags=p.tags.slice(0,p.max));for(var t=(f=p.tags,g=Math.floor(f.length/2),f.length%2?f[g].count:(f[g-1].count+f[g].count)/2),a=0;a<p.tags.length;a++)p.tags[a]=(s=p.tags[a],l=t,c=h(p.tags,t),p.context.domainUrl,d=void 0,u=(s.count>=l?c[0].delta:c[1].delta)/2,d=s.count>=2*u?1:s.count>=u&&s.count<2*u?2:3,d=s.count>=l?d:d+3,(s={count:s.count,name:s.name,opacity:((7-d+4)/10+.05).toFixed(2),size:((7-d)/3).toFixed(1),weight:d}).size=6!==d?s.size:parseFloat(s.size)+.3,s),p.tags[a].selected=(n=p.contextToRefine?p.contextToRefine:p.context,r=p.facetName,i=p.tags[a].name,o=void 0,o=n.parameters["refine."+r],angular.isDefined(o)&&(angular.isArray(o)&&-1<o.indexOf(i)||o===i));p.tags=function(e){for(var t=e.length-1;0<t;t--){var a=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[a],e[a]=n}return e}(p.tags)}var n,r,i,o,s,l,c,d,u,f,g})};p.$watch("context",function(e,t){("catalog"===p.context.type||"dataset"===p.context.type&&p.context.dataset)&&n()},!0)}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsTextSearch",["QueryParameters",function(e){var t=e;return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-text-search">   <form ng-submit="applySearch()" class="odswidget-text-search__form">       <input class="odswidget-text-search__search-box" name="q" type="text"                ng-model="searchExpression"                aria-label="{{ translatedPlaceholder }}"                placeholder="{{ translatedPlaceholder }}">        <button type="reset" class="odswidget-text-search__reset" ng-show="searchExpression" ng-click="resetSearch()" aria-label="Reset search" translate="aria-label">           <i class="fa fa-times-circle" aria-hidden="true"></i>       </button>       <button type="submit" class="odswidget-text-search__submit" aria-label="Search in catalog" translate="aria-label">           <i class="fa fa-search" aria-hidden="true"></i>       </button>    </form></div>',scope:{placeholder:"@?",button:"@?",context:"=",field:"@?",suffix:"@?"},link:function(e,t,a){"autofocus"in a&&$(t).find("input").focus()},controller:["$scope","$attrs","translate",function(i,n,a){var o=[],r={};if(angular.isArray(i.context)?o=i.context:o.push(i.context),i.suffix&&-1!==t.indexOf("q."+i.suffix))throw"The "+i.suffix+" suffix is reserved and cannot be used for text-search";var s=function(e,t){var a=l(e),n=c(a),r=e.parameters[n];if(r){var i=r.match(/([\w-_]+):\s?"(.*)"/);return i&&a.field===i[1]?i[2]:t?r:void 0}},l=function(e){return r[e.name]},c=function(e){return e.parameter},d=i.$watch("context",function(e,t){e&&(angular.isArray(e)||(e=[e]),angular.forEach(o,function(e){var t=n[e.name+"Field"]||i.field,a="q";i.suffix&&(a+="."+i.suffix),r[e.name]={field:t,parameter:a}}),angular.forEach(e,function(e){i.searchExpression=i.searchExpression||s(e)}),i.searchExpression||angular.forEach(e,function(e){var t=l(e),a=c(t);i.searchExpression=i.searchExpression||e.parameters[a]}),d(),i.$watch(function(){return o.map(function(e){var t=l(e),a=c(t);return e.parameters[a]})},function(e,t){if(!angular.equals(e,t)){for(var a=!0,n=s(o[0],!0),r=1;r<o.length;r++){if(n!=s(o[r],!0)){a=!1;break}}a&&(i.searchExpression=n)}},!0))}),u=i.$watch("placeholder",function(e,t){e&&(i.translatedPlaceholder=a(i.placeholder),u())});i.resetSearch=function(){angular.forEach(o,function(e){var t=l(e),a=c(t);delete e.parameters[a]})},i.applySearch=function(){angular.forEach(o,function(e){var t=l(e),a=c(t);t.field&&i.searchExpression?e.parameters[a]=t.field+':"'+i.searchExpression+'"':e.parameters[a]=i.searchExpression})}}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsThemeBoxes",function(){return{restrict:"E",replace:!1,template:'<div class="odswidget odswidget-theme-boxes">   <div ng-repeat="item in items" class="odswidget-theme-boxes__box" ods-facet-results="items" ods-facet-results-context="context" ods-facet-results-facet-name="theme">       <a ng-href="{{context.domainUrl}}/explore/?refine.theme={{encode(item.path)}}" target="_self" translate="ods-tooltip" translate-n="item.count" translate-plural="{{item.name}} ({{$count}} datasets)" ods-tooltip="{{item.name}} ({{$count}} dataset)" ods-tooltip-direction="bottom" style="display: block;">           <ods-theme-picto class="odswidget-theme-boxes__picto" theme="{{item.name}}"></ods-theme-picto>       </a>   </div></div>',scope:{context:"="},controller:["$scope",function(e){e.encode=encodeURIComponent}]}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsTimerange",["ModuleLazyLoader","translate","odsTimerangeParser",function(u,f,g){var p={styles:{container:"rd-container odswidgets-rd-container"},weekStart:1},h=function(e){return"yesterday"===e?moment().subtract("days",1):"now"===e?moment():angular.isString(e)?moment(e):null},m=function(e){return e?moment(e).milliseconds(0).toISOString().replace(".000Z","Z"):null},y=function(e,t,a,n){return"string"==typeof e&&(e=moment(e,t)),"false"!==a&&!1!==a||("from"===n&&(e.milliseconds(0),-1===t.indexOf("H")&&-1===t.indexOf("h")&&-1===t.indexOf("LLL")&&-1===t.indexOf("LT")&&e.hours(0),-1===t.indexOf("m")&&-1===t.indexOf("LLL")&&-1===t.indexOf("LT")&&e.minutes(0),-1===t.indexOf("s")&&-1===t.indexOf("LTS")&&e.seconds(0)),"to"===n&&(e.milliseconds(999),-1===t.indexOf("H")&&-1===t.indexOf("h")&&-1===t.indexOf("LLL")&&-1===t.indexOf("LT")&&e.hours(23),-1===t.indexOf("m")&&-1===t.indexOf("LLL")&&-1===t.indexOf("LT")&&e.minutes(59),-1===t.indexOf("s")&&-1===t.indexOf("LTS")&&e.seconds(59))),e};return{restrict:"E",replace:!0,scope:{context:"=",timeField:"@?",defaultFrom:"@?",defaultTo:"@?",displayTime:"@?",dateFormat:"@?",suffix:"@?",to:"=?",from:"=?",labelFrom:"@?",labelTo:"@?",placeholderFrom:"@?",placeholderTo:"@?"},template:'<div class="odswidget odswidget-timerange">    <div class="odswidget-timerange__from">        <span class="odswidget-timerange__label" ng-bind="labelFrom"></span>        <input type="text" placeholder="{{ placeholderFrom }}" class="odswidget-timerange__input">        <button type="reset" class="odswidget-timerange__reset" ng-show="from" ng-click="resetSearchFrom()" aria-label="Reset search" translate="aria-label">           <i class="fa fa-times-circle" aria-hidden="true"></i>        </button>    </div>    <div class="odswidget-timerange__to">        <span class="odswidget-timerange__label" ng-bind="labelTo"></span>        <input type="text" placeholder="{{ placeholderTo }}" class="odswidget-timerange__input">        <button type="reset" class="odswidget-timerange__reset" ng-show="to" ng-click="resetSearchTo()" aria-label="Reset search" translate="aria-label">           <i class="fa fa-times-circle" aria-hidden="true"></i>        </button>    </div></div>',link:function(r,e,a){var n=angular.isUndefined(r.suffix)?"":"."+r.suffix;r.labelFrom=angular.isDefined(r.labelFrom)?r.labelFrom:f("From"),r.labelTo=angular.isDefined(r.labelTo)?r.labelTo:f("to");var i=e.find("input"),t="YYYY-MM-DD HH:mm";angular.isDefined(r.displayTime)&&"false"===r.displayTime&&(t="YYYY-MM-DD"),r.dateFormat=r.dateFormat||t;var o,s=function(e){var t=a[e.name+"ParameterName"]||"q";return-1<["q","rq"].indexOf(t)&&(t=t+".timerange"+n),t};if(o=angular.isArray(r.context)?r.context[0].parameters[s(r.context[0])]:r.context.parameters[s(r.context)],angular.isDefined(o)){var l=g(o);l.field===r.timeField&&(r.defaultFrom=l.from,r.defaultTo=l.to)}if(angular.isDefined(r.defaultFrom)){var c=y(h(r.defaultFrom),r.dateFormat,r.displayTime,"from");i[0].value=c.format(r.dateFormat),r.from=m(c)}if(angular.isDefined(r.defaultTo)){var d=y(h(r.defaultTo),r.dateFormat,r.displayTime,"to");i[1].value=d.format(r.dateFormat),r.to=m(d)}u("rome").then(function(){void 0===r.displayTime?r.displayTime=!0:r.displayTime="true"===r.displayTime;var a=rome(i[0],angular.extend({},p,{time:r.displayTime,dateValidator:rome.val.beforeEq(i[1]),initialValue:r.defaultFrom,inputFormat:r.dateFormat}));a.on("data",function(t){r.$applyAsync(function(){var e=y(moment(t,r.dateFormat),r.dateFormat,r.displayTime,"from");$(i[0]).val(e.format(r.dateFormat)),a.setValue(e),r.from=m(e)})});var n=rome(i[1],angular.extend({},p,{time:r.displayTime,dateValidator:rome.val.afterEq(i[0]),initialValue:r.defaultTo,inputFormat:r.dateFormat}));n.on("data",function(t){r.$applyAsync(function(){var e=y(moment(t,r.dateFormat),r.dateFormat,r.displayTime,"to");n.setValue(e),r.to=m(e)})});r.$watch(function(){var a=!0,e=angular.isArray(r.context)?r.context:[r.context];return angular.forEach(e,function(e){angular.forEach(e.parameters,function(e,t){-1===t.indexOf("from_date")&&-1===t.indexOf("timerange")||(a=!1)})}),a},function(e,t){e&&!t&&r.resetSearchFrom()},!0),r.$watch(function(){var a=!0,e=angular.isArray(r.context)?r.context:[r.context];return angular.forEach(e,function(e){angular.forEach(e.parameters,function(e,t){-1===t.indexOf("to_date")&&-1===t.indexOf("timerange")||(a=!1)})}),a},function(e,t){e&&!t&&r.resetSearchTo()},!0),r.resetSearchFrom=function(){i[0].value=null,r.from=void 0},r.resetSearchTo=function(){i[1].value=null,r.to=void 0}})},controller:["$scope","$attrs","$q","$compile","$rootScope","$parse",function(i,t,e,a,n,r){var o=[],s={},l=angular.isUndefined(i.suffix)?"":"."+i.suffix;angular.isArray(i.context)?o=i.context:(o.push(i.context),s[i.context.name]={},i.timeField&&(s[i.context.name].timeField=i.timeField)),angular.forEach(o,function(e){s[e.name]={timefield:s[i.context.name]&&s[i.context.name].timeField?s[i.context.name].timeField:null,formatter:r("$field + ':[' + $from + ' TO ' + $to + ']'"),parameter:"q"},angular.isDefined(t[e.name+"ParameterFormatter"])&&(s[e.name].formatter=r(t[e.name+"ParameterFormatter"])),angular.isDefined(t[e.name+"ParameterName"])&&(s[e.name].parameter=t[e.name+"ParameterName"]),angular.isDefined(t[e.name+"TimeField"])&&(s[e.name].timefield=t[e.name+"TimeField"])});var c=function(e,n){var r;i.$watch("[from, to]",function(t){t[0]&&t[1]?(r=["from_date","to_date"],angular.forEach(e,function(e){var t=n[e.name].parameter,a={};a.$to=i.to,a.$from=i.from,a.$field=n[e.name].timefield,-1<["q","rq"].indexOf(t)&&(t=t+".timerange"+l),e.parameters[t]=n[e.name].formatter(a),d(e,n,r)})):t[0]&&!t[1]?(r=["to_date","timerange"],angular.forEach(e,function(e){e.parameters[u(e,n,"from_date")]=n[e.name].timefield+'>="'+t[0]+'"',d(e,n,r)})):t[1]&&!t[0]?(r=["from_date","timerange"],angular.forEach(e,function(e){e.parameters[u(e,n,"to_date")]=n[e.name].timefield+'<="'+t[1]+'"',d(e,n,r)})):(r=["from_date","to_date","timerange"],angular.forEach(e,function(e){d(e,n,r)}))},!0)},d=function(t,a,e){angular.forEach(e,function(e){t.parameters[u(t,a,e)]&&delete t.parameters[u(t,a,e)]})},u=function(e,t,a){return t[e.name].parameter+"."+a+l};1==o.length&&"catalog"==o[0].type?c(o,s):e.all(o.map(function(t){return t.wait().then(function(e){null===s[t.name].timefield&&(s[t.name].timefield=function(e){if(e){var t=e.fields.filter(function(e){return"date"===e.type||"datetime"===e.type});return 1<t.length&&console.log('Warning: the dataset "'+e.getUniqueId()+'" has more than one date or datetime field, the first date or datetime field will be used. You can specify the field to use using the "time-field" parameter.'),0===t.length&&console.log('Error: the dataset "'+e.getUniqueId()+"\" doesn't have any date or datetime field, which is required for the Timerange widget."),t[0].name}return null}(e))})})).then(function(){c(o,s)})}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsTimescale",function(){return{restrict:"E",replace:!0,scope:{context:"=",timeField:"@",defaultValue:"@"},template:'<div class="odswidget odswidget-timescale">   <ul class="odswidget-timescale__scale-list">       <li class="odswidget-timescale__scale" ng-class="{\'odswidget-timescale__scale--active\': scale == \'everything\' || !scale}"> <a class="odswidget-timescale__scale-link" href="#" ng-click="scale = \'everything\'; $event.preventDefault();" translate>Everything</a></li>       <li class="odswidget-timescale__scale" ng-class="{\'odswidget-timescale__scale--active\': scale == \'year\'}">                 <a class="odswidget-timescale__scale-link" href="#" ng-click="scale = \'year\'; $event.preventDefault();" translate>Last 12 months</a></li>       <li class="odswidget-timescale__scale" ng-class="{\'odswidget-timescale__scale--active\': scale == \'month\'}">                <a class="odswidget-timescale__scale-link" href="#" ng-click="scale = \'month\'; $event.preventDefault();" translate>Last 4 weeks</a></li>       <li class="odswidget-timescale__scale" ng-class="{\'odswidget-timescale__scale--active\': scale == \'week\'}">                 <a class="odswidget-timescale__scale-link" href="#" ng-click="scale = \'week\'; $event.preventDefault();" translate>Last 7 days</a></li>       <li class="odswidget-timescale__scale" ng-class="{\'odswidget-timescale__scale--active\': scale == \'day\'}">                  <a class="odswidget-timescale__scale-link" href="#" ng-click="scale = \'day\'; $event.preventDefault();" translate>Last 24 hours</a></li>   </ul></div>',controller:["$scope","$attrs","$q",function(r,a,e){var t=[],n={},i="q.timescale";angular.isArray(r.context)?t=r.context:t.push(r.context),e.all(t.map(function(t){return t.wait().then(function(e){angular.isDefined(a[t.name+"TimeField"])?n[t.dataset.getUniqueId()]=a[t.name+"TimeField"]:r.timeField?n[t.dataset.getUniqueId()]=r.timeField:function(e){if(e){var t=e.fields.filter(function(e){return"date"===e.type||"datetime"===e.type});1<t.length&&console.log('Warning: the dataset "'+e.getUniqueId()+'" has more than one date or datetime field, the first date or datetime field will be used. You can specify the field to use using the "time-field" parameter.'),0===t.length&&console.log('Error: the dataset "'+e.getUniqueId()+"\" doesn't have any date or datetime field, which is required for the Timerange widget."),n[e.getUniqueId()]=t[0].name}}(e)})})).then(function(){o(t,n);r.$watch(function(){return t.reduce(function(e,t){return e&&!t.parameters[i]},!0)},function(e,t){e&&!t&&(r.scale="everything")},!0)});var o=function(a,n){r.scale=r.defaultValue||"everything",r.$watch("scale",function(e){if("everything"!==e){var t=null;"day"===e?t="#now(days=-1)":"week"===e?t="#now(weeks=-1)":"month"===e?t="#now(weeks=-4)":"year"===e&&(t="#now(years=-1)"),angular.forEach(a,function(e){e.parameters[i]=n[e.dataset.getUniqueId()]+">="+t})}else angular.forEach(a,function(e){delete e.parameters[i]})},!0)}}]}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsToggleModel",function(){var r=function(e,t){"string"==typeof e[t]&&(e[t]=e[t].split(","))},i=function(e,t,a){"csv"==a&&angular.isArray(e[t])&&(e[t]=e[t].join(","))};return{restrict:"A",scope:{odsToggleModel:"=",odsToggleKey:"@",odsToggleValue:"@",odsStoreAs:"@?"},link:function(n,t,e){angular.isDefined(n.odsStoreAs)&&-1!=["array","csv"].indexOf(n.odsStoreAs)||(n.odsStoreAs="array"),t.on("change",function(e){e.currentTarget.checked?n.$apply(function(){var e,t,a;r(n.odsToggleModel,n.odsToggleKey),e=n.odsToggleModel,t=n.odsToggleKey,a=n.odsToggleValue,e[t]?angular.isArray(e[t])?e[t].indexOf(a)<0&&e[t].push(a):angular.equals(e[t],a)||(e[t]=[e[t],a]):e[t]=a,i(n.odsToggleModel,n.odsToggleKey,n.odsStoreAs)}):n.$apply(function(){var e,t,a;r(n.odsToggleModel,n.odsToggleKey),e=n.odsToggleModel,t=n.odsToggleKey,a=n.odsToggleValue,e[t]&&(angular.isArray(e[t])?0<=e[t].indexOf(a)&&(1===e[t].length?delete e[t]:e[t].splice(e[t].indexOf(a),1)):angular.equals(e[t],a)&&delete e[t]),i(n.odsToggleModel,n.odsToggleKey,n.odsStoreAs)})}),n.$watch("odsToggleModel[odsToggleKey]",function(e){e?angular.isArray(e)&&0<=e.indexOf(n.odsToggleValue)||!angular.isArray(e)&&0<=e.split(",").indexOf(n.odsToggleValue)?t.prop("checked",!0):angular.equals(e,n.odsToggleValue)?t.prop("checked",!0):t.prop("checked",!1):t.prop("checked",!1)},!0)}}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsTopPublishers",["ODSAPI",function(a){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-top-publishers"><ul class="odswidget-top-publishers__publishers">   <li class="no-data" ng-hide="publishers" translate>No data available yet</li>   <li class="odswidget-top-publishers__publisher" ng-repeat="publisher in publishers" ng-if="publishers">       <div class="odswidget-top-publishers__publisher-details">           <div class="odswidget-top-publishers__publisher-details-name"><a ng-href="{{ context.domainUrl }}/explore/?refine.publisher={{ publisher.path }}" target="_self">{{ publisher.name }}</a></div>           <div class="odswidget-top-publishers__publisher-details-count"><i class="fa fa-table" aria-hidden="true"></i> <span translate translate-n="publisher.count" translate-plural="Used by {{$count}} datasets">Used by {{$count}} dataset</span></div>       </div>   </li></ul></div>',scope:{context:"="},controller:["$scope",function(t){var e=a.uniqueCall(a.datasets.search);t.$watch("context",function(){e(t.context,"publisher").success(function(e){t.publishers=e.facet_groups[0].facets.slice(0,5)})})}]}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsTwitterTimeline",function(){return{restrict:"E",replace:!0,template:'<div class="odswidget"></div>',scope:{widgetId:"@"},link:function(e,t,a){var n='<a class="twitter-timeline"    href="https://twitter.com/twitterapi"    data-widget-id="'+a.widgetId+'"';a.height&&(n+='   height="'+a.height+'"'),a.width&&(n+='   width="'+a.width+'"'),n+='   >Tweets</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");<\/script>',t.append(n)}}})}(),function(){"use strict";var e=angular.module("ods-widgets");e.directive("inject",function(){return{link:function(e,a,t,n,r){var i=e.$new();r?r(i,function(e){var t=e.clone();t.contents().wrapAll("<div>"),0<t.contents().length&&0<t.contents().html().trim().length&&(a.empty(),a.append(e),a.on("$destroy",function(){i.$destroy()}))}):console.warn("inject directive used on an element with no transcluded directives",a)}}}),e.directive("odsFullClick",function(){return{restrict:"A",link:function(e,n,t){t.odsFullClick&&n.find("[ods-main-click]").attr("href",t.odsFullClick),n.click(function(e){if(!$(e.target).is("a,button,[ng-click]")&&0===$(e.target).parents("a,button,[ng-click]").length&&n.find("[ods-main-click]").length)if(document.createEvent){var t=document.createEvent("MouseEvents"),a=e.originalEvent;t.initMouseEvent(a.type,a.bubbles,a.cancelable,window,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget),n.find("[ods-main-click]")[0].dispatchEvent(t)}else document.createEventObject&&(window.location=n.find("[ods-main-click]")[0].href)})}}})}(),function(){"use strict";var e=angular.module("ods-widgets"),c=function(e,t,a){return e.$parent.$eval(t[(n=a,"_serie"===n?"values":"values"+ODS.StringUtils.capitalize(n))]);var n};e.directive("odsVegaLiteChart",["ModuleLazyLoader",function(e){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-vega-lite-chart">   <div class="vega-chart"></div></div>',scope:{spec:"="},link:function(n,r,i){var o,s=function(e){var t,a=[];if(e.hasOwnProperty("data"))e.data.name&&a.push(e.data.name);else if(e.hasOwnProperty("vconcat"))for(t=0;t<e.vconcat.length;t++)e.vconcat[t].data.name&&a.push(e.vconcat[t].data.name);else if(e.hasOwnProperty("hconcat"))for(t=0;t<e.hconcat.length;t++)e.hconcat[t].data.name&&a.push(e.hconcat[t].data.name);else a=["_serie"];return a}(n.spec),l=function(e,t){var a=vega.changeset().remove(function(e){return!0}).insert(t);o.change(e,a).resize().run()};n.$on("$destroy",function(){o&&o.finalize()}),e("vega").then(function(){var t=n.$watch("spec",function(e){e&&(t(),function(){var e=n.spec;!e.data&&angular.equals(s,["_serie"])&&(e.data={name:"_serie",values:[]}),e=vl.compile(e).spec;var t=vega.parse(e),a=new vegaTooltip.Handler;o=new vega.View(t).renderer("canvas").tooltip(a.call).initialize(r.find(".vega-chart")[0]).hover().run()}(),angular.forEach(s,function(a){n.$watch(function(){return c(n,i,a)},function(e,t){l(a,e||[])})}))})})}}}])}(),function(){"use strict";angular.module("ods-widgets").directive("odsWidgetTooltip",["$rootScope","$compile",function(d,u){return{restrict:"A",priority:100,transclude:!0,controller:["$scope","$element","$attrs","$transclude",function(e,t,a,r){var i,o,s,l,c=this;this.configure=function(e){i=e.defaultTemplate||"",o=e.displayedFields||[],s=e.fields||[],l=e.context||{}},this.render=function(e,t,a){var n=d.$new(!0);return n.record=angular.copy(e),n.displayedFields=angular.copy(o),n.fields=angular.copy(s),n.context=angular.copy(l),a&&(n.displayedFields=n.displayedFields.filter(function(e){return a!==e.name})),angular.merge(n,t||{}),i||r(d.$new(!0),function(e,t){i=0<e.length?e:c.defaultTemplate}),u(i)(n)}}]}}])}();